// Переменные используются для передачи данных из ПроверитьПоказатели()
// чтобы не дублировать формирование информации при выгрузке.
&НаСервере
Перем ПараметрыВыгрузки, ДеревоВыгрузки;

&НаСервере
Перем мОбъектОтчета;

&НаСервере
Перем ДанныеОПТЗ_Р1; // Данные обособленных подразделений Раздела 1.
&НаСервере
Перем ДанныеПроизводителейРаздел_Р1; // Данные производителей Раздела 1.

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	// Обход ошибки платформы Параметр сеанса отсутствует или удален
	ТабличныйДокумент.Очистить();
	
	СформироватьСтруктуруРеквизитовФормы();
	
	СтруктураРеквизитовФормы.СписокПечатаемыхЛистов = Новый СписокЗначений;
	
	СтруктураРеквизитовФормы.мСоставПоказателей = "СоставПоказателей2012Кв3";
	                                     	
	СтруктураРеквизитовФормы.мОписаниеТиповЧислоЕ = Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(14, 2));
	
	МассивБулево = Новый Массив;
	МассивБулево.Добавить(Тип("Булево"));
	СтруктураРеквизитовФормы.мОписаниеТиповБулево = Новый ОписаниеТипов(МассивБулево);
	
	// ОПИСАНИЕ ПАРАМЕТРОВ МНОГОСТРОЧНЫХ ГРУПП
	// Идентификаторы многострочных групп
	
	СтруктураРеквизитовФормы.мИдГруппы11 = "П0000100001"; 
	СтруктураРеквизитовФормы.мИдГруппы12 = "П0000100003"; 
	СтруктураРеквизитовФормы.мИдГруппы21 = "П0000200001"; 
	СтруктураРеквизитовФормы.мИдГруппы22 = "П0000200003"; 
	
	// количество строк многострочных разделов по "бумажной" форме отчета
	// (минимальное количество строк, которое должно присутствовать всегда)
	КолИсхСтрокИдГруппы11 = 1;
	КолИсхСтрокИдГруппы12 = 1;
	КолИсхСтрокИдГруппы21 = 1;
	КолИсхСтрокИдГруппы22 = 1;
	
	КолКолонокИдГруппы11 = 19;
	КолКолонокИдГруппы12 = 19;
	КолКолонокИдГруппы21 = 13;
	КолКолонокИдГруппы22 = 13;
	
	СтруктураДанныхТитульный = Новый Структура;
	                        	
	// структура многострочных разделов формы
	мСтруктураМногострочныхРазделов = Новый Структура;
	мСтруктураМногострочныхРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы11, СтруктураРеквизитовФормы.мИдГруппы11);
	мСтруктураМногострочныхРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы12, СтруктураРеквизитовФормы.мИдГруппы12);
	мСтруктураМногострочныхРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы21, СтруктураРеквизитовФормы.мИдГруппы21);
	мСтруктураМногострочныхРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы22, СтруктураРеквизитовФормы.мИдГруппы22);
	
	// структура исходных строк (минимального кол-ва) многострочных разделов формы
	мСтруктураИсхКолвоСтрокРазделов = Новый Структура;
	мСтруктураИсхКолвоСтрокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы11, КолИсхСтрокИдГруппы11);
	мСтруктураИсхКолвоСтрокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы12, КолИсхСтрокИдГруппы12);
	мСтруктураИсхКолвоСтрокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы21, КолИсхСтрокИдГруппы21);
	мСтруктураИсхКолвоСтрокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы22, КолИсхСтрокИдГруппы22);
	
	мСтруктураКолвоКолонокРазделов = Новый Структура;
	мСтруктураКолвоКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы11, КолКолонокИдГруппы11);
	мСтруктураКолвоКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы12, КолКолонокИдГруппы12);
	мСтруктураКолвоКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы21, КолКолонокИдГруппы21);
	мСтруктураКолвоКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы22, КолКолонокИдГруппы22);
	
	мСтруктураИменаКолонокРазделов = Новый Структура;
	мСтруктураИменаКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы11,    Новый СписокЗначений);
	мСтруктураИменаКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы12,    Новый СписокЗначений);
	мСтруктураИменаКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы21,    Новый СписокЗначений);
	мСтруктураИменаКолонокРазделов.Вставить(СтруктураРеквизитовФормы.мИдГруппы22,    Новый СписокЗначений);

	ИнициализацияМногостраничныхРазделов();
	
	мСтруктураМногостраничныхРазделов = Новый Структура;
	мСтруктураМногостраничныхРазделов.Вставить("Лицензии",   "ТаблицаСтраницыЛицензии");
	мСтруктураМногостраничныхРазделов.Вставить("Раздел1",   "ТаблицаСтраницыРаздел1");
	мСтруктураМногостраничныхРазделов.Вставить("Раздел2",   "ТаблицаСтраницыРаздел2");
	
	СтруктураРеквизитовФормы.мСоответствияМнгЧ = Новый Соответствие;
	СтруктураРеквизитовФормы.мСоответствияМнгЧ.Вставить(СтруктураРеквизитовФормы.мИдГруппы11, "МногострочнаяЧасть1");
	СтруктураРеквизитовФормы.мСоответствияМнгЧ.Вставить(СтруктураРеквизитовФормы.мИдГруппы12, "МногострочнаяЧасть2");
	СтруктураРеквизитовФормы.мСоответствияМнгЧ.Вставить(СтруктураРеквизитовФормы.мИдГруппы21, "МногострочнаяЧасть1");
	СтруктураРеквизитовФормы.мСоответствияМнгЧ.Вставить(СтруктураРеквизитовФормы.мИдГруппы22, "МногострочнаяЧасть2");
		
	ЦветЗаполняетсяТолькоВручную     = Новый Цвет(255, 255, 225);
	ЦветЗаполняетсяАвтоКорректир     = Новый Цвет(255, 240, 200);
	ЦветЗаполняетсяАвтоБезКорректир  = Новый Цвет(230, 240, 220);
	ЦветЗаполняетсяАвтоАрифметика    = Новый Цвет(192, 220, 192);  // ЗЕЛЕНЫЙ
	ЦветЗаполняетсяОднозначноВручную = Новый Цвет(255, 255, 192);  // ЖЕЛТЫЙ
	ЦветЗаполняетсяАвтоматически     = Новый Цвет(255, 255, 255);  // Белый, Ввод запрещен
	
	// структура цветов раскраски автозаполняемых ячеек
	мСтруктураЦветовРаскраски = Новый Структура;
	мСтруктураЦветовРаскраски.Вставить("_1", ЦветЗаполняетсяТолькоВручную);
	мСтруктураЦветовРаскраски.Вставить("_2", ЦветЗаполняетсяАвтоКорректир);
	мСтруктураЦветовРаскраски.Вставить("_3", ЦветЗаполняетсяАвтоБезКорректир);
	мСтруктураЦветовРаскраски.Вставить("_4", ЦветЗаполняетсяАвтоАрифметика);
	мСтруктураЦветовРаскраски.Вставить("_0", ЦветЗаполняетсяОднозначноВручную);
	мСтруктураЦветовРаскраски.Вставить("_5", ЦветЗаполняетсяАвтоматически);
	
	мСтруктураВариантыЗаполнения       = Новый Структура;
	мСтруктураВариантыЗаполненияЭталон = Новый Структура;
	
	//// ОПИСАНИЕ ПАРАМЕТРОВ ФОРМЫ ОТЧЕТА
	//
	// Версия формы
	СтруктураРеквизитовФормы.мВерсияФормы = "13/09/2012"; // Первый вариант
	
	СтруктураРеквизитовФормы.КНД = "";
	СтруктураРеквизитовФормы.НаименованиеОтчетаДляВыгрузки = "";
	
	СтруктураРеквизитовФормы.мПечатныеформы = Новый СписокЗначений;
	СтруктураРеквизитовФормы.мПечатаемыеРазделы = Новый СписокЗначений;
	
	ИмяРаздела = "Титульный";
		
	СтруктураРеквизитовФормы.НаимТекущегоРаздела = ИмяРаздела;
	
	СтруктураРеквизитовФормы.мВыбраннаяФорма          = Параметры.мВыбраннаяФорма;
	СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета  = Параметры.мДатаКонцаПериодаОтчета;
	СтруктураРеквизитовФормы.мДатаНачалаПериодаОтчета = Параметры.мДатаНачалаПериодаОтчета;
	СтруктураРеквизитовФормы.мПериодичность           = Параметры.мПериодичность;
	СтруктураРеквизитовФормы.мСкопированаФорма        = Параметры.мСкопированаФорма;
	СтруктураРеквизитовФормы.мСохраненныйДок          = Параметры.мСохраненныйДок;
	СтруктураРеквизитовФормы.Организация              = Параметры.Организация;
	СтруктураРеквизитовФормы.СформироватьФормуОтчетаАвтоматически = Параметры.СформироватьФормуОтчетаАвтоматически;
	
	ТабличныйДокумент.Вывести(ПолучитьМакетФормыОтчета(ИмяРаздела));
	
	ДатаПодписи	= ТекущаяДатаСеанса();
	
	СтруктураРеквизитовФормы.СправочникиВидыКонтактнойИнформацииФактАдресОрганизации = Справочники.ВидыКонтактнойИнформации.ФактАдресОрганизации;
	
	Инициализация(Параметры.БезОткрытияФормы);
	
	РегламентированнаяОтчетностьПереопределяемый.ПриСозданииФормыРеглОтчета(
		СтруктураРеквизитовФормы.ИмяОтчета, СтруктураРеквизитовФормы.ИмяФормы, ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура СформироватьСтруктуруРеквизитовФормы()
	
	СтруктураРеквизитовФормы = Новый Структура;
	СтруктураРеквизитовФормы.Вставить("мВыбраннаяФорма");
	СтруктураРеквизитовФормы.Вставить("мСкопированаФорма");
	СтруктураРеквизитовФормы.Вставить("мСохраненныйДок");
	СтруктураРеквизитовФормы.Вставить("мВерсияФормы");
	СтруктураРеквизитовФормы.Вставить("мВерсияФормата");
	СтруктураРеквизитовФормы.Вставить("мСчетчикСтраниц");
	СтруктураРеквизитовФормы.Вставить("мАвтоВыборКодов");
	СтруктураРеквизитовФормы.Вставить("мДатаНачалаПериодаОтчета");
	СтруктураРеквизитовФормы.Вставить("мДатаКонцаПериодаОтчета");
	СтруктураРеквизитовФормы.Вставить("мПериодичность");
	СтруктураРеквизитовФормы.Вставить("мЗаписьЗапрещена");
	СтруктураРеквизитовФормы.Вставить("мЗаписываетсяНовыйДокумент");
	СтруктураРеквизитовФормы.Вставить("мВариант");
	СтруктураРеквизитовФормы.Вставить("мВидДеят");
	СтруктураРеквизитовФормы.Вставить("мИдГруппы11");
	СтруктураРеквизитовФормы.Вставить("мИдГруппы12");
	СтруктураРеквизитовФормы.Вставить("мИдГруппы21");
	СтруктураРеквизитовФормы.Вставить("мИдГруппы22");
	СтруктураРеквизитовФормы.Вставить("мСтрокаФормата");
	СтруктураРеквизитовФормы.Вставить("мОписаниеТиповЧислоЕ");
	СтруктураРеквизитовФормы.Вставить("мСтараяВерсияФормы");
	СтруктураРеквизитовФормы.Вставить("мИННЮЛ");
	СтруктураРеквизитовФормы.Вставить("мКППЮЛ");
	СтруктураРеквизитовФормы.Вставить("мТелОрганизации");
	СтруктураРеквизитовФормы.Вставить("мВПрограммеИзмененаОрганизация");
	СтруктураРеквизитовФормы.Вставить("мПечатныеФормы");
	СтруктураРеквизитовФормы.Вставить("мПечатаемыеРазделы");
	СтруктураРеквизитовФормы.Вставить("мСоставПоказателей");
	СтруктураРеквизитовФормы.Вставить("мДокументВосстановлен");
	СтруктураРеквизитовФормы.Вставить("мРежимПечати");
	СтруктураРеквизитовФормы.Вставить("мОписаниеТиповБулево");
	СтруктураРеквизитовФормы.Вставить("мБезОткрытияФормы");
	СтруктураРеквизитовФормы.Вставить("КНД");
	СтруктураРеквизитовФормы.Вставить("НаименованиеОтчетаДляВыгрузки");
	СтруктураРеквизитовФормы.Вставить("КодНО");
	СтруктураРеквизитовФормы.Вставить("КППТек");
	СтруктураРеквизитовФормы.Вставить("НаимТекущегоРаздела");
	СтруктураРеквизитовФормы.Вставить("Организация");
	СтруктураРеквизитовФормы.Вставить("ВидДокумента");
	СтруктураРеквизитовФормы.Вставить("СтрПериодОтчета");
	СтруктураРеквизитовФормы.Вставить("ФИОИсп");
	СтруктураРеквизитовФормы.Вставить("НаимОрганизации");
	СтруктураРеквизитовФормы.Вставить("ВыводитьСтраницуВТаблДокНаСервере");
	СтруктураРеквизитовФормы.Вставить("ФлажокОтклАвтоРасчет", Ложь);
	СтруктураРеквизитовФормы.Вставить("СправочникиВидыКонтактнойИнформацииФактАдресОрганизации");
	СтруктураРеквизитовФормы.Вставить("СписокПечатаемыхЛистов");
	СтруктураРеквизитовФормы.Вставить("Руководитель");
	СтруктураРеквизитовФормы.Вставить("Бухгалтер");
	СтруктураРеквизитовФормы.Вставить("ИндивидуальныйПредприниматель");
	СтруктураРеквизитовФормы.Вставить("Исполнитель");
	СтруктураРеквизитовФормы.Вставить("ТелОрганизации");
	СтруктураРеквизитовФормы.Вставить("мСоответствияМнгЧ");
	СтруктураРеквизитовФормы.Вставить("ТекущаяСтрокаРазделовОтчета");
	СтруктураРеквизитовФормы.Вставить("ОтображатьКнопкуЗаполнить", Ложь);
	СтруктураРеквизитовФормы.Вставить("ОтображатьКнопкуРасшифровать", Ложь);
	СтруктураРеквизитовФормы.Вставить("АдресВременногоХранилищаРасшифровки");
	СтруктураРеквизитовФормы.Вставить("мСохранятьРасшифровку", Истина);
	СтруктураРеквизитовФормы.Вставить("СформироватьФормуОтчетаАвтоматически");
	СтруктураРеквизитовФормы.Вставить("ИмяОтчета", Сред(Лев(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7));
	СтруктураРеквизитовФормы.Вставить("ИмяФормы", Сред(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, "ФормаОтчета")));
	
КонецПроцедуры

&НаСервере
Процедура ИнициализацияМногостраничныхРазделов()
	
	СтрПерваяСтраница = ТаблицаСтраницыЛицензии.Добавить();
	СтрПерваяСтраница.Представление               = "Новая страница";
	СтрПерваяСтраница.АктивнаяСтраница            = Истина;
	СтрПерваяСтраница.АвтоматическоеПредставление = Истина;
	
	СтрПерваяСтраница = ТаблицаСтраницыРаздел1.Добавить();
	СтрПерваяСтраница.Представление               = "Новая страница";
	СтрПерваяСтраница.АктивнаяСтраница            = Истина;
	СтрПерваяСтраница.АвтоматическоеПредставление = Истина;
	
	СтрПерваяСтраница = ТаблицаСтраницыРаздел2.Добавить();
	СтрПерваяСтраница.Представление               = "Новая страница";
	СтрПерваяСтраница.АктивнаяСтраница            = Истина;
	СтрПерваяСтраница.АвтоматическоеПредставление = Истина;

КонецПроцедуры

&НаСервере
Процедура Инициализация(БезОткрытияФормы = Ложь) Экспорт
	
	СтруктураРеквизитовФормы.мБезОткрытияФормы = БезОткрытияФормы;
	
	ИнициализироватьДополнительныеДанные(ЭтаФорма);

	ЗаполнитьСтруктуруЗависимыхЯчеекДляАвторасчета();
    	
	ЗаполнитьНачальныеНастройки();
	
	ФормироватьСтруктуруСвойствСтраниц();
	
	ЗаполнитьСтруктуруИменКолонокМногострочныхРазделов();

	СтруктураРеквизитовФормы.мРежимПечати = Ложь;

	СтруктураРеквизитовФормы.мАвтоВыборКодов = Ложь;
	
	Если СтруктураРеквизитовФормы.СформироватьФормуОтчетаАвтоматически Тогда
		СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Истина;
	Иначе
		СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Ложь;
	КонецЕсли;
	
	СтруктураРеквизитовФормы.мСтараяВерсияФормы = СтруктураРеквизитовФормы.мВерсияФормы;
	СтруктураРеквизитовФормы.мДокументВосстановлен = Ложь;
	
	СтруктураРеквизитовФормы.ВидДокумента = 0;
	СтруктураРеквизитовФормы.мВидДеят = "";
	
	СформироватьСпискиВыбора();
	
	Если СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Тогда

		НачальныеОперацииСМногострочнымиБлоками();
		
		Если СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено Тогда
			// Документ скопирован.
			ВосстановитьСохраненныеДанные();
		Иначе
			// Это новый документ. Установим реквизиты формы по умолчанию.
			КопироватьДанныеФормы(мДеревоСтраницОтчета, мДеревоВыбранныхСтраниц);
		КонецЕсли;
		
		ЗаполнитьДатуВЯчейкахНаСервере();
		
		Модифицированность = Истина;
		
	Иначе
		
		Если НЕ БезОткрытияФормы Тогда
			НачальныеОперацииСМногострочнымиБлоками();
		КонецЕсли;
		
		// При открытии или при копировании сохраненного
		// отчета восстанавливаем сохраненные данные.
		ВосстановитьСохраненныеДанные();
		
		Если ЗначениеЗаполнено(СтруктураРеквизитовФормы.мСкопированаФорма) Тогда
			СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено;
		КонецЕсли;
		
		Если НЕ БезОткрытияФормы
           И НЕ СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Тогда
				   
        	ЗаблокироватьДанныеДляРедактирования(СтруктураРеквизитовФормы.мСохраненныйДок, , ЭтаФорма.УникальныйИдентификатор);

        КонецЕсли;

	КонецЕсли;
	
	РегламентированнаяОтчетность.ПолучитьСведенияОПоказателяхОтчета(ЭтаФорма);
	
	Если НЕ СтруктураРеквизитовФормы.ОтображатьКнопкуЗаполнить Тогда
		Элементы.Заполнить.Видимость = Ложь;
	КонецЕсли;
	
	Если НЕ СтруктураРеквизитовФормы.ОтображатьКнопкуРасшифровать Тогда
		Элементы.Расшифровать.Видимость = Ложь;
		СтруктураРеквизитовФормы.мСохранятьРасшифровку = Ложь;
		Элементы.ТабличныйДокументКонтекстноеМенюРасшифровать.Видимость = Ложь;
	КонецЕсли;
	
	ПоказатьПериод();
	
	Если СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено
	 Или СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация
	 ИЛИ СтруктураРеквизитовФормы.СформироватьФормуОтчетаАвтоматически Тогда
		
		ЗаполнитьСведенияОбОрганизации();
		
	КонецЕсли;
	
	ТабличныйДокумент.Области.Прил.Маска = "999";
	
	ТабличныйДокумент.Области.НомКорр.Значение      = ?(НомерКорректировки = 0, "0", Формат(НомерКорректировки, "ЧЦ=2; ЧВН="));
	
	ТабличныйДокумент.Области.ДатаПодписи.Значение  = ДатаПодписи;
	
	СформироватьДеревоРазделовОтчетаНаСервере();
	
	СтруктураРеквизитовФормы.НаимОрганизации = СтруктураРеквизитовФормы.Организация.Наименование;
	
	РегламентированнаяОтчетность.ДобавитьКнопкуПрисоединенныеФайлы(ЭтаФорма);
	
	РегламентированнаяОтчетностьКлиентСервер.ПриИнициализацииФормыРегламентированногоОтчета(ЭтаФорма, "ФСРАР");
	
	СтруктураРеквизитовФормы.ВыводитьСтраницуВТаблДокНаСервере = Ложь;
	
	Если СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета < '20131101' Тогда		
		СтруктураРеквизитовФормы.мВерсияФормата = "420";
	ИначеЕсли СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета < '20150901' Тогда
		СтруктураРеквизитовФормы.мВерсияФормата = "430";
	Иначе
		СтруктураРеквизитовФормы.мВерсияФормата = "431";
	КонецЕсли;
	
	Если СтруктураРеквизитовФормы.СформироватьФормуОтчетаАвтоматически Тогда
		ЗаполнитьАвтоНаСервере();
		Если Элементы.Расшифровать.Видимость Тогда
			Элементы.Расшифровать.Доступность = Истина;
			Элементы.ТабличныйДокументКонтекстноеМенюРасшифровать.Доступность = Истина;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ИнициализироватьДополнительныеДанные(Форма)
	
	Если ТипЗнч(Форма.ДополнительныеДанные) <> Тип("Структура") Тогда
		Форма.ДополнительныеДанные = Новый Структура;
	КонецЕсли;
	
	Если НЕ Форма.ДополнительныеДанные.Свойство("Титульный")
	 ИЛИ ТипЗнч(Форма.ДополнительныеДанные.Титульный) <> Тип("Структура") Тогда
		Форма.ДополнительныеДанные.Вставить("Титульный", Новый Структура);
	КонецЕсли;
	
	АдресОрганизации = Новый Структура;
	АдресОрганизации.Вставить("КодСтраны",       "");
	АдресОрганизации.Вставить("Индекс",          "");
	АдресОрганизации.Вставить("КодРегиона",      "");
	АдресОрганизации.Вставить("Район",           "");
	АдресОрганизации.Вставить("Город",           "");
	АдресОрганизации.Вставить("НаселенныйПункт", "");
	АдресОрганизации.Вставить("Улица",           "");
	АдресОрганизации.Вставить("Дом",             "");
	АдресОрганизации.Вставить("Корпус",          "");
	АдресОрганизации.Вставить("Квартира",        "");
	
	Если Форма.ДополнительныеДанные.Титульный.Свойство("АдресОрганизации") Тогда
		ЗаполнитьЗначенияСвойств(АдресОрганизации, Форма.ДополнительныеДанные.Титульный.АдресОрганизации);
	КонецЕсли;
	Форма.ДополнительныеДанные.Титульный.Вставить("АдресОрганизации", АдресОрганизации);
		
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ВосстановитьСтруктуруДополнительныхДанных(Форма)
	
	ИнициализироватьДополнительныеДанные(Форма);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСтруктуруЗависимыхЯчеекДляАвторасчета()
	                                                                
	СтруктураЗависимыхЯчеекДляАвторасчета = Новый Структура;
	
	//Раздел 1
	
	// Многострочная часть 1
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000110", "П000010000107;П000010000108;П000010000109");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000113", "П000010000107;П000010000108;П000010000109;П000010000111;П000010000112");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000117", "П000010000114;П000010000115;П000010000116");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000118", "П000010000106;П000010000107;П000010000108;П000010000109;П000010000111;П000010000112;П000010000114;П000010000115;П000010000116");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000206", "П000010000106");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000207", "П000010000107");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000208", "П000010000108");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000209", "П000010000109");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000210", "П000010000107;П000010000108;П000010000109");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000211", "П000010000111");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000212", "П000010000112");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000213", "П000010000107;П000010000108;П000010000109;П000010000111;П000010000112");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000214", "П000010000114");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000215", "П000010000115");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000216", "П000010000116");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000217", "П000010000114;П000010000115;П000010000116");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000218", "П000010000106;П000010000107;П000010000108;П000010000109;П000010000111;П000010000112;П000010000114;П000010000115;П000010000116");
	
	// Многострочная часть 2
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000310", "П000010000307;П000010000308;П000010000309");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000313", "П000010000307;П000010000308;П000010000309;П000010000311;П000010000312");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000317", "П000010000314;П000010000315;П000010000316");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000318", "П000010000306;П000010000307;П000010000308;П000010000309;П000010000311;П000010000312;П000010000314;П000010000315;П000010000316");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000406", "П000010000306");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000407", "П000010000307");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000408", "П000010000308");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000409", "П000010000309");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000410", "П000010000307;П000010000308;П000010000309");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000411", "П000010000311");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000412", "П000010000312");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000413", "П000010000307;П000010000308;П000010000309;П000010000311;П000010000312");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000414", "П000010000314");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000415", "П000010000315");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000416", "П000010000316");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000417", "П000010000314;П000010000315;П000010000316");
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000010000418", "П000010000306;П000010000307;П000010000308;П000010000309;П000010000311;П000010000312;П000010000314;П000010000315;П000010000316");

	//Раздел 2
	
	// Многострочная часть 1
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000020000212", "П000020000112");
	
	// Многострочная часть 2
	СтруктураЗависимыхЯчеекДляАвторасчета.Вставить("П000020000412", "П000020000312");

КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСтруктуруИменКолонокМногострочныхРазделов()
	
	Для каждого ЭлементСтруктуры Из мСтруктураМногострочныхРазделов Цикл
		
		СписокИменРаздела = мСтруктураИменаКолонокРазделов[ЭлементСтруктуры.Ключ];
		ТаблицаРаздела = ДанныеФормыВЗначение(ЭтаФорма[ЭлементСтруктуры.Значение], Тип("ТаблицаЗначений"));
		
		СписокИменРаздела.Очистить();
		Для каждого КолонкаТаблицы Из ТаблицаРаздела.Колонки Цикл
			СписокИменРаздела.Добавить(КолонкаТаблицы.Имя);
		КонецЦикла; 
		
	КонецЦикла; 
	
КонецПроцедуры

&НаСервере
Процедура НачальныеОперацииСМногострочнымиБлоками()
	Перем ИсходноеКоличествоСтрокГруппы;

	// создаем исходную структуру многострочных разделов
	Для Каждого ЭлементСтруктуры Из мСтруктураМногострочныхРазделов Цикл
		ИмяГруппы = ЭлементСтруктуры.Ключ;
		СтруктураГруппы = ЭтаФорма[ЭлементСтруктуры.Значение];
		
		мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, ИсходноеКоличествоСтрокГруппы);

		Для НСтр = 1 По ИсходноеКоличествоСтрокГруппы Цикл

			СтруктураГруппы.Добавить();
            			
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если СтрНайти(Заголовок, СтруктураРеквизитовФормы.СтрПериодОтчета) = 0 Тогда
		Заголовок = Заголовок + " за " + СтруктураРеквизитовФормы.СтрПериодОтчета;
	КонецЕсли;
	
	ОргСтр = " (" + СтруктураРеквизитовФормы.НаимОрганизации + ")";
	Если СтрНайти(Заголовок, ОргСтр) = 0 Тогда
		Заголовок = Заголовок + ОргСтр;
	КонецЕсли;
	
	Заголовок = Заголовок + ?(СтрНайти(ЭтаФорма.ИмяФормы, "Внешний") > 0, " - внешний отчет", "");
	
	ПодключитьОбработчикОжидания("ВыполнитьПроверкуПередОткрытием", 0.1, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыполнитьПроверкуПередОткрытием()
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПриОткрытииЗавершение", ЭтотОбъект);
	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередОткрытиемФормыРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытииЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Модифицированность = Ложь;
		Закрыть();
		Возврат;
	КонецЕсли;
	
	ТребуетсяПредупредитьОбИзменениях = Ложь;
	
	РегламентированнаяОтчетностьКлиентПереопределяемый.ИзменитьПризнакВыводаПредупрежденияОбИзменениях(
		СтруктураРеквизитовФормы.ИмяОтчета, СтруктураРеквизитовФормы.ИмяФормы, ТребуетсяПредупредитьОбИзменениях, ЭтаФорма);
		
	Если ТребуетсяПредупредитьОбИзменениях Тогда
		ПодключитьОбработчикОжидания("Подключаемый_ПредупредитьОбИзменениях", 0.5, Истина);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ПредупредитьОбИзменениях()
	
	РегламентированнаяОтчетностьКлиентПереопределяемый.ПредупредитьОбИзменениях(
		СтруктураРеквизитовФормы.ИмяОтчета, СтруктураРеквизитовФормы.ИмяФормы, ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНачальныеНастройки()
		
	МакетСоставаПоказателей = ОбъектОтчета(ЭтаФорма.ИмяФормы).ПолучитьМакет(СтруктураРеквизитовФормы.мСоставПоказателей);
			
	Для Инд = 0 По МакетСоставаПоказателей.Области.Количество() - 1 Цикл
				
		ТекОбласть    = МакетСоставаПоказателей.Области[Инд];
		ИмяСтраницы   = ТекОбласть.Имя;
				
		ЭтаФорма["ТаблицаВариантыЗаполнения" + ИмяСтраницы].Добавить();
		
		// Таблица значений содержит информацию о вариантах заполнения показателя отчета.
		// В колонках таблицы значений отображается следующая информация:
		//   - имя ячейки (код показателя);
		//   - вариант заполнения ячейки;
		//   - вычисленное по данным ИБ значение ячейки;
		//   - величина автокорректировки значения ячейки;
		//   - примечание к ячейке.
		//
				
		Для Ном = ТекОбласть.Верх По ТекОбласть.Низ Цикл
			// перебираем строки макета
            					
			// Код показателя (по составу показателей) определяется по первой колонке макета
			КодПоказателя = СокрП(МакетСоставаПоказателей.Область(Ном, 1).Текст);
			ИмяПоказателя = КодПоказателя;

			Если КодПоказателя = "===" Тогда         // признак конечной строки
				Прервать;
			КонецЕсли;
			
			Если Лев(КодПоказателя, 2) = "//" Тогда  // пропускаем комментарии
				Продолжить;
			КонецЕсли;

			// код показателя по форме отчете (имя ячейки в полях табличного документа формы)
			КодПоказателяПоФорме = СокрЛП(МакетСоставаПоказателей.Область(Ном, 2).Текст);
			// признак многострочности определяется по третьей колонке макета
			ПризнМногострочность = СокрЛП(МакетСоставаПоказателей.Область(Ном, 3).Текст);
			// по четвертой колонке определяется тип данных реквизита
			ТипДанныхРеквизита   = СокрЛП(МакетСоставаПоказателей.Область(Ном, 4).Текст);
			// по колонке 5 определяется исходное количество строк многострочного раздела
			стрКолСтрокИсходный  = СокрЛП(МакетСоставаПоказателей.Область(Ном, 5).Текст);
			// вариант заполнения ячейки определяется по колонке 6 макета
			стрВариантЗаполнения = РегламентированнаяОтчетность.ПолучитьВариантЗаполненияПоказателяРегОтчета(МакетСоставаПоказателей, Ном);
			
			ДопОписание			 = СокрЛП(МакетСоставаПоказателей.Область(Ном, 7).Текст);
			// признак обязательности заполнения показателя
			Обязательность  	 = СокрЛП(МакетСоставаПоказателей.Область(Ном, 8).Текст);
			
			// код показателя из структуры, берется из колонки 9
			КодПоказателяПоСтруктуре = СокрЛП(МакетСоставаПоказателей.Область(Ном, 9).Текст);

			чКолСтрокИсходный    = ? (ПустаяСтрока(стрКолСтрокИсходный),  0, Число(стрКолСтрокИсходный));
			чВариантЗаполнения   = ? (ПустаяСтрока(стрВариантЗаполнения), 0, Число(стрВариантЗаполнения));

			// формируем таблицу значений, содержащей состав показателей отчета
			НоваяСтрока = мТаблицаСоставПоказателей.Добавить();
			НоваяСтрока.ИмяПоляТаблДокумента     = ИмяСтраницы;
			НоваяСтрока.КодПоказателяПоСоставу   = КодПоказателя;
			НоваяСтрока.КодПоказателяПоФорме     = КодПоказателяПоФорме;
			НоваяСтрока.ПризнМногострочности     = ПризнМногострочность;
			НоваяСтрока.ТипДанныхПоказателя      = ТипДанныхРеквизита;
			НоваяСтрока.КодПоказателяПоСтруктуре = КодПоказателяПоСтруктуре;

			Если чВариантЗаполнения <> 0 Тогда
				// Если в колонке 6 задан вариант заполнения показателя, 
				// то его значение может определяться по данным ИБ.
				// Дополняем таблицу значений вариантов заполнения
				НоваяСтрока = ЭтаФорма["ТаблицаВариантыЗаполнения" + ИмяСтраницы][0].ТаблицаВариантовЗаполнения.Добавить();
				НоваяСтрока.КодПоказателя      = ? (Не ПустаяСтрока(КодПоказателяПоФорме), КодПоказателяПоФорме, КодПоказателя);
				НоваяСтрока.ВариантЗаполнения  = чВариантЗаполнения;
				НоваяСтрока.КодПоказателяПоСтруктуре  = КодПоказателяПоСтруктуре;
			КонецЕсли;

		КонецЦикла;

		Если ЭтаФорма["ТаблицаВариантыЗаполнения" + ИмяСтраницы][0].ТаблицаВариантовЗаполнения.Количество() > 0 Тогда		
			// имеются автоматически заполняемые ячейки
            
			// Создаем структуру, содержащей варианты заполнения показателей отчета.
			//
			// В качестве ключа используется имя страницы основной панели формы, содержащей
			//   табличный документ с автоматически заполняемыми показателями.
			// В качестве значения принимаем Массив из таблицы значений - вариантов заполнения
			//   показателей по каждой странице многостраничного раздела.
			//
			мСтруктураВариантыЗаполнения.Вставить(ИмяСтраницы, ИмяСтраницы);
			мСтруктураВариантыЗаполненияЭталон.Вставить(ИмяСтраницы, ИмяСтраницы);
						
		Конецесли;

	КонецЦикла;
	
	ФормироватьСтруктуруСтраницОтчета();
	
КонецПроцедуры

&НаСервере
Процедура ФормироватьСтруктуруСвойствСтраниц() Экспорт
		
	мСвойстваРазделовДекларации.ПолучитьЭлементы().Очистить();
	

	СтрокаУровня1 = мСвойстваРазделовДекларации.ПолучитьЭлементы().Добавить();
	
	СтрокаУровня1.ИмяСтраницы                          = "Титульный";
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.ОчищатьРаздел                        = Ложь;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.ПолучитьЭлементы().Добавить();
	
	СтрокаУровня1.ИмяСтраницы                          = "Лицензии";
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.ОчищатьРаздел                        = Ложь;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	

	СтрокаУровня1 = мСвойстваРазделовДекларации.ПолучитьЭлементы().Добавить();
	
	СтрокаУровня1.ИмяСтраницы                          = "Раздел1";
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь; // Не инициализировать элементы  управления корректировкой автозаполняемых значений
	
	НовСтр = СтрокаУровня1.МногострочностьВРазделе.Добавить();
	НовСтр.ИдГруппы = СтруктураРеквизитовФормы.мИдГруппы11;
	НовСтр.Область = "МногострочнаяЧасть1";
	НовСтр.ВысотаСтроки = 1;
	
	НовСтр = СтрокаУровня1.МногострочностьВРазделе.Добавить();
	НовСтр.ИдГруппы = СтруктураРеквизитовФормы.мИдГруппы12;
	НовСтр.Область = "МногострочнаяЧасть2";
	НовСтр.ВысотаСтроки = 1;
	
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.ПолучитьЭлементы().Добавить();

	СтрокаУровня1.ИмяСтраницы                          = "Раздел2";
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь; // Не инициализировать элементы  управления корректировкой автозаполняемых значений

	НовСтр = СтрокаУровня1.МногострочностьВРазделе.Добавить();
	НовСтр.ИдГруппы = СтруктураРеквизитовФормы.мИдГруппы21;
	НовСтр.Область = "МногострочнаяЧасть1";
	НовСтр.ВысотаСтроки = 1;
	
	НовСтр = СтрокаУровня1.МногострочностьВРазделе.Добавить();
	НовСтр.ИдГруппы = СтруктураРеквизитовФормы.мИдГруппы22;
	НовСтр.Область = "МногострочнаяЧасть2";
	НовСтр.ВысотаСтроки = 1;

КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УстановитьДоступностьПолейРаздела1(Форма)
	
	СтраницыРаздела = Неопределено;
	Форма.мСтруктураМногостраничныхРазделов.Свойство("Раздел1", СтраницыРаздела);
	СтраницыРаздела = Форма[СтраницыРаздела];
	АктивнаяСтраница = СтраницыРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));

	Если АктивнаяСтраница.Количество() > 0 Тогда
		АктивнаяСтраница = АктивнаяСтраница[0];
        ИндексСтраницы = СтраницыРаздела.Индекс(АктивнаяСтраница);
	Иначе
		Возврат;
	КонецЕсли;
	
	РазрешитьВвод = (ИндексСтраницы = 0);
	
	Если РазрешитьВвод Тогда
		
		УстановитьЦветФонаЯчейки(Форма, , , "Раздел1");
		
		НомерСтроки = 1;
		Постфикс = Формат(НомерСтроки, "ЧГ=0");
		Пока Форма.ТабличныйДокумент.Области.Найти("П000010000101_" + Постфикс) <> Неопределено Цикл
			
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000101")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000101_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000102")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000102_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000103")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000103_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000104")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000104_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000105")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000105_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000106")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000106_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000107")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000107_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000108")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000108_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000109")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000109_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000110")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000110_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000111")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000111_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000112")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000112_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000113")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000113_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000114")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000114_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000115")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000115_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000116")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000116_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000117")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000117_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел1[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000010000118")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000010000118_" + Постфикс, 0, "Раздел1");
			КонецЕсли;
			
			НомерСтроки = НомерСтроки + 1;
			Постфикс = Формат(НомерСтроки, "ЧГ=0");

		КонецЦикла;
		
	Иначе
		
		НомерСтроки = 1;
		Постфикс = Формат(НомерСтроки, "ЧГ=0");
		Пока Форма.ТабличныйДокумент.Области.Найти("П000010000101_" + Постфикс) <> Неопределено Цикл
			
			УстановитьЦветФонаЯчейки(Форма, "П000010000101_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000102_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000103_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000104_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000105_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000106_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000107_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000108_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000109_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000110_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000111_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000112_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000113_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000114_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000115_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000116_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000117_" + Постфикс, 5, "Раздел1");
			УстановитьЦветФонаЯчейки(Форма, "П000010000118_" + Постфикс, 5, "Раздел1");
			
			НомерСтроки = НомерСтроки + 1;
			Постфикс = Формат(НомерСтроки, "ЧГ=0");
		КонецЦикла;
		
		УстановитьЦветФонаЯчейки(Форма, "П000010000206", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000207", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000208", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000209", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000210", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000211", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000212", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000213", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000214", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000215", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000216", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000217", 5, "Раздел1");
		УстановитьЦветФонаЯчейки(Форма, "П000010000218", 5, "Раздел1");
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УстановитьДоступностьПолейРаздела2(Форма)
	
	СтраницыРаздела = Неопределено;
	Форма.мСтруктураМногостраничныхРазделов.Свойство("Раздел2", СтраницыРаздела);
	СтраницыРаздела = Форма[СтраницыРаздела];
	АктивнаяСтраница = СтраницыРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));

	Если АктивнаяСтраница.Количество() > 0 Тогда
		АктивнаяСтраница = АктивнаяСтраница[0];
        ИндексСтраницы = СтраницыРаздела.Индекс(АктивнаяСтраница);
	Иначе
		Возврат;
	КонецЕсли;
	
	РазрешитьВвод = (ИндексСтраницы = 0);
	
	Если РазрешитьВвод Тогда
		
		УстановитьЦветФонаЯчейки(Форма, , , "Раздел2");
		
		НомерСтроки = 1;
		Постфикс = Формат(НомерСтроки, "ЧГ=0");
		Пока Форма.ТабличныйДокумент.Области.Найти("П000020000101_" + Постфикс) <> Неопределено Цикл
			
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000101")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000101_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000102")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000102_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000103")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000103_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000104")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000104_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000105")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000105_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000106")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000106_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000107")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000107_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000108")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000108_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000109")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000109_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000110")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000110_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000111")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000111_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			Если Форма.ТаблицаВариантыЗаполненияРаздел2[0].ТаблицаВариантовЗаполнения.НайтиСтроки(Новый Структура("КодПоказателя", "П000020000112")).Количество() = 0 Тогда
				УстановитьЦветФонаЯчейки(Форма, "П000020000112_" + Постфикс, 0, "Раздел2");
			КонецЕсли;
			
			НомерСтроки = НомерСтроки + 1;
			Постфикс = Формат(НомерСтроки, "ЧГ=0");

		КонецЦикла;
		
	Иначе
		
		НомерСтроки = 1;
		Постфикс = Формат(НомерСтроки, "ЧГ=0");
		Пока Форма.ТабличныйДокумент.Области.Найти("П000020000101_" + Постфикс) <> Неопределено Цикл
			
			УстановитьЦветФонаЯчейки(Форма, "П000020000101_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000102_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000103_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000104_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000105_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000106_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000107_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000108_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000109_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000110_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000111_" + Постфикс, 5, "Раздел2");
			УстановитьЦветФонаЯчейки(Форма, "П000020000112_" + Постфикс, 5, "Раздел2");
			
			НомерСтроки = НомерСтроки + 1;
			Постфикс = Формат(НомерСтроки, "ЧГ=0");
		КонецЦикла;
		
		УстановитьЦветФонаЯчейки(Форма, "П000020000212", 5, "Раздел2");
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ПронумероватьТаблицыРаздела1(Форма)
	
	Если Форма.СтруктураРеквизитовФормы.мРежимПечати Тогда
		Возврат;
	КонецЕсли;
	
	ЭтоПерваяСтраница = Форма[Форма.мСтруктураМногостраничныхРазделов.Раздел1][0].АктивнаяСтраница;
	
	Если ЭтоПерваяСтраница Тогда
		ПроставитьНомераВТаблицеДекларация(Форма, "П0000100001");
	КонецЕсли;
	
	ПроставитьНомераВТаблицеДекларация(Форма, "П0000100003");
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ПронумероватьТаблицыРаздела2(Форма)
	
	Если Форма.СтруктураРеквизитовФормы.мРежимПечати Тогда
		Возврат;
	КонецЕсли;
	
	ЭтоПерваяСтраница = Форма[Форма.мСтруктураМногостраничныхРазделов.Раздел2][0].АктивнаяСтраница;
	
	Если ЭтоПерваяСтраница Тогда
		ПроставитьНомераВТаблицеДекларация(Форма, "П0000200001");
	КонецЕсли;
	
	ПроставитьНомераВТаблицеДекларация(Форма, "П0000200003");
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ПроставитьНомераВТаблицеДекларация(Форма, ПрефиксИмениТаблицы)
	
	ИмяГрафыНомераПП = ПрефиксИмениТаблицы + "00";
	
	НомерСтроки = 1;
	Постфикс = "_" + Формат(НомерСтроки, "ЧГ=0");
	Пока Форма.ТабличныйДокумент.Области.Найти(ИмяГрафыНомераПП + Постфикс) <> Неопределено Цикл
		Форма.ТабличныйДокумент.Области[ИмяГрафыНомераПП + Постфикс].Значение = НомерСтроки;
		
		НомерСтроки = НомерСтроки + 1;
		Постфикс = "_" + Формат(НомерСтроки, "ЧГ=0");
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура СформироватьСпискиВыбора()
	
	ДатаПериодаОтчета = СтруктураРеквизитовФормы.мДатаКонцапериодаОтчета;
	
	Если ДатаПериодаОтчета < '20131101' Тогда
		ИмяМакета = "Списки2012Кв3";
	ИначеЕсли ДатаПериодаОтчета < '20140901' Тогда
		ИмяМакета = "Списки2012Кв3_20131101";
	Иначе
		// С 3-го квартала 2015 года действует новый список.
		// Отчет квартальный, поэтому можно указать 01.09 как границу
		ИмяМакета = ?(ДатаПериодаОтчета < '20150901', "Списки2014Кв4", "Списки2015Кв3");		
	КонецЕсли;
	
	МакетСоставаПоказателей = ОбъектОтчета(ЭтаФорма.ИмяФормы).ПолучитьМакет(ИмяМакета);
	
	КоллекцияСписковВыбора = Новый Соответствие;
	Для Каждого Область Из МакетСоставаПоказателей.Области Цикл
		Если Область.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Строки Тогда
			ВерхОбласти = Область.Верх;
			НизОбласти = Область.Низ;
			ТаблСписка = Новый ТаблицаЗначений;
			ТаблСписка.Колонки.Добавить("Код",,, МакетСоставаПоказателей.Область(ВерхОбласти, 1, ВерхОбласти, 1).ШиринаКолонки);
			ТаблСписка.Колонки.Добавить("Название",,, МакетСоставаПоказателей.Область(ВерхОбласти, 2, ВерхОбласти, 2).ШиринаКолонки);
			Для НомСтр = ВерхОбласти По НизОбласти Цикл
				КодПоказателя = СокрП(МакетСоставаПоказателей.Область(НомСтр, 1).Текст);
				Если КодПоказателя <> "###" Тогда
					НовСтрока = ТаблСписка.Добавить();
					НовСтрока.Код = КодПоказателя;
					НовСтрока.Название = СокрП(МакетСоставаПоказателей.Область(НомСтр, 2).Текст);
				КонецЕсли;
			КонецЦикла;
			КоллекцияСписковВыбора.Вставить(Область.Имя, ТаблСписка);
		КонецЕсли;
	КонецЦикла;
	
	СвойстваПоказателей.Очистить();
			
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000010000101", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000010000102", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000010000301", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000010000302", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000020000101", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000020000102", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000020000301", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	РегламентированнаяОтчетность.ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000020000302", 3, , "Выбор вида продукции", КоллекцияСписковВыбора["ВидыПродукции"]);
	
КонецПроцедуры

&НаСервере
Процедура ПоказатьПериод()

	СтруктураРеквизитовФормы.СтрПериодОтчета = ПредставлениеПериода( НачалоДня(СтруктураРеквизитовФормы.мДатаНачалаПериодаОтчета), КонецДня(СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета), "ФП = Истина" );
    
	Если (СтруктураРеквизитовФормы.мДокументВосстановлен) И (СтруктураРеквизитовФормы.мСкопированаФорма = Неопределено) Тогда
		Возврат;
	КонецЕсли;
    
	НомерМесяца   = Формат(СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета, "ДФ=М");
	НомерКвартала = Формат(СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета, "ДФ=к");
	НомерГода     = Формат(СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета, "ДФ=гггг");

	// Отображение на титульном листе отчетного периода.
	Значение1Кв = ?(НомерКвартала = "1", "V", "");
	ТабличныйДокумент.Области.ОтчетныйПериод1Кв.Значение = Значение1Кв;
	
	Значение2Кв = ?(НомерКвартала = "2", "V", "");
	ТабличныйДокумент.Области.ОтчетныйПериод2Кв.Значение = Значение2Кв;
	
	Значение3Кв = ?(НомерКвартала = "3", "V", "");
	ТабличныйДокумент.Области.ОтчетныйПериод3Кв.Значение = Значение3Кв;
	
	Значение4Кв = ?(НомерКвартала = "4", "V", "");
	ТабличныйДокумент.Области.ОтчетныйПериод4Кв.Значение = Значение4Кв;
	
	ТабличныйДокумент.Области.ОтчетныйГод.Значение = НомерГода;
	    
КонецПроцедуры

&НаСервере
Процедура ФормироватьСтруктуруСтраницОтчета() 

	мДеревоСтраницОтчета.ПолучитьЭлементы().Очистить();

	СтрокаУровня1 = мДеревоСтраницОтчета.ПолучитьЭлементы().Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Титульный";
	СтрокаУровня1.Представление            = "Титульный лист";
	СтрокаУровня1.ОриентацияСтраницы       = "Портрет";
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.ПолучитьЭлементы().Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Лицензии";
	СтрокаУровня1.Представление            = "Адреса мест
											|осуществления
											|деятельности";
	
	СтрокаУровня1.ОриентацияСтраницы       = "Портрет";
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.ПолучитьЭлементы().Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел1";
	СтрокаУровня1.Представление            = "Раздел I";
	СтрокаУровня1.ОриентацияСтраницы       = "Ландшафт";
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;

	СтрокаУровня1 = мДеревоСтраницОтчета.ПолучитьЭлементы().Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел2";
	СтрокаУровня1.Представление            = "Раздел II";
	СтрокаУровня1.ОриентацияСтраницы       = "Ландшафт";
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСведенияОбОрганизации(ВПрограммеИзмененаДатаПодписи = Ложь)

	РабочаяОрганизация = СтруктураРеквизитовФормы.Организация;
	Если (РабочаяОрганизация = Неопределено) Или (РабочаяОрганизация = РегламентированнаяОтчетностьКлиентСервер.ПустоеЗначениеТипа("СправочникСсылка.Организации")) Тогда
		Возврат
	КонецЕсли;

	ЭтоПБОЮЛ = НЕ РегламентированнаяОтчетностьВызовСервера.ЭтоЮридическоеЛицо(РабочаяОрганизация);
	
	// Составляем список данных, необходимых для вывода в декларацию
	Сведения = Новый СписокЗначений;
	
	Сведения.Добавить("", "ИННЮЛ");
	Сведения.Добавить("", "КППЮЛ");
	Сведения.Добавить("", "НаимЮЛПол");
	Сведения.Добавить("", "НаимЮЛСокр"); 
	Сведения.Добавить("", "ТелОрганизации");
	Сведения.Добавить("", "АдресЭлектроннойПочтыОрганизации");
	Сведения.Добавить("", "ФИОРук");
	Сведения.Добавить("", "ФИОБух");
	Сведения.Добавить("", "ПолныйАдрЮР");
	Сведения.Добавить("", "АдрЮР");
	Сведения.Добавить("", "АдрПрописки");

	Результат = РегламентированнаяОтчетностьВызовСервера.ПолучитьСведенияОбОрганизации(РабочаяОрганизация, ДатаПодписи, Сведения);
	
	ИНН = СокрЛП(Результат.ИННЮЛ);
	КПП = ?(ЭтоПБОЮЛ, "", СокрЛП(Результат.КППЮЛ));
	
	СтруктураРеквизитовФормы.мИННЮЛ = ИНН;
	СтруктураРеквизитовФормы.мКППЮЛ = КПП;
	СтруктураРеквизитовФормы.ТелОрганизации = Результат.ТелОрганизации;
	
	ТабличныйДокумент.Области.ИНН1.Значение = ИНН;
	ТабличныйДокумент.Области.КПП1.Значение = КПП;
	ТабличныйДокумент.Области.ТелОрганизации.Значение = Результат.ТелОрганизации;
	ТабличныйДокумент.Области.ЭлектроннаяПочта.Значение = Результат.АдресЭлектроннойПочтыОрганизации;

	ТабличныйДокумент.Области.ОргНазв.Значение = Результат.НаимЮЛПол;
	
	Если ЭтоПБОЮЛ Тогда
	    Если ПустаяСтрока(СтрЗаменить(Результат.АдрЮр, ",", "")) Тогда
		    ЮридическийАдрес = Результат.АдрПрописки;
		Иначе	
		    ЮридическийАдрес = Результат.АдрЮр;
		КонецЕсли; 
	Иначе	
	    ЮридическийАдрес = Результат.АдрЮр;
	КонецЕсли; 
		
	АдресОрганизации = ДополнительныеДанные.Титульный.АдресОрганизации;
	
	Если НЕ ПустаяСтрока(ЮридическийАдрес) Тогда
		СтруктураАдреса = РегламентированнаяОтчетностьКлиентСервер.РазложитьАдрес(ЮридическийАдрес);
		ОчиститьСтруктуру(АдресОрганизации);

		АдресОрганизации = Новый Структура;
		Если Не СтруктураАдреса = Неопределено Тогда
			АдресОрганизации.Вставить("КодСтраны",       СокрЛП(СтруктураАдреса.Страна));
			АдресОрганизации.Вставить("Индекс",          СокрЛП(СтруктураАдреса.Индекс));
			АдресОрганизации.Вставить("КодРегиона",      РегламентированнаяОтчетностьВызовСервера.КодРегионаПоНазванию(СокрЛП(СтруктураАдреса.Регион)));
			АдресОрганизации.Вставить("Район",           СокрЛП(СтруктураАдреса.Район));
			АдресОрганизации.Вставить("Город",           СокрЛП(СтруктураАдреса.Город));
			АдресОрганизации.Вставить("НаселенныйПункт", СокрЛП(СтруктураАдреса.НаселенныйПункт));
			АдресОрганизации.Вставить("Улица",           СокрЛП(СтруктураАдреса.Улица));
			АдресОрганизации.Вставить("Дом",             СокрЛП(СтруктураАдреса.Дом));
			АдресОрганизации.Вставить("Корпус",          СокрЛП(СтруктураАдреса.Корпус));
			АдресОрганизации.Вставить("Квартира",        СокрЛП(СтруктураАдреса.Квартира));
			АдресОрганизации.Вставить("Адрес",       	 РегламентированнаяОтчетностьКлиентСервер.ПредставлениеАдресаВФормате9Запятых(ЮридическийАдрес));
		КонецЕсли;	
		
	КонецЕсли;
	
	ПредставлениеАдреса = РегламентированнаяОтчетностьКлиентСервер.ПредставлениеАдресаВФормате9Запятых(ЮридическийАдрес);
	Если ЭтоПБОЮЛ Тогда
		ТабличныйДокумент.Области.ПоМестуОрганизации.Значение = "";
		ТабличныйДокумент.Области.ПоМестуИндивидуальногоПредпринимателя.Значение = "V";
		ТабличныйДокумент.Области.АдресИндивидуальногоПредпринимателя.Значение = ПредставлениеАдреса;
		ТабличныйДокумент.Области.АдресОрганизации.Значение = "";
	Иначе
		ТабличныйДокумент.Области.ПоМестуОрганизации.Значение = "V";
		ТабличныйДокумент.Области.ПоМестуИндивидуальногоПредпринимателя.Значение = "";
		ТабличныйДокумент.Области.АдресОрганизации.Значение = ПредставлениеАдреса;
		ТабличныйДокумент.Области.АдресИндивидуальногоПредпринимателя.Значение = "";
	КонецЕсли;
	
	ДополнительныеДанные.Титульный.Вставить("АдресОрганизации", АдресОрганизации);
			
	Если Результат <> Неопределено Тогда
		
		Если ЭтоПБОЮЛ Тогда
			СтруктураРеквизитовФормы.Руководитель = "";
			СтруктураРеквизитовФормы.ИндивидуальныйПредприниматель = Результат.ФИОРук;
		Иначе
			СтруктураРеквизитовФормы.Руководитель = Результат.ФИОРук;
			СтруктураРеквизитовФормы.ИндивидуальныйПредприниматель = "";
		КонецЕсли;
		СтруктураРеквизитовФормы.Бухгалтер = Результат.ФИОБух;
		
		ТабличныйДокумент.Области.ОргДиректор.Значение = СтруктураРеквизитовФормы.Руководитель;
		ТабличныйДокумент.Области.ОргБухгалтер.Значение = СтруктураРеквизитовФормы.Бухгалтер;
		ТабличныйДокумент.Области.ОргИндивидуальныйПредприниматель.Значение = СтруктураРеквизитовФормы.ИндивидуальныйПредприниматель;
		
	КонецЕсли;

	Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	
	РегламентированнаяОтчетностьКлиент.ПередЗакрытиемРегламентированногоОтчета(ЭтаФорма, Отказ, СтандартнаяОбработка, ЗавершениеРаботы, ТекстПредупреждения);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии(ЗавершениеРаботы)
	
	Если ЗавершениеРаботы Тогда
				
		Возврат;
		
	КонецЕсли;
	
	ПриЗакрытииНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ПриЗакрытииНаСервере()
	
	РегламентированнаяОтчетность.ПриЗакрытииРегламентированногоОтчета(ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура СохранитьДеревоСтраницОтчета(Знач мСохраненныйДок)
	
	Если мСохраненныйДок <> Неопределено Тогда
				
		Если ТипЗнч(мСохраненныйДок) = Тип("ДокументСсылка.РегламентированныйОтчет") Тогда
			мСохраненныйДок = мСохраненныйДок.ПолучитьОбъект();
		КонецЕсли;
		
		Если Не мСохраненныйДок.ЭтоНовый() Тогда
			// Сохраняем выбранные листы для печати в хранилище
			ХранилищеДанных = Новый ХранилищеЗначения(РеквизитФормыВЗначение("мДеревоСтраницОтчета"));
			мСохраненныйДок.ДеревоНастройкиСтраниц = ХранилищеДанных;
			Попытка
				мСохраненныйДок.Записать();
			Исключение
			КонецПопытки;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура СформироватьДеревоРазделовОтчетаНаСервере() Экспорт
	
	СформироватьДеревоРазделовОтчета(ЭтаФорма);
			
КонецПроцедуры

&НаКлиенте
Процедура СформироватьДеревоРазделовОтчетаНаКлиенте() Экспорт
	
	СформироватьДеревоРазделовОтчета(ЭтаФорма);
			
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура СформироватьДеревоРазделовОтчета(Форма)
	
	Форма["РазделыОтчета"].ПолучитьЭлементы().Очистить();
	
	Для Каждого ЭлементДереваСтраницОтчета Из Форма["мДеревоСтраницОтчета"].ПолучитьЭлементы() Цикл
		
		Если ЭлементДереваСтраницОтчета.ПоказатьСтраницу = 1 Тогда
			
			ЭлементРазделовОтчета = Форма["РазделыОтчета"].ПолучитьЭлементы().Добавить();
			ЭлементРазделовОтчета.КолонкаРазделыОтчета         = ЭлементДереваСтраницОтчета.Представление;
			ЭлементРазделовОтчета.КолонкаРазделыОтчетаСокрНаим = ЭлементДереваСтраницОтчета.ИмяСтраницы;
			ЭлементРазделовОтчета.ИндексКартинки               = 1;
			ЭлементРазделовОтчета.РазделМногостраничный        = Ложь;
			ЭлементРазделовОтчета.РазделМногострочный          = Ложь;
			
			НайденноеЗначение = Неопределено;
			
			Если Форма["мСтруктураМногостраничныхРазделов"].Свойство(ЭлементРазделовОтчета.КолонкаРазделыОтчетаСокрНаим, НайденноеЗначение) Тогда
				
				Если НЕ НайденноеЗначение = Неопределено Тогда
					
					НайденноеЗначение = Форма[НайденноеЗначение];
					
					ЭлементРазделовОтчета.ИндексКартинки        = 0;
					ЭлементРазделовОтчета.РазделМногостраничный = Истина;
					
					Для НомерСтраницы = 1 По НайденноеЗначение.Количество() Цикл
						
						СтраницаРазделаОтчета = ЭлементРазделовОтчета.ПолучитьЭлементы().Добавить();
						
						СтраницаРазделаОтчета.КолонкаРазделыОтчета              = "Стр. " + НомерСтраницы;
						СтраницаРазделаОтчета.КолонкаРазделыОтчетаСокрНаим      = ЭлементРазделовОтчета.КолонкаРазделыОтчетаСокрНаим;
						СтраницаРазделаОтчета.КолонкаНомерСтраницыРазделаОтчета = НомерСтраницы;
						СтраницаРазделаОтчета.ИндексКартинки                    = 1;
						СтраницаРазделаОтчета.РазделМногостраничный             = ЭлементРазделовОтчета.РазделМногостраничный;
						СтраницаРазделаОтчета.РазделМногострочный               = ЭлементРазделовОтчета.РазделМногострочный;
						
					КонецЦикла;
					
				КонецЕсли;
				
			КонецЕсли;
				
		КонецЕсли;
				
	КонецЦикла;
			
КонецПроцедуры

&НаСервере
Процедура УправлениеЛистамиНаСервере(ТипНП = Неопределено) Экспорт
	
	// Процедура "заглушка". Для совместимости с общими механизмами работы с многостраничными разделами.
	Возврат;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДатуВЯчейкахНаКлиенте() Экспорт
	
	ЗаполнитьДатуВЯчейках(ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьДатуВЯчейкахНаСервере() Экспорт
	
	ЮрЛицо = РегламентированнаяОтчетностьВызовСервера.ЭтоЮридическоеЛицо(СтруктураРеквизитовФормы.Организация);
	
	Если СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета < '20140101' Тогда
		ЗаполнитьДатуВЯчейках(ЭтаФорма, Истина);
	Иначе
		ЗаполнитьДатуВЯчейках(ЭтаФорма, ЮрЛицо);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ЗаполнитьДатуВЯчейках(Форма, ЮрЛицо = Неопределено)
	
	Если ЮрЛицо = Неопределено ИЛИ ЮрЛицо Тогда
		Форма.ТабличныйДокумент.Области.ДатаПодписи.Значение = Форма.ДатаПодписи;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура РазделыОтчетаПриАктивизацииСтроки(Элемент)
	
	Если Элемент.ТекущиеДанные = Неопределено
	 ИЛИ Элемент.ТекущаяСтрока = СтруктураРеквизитовФормы.ТекущаяСтрокаРазделовОтчета Тогда
		Возврат;
	КонецЕсли;
	
	РазделОтчета = Элемент.ТекущиеДанные.ПолучитьРодителя() = Неопределено;
	
	СтруктураРеквизитовФормы.ТекущаяСтрокаРазделовОтчета = Элемент.ТекущаяСтрока;
	
	Элементы.ОчиститьТекущуюСтраницу.Доступность = Истина;
	Элементы.Обновить.Доступность = Элемент.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим = "Титульный";
	
	Элементы.РазделыОтчетаКонтекстноеМенюДобавитьСтраницу.Видимость = Ложь;
	Элементы.РазделыОтчетаКонтекстноеМенюУдалитьСтраницу.Видимость  = Ложь;
	
	Если СтруктураРеквизитовФормы.ВыводитьСтраницуВТаблДокНаСервере Тогда
		Если Элемент.ТекущиеДанные.РазделМногостраничный Тогда
			Элемент.ТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета = ?(Элемент.ТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета = Неопределено
															        ИЛИ Элемент.ТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета = 0, 1, Элемент.ТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета);
		КонецЕсли;
		ВывестиМакетСтраницыВТабличныйДокументНаСервере(Элемент.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим, Элемент.ТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета, РазделОтчета);
	Иначе
		СтруктураРеквизитовФормы.ВыводитьСтраницуВТаблДокНаСервере = Истина;
	КонецЕсли;
	
	Элементы.РазделыОтчетаКонтекстноеМенюДобавитьСтраницу.Видимость = Ложь;
	Элементы.РазделыОтчетаКонтекстноеМенюУдалитьСтраницу.Видимость  = Ложь;
	
	Если Элемент.ТекущиеДанные.РазделМногостраничный Тогда
		
		Элемент.Развернуть(Элемент.ТекущаяСтрока);
		
		Элементы.РазделыОтчетаКонтекстноеМенюДобавитьСтраницу.Видимость = Истина;
		Элементы.РазделыОтчетаКонтекстноеМенюУдалитьСтраницу.Видимость  = Истина;
		
		Если РазделОтчета Тогда
			Элементы.ОчиститьТекущуюСтраницу.Доступность = Ложь;
			Элементы.РазделыОтчетаКонтекстноеМенюУдалитьСтраницу.Видимость  = Ложь;
			Если Элемент.ТекущиеДанные.ПолучитьЭлементы().Количество() = 1 Тогда
				Элементы.РазделыОтчетаКонтекстноеМенюУдалитьСтраницу.Видимость  = Ложь;
			КонецЕсли;
		ИначеЕсли Элемент.ТекущиеДанные.ПолучитьРодителя().ПолучитьЭлементы().Количество() = 1 Тогда
			Элементы.РазделыОтчетаКонтекстноеМенюУдалитьСтраницу.Видимость  = Ложь;
		КонецЕсли;
		
	КонецЕсли;
	
	Если Элемент.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим = "Раздел1"
	 ИЛИ Элемент.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим = "Раздел2" Тогда
		Элементы.ТабличныйДокументКонтекстноеМенюДобавитьСтроку.Видимость = Истина;
		Элементы.ТабличныйДокументКонтекстноеМенюУдалитьСтроку.Видимость = Истина;
	Иначе
		Элементы.ТабличныйДокументКонтекстноеМенюДобавитьСтроку.Видимость = Ложь;
		Элементы.ТабличныйДокументКонтекстноеМенюУдалитьСтроку.Видимость = Ложь;
	КонецЕсли;
	
	ТекТабличноеПоле = ЭтаФорма["ТабличныйДокумент"];
	ИмяТекущейОбласти = "R1C1";
	ЭтаФорма.Элементы["ТабличныйДокумент"].ТекущаяОбласть = ТекТабличноеПоле.Область(ИмяТекущейОбласти);
	ЭтаФорма.ТекущийЭлемент = ЭтаФорма.Элементы["ТабличныйДокумент"];
	
КонецПроцедуры

&НаСервере
Процедура ВывестиМакетСтраницыВТабличныйДокументНаСервере(ИмяТекРаздела, НомерСтраницыРазделаОтчета, РазделОтчета = Ложь)
	
	СохранитьДанныеРаздела(СтруктураРеквизитовФормы.НаимТекущегоРаздела, Истина);
	
	ВывестиМакетВТаблДокНаСервере(ИмяТекРаздела, НомерСтраницыРазделаОтчета, РазделОтчета);
	
	СтруктураРеквизитовФормы.НаимТекущегоРаздела = ИмяТекРаздела;
	
КонецПроцедуры

&НаСервере
Процедура СохранитьДанныеРаздела(НаимРаздела, ОчищатьРазделЕслиЕстьМногострочность, ИзменятьАктивнуюСтраницу = Истина)	
	
	// Многостраничные разделы.
	//
	Если НаимРаздела = "Лицензии" Тогда
	     			
		СтруктураДанных = Новый Структура;
		
		СтруктураДанных = СобратьДанныеТекущегоТаблПоляНаСервере("ТабличныйДокумент");
					
		НаимТаблицыСтраницы = "ТаблицаСтраницыЛицензии";
		
		АктивнаяСтраница = ЭтаФорма[НаимТаблицыСтраницы].НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
		
		Если АктивнаяСтраница.Количество() > 0 Тогда
			
			АктивнаяСтраница = АктивнаяСтраница[0];
			
			АктивнаяСтраница.Данные.Очистить();
			АктивнаяСтраница.Данные.Добавить(СтруктураДанных);
			
			ОпределитьПредставлениеДопСтраниц(НаимРаздела);
			
			АктивнаяСтраница.АктивнаяСтраница = НЕ ИзменятьАктивнуюСтраницу;
						
		КонецЕсли;
		
	// Многостраничные и многострочные разделы.
	//
	ИначеЕсли НаимРаздела = "Раздел1"
		  ИЛИ НаимРаздела = "Раздел2" Тогда
		
		ТаблицаСтраницРаздела = Неопределено;
		
		мСтруктураМногостраничныхРазделов.Свойство(НаимРаздела, ТаблицаСтраницРаздела);
				
		ТаблицаСтраницРаздела = ЭтаФорма[ТаблицаСтраницРаздела];
		
		СтрТаблицыСтраниц = ТаблицаСтраницРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
		
		Если СтрТаблицыСтраниц.Количество() > 0 Тогда
				
			СтрТаблицаСтраницы = СтрТаблицыСтраниц[0];
			
			// Сохраним данные активной страницы, с присвоением Представления страницы и с очистной многострочных частей (Истина)
			
			СтруктураДанныхТекущейТаблицы = СобратьДанныеТекущегоТаблПоля(ЭтаФорма, "ТабличныйДокумент");
			
			ОпределитьПредставлениеДопСтраниц(НаимРаздела);

			СтруктураДанныхДопСтрокРаздела = СформироватьСтруктуруДанныхДопСтрокСтраницы(ЭтаФорма, НаимРаздела);
			
			Если СтрТаблицаСтраницы.Данные.Количество() > 0 Тогда
				СтрТаблицаСтраницы.Данные[0].Значение = СтруктураДанныхТекущейТаблицы;
			Иначе
				СтрТаблицаСтраницы.Данные.Добавить(СтруктураДанныхТекущейТаблицы);
			КонецЕсли;
							
			Если СтрТаблицаСтраницы.ДанныеДопСтрок.Количество() > 0 Тогда
				СтрТаблицаСтраницы.ДанныеДопСтрок[0].Значение = СтруктураДанныхДопСтрокРаздела;
			Иначе
				СтрТаблицаСтраницы.ДанныеДопСтрок.Добавить(СтруктураДанныхДопСтрокРаздела, "ДанныеФормыКоллекцияТаблицаДопСтрокРаздела");
			КонецЕсли;
			
			СтрТаблицаСтраницы.АктивнаяСтраница = НЕ ИзменятьАктивнуюСтраницу;
			
		КонецЕсли;
		
	// Обычные разделы.
	//
	Иначе
		
		ЭтаФорма["СтруктураДанных" + НаимРаздела] = СобратьДанныеТекущегоТаблПоля(ЭтаФорма, "ТабличныйДокумент");
		
	КонецЕсли;
				
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Функция СформироватьСтруктуруДанныхДопСтрокСтраницы(Форма, ИмяСтраницы)
	Перем СтруктураДанныхДопСтрокРаздела;

	Если ИмяСтраницы = "Раздел1" Тогда

		// Так как Таблица 1 содержит несколько многострочных блоков,
		// то поочередно сохраняем данные дополнительных строк каждого блока.
		ОбновитьСтруктуруМногострочногоРаздела(Форма, Форма.СтруктураРеквизитовФормы.мИдГруппы11);
		ОбновитьСтруктуруМногострочногоРаздела(Форма, Форма.СтруктураРеквизитовФормы.мИдГруппы12);

		СтруктураДанныхДопСтрокРаздела = Новый Структура;
		
		ПромТаблицаДопСтрокРаздела = Неопределено;
		Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, ПромТаблицаДопСтрокРаздела);
		ПромТаблицаДопСтрокРаздела = Форма[ПромТаблицаДопСтрокРаздела];
		ТаблицаДопСтрокГруппы1 = Форма["Хранилище" + Форма.СтруктураРеквизитовФормы.мИдГруппы11].Добавить().Таблица;
		КопироватьДанныеФормы(ПромТаблицаДопСтрокРаздела, ТаблицаДопСтрокГруппы1);
		СтруктураДанныхДопСтрокРаздела.Вставить(Форма.СтруктураРеквизитовФормы.мИдГруппы11, ТаблицаДопСтрокГруппы1);
		
		ПромТаблицаДопСтрокРаздела = Неопределено;
		Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, ПромТаблицаДопСтрокРаздела);
		ПромТаблицаДопСтрокРаздела = Форма[ПромТаблицаДопСтрокРаздела];
		ТаблицаДопСтрокГруппы2 = Форма["Хранилище" + Форма.СтруктураРеквизитовФормы.мИдГруппы12].Добавить().Таблица;
		КопироватьДанныеФормы(ПромТаблицаДопСтрокРаздела, ТаблицаДопСтрокГруппы2);
		СтруктураДанныхДопСтрокРаздела.Вставить(Форма.СтруктураРеквизитовФормы.мИдГруппы12, ТаблицаДопСтрокГруппы2);

	ИначеЕсли ИмяСтраницы = "Раздел2" Тогда

		// Так как Таблица 2 содержит несколько многострочных блоков,
		// то поочередно сохраняем данные дополнительных строк каждого блока.
		ОбновитьСтруктуруМногострочногоРаздела(Форма, Форма.СтруктураРеквизитовФормы.мИдГруппы21);
		ОбновитьСтруктуруМногострочногоРаздела(Форма, Форма.СтруктураРеквизитовФормы.мИдГруппы22);

		СтруктураДанныхДопСтрокРаздела = Новый Структура;

		// Обновим структуру, хранящую данные строк многострочных блоков.
		
		ПромТаблицаДопСтрокРаздела = Неопределено;
		Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы21, ПромТаблицаДопСтрокРаздела);
		ПромТаблицаДопСтрокРаздела = Форма[ПромТаблицаДопСтрокРаздела];
		ТаблицаДопСтрокГруппы1 = Форма["Хранилище" + Форма.СтруктураРеквизитовФормы.мИдГруппы21].Добавить().Таблица;
		КопироватьДанныеФормы(ПромТаблицаДопСтрокРаздела, ТаблицаДопСтрокГруппы1);
		СтруктураДанныхДопСтрокРаздела.Вставить(Форма.СтруктураРеквизитовФормы.мИдГруппы21, ТаблицаДопСтрокГруппы1);
		
		ПромТаблицаДопСтрокРаздела = Неопределено;
		Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы22, ПромТаблицаДопСтрокРаздела);
		ПромТаблицаДопСтрокРаздела = Форма[ПромТаблицаДопСтрокРаздела];
		ТаблицаДопСтрокГруппы2 = Форма["Хранилище" + Форма.СтруктураРеквизитовФормы.мИдГруппы22].Добавить().Таблица;
		КопироватьДанныеФормы(ПромТаблицаДопСтрокРаздела, ТаблицаДопСтрокГруппы2);
		СтруктураДанныхДопСтрокРаздела.Вставить(Форма.СтруктураРеквизитовФормы.мИдГруппы22, ТаблицаДопСтрокГруппы2);
		
	КонецЕсли;

	Возврат СтруктураДанныхДопСтрокРаздела;

КонецФункции

&НаСервере
Процедура ВывестиМакетВТаблДокНаСервере(ИмяТекРаздела, НомерСтраницыРазделаОтчета, РазделОтчета = Ложь)
	
	ТабличныйДокумент.Очистить();
	ТабличныйДокумент.Вывести(ПолучитьМакетФормыОтчета(ИмяТекРаздела));
	
	// Многостраничные разделы.
	//
	Если ИмяТекРаздела = "Лицензии" Тогда
		
		НаимТаблицыСтраницы = "ТаблицаСтраницыЛицензии";
		
		СтруктураДанных = Новый Структура;
		
		СписокДанных = ЭтаФорма[НаимТаблицыСтраницы][НомерСтраницыРазделаОтчета - 1].Данные;
		
		Для каждого ТаблицаСтраницы Из ЭтаФорма[НаимТаблицыСтраницы] Цикл
			Если ЭтаФорма[НаимТаблицыСтраницы].Количество() = 1 Или РазделОтчета Тогда
				Для Каждого Область Из ТабличныйДокумент.Области Цикл
					Если СтрЧислоВхождений(Область.Имя, "УдалитьСтраницу") > 0 Тогда
						Область.Текст = "";
						Область.Гиперссылка = Ложь;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
			ТаблицаСтраницы.АктивнаяСтраница = Ложь;
		КонецЦикла;
		
		ЭтаФорма[НаимТаблицыСтраницы][НомерСтраницыРазделаОтчета - 1].АктивнаяСтраница = Истина;
		
	    Если СписокДанных.Количество() > 0 Тогда
	    	СтруктураДанных = СписокДанных[0].Значение;
	    КонецЕсли;
	     	 
		Для Каждого ЭлСтруктуры Из СтруктураДанных Цикл
			Попытка
				ТабличныйДокумент.Области[ЭлСтруктуры.Ключ].Значение = ЭлСтруктуры.Значение;
			Исключение
			КонецПопытки;
		КонецЦикла;
		
	// Многостраничные и многострочные разделы.
	//
	ИначеЕсли ИмяТекРаздела = "Раздел1"
		  ИЛИ ИмяТекРаздела = "Раздел2" Тогда
		
		НаимТаблицыСтраницы = мСтруктураМногостраничныхРазделов[ИмяТекРаздела];
		
		СтруктураДанных = Новый Структура;
		
		СписокДанных = ЭтаФорма[НаимТаблицыСтраницы][НомерСтраницыРазделаОтчета - 1].Данные;
		
		Для каждого ТаблицаСтраницы Из ЭтаФорма[НаимТаблицыСтраницы] Цикл
			
			Для Каждого Область Из ТабличныйДокумент.Области Цикл
				Если (СтрЧислоВхождений(Область.Имя, "ДобавитьСтроку") > 0
				 ИЛИ СтрЧислоВхождений(Область.Имя, "ДопЛиния") > 0)
				   И НЕ СтрЧислоВхождений(Область.Имя, "ДобавитьСтрокуЗначок") > 0 Тогда
					Линия2пт = Новый Линия(ТипЛинииЯчейкиТабличногоДокумента.Сплошная, 2);
					Область.ГраницаСнизу = Линия2пт;
				КонецЕсли;
			КонецЦикла;
			
			Если ЭтаФорма[НаимТаблицыСтраницы].Количество() = 1 Или РазделОтчета Тогда
				Для Каждого Область Из ТабличныйДокумент.Области Цикл
					Если СтрЧислоВхождений(Область.Имя, "УдалитьСтраницу") > 0 Тогда
						Область.Текст = "";
						Область.Гиперссылка = Ложь;
					КонецЕсли;
				КонецЦикла;
			ИначеЕсли НомерСтраницыРазделаОтчета <> 1 Тогда
				
				ПерваяОбластьДобавитьСтрокуЗначок = ТабличныйДокумент.Области.Найти("ДобавитьСтрокуЗначокТ1");
				ПерваяОбластьДобавитьСтрокуЗначок.Видимость = Ложь;
				ПерваяОбластьДобавитьСтрокуЗначок.Гиперссылка = Ложь;
				ПерваяОбластьДобавитьСтрокуЗначок.Очистить(Истина, Истина);
				
				ПерваяОбластьДобавитьСтроку = ТабличныйДокумент.Области.Найти("ДобавитьСтрокуТ1");
				ПерваяОбластьДобавитьСтроку.Видимость = Ложь;
				ПерваяОбластьДобавитьСтроку.Гиперссылка = Ложь;
				ПерваяОбластьДобавитьСтроку.Очистить(Истина, Истина);
				
			КонецЕсли;
			
			ТаблицаСтраницы.АктивнаяСтраница = Ложь;
			
		КонецЦикла;
		
		ЭтаФорма[НаимТаблицыСтраницы][НомерСтраницыРазделаОтчета - 1].АктивнаяСтраница = Истина;
		
		Если СписокДанных.Количество() > 0 Тогда
			СтруктураДанных = СписокДанных[0].Значение;
		КонецЕсли;
		 	 
		Для Каждого ЭлСтруктуры Из СтруктураДанных Цикл
			
			Попытка
				ТабличныйДокумент.Области[ЭлСтруктуры.Ключ].Значение = ЭлСтруктуры.Значение;
			Исключение
			КонецПопытки;
			
		КонецЦикла;
		
		ТаблицаСтраницРаздела = Неопределено;
		
		мСтруктураМногостраничныхРазделов.Свойство(ИмяТекРаздела, ТаблицаСтраницРаздела);
				
		ТаблицаСтраницРаздела = ЭтаФорма[ТаблицаСтраницРаздела];
		                                                        		
		СтрСледующаяСтраница = ТаблицаСтраницРаздела[НомерСтраницыРазделаОтчета - 1];
		
		СтрСледующаяСтраница.АктивнаяСтраница = Истина;
		
		ТаблицаВариантыЗаполнения = РегламентированнаяОтчетностьВызовСервера.ПолучитьТаблицуВариантовЗаполненияНаСервере(ЭтаФорма, ИмяТекРаздела);
				
		НовДанныеДопСтрокРаздела = СтрСледующаяСтраница.ДанныеДопСтрок;
		
		Если (ТипЗнч(НовДанныеДопСтрокРаздела) = Тип("СписокЗначений"))
			И (НовДанныеДопСтрокРаздела.Количество() > 0)
			И (НовДанныеДопСтрокРаздела[0].Представление = "ДанныеФормыКоллекцияТаблицаДопСтрокРаздела") Тогда
			
			НовДанныеДопСтрокРаздела = НовДанныеДопСтрокРаздела[0].Значение;
			
		Иначе
			
			НовДанныеДопСтрокРаздела = Неопределено;
			
		КонецЕсли;

		
		Если НовДанныеДопСтрокРаздела <> Неопределено Тогда
			
			Для Каждого ГруппаСтрок Из НовДанныеДопСтрокРаздела Цикл
				
				ИмяГруппыДопСтрок = ГруппаСтрок.Ключ;
				ДанныеГруппыСтрок = ГруппаСтрок.Значение;
				
				ПромТаблицаГруппыСтрок = ЭтаФорма["Хранилище" + ИмяГруппыДопСтрок].Добавить().Таблица;
				
				КопироватьДанныеФормы(ДанныеГруппыСтрок, ПромТаблицаГруппыСтрок);
				
				// Заменяем таблицу значений с данными текущей страницы.
				КопироватьДанныеФормы(ПромТаблицаГруппыСтрок, ЭтаФорма[ИмяГруппыДопСтрок]);
				
				ВывестиРазделВТабличныйДокумент(ЭтаФорма, ИмяГруппыДопСтрок, ПромТаблицаГруппыСтрок);
				ОбновитьСтруктуруМногострочногоРазделаНаСервере(ИмяГруппыДопСтрок);
				
			КонецЦикла;
			
		КонецЕсли;
		
		ОтрисоватьЗначкиУдаленияСтрок(ТабличныйДокумент);
		
	// Обычные разделы.
	//
	Иначе
		
		Для Каждого ЭлСтруктуры Из ЭтаФорма["СтруктураДанных" + ИмяТекРаздела] Цикл
			Попытка
				ТабличныйДокумент.Области[ЭлСтруктуры.Ключ].Значение = ЭлСтруктуры.Значение;
			Исключение
			КонецПопытки;
		КонецЦикла;
		
	КонецЕсли;
	
	
	Если ИмяТекРаздела = "Титульный"
	 ИЛИ ИмяТекРаздела = "Лицензии" Тогда
						
	Иначе
		
		УстановитьЦветФонаЯчейкиНаСервере(,, ИмяТекРаздела);
		 
		ТабличныйДокумент.Области.НомСтр1.Значение = "0";
		ТабличныйДокумент.Области.НомСтр2.Значение = "0";
		ТабличныйДокумент.Области.НомСтр3.Значение = "0";
		ТабличныйДокумент.Области.Руководитель.Значение        			 = СтруктураРеквизитовФормы.Руководитель;
		ТабличныйДокумент.Области.Бухгалтер.Значение            		 = СтруктураРеквизитовФормы.Бухгалтер;
		ТабличныйДокумент.Области.ИндивидуальныйПредприниматель.Значение = СтруктураРеквизитовФормы.ИндивидуальныйПредприниматель;
						
	КонецЕсли;
	
	Если ИмяТекРаздела = "Раздел1" Тогда
		УстановитьДоступностьПолейРаздела1(ЭтаФорма);
		ПронумероватьТаблицыРаздела1(ЭтаФорма);
	ИначеЕсли ИмяТекРаздела = "Раздел2" Тогда
		УстановитьДоступностьПолейРаздела2(ЭтаФорма);
		ПронумероватьТаблицыРаздела2(ЭтаФорма);
	КонецЕсли;
	
	Если ИмяТекРаздела = "Титульный" Тогда
		ТабличныйДокумент.Области.Прил.Маска = "999";
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ОтрисоватьЗначкиУдаленияСтрок(ТабДок)
	
	МассивОбластейСДопСтроками = Новый Массив;
	
	Для Каждого ОбластьТД Из ТабДок.Области Цикл
		Если СтрЧислоВхождений(ОбластьТД.Имя, "УдалитьСтроку") > 0 Тогда
			Если СтрЧислоВхождений(ОбластьТД.Имя, "_2") > 0 Тогда
				МассивОбластейСДопСтроками.Добавить(Лев(ОбластьТД.Имя, 26));
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	Для Каждого ОбластьТД Из ТабДок.Области Цикл
		Если СтрЧислоВхождений(ОбластьТД.Имя, "УдалитьСтроку") > 0 Тогда
			Если МассивОбластейСДопСтроками.Найти(Лев(ОбластьТД.Имя, 26)) = Неопределено Тогда
				ОбластьТД.Гиперссылка = Ложь;
				ОбластьТД.Текст = "";
			Иначе
				ОбластьТД.Гиперссылка = Истина;
				ОбластьТД.Текст = "х";
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ВывестиРазделВТабличныйДокумент(Форма, ИмяГруппы, СтруктураГруппы) Экспорт
	
	Перем ИсходноеКоличествоСтрокГруппы;

	#Если НаКлиенте Тогда
		ТекущаяСтраница = Форма.ОпределитьТабличноеПолеПоИдМногострочногоРазделаНаКлиенте(ИмяГруппы);
	#Иначе
		ТекущаяСтраница = Форма.ОпределитьТабличноеПолеПоИдМногострочногоРазделаНаСервере(ИмяГруппы);
	#КонецЕсли

	// определим исходное колво строк многострочного раздела,
	// соответствующее бумажной форме отчета
	Форма.мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, ИсходноеКоличествоСтрокГруппы);

	// реальное кол-во строк (колво заполненных строк)
	ТекущееКоличествоСтрокГруппы = СтруктураГруппы.Количество();

	ТекТабличноеПолеИмя = "ТабличныйДокумент";
	
	ТекТабличноеПоле = Форма[ТекТабличноеПолеИмя];

	// При восстановлении сохраненных данных отчета сравниваем исходное кол-во
	// отображаемых в форме строк многострочного раздела с реальным количеством
	// созданных строк в сохраненном отчете.
	Если ТекущееКоличествоСтрокГруппы > ИсходноеКоличествоСтрокГруппы Тогда
		
		Форма.ДобавитьНеобходимоеКоличествоДопСтрокНаСервере(ТекТабличноеПоле, ТекТабличноеПолеИмя, ИсходноеКоличествоСтрокГруппы, ТекущееКоличествоСтрокГруппы, ИмяГруппы, СтруктураГруппы);
		
		Форма[ТекТабличноеПолеИмя] = ТекТабличноеПоле;
		
	КонецЕсли;
	
	// выводим значения строк
	Для Каждого СтрокаТаблицы Из СтруктураГруппы Цикл
		
		НомерСтрокиВТаблице      = СтруктураГруппы.Индекс(СтрокаТаблицы);
		НомерСтрокиВФормеТаблицы = Формат(НомерСтрокиВТаблице + 1, "ЧГ=");
		
		СписокИменКолонокРаздела = Форма.мСтруктураИменаКолонокРазделов[ИмяГруппы];
		
		Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
			
			КолонкаТаблицыИмя = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
			
			Если СтруктураГруппы[0].Свойство(КолонкаТаблицыИмя) Тогда
				
				ИмяЯчейки                = КолонкаТаблицыИмя + "_" + НомерСтрокиВФормеТаблицы;
				ОбластьЯчейкиТаблицы     = ТекТабличноеПоле.Области[ИмяЯчейки];
				ЗначениеЯчейки           = СтрокаТаблицы[КолонкаТаблицыИмя];
				
				Если ОбластьЯчейкиТаблицы.СодержитЗначение = Истина Тогда
					ОбластьЯчейкиТаблицы.Значение = ЗначениеЯчейки;
				Иначе
					// устанавливаем порядковый номер строки
					ОбластьЯчейкиТаблицы.Текст = ЗначениеЯчейки;
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЦикла;

КонецПроцедуры

&НаСервере
Процедура ВставитьОбластьВТабличныйДокументНаСервере(ТекТабличноеПолеИмя, ИсходноеКоличествоСтрокГруппы, ТекущееКоличествоСтрокГруппы, ИмяГруппы, СтруктураГруппы) Экспорт
	
	ТекТабличноеПоле = ЭтаФорма[ТекТабличноеПолеИмя];
	
	СписокИменКолонокРаздела = мСтруктураИменаКолонокРазделов[ИмяГруппы];

	// При превышении реального кол-ва строк над исходным кол-вом (по шаблону),
	// автоматически добавляем необходимое колво строк.
	Для НомНовойСтроки = ИсходноеКоличествоСтрокГруппы + 1 По ТекущееКоличествоСтрокГруппы Цикл
		
		НомИсходнойСтроки = Формат(НомНовойСтроки - 1, "ЧГ=");
		НомНовойСтрокиСтр = Формат(НомНовойСтроки, "ЧГ=");
		
		НомерГрафы = 1;
		
		КолонкаТаблицыИмя = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
		
		// определяем имя первой ячейки последней из исходных строк
		ИмяПервойЯчейкиПоследнейСтроки = КолонкаТаблицыИмя + "_" + НомИсходнойСтроки;
		
		// область первой ячейки последней из исходных строк
		ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяПервойЯчейкиПоследнейСтроки];
		
		// номера строк исходной области
		НомерВерхЯчейкиОбласти = ОбластьЯчейки.Верх;
		НомерНижнЯчейкиОбласти = ОбластьЯчейки.Низ;
		
		СдвигСтрок = НомерНижнЯчейкиОбласти - НомерВерхЯчейкиОбласти + 1;
		
		// номера строк вставляемой области
		НомерВерхЯчейкиНовойОбласти = НомерВерхЯчейкиОбласти + СдвигСтрок;
		НомерНижнЯчейкиНовойОбласти = НомерНижнЯчейкиОбласти + СдвигСтрок;
		
		РегламентированнаяОтчетностьВызовСервера.СпециальногоДобавленияСтроки(ТекТабличноеПоле, ТекТабличноеПолеИмя, ИмяГруппы, НомерВерхЯчейкиОбласти, НомерНижнЯчейкиОбласти);
		
		ЭтаФорма[ТекТабличноеПолеИмя] = ТекТабличноеПоле;
		                            		
		// переопределяем имена вставленной области
		Для НомерГрафы = 1 По мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
			
			КолонкаТаблицыИмя = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
			
			// переопределяем имена вставленной области
			Если СтруктураГруппы[0].Свойство(КолонкаТаблицыИмя) Тогда
				
				ИмяОбластиЯчейки    = КолонкаТаблицыИмя + "_" + НомИсходнойСтроки;
				ИмяНовОбластиЯчейки = КолонкаТаблицыИмя + "_" + НомНовойСтрокиСтр;
				
				ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяОбластиЯчейки];
				ОбластьЯчейки.Имя = ИмяНовОбластиЯчейки;
				
				// определяем границы ячейки исходной области
				НомерВерхСтрокиЯчейки  = ОбластьЯчейки.Верх - СдвигСтрок;
				НомерНижнСтрокиЯчейки  = ОбластьЯчейки.Низ  - СдвигСтрок;
				НомерЛевоКолонкиЯчейки = ОбластьЯчейки.Лево;
				НомерПравКолонкиЯчейки = ОбластьЯчейки.Право;
				
				// Назначаем имя ячейки исходной области,
				// (т.к. в результате вставки новой области оно было очищено)
				ОбластьЯчейкиИсходнойОбласти = ТекТабличноеПоле.Область(НомерВерхСтрокиЯчейки, НомерЛевоКолонкиЯчейки, НомерНижнСтрокиЯчейки, НомерПравКолонкиЯчейки);
				ОбластьЯчейкиИсходнойОбласти.Имя = ИмяОбластиЯчейки;
				
				// очищаем значения ячеек вставленной области
				Если ОбластьЯчейки.СодержитЗначение = Истина Тогда
					ОбластьЯчейки.Очистить();
				Иначе
					// порядковый номер последней строки перед вставкой
					ИсходныйНомер        = Число("0"+ОбластьЯчейки.Текст);
					НовыйПорядковыйНомер = ИсходныйНомер + 1;
					
					ОбластьЯчейки.Текст  = Строка(НовыйПорядковыйНомер);
				КонецЕсли;
				
			КонецЕсли;	
			
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ДобавитьНеобходимоеКоличествоДопСтрокНаСервере(ТекТабличноеПоле, ТекТабличноеПолеИмя, ИсходноеКоличествоСтрокГруппы, ТекущееКоличествоСтрокГруппы, ИмяГруппы, СтруктураГруппы) Экспорт
		
	ИмяОбласти = СтруктураРеквизитовФормы.мСоответствияМнгЧ[ИмяГруппы];
		
	ОбластьДопСтроки = ТекТабличноеПоле.ПолучитьОбласть(ИмяОбласти);
	
	МногострочнаяЧастьВерх = ТекТабличноеПоле.Области[ИмяОбласти].Верх;
			
	ТекТабличноеПоле.ВставитьОбласть(ОбластьДопСтроки.Область(), ТекТабличноеПоле.Область(МногострочнаяЧастьВерх + 1, , МногострочнаяЧастьВерх + ТекущееКоличествоСтрокГруппы - 1), ТипСмещенияТабличногоДокумента.ПоВертикали);
		
	Для НомНовойСтроки = ИсходноеКоличествоСтрокГруппы По ТекущееКоличествоСтрокГруппы Цикл
						
		Для Каждого Область Из ОбластьДопСтроки.Области Цикл
			
			ОбластьТаблДок = ТекТабличноеПоле.Область(МногострочнаяЧастьВерх + ТекущееКоличествоСтрокГруппы - НомНовойСтроки, Область.Лево, МногострочнаяЧастьВерх + ТекущееКоличествоСтрокГруппы - НомНовойСтроки, Область.Право);
			
			Если ОбластьТаблДок.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник Тогда
				
				Если ОбластьТаблДок.СодержитЗначение Тогда
					ОбластьТаблДок.Очистить();
				КонецЕсли;
				
				ОбластьТаблДок.Имя = Лев(Область.Имя, СтрНайти(Область.Имя, "_")) + Формат(ТекущееКоличествоСтрокГруппы - НомНовойСтроки + 1, "ЧГ=");
				
			КонецЕсли;
			
		КонецЦикла;
						
	КонецЦикла;	
		
	ТекТабличноеПоле.Область(ТекТабличноеПоле.Области[ИмяОбласти].Верх, , ТекТабличноеПоле.Области[ИмяОбласти].Верх).Имя = "";
	
	ТекТабличноеПоле.Область(МногострочнаяЧастьВерх, , МногострочнаяЧастьВерх).Имя = ИмяОбласти;
	
КонецПроцедуры

&НаСервере
Процедура ОбновитьСтруктуруМногострочногоРазделаНаСервере(ИмяГруппы) Экспорт
	
	ОбновитьСтруктуруМногострочногоРаздела(ЭтаФорма, ИмяГруппы);
	
КонецПроцедуры // ОбновитьСтруктуруМногострочногоРазделаНаСервере()

&НаКлиенте
Процедура ОбновитьСтруктуруМногострочногоРазделаНаКлиенте(ИмяГруппы) Экспорт
	
	ОбновитьСтруктуруМногострочногоРаздела(ЭтаФорма, ИмяГруппы);
	
КонецПроцедуры // ОбновитьСтруктуруМногострочногоРазделаНаКлиенте()

&НаКлиентеНаСервереБезКонтекста
Процедура ОбновитьСтруктуруМногострочногоРаздела(Форма, ИмяГруппы)
	
	Перем СтруктураГруппы;
	
	Форма.мСтруктураМногострочныхРазделов.Свойство(ИмяГруппы, СтруктураГруппы);
	
	СтруктураГруппы = Форма[СтруктураГруппы];
		
	ТекТабличноеПолеИмя = "ТабличныйДокумент";
	
	ТекТабличноеПоле = Форма[ТекТабличноеПолеИмя];
	
	Для НСтр = 1 По СтруктураГруппы.Количество() Цикл
		
		НСтрСуфф = Формат(НСтр, "ЧГ=");
		
		ТекСтрокаТаблицы = СтруктураГруппы[НСтр - 1];
		
		СписокИменКолонокРаздела = Форма.мСтруктураИменаКолонокРазделов[ИмяГруппы];
	
		Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
				
			ИмяКолонки = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
			
			Если СтруктураГруппы[0].Свойство(ИмяКолонки) Тогда	
				
				ИмяЯчейки     = ИмяКолонки + "_" + НСтрСуфф;
				ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяЯчейки];
				
				Если ОбластьЯчейки.СодержитЗначение = Истина Тогда
					ЗначениеЯчейки = ОбластьЯчейки.Значение;
				Иначе
					ЗначениеЯчейки = ОбластьЯчейки.Текст;
				КонецЕсли;
				
				Если ТипЗнч(ЗначениеЯчейки) = Тип("Строка") Тогда				
					ЗначениеЯчейки = СокрЛП(ЗначениеЯчейки);				
				КонецЕсли; 
				
				ТекСтрокаТаблицы[ИмяКолонки] = ЗначениеЯчейки;
				
			КонецЕсли;	
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Функция ОпределитьИдМногострочногоРазделаПоАктивнойСтраницеНаСервере(ИмяЛиста = Неопределено, ИмяОбласти = Неопределено) Экспорт
	
	ИдГрупп = Новый Структура;
	ИдГрупп.Вставить("мИдГруппы11", СтруктураРеквизитовФормы.мИдГруппы11);
	ИдГрупп.Вставить("мИдГруппы12", СтруктураРеквизитовФормы.мИдГруппы12);
	ИдГрупп.Вставить("мИдГруппы21", СтруктураРеквизитовФормы.мИдГруппы21);
	ИдГрупп.Вставить("мИдГруппы22", СтруктураРеквизитовФормы.мИдГруппы22);
	
	Возврат ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ИмяЛиста, , ИдГрупп, ИмяОбласти);
	
КонецФункции

&НаКлиенте
Функция ОпределитьИдМногострочногоРазделаПоАктивнойСтраницеНаКлиенте(ИмяЛиста = Неопределено, ИмяОбласти = Неопределено) Экспорт
	
	ИдГрупп = Новый Структура;
	ИдГрупп.Вставить("мИдГруппы11", СтруктураРеквизитовФормы.мИдГруппы11);
	ИдГрупп.Вставить("мИдГруппы12", СтруктураРеквизитовФормы.мИдГруппы12);
	ИдГрупп.Вставить("мИдГруппы21", СтруктураРеквизитовФормы.мИдГруппы21);
	ИдГрупп.Вставить("мИдГруппы22", СтруктураРеквизитовФормы.мИдГруппы22);
	
	Возврат ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ИмяЛиста, , ИдГрупп, ИмяОбласти);
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ИмяЛиста = Неопределено, ТекущаяСтраница, ИдГрупп, ИмяОбласти = Неопределено)
	
	Перем ИмяГруппы;
	
	Если ИмяЛиста = Неопределено Тогда
		ИмяТекущейСтраницыПанели = ТекущаяСтраница.Имя;
	Иначе
		ИмяТекущейСтраницыПанели = ИмяЛиста;
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "Раздел1" Тогда
		ИмяГруппы = ?(СтрЧислоВхождений(ИмяОбласти, "Т1") > 0
					ИЛИ СтрЧислоВхождений(ИмяОбласти, "П0000100001") > 0, ИдГрупп.мИдГруппы11, ИдГрупп.мИдГруппы12);
	ИначеЕсли ИмяТекущейСтраницыПанели = "Раздел2" Тогда
		ИмяГруппы = ?(СтрЧислоВхождений(ИмяОбласти, "Т1") > 0
					ИЛИ СтрЧислоВхождений(ИмяОбласти, "П0000200001") > 0, ИдГрупп.мИдГруппы21, ИдГрупп.мИдГруппы22);
	КонецЕсли;
	
	Возврат ИмяГруппы;
	
КонецФункции

&НаСервере
Функция СобратьДанныеТекущегоТаблПоляНаСервере(ИмяТабличногоПоля) Экспорт
	
	Возврат СобратьДанныеТекущегоТаблПоля(ЭтаФорма, ИмяТабличногоПоля);

КонецФункции

&НаКлиенте
Функция СобратьДанныеТекущегоТаблПоляНаКлиенте(ИмяТабличногоПоля) Экспорт
	
	Возврат СобратьДанныеТекущегоТаблПоля(ЭтаФорма, ИмяТабличногоПоля);
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция СобратьДанныеТекущегоТаблПоля(Форма, ИмяТабличногоПоля)
	
	СтруктураДанныхПоля = Новый Структура;
	
	Для Каждого ТекущаяОбласть Из Форма[ИмяТабличногоПоля].Области Цикл
		
		Если ТекущаяОбласть.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник И ТекущаяОбласть.СодержитЗначение = Истина Тогда
			
			СтруктураДанныхПоля.Вставить(ТекущаяОбласть.Имя, ТекущаяОбласть.Значение);
						
		КонецЕсли;
		
	КонецЦикла;
		
	Возврат СтруктураДанныхПоля;
	
КонецФункции

&НаСервере
Процедура ОчиститьТабличноеПолеНаСервере(ВыбТабличноеПолеИмя) Экспорт

	ОчиститьТабличноеПоле(ЭтаФорма, ВыбТабличноеПолеИмя);

КонецПроцедуры

&НаКлиенте
Процедура ОчиститьТабличноеПолеНаКлиенте(ВыбТабличноеПолеИмя) Экспорт

	ОчиститьТабличноеПоле(ЭтаФорма, ВыбТабличноеПолеИмя);

КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ОчиститьТабличноеПоле(Форма, ВыбТабличноеПолеИмя)

    ВыбТабличноеПоле = Форма.ТабличныйДокумент;
	
	//для очистки защищенных областей итоговых ячеек
	//получим список итоговых ячеек, снимая с них защиту), а после очищения вернем защиту
	СписокИтоговыхЯчеек = Новый СписокЗначений;
	
	Для каждого Область Из ВыбТабличноеПоле.Области Цикл
		Если ВыбТабличноеПолеИмя <> "Титульный"
		   И Область.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник
		   И Область.СодержитЗначение
		   И Область.Защита
		   И СтрНайти(Область.Имя, "НомСтр") = 0 
	       И Область.Имя <> "Руководитель" 
		   И Область.Имя <> "Бухгалтер"
		   И Область.Имя <> "ИндивидуальныйПредприниматель" Тогда

			Область.Защита = Ложь;
			СписокИтоговыхЯчеек.Добавить(Область.Имя);
			
		КонецЕсли;
	КонецЦикла;
	
	РегламентированнаяОтчетностьКлиентСервер.ОчиститьТабличноеПоле(Форма, ВыбТабличноеПолеИмя);
	
	ВыбТабличноеПоле = Форма.ТабличныйДокумент;
	
	// Непосредственно очищаем ячейки табличного документа.
	// Повторно, так как в результате расчета многостраничного многострочного блока заполняются итоговые ячейки, 
	// в арифметике которых есть показатели не из многострочного блока
	Для Инд = 0 По ВыбТабличноеПоле.Области.Количество() - 1 Цикл
		ТекущаяОбласть = ВыбТабличноеПоле.Области[Инд];

		Если Не ТекущаяОбласть.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник Тогда
			Продолжить;
		КонецЕсли;

		Если ТекущаяОбласть.СодержитЗначение <> Истина Тогда
			Продолжить;
		КонецЕсли;

		Если ТекущаяОбласть.Защита Тогда
			Продолжить;
		КонецЕсли;

		ТекущаяОбласть.Очистить();
	КонецЦикла;
	
	Для каждого КодИтоговогоПоказателя Из СписокИтоговыхЯчеек Цикл
		ОбластьПоказателя=ВыбТабличноеПоле.Области.Найти(КодИтоговогоПоказателя.Значение);
		Если ОбластьПоказателя <> Неопределено Тогда
			ОбластьПоказателя.Защита = Истина;
		КонецЕсли;
	КонецЦикла;
		
	ОчиститьСлужебныеДанныеРаздела(Форма, ВыбТабличноеПолеИмя);
			
	Если ВыбТабличноеПолеИмя = "Раздел1" Тогда
		УстановитьДоступностьПолейРаздела1(Форма);
		ПронумероватьТаблицыРаздела1(Форма);
	ИначеЕсли ВыбТабличноеПолеИмя = "Раздел2" Тогда
		УстановитьДоступностьПолейРаздела2(Форма);
		ПронумероватьТаблицыРаздела2(Форма);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ОчиститьСлужебныеДанныеРаздела(Форма, ИмяСтраницыПанели)
	
	Если Форма.мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницыПанели) Тогда

		СтраницыРаздела = Неопределено;
		
		Форма.мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницыПанели, СтраницыРаздела);
		СтраницыРаздела = Форма[СтраницыРаздела];
		
		АктивнаяСтраница = СтраницыРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
		Если АктивнаяСтраница.Количество() = 0 Тогда
			Возврат;
		Иначе
			АктивнаяСтраница = АктивнаяСтраница[0];
		КонецЕсли;
		
		Если АктивнаяСтраница.ДополнительныеДанные.Количество() = 0 Тогда
			Возврат;
		КонецЕсли;
		
		Если ТипЗнч(АктивнаяСтраница.ДополнительныеДанные[0].Значение) <> Тип("Структура") Тогда
			Возврат;
		КонецЕсли;
			
		АктивнаяСтраница.ДополнительныеДанные[0].Значение = Новый Структура;
		АктивнаяСтраница.ДополнительныеДанные[0].Пометка = Ложь;
		
	Иначе 
		
		Форма.ДополнительныеДанные[ИмяСтраницыПанели] = Неопределено;
		ВосстановитьСтруктуруДополнительныхДанных(Форма);

	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ОчиститьСтруктуру(ОчищаемаяСтруктура)
	
	Если ТипЗнч(ОчищаемаяСтруктура) <> Тип("Структура") Тогда
		Возврат;
	КонецЕсли;
	
	Для Каждого ЭлементСтруктуры Из ОчищаемаяСтруктура Цикл
		Если ТипЗнч(ЭлементСтруктуры.Значение) = Тип("Структура") Тогда
			ОчиститьСтруктуру(ОчищаемаяСтруктура[ЭлементСтруктуры.Ключ]);
		Иначе
			ОчищаемаяСтруктура[ЭлементСтруктуры.Ключ] = РегламентированнаяОтчетностьКлиентСервер.ПустоеЗначениеТипа(ТипЗнч(ЭлементСтруктуры.Значение));
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура УдалитьНеобходимоеКоличествоДопСтрокНаСервере(ВыбТабличноеПоле, ВыбТабличноеПолеИмя, ИмяГруппыДопСтрок) Экспорт
	
	// Получим таблицу значений, содержащую данные дополнительных строк.
	ПромТаблицаДопСтрокРаздела = Неопределено;
	мСтруктураМногострочныхРазделов.Свойство(ИмяГруппыДопСтрок, ПромТаблицаДопСтрокРаздела);
	
	ПромТаблицаДопСтрокРаздела = ЭтаФорма[ПромТаблицаДопСтрокРаздела];
	
	ИсходноеКоличествоСтрокГруппы = 0;
	мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппыДопСтрок, ИсходноеКоличествоСтрокГруппы);
	
	ТекущееКоличествоСтрок = ПромТаблицаДопСтрокРаздела.Количество();
	
	Если ТекущееКоличествоСтрок > ИсходноеКоличествоСтрокГруппы Тогда
		// Имеются дополнительные строки.
		// Удаляем их.
		
		НСтр = ПромТаблицаДопСтрокРаздела.Количество();
		
		Пока НСтр > ИсходноеКоличествоСтрокГруппы Цикл
			
			ТекСтрокаТаблицы = ПромТаблицаДопСтрокРаздела[НСтр - 1];
			
			ИмяПервойКолонки = ИмяГруппыДопСтрок + "00_";
			ИмяПервойЯчейкиУдаляемойСтроки  = ИмяПервойКолонки + Формат(НСтр, "ЧГ=0");
			
			// область первой ячейки удаляемой строки многострочного раздела
			ОбластьЯчейки = ВыбТабличноеПоле.Области[ИмяПервойЯчейкиУдаляемойСтроки];
			
			НомерВерхЯчейкиОбласти = ОбластьЯчейки.Верх;
			НомерНижнЯчейкиОбласти = ОбластьЯчейки.Низ;
			
			РегламентированнаяОтчетностьВызовСервера.СпециальногоУдаленияСтроки(ВыбТабличноеПоле, ВыбТабличноеПолеИмя, ИмяГруппыДопСтрок, НомерВерхЯчейкиОбласти, НомерНижнЯчейкиОбласти);
			
			// удаляем из структуры многострочного раздела соответствующую строку
			ПромТаблицаДопСтрокРаздела.Удалить(ТекСтрокаТаблицы);
			
			НСтр = НСтр - 1;
						
		КонецЦикла;	
		
		Если ВыбТабличноеПоле.Области.Найти("МногострочнаяЧасть") = Неопределено Тогда
			
			ВыбТабличноеПоле.Область(НомерВерхЯчейкиОбласти - 1, , НомерНижнЯчейкиОбласти - 1).Имя = "МногострочнаяЧасть";
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура РасчетНаКлиенте(ИмяТекущейСтраницыПанели = "", ОбластьИмя = "") Экспорт

	Расчет(ЭтаФорма, ИмяТекущейСтраницыПанели, ОбластьИмя);

КонецПроцедуры

&НаСервере
Процедура РасчетНаСервере(ИмяТекущейСтраницыПанели = "", ОбластьИмя = "") Экспорт

	Расчет(ЭтаФорма, ИмяТекущейСтраницыПанели, ОбластьИмя);

КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура Расчет(Форма, ИмяТекущейСтраницыПанели = "", Знач ОбластьИмя = "") Экспорт

	Если Форма.СтруктураРеквизитовФормы.ФлажокОтклАвтоРасчет Или Форма.СтруктураРеквизитовФормы.мРежимПечати Тогда
		Возврат;
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "Раздел1" Тогда
		
		Если Форма.СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел1" Тогда
			
			//Многострочная часть 1
			
			НомПоз = СтрНайти(ОбластьИмя, "_");
			ДлинаСтроки = СтрДлина(ОбластьИмя);
			
			Если НомПоз > 0 Тогда
				ПостфиксСтроки = "_" + Прав(ОбластьИмя, ДлинаСтроки - НомПоз);
				ОбластьИмя = Лев(ОбластьИмя, НомПоз - 1);
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) Тогда
				
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Для Инд = 1 По КоличествоСтрок Цикл
					
					ПостфиксСтроки = "_" + Формат(Инд, "ЧГ=0");
			
					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000110, ОбластьИмя) > 0 Тогда   

						Графа07 = Форма.ТабличныйДокумент.Области["П0000100001" + "07" + ПостфиксСтроки].Значение;
						Графа08 = Форма.ТабличныйДокумент.Области["П0000100001" + "08" + ПостфиксСтроки].Значение;
						Графа09 = Форма.ТабличныйДокумент.Области["П0000100001" + "09" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы10 = Графа07 + Графа08 + Графа09;
						Форма.ТабличныйДокумент.Области["П0000100001" + "10" + ПостфиксСтроки].Значение = ЗначениеГрафы10;
					
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000113, ОбластьИмя) > 0 Тогда   
					
						Графа10 = Форма.ТабличныйДокумент.Области["П0000100001" + "10" + ПостфиксСтроки].Значение;
						Графа11 = Форма.ТабличныйДокумент.Области["П0000100001" + "11" + ПостфиксСтроки].Значение;
						Графа12 = Форма.ТабличныйДокумент.Области["П0000100001" + "12" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы13 = Графа10 + Графа11 + Графа12;
						Форма.ТабличныйДокумент.Области["П0000100001" + "13" + ПостфиксСтроки].Значение = ЗначениеГрафы13;
					
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000117, ОбластьИмя) > 0 Тогда   
					
						Графа14 = Форма.ТабличныйДокумент.Области["П0000100001" + "14" + ПостфиксСтроки].Значение;
						Графа15 = Форма.ТабличныйДокумент.Области["П0000100001" + "15" + ПостфиксСтроки].Значение;
						Графа16 = Форма.ТабличныйДокумент.Области["П0000100001" + "16" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы17 = Графа14 + Графа15 + Графа16;
						Форма.ТабличныйДокумент.Области["П0000100001" + "17" + ПостфиксСтроки].Значение = ЗначениеГрафы17;
					
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000118, ОбластьИмя) > 0 Тогда   
					
						Графа06 = Форма.ТабличныйДокумент.Области["П0000100001" + "06" + ПостфиксСтроки].Значение;
						Графа13 = Форма.ТабличныйДокумент.Области["П0000100001" + "13" + ПостфиксСтроки].Значение;
						Графа17 = Форма.ТабличныйДокумент.Области["П0000100001" + "17" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы18 = Графа06 + Графа13 - Графа17;
						Форма.ТабличныйДокумент.Области["П0000100001" + "18" + ПостфиксСтроки].Значение = ЗначениеГрафы18;
						
					КонецЕсли;
					
				КонецЦикла;
				
			Иначе
					
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000110, ОбластьИмя) > 0 Тогда   
					
					Графа07 = Форма.ТабличныйДокумент.Области["П0000100001" + "07" + ПостфиксСтроки].Значение;
					Графа08 = Форма.ТабличныйДокумент.Области["П0000100001" + "08" + ПостфиксСтроки].Значение;
					Графа09 = Форма.ТабличныйДокумент.Области["П0000100001" + "09" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы10 = Графа07 + Графа08 + Графа09;
					Форма.ТабличныйДокумент.Области["П0000100001" + "10" + ПостфиксСтроки].Значение = ЗначениеГрафы10;
					
				КонецЕсли;
				
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000113, ОбластьИмя) > 0 Тогда   
					
					Графа10 = Форма.ТабличныйДокумент.Области["П0000100001" + "10" + ПостфиксСтроки].Значение;
					Графа11 = Форма.ТабличныйДокумент.Области["П0000100001" + "11" + ПостфиксСтроки].Значение;
					Графа12 = Форма.ТабличныйДокумент.Области["П0000100001" + "12" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы13 = Графа10 + Графа11 + Графа12;
					Форма.ТабличныйДокумент.Области["П0000100001" + "13" + ПостфиксСтроки].Значение = ЗначениеГрафы13;
					
				КонецЕсли;
				
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000117, ОбластьИмя) > 0 Тогда   
					
					Графа14 = Форма.ТабличныйДокумент.Области["П0000100001" + "14" + ПостфиксСтроки].Значение;
					Графа15 = Форма.ТабличныйДокумент.Области["П0000100001" + "15" + ПостфиксСтроки].Значение;
					Графа16 = Форма.ТабличныйДокумент.Области["П0000100001" + "16" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы17 = Графа14 + Графа15 + Графа16;
					Форма.ТабличныйДокумент.Области["П0000100001" + "17" + ПостфиксСтроки].Значение = ЗначениеГрафы17;
					
				КонецЕсли;
				
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000118, ОбластьИмя) > 0 Тогда   
					
					Графа06 = Форма.ТабличныйДокумент.Области["П0000100001" + "06" + ПостфиксСтроки].Значение;
					Графа13 = Форма.ТабличныйДокумент.Области["П0000100001" + "13" + ПостфиксСтроки].Значение;
					Графа17 = Форма.ТабличныйДокумент.Области["П0000100001" + "17" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы18 = Графа06 + Графа13 - Графа17;
					Форма.ТабличныйДокумент.Области["П0000100001" + "18" + ПостфиксСтроки].Значение = ЗначениеГрафы18;
					
				КонецЕсли;
					
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000206, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000206.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000206.Значение = Форма.ТабличныйДокумент.Области.П000010000206.Значение + Форма.ТабличныйДокумент.Области["П000010000106" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000207, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000207.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000207.Значение = Форма.ТабличныйДокумент.Области.П000010000207.Значение + Форма.ТабличныйДокумент.Области["П000010000107" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000208, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000208.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000208.Значение = Форма.ТабличныйДокумент.Области.П000010000208.Значение + Форма.ТабличныйДокумент.Области["П000010000108" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000209, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000209.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000209.Значение = Форма.ТабличныйДокумент.Области.П000010000209.Значение + Форма.ТабличныйДокумент.Области["П000010000109" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000210, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000210.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000210.Значение = Форма.ТабличныйДокумент.Области.П000010000210.Значение + Форма.ТабличныйДокумент.Области["П000010000110" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000211, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000211.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000211.Значение = Форма.ТабличныйДокумент.Области.П000010000211.Значение + Форма.ТабличныйДокумент.Области["П000010000111" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000212, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000212.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000212.Значение = Форма.ТабличныйДокумент.Области.П000010000212.Значение + Форма.ТабличныйДокумент.Области["П000010000112" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000213, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000213.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000213.Значение = Форма.ТабличныйДокумент.Области.П000010000213.Значение + Форма.ТабличныйДокумент.Области["П000010000113" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;

			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000214, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000214.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000214.Значение = Форма.ТабличныйДокумент.Области.П000010000214.Значение + Форма.ТабличныйДокумент.Области["П000010000114" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000215, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000215.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000215.Значение = Форма.ТабличныйДокумент.Области.П000010000215.Значение + Форма.ТабличныйДокумент.Области["П000010000115" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000216, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000216.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000216.Значение = Форма.ТабличныйДокумент.Области.П000010000216.Значение + Форма.ТабличныйДокумент.Области["П000010000116" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000217, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000217.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000217.Значение = Форма.ТабличныйДокумент.Области.П000010000217.Значение + Форма.ТабличныйДокумент.Области["П000010000117" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000218, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы11, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000218.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000218.Значение = Форма.ТабличныйДокумент.Области.П000010000218.Значение + Форма.ТабличныйДокумент.Области["П000010000118" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
						
			
			//Многострочная часть 2
			
			НомПоз = СтрНайти(ОбластьИмя, "_");
			ДлинаСтроки = СтрДлина(ОбластьИмя);
			
			Если НомПоз > 0 Тогда
				ПостфиксСтроки = "_" + Прав(ОбластьИмя, ДлинаСтроки - НомПоз);
				ОбластьИмя = Лев(ОбластьИмя, НомПоз - 1);
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) Тогда
			
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Для Инд = 1 По КоличествоСтрок Цикл
					
					ПостфиксСтроки = "_" + Формат(Инд, "ЧГ=0");

					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000310, ОбластьИмя) > 0 Тогда   

						Графа07 = Форма.ТабличныйДокумент.Области["П0000100003" + "07" + ПостфиксСтроки].Значение;
						Графа08 = Форма.ТабличныйДокумент.Области["П0000100003" + "08" + ПостфиксСтроки].Значение;
						Графа09 = Форма.ТабличныйДокумент.Области["П0000100003" + "09" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы10 = Графа07 + Графа08 + Графа09;
						Форма.ТабличныйДокумент.Области["П0000100003" + "10" + ПостфиксСтроки].Значение = ЗначениеГрафы10;
					
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000313, ОбластьИмя) > 0 Тогда   
					
						Графа10 = Форма.ТабличныйДокумент.Области["П0000100003" + "10" + ПостфиксСтроки].Значение;
						Графа11 = Форма.ТабличныйДокумент.Области["П0000100003" + "11" + ПостфиксСтроки].Значение;
						Графа12 = Форма.ТабличныйДокумент.Области["П0000100003" + "12" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы13 = Графа10 + Графа11 + Графа12;
						Форма.ТабличныйДокумент.Области["П0000100003" + "13" + ПостфиксСтроки].Значение = ЗначениеГрафы13;
					
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000317, ОбластьИмя) > 0 Тогда   
					
						Графа14 = Форма.ТабличныйДокумент.Области["П0000100003" + "14" + ПостфиксСтроки].Значение;
						Графа15 = Форма.ТабличныйДокумент.Области["П0000100003" + "15" + ПостфиксСтроки].Значение;
						Графа16 = Форма.ТабличныйДокумент.Области["П0000100003" + "16" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы17 = Графа14 + Графа15 + Графа16;
						Форма.ТабличныйДокумент.Области["П0000100003" + "17" + ПостфиксСтроки].Значение = ЗначениеГрафы17;
					
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000318, ОбластьИмя) > 0 Тогда   
					
						Графа06 = Форма.ТабличныйДокумент.Области["П0000100003" + "06" + ПостфиксСтроки].Значение;
						Графа13 = Форма.ТабличныйДокумент.Области["П0000100003" + "13" + ПостфиксСтроки].Значение;
						Графа17 = Форма.ТабличныйДокумент.Области["П0000100003" + "17" + ПостфиксСтроки].Значение;
						
						ЗначениеГрафы18 = Графа06 + Графа13 - Графа17;
						Форма.ТабличныйДокумент.Области["П0000100003" + "18" + ПостфиксСтроки].Значение = ЗначениеГрафы18;
						
					КонецЕсли;
					
				КонецЦикла;
				
			Иначе
				
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000310, ОбластьИмя) > 0 Тогда   
					
					Графа07 = Форма.ТабличныйДокумент.Области["П0000100003" + "07" + ПостфиксСтроки].Значение;
					Графа08 = Форма.ТабличныйДокумент.Области["П0000100003" + "08" + ПостфиксСтроки].Значение;
					Графа09 = Форма.ТабличныйДокумент.Области["П0000100003" + "09" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы10 = Графа07 + Графа08 + Графа09;
					Форма.ТабличныйДокумент.Области["П0000100003" + "10" + ПостфиксСтроки].Значение = ЗначениеГрафы10;
					
				КонецЕсли;
				
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000313, ОбластьИмя) > 0 Тогда   
					
					Графа10 = Форма.ТабличныйДокумент.Области["П0000100003" + "10" + ПостфиксСтроки].Значение;
					Графа11 = Форма.ТабличныйДокумент.Области["П0000100003" + "11" + ПостфиксСтроки].Значение;
					Графа12 = Форма.ТабличныйДокумент.Области["П0000100003" + "12" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы13 = Графа10 + Графа11 + Графа12;
					Форма.ТабличныйДокумент.Области["П0000100003" + "13" + ПостфиксСтроки].Значение = ЗначениеГрафы13;
					
				КонецЕсли;
				
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000317, ОбластьИмя) > 0 Тогда   
					
					Графа14 = Форма.ТабличныйДокумент.Области["П0000100003" + "14" + ПостфиксСтроки].Значение;
					Графа15 = Форма.ТабличныйДокумент.Области["П0000100003" + "15" + ПостфиксСтроки].Значение;
					Графа16 = Форма.ТабличныйДокумент.Области["П0000100003" + "16" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы17 = Графа14 + Графа15 + Графа16;
					Форма.ТабличныйДокумент.Области["П0000100003" + "17" + ПостфиксСтроки].Значение = ЗначениеГрафы17;
					
				КонецЕсли;
				
				Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000318, ОбластьИмя) > 0 Тогда   
					
					Графа06 = Форма.ТабличныйДокумент.Области["П0000100003" + "06" + ПостфиксСтроки].Значение;
					Графа13 = Форма.ТабличныйДокумент.Области["П0000100003" + "13" + ПостфиксСтроки].Значение;
					Графа17 = Форма.ТабличныйДокумент.Области["П0000100003" + "17" + ПостфиксСтроки].Значение;
					
					ЗначениеГрафы18 = Графа06 + Графа13 - Графа17;
					Форма.ТабличныйДокумент.Области["П0000100003" + "18" + ПостфиксСтроки].Значение = ЗначениеГрафы18;
					
				КонецЕсли;
				
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000406, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000406.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000406.Значение = Форма.ТабличныйДокумент.Области.П000010000406.Значение + Форма.ТабличныйДокумент.Области["П000010000306" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;

			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000407, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000407.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000407.Значение = Форма.ТабличныйДокумент.Области.П000010000407.Значение + Форма.ТабличныйДокумент.Области["П000010000307" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000408, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000408.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000408.Значение = Форма.ТабличныйДокумент.Области.П000010000408.Значение + Форма.ТабличныйДокумент.Области["П000010000308" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000409, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000409.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000409.Значение = Форма.ТабличныйДокумент.Области.П000010000409.Значение + Форма.ТабличныйДокумент.Области["П000010000309" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000410, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000410.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000410.Значение = Форма.ТабличныйДокумент.Области.П000010000410.Значение + Форма.ТабличныйДокумент.Области["П000010000310" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000411, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000411.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000411.Значение = Форма.ТабличныйДокумент.Области.П000010000411.Значение + Форма.ТабличныйДокумент.Области["П000010000311" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000412, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000412.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000412.Значение = Форма.ТабличныйДокумент.Области.П000010000412.Значение + Форма.ТабличныйДокумент.Области["П000010000312" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000413, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000413.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000413.Значение = Форма.ТабличныйДокумент.Области.П000010000413.Значение + Форма.ТабличныйДокумент.Области["П000010000313" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;

			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000414, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000414.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000414.Значение = Форма.ТабличныйДокумент.Области.П000010000414.Значение + Форма.ТабличныйДокумент.Области["П000010000314" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000415, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000415.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000415.Значение = Форма.ТабличныйДокумент.Области.П000010000415.Значение + Форма.ТабличныйДокумент.Области["П000010000315" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000416, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000416.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000416.Значение = Форма.ТабличныйДокумент.Области.П000010000416.Значение + Форма.ТабличныйДокумент.Области["П000010000316" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000417, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000417.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000417.Значение = Форма.ТабличныйДокумент.Области.П000010000417.Значение + Форма.ТабличныйДокумент.Области["П000010000317" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000010000418, ОбластьИмя) > 0 Тогда   
						
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы12, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				КоличествоСтрок = СтруктураГруппы.Количество();
				Форма.ТабличныйДокумент.Области.П000010000418.Значение = 0;
				Для Инд = 1 По КоличествоСтрок Цикл
					Постфикс = "_" + Формат(Инд, "ЧГ=0");
					Форма.ТабличныйДокумент.Области.П000010000418.Значение = Форма.ТабличныйДокумент.Области.П000010000418.Значение + Форма.ТабличныйДокумент.Области["П000010000318" + Постфикс].Значение;
				КонецЦикла;
			
			КонецЕсли;
			
		КонецЕсли;
					
	ИначеЕсли ИмяТекущейСтраницыПанели = "Раздел2" Тогда
		
		Если Форма.СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел2" Тогда
			
			НомПоз = СтрНайти(ОбластьИмя, "_");
			ДлинаСтроки = СтрДлина(ОбластьИмя);
			
			Если НомПоз > 0 Тогда
				ПостфиксСтроки = "_" + Прав(ОбластьИмя, ДлинаСтроки - НомПоз);
				ОбластьИмя = Лев(ОбластьИмя, НомПоз - 1);
			КонецЕсли;			

			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000020000212, ОбластьИмя) > 0 Тогда   
			
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы21, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				СуммаГрафы12 = 0;
				Для Инд = 1 По СтруктураГруппы.Количество() Цикл
					ПостфиксСтроки = "_" + Формат(Инд, "ЧГ=0");
					СуммаГрафы12 = СуммаГрафы12 + Форма.ТабличныйДокумент.Области["П000020000112" + ПостфиксСтроки].Значение;
				КонецЦикла;
				Форма.ТабличныйДокумент.Области["П000020000212"].Значение = СуммаГрафы12;
				
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(ОбластьИмя) ИЛИ СтрЧислоВхождений(Форма.СтруктураЗависимыхЯчеекДляАвторасчета.П000020000412, ОбластьИмя) > 0 Тогда   
			
				СтруктураГруппы = Неопределено;
				Форма.мСтруктураМногострочныхРазделов.Свойство(Форма.СтруктураРеквизитовФормы.мИдГруппы22, СтруктураГруппы);
				СтруктураГруппы = Форма[СтруктураГруппы];
				
				СуммаГрафы12 = 0;
				Для Инд = 1 По СтруктураГруппы.Количество() Цикл
					ПостфиксСтроки = "_" + Формат(Инд, "ЧГ=0");
					СуммаГрафы12 = СуммаГрафы12 + Форма.ТабличныйДокумент.Области["П000020000312" + ПостфиксСтроки].Значение;
				КонецЦикла;
				Форма.ТабличныйДокумент.Области["П000020000412"].Значение = СуммаГрафы12;
				
			КонецЕсли;
			
		КонецЕсли;
					
	ИначеЕсли ИмяТекущейСтраницыПанели = "" Тогда
		
		РасчетВСтруктуре(Форма);
		Расчет(Форма, "Раздел1");
		Расчет(Форма, "Раздел2");
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура РасчетВСтруктуре(Форма);
	
	// Расчет осуществляется по структуре многостраничных разделов.
	
	ТаблицаРаздела = Форма[Форма.мСтруктураМногостраничныхРазделов["Раздел1"]];
	
	Для Каждого Страница Из ТаблицаРаздела Цикл
		
		Данные = Страница.Данные[0].Значение;
		Если (Данные = Неопределено) ИЛИ (Тип(Данные) <> Тип("Структура")) Тогда
			Продолжить;
		КонецЕсли;
		
		ТаблицаБлока = Страница.ДанныеДопСтрок[0].Значение.П0000100003;
		
		Если ТаблицаБлока <> Неопределено Тогда
			
			СписокСуммируемыхГраф = "06,07,08,09,10,11,12,13,14,15,16,17,18";
			МассивНомеровГраф = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(СписокСуммируемыхГраф);
			СуммыПоГрафам = Новый Соответствие;
			Для Каждого Графа Из МассивНомеровГраф Цикл
				СуммыПоГрафам.Вставить(Графа, 0);
			КонецЦикла;
			
			Для Каждого ТекСтрока из ТаблицаБлока Цикл
				
				ИндексТекСтроки =  ТаблицаБлока.Индекс(ТекСтрока) + 1;
				
				ПостфиксСтроки = "_" + Формат(ИндексТекСтроки, "ЧГ=0");
				
				Графа07 = ТекСтрока["П0000100003" + "07"];
				Графа08 = ТекСтрока["П0000100003" + "08"];
				Графа09 = ТекСтрока["П0000100003" + "09"];
				
				ЗначениеГрафы10 = Графа07 + Графа08 + Графа09;
				ТекСтрока["П0000100003" + "10"] = ЗначениеГрафы10;
				
				Графа10 = ТекСтрока["П0000100003" + "10"];
				Графа11 = ТекСтрока["П0000100003" + "11"];
				Графа12 = ТекСтрока["П0000100003" + "12"];
				
				ЗначениеГрафы13 = Графа10 + Графа11 + Графа12;
				ТекСтрока["П0000100003" + "13"] = ЗначениеГрафы13;
				
				Графа14 = ТекСтрока["П0000100003" + "14"];
				Графа15 = ТекСтрока["П0000100003" + "15"];
				Графа16 = ТекСтрока["П0000100003" + "16"];
				
				ЗначениеГрафы17 = Графа14 + Графа15 + Графа16;
				ТекСтрока["П0000100003" + "17"] = ЗначениеГрафы17;
				
				Графа06 = ТекСтрока["П0000100003" + "06"];
				Графа13 = ТекСтрока["П0000100003" + "13"];
				Графа17 = ТекСтрока["П0000100003" + "17"];
				
				ЗначениеГрафы18 = Графа06 + Графа13 - Графа17;
				ТекСтрока["П0000100003" + "18"] = ЗначениеГрафы18;
				
				// Учет строки в суммах по графам.
				Для Каждого Графа Из МассивНомеровГраф Цикл
					ЗначениеГрафы = ТекСтрока["П0000100003" + Графа];
					СуммыПоГрафам.Вставить(Графа, СуммыПоГрафам[Графа] + ЗначениеГрафы);
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЕсли;
		
		Для Каждого Графа Из МассивНомеровГраф Цикл
			Данные["П0000100004" + Графа] = СуммыПоГрафам[Графа];
		КонецЦикла;
		
		ТаблицаБлока = Страница.ДанныеДопСтрок[0].Значение.П0000100001;
		
		Если ТаблицаБлока <> Неопределено Тогда
			
			СписокСуммируемыхГраф = "06,07,08,09,10,11,12,13,14,15,16,17,18";
			МассивНомеровГраф = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(СписокСуммируемыхГраф);
			СуммыПоГрафам = Новый Соответствие;
			Для Каждого Графа Из МассивНомеровГраф Цикл
				СуммыПоГрафам.Вставить(Графа, 0);
			КонецЦикла;
			
			Для Каждого ТекСтрока из ТаблицаБлока Цикл
				
				ИндексТекСтроки =  ТаблицаБлока.Индекс(ТекСтрока) + 1;
				
				ПостфиксСтроки = "_" + Формат(ИндексТекСтроки, "ЧГ=0");
				
				Графа07 = ТекСтрока["П0000100001" + "07"];
				Графа08 = ТекСтрока["П0000100001" + "08"];
				Графа09 = ТекСтрока["П0000100001" + "09"];
				
				ЗначениеГрафы10 = Графа07 + Графа08 + Графа09;
				ТекСтрока["П0000100001" + "10"] = ЗначениеГрафы10;
				
				Графа10 = ТекСтрока["П0000100001" + "10"];
				Графа11 = ТекСтрока["П0000100001" + "11"];
				Графа12 = ТекСтрока["П0000100001" + "12"];
				
				ЗначениеГрафы13 = Графа10 + Графа11 + Графа12;
				ТекСтрока["П0000100001" + "13"] = ЗначениеГрафы13;
				
				Графа14 = ТекСтрока["П0000100001" + "14"];
				Графа15 = ТекСтрока["П0000100001" + "15"];
				Графа16 = ТекСтрока["П0000100001" + "16"];
				
				ЗначениеГрафы17 = Графа14 + Графа15 + Графа16;
				ТекСтрока["П0000100001" + "17"] = ЗначениеГрафы17;
				
				Графа06 = ТекСтрока["П0000100001" + "06"];
				Графа13 = ТекСтрока["П0000100001" + "13"];
				Графа17 = ТекСтрока["П0000100001" + "17"];
				
				ЗначениеГрафы18 = Графа06 + Графа13 - Графа17;
				ТекСтрока["П0000100001" + "18"] = ЗначениеГрафы18;
				
				// Учет строки в суммах по графам.
				Для Каждого Графа Из МассивНомеровГраф Цикл
					ЗначениеГрафы = ТекСтрока["П0000100001" + Графа];
					СуммыПоГрафам.Вставить(Графа, СуммыПоГрафам[Графа] + ЗначениеГрафы);
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЕсли;
		
		Для Каждого Графа Из МассивНомеровГраф Цикл
			Данные["П0000100002" + Графа] = СуммыПоГрафам[Графа];
		КонецЦикла;
		
		//Для инициализации обмена с сервером
		Страница.Данные[0].Пометка = Ложь;
		Страница.ДанныеДопСтрок[0].Пометка = Ложь;
		
	КонецЦикла;
	
	
	ТаблицаРаздела = Форма[Форма.мСтруктураМногостраничныхРазделов["Раздел2"]];
	
	Для Каждого Страница Из ТаблицаРаздела Цикл
		
		Данные = Страница.Данные[0].Значение;
		Если (Данные = Неопределено) ИЛИ (Тип(Данные) <> Тип("Структура")) Тогда
			Продолжить;
		КонецЕсли;
		
		ТаблицаБлока = Страница.ДанныеДопСтрок[0].Значение.П0000200001;
		
		Если ТаблицаБлока <> Неопределено Тогда
			
			СуммаГрафы12 = 0;
			Для Каждого ТекСтрока из ТаблицаБлока Цикл
				
				ИндексТекСтроки =  ТаблицаБлока.Индекс(ТекСтрока) + 1;
				ПостфиксСтроки = "_" + Формат(ИндексТекСтроки, "ЧГ=0");
				СуммаГрафы12 = СуммаГрафы12 + ТекСтрока["П000020000112"];
				
			КонецЦикла;
			
		КонецЕсли;
		
		Данные["П000020000212"] = СуммаГрафы12;
		
		
		ТаблицаБлока = Страница.ДанныеДопСтрок[0].Значение.П0000200003;
		
		Если ТаблицаБлока <> Неопределено Тогда
			
			СуммаГрафы12 = 0;
			Для Каждого ТекСтрока из ТаблицаБлока Цикл
				
				ИндексТекСтроки =  ТаблицаБлока.Индекс(ТекСтрока) + 1;
				ПостфиксСтроки = "_" + Формат(ИндексТекСтроки, "ЧГ=0");
				СуммаГрафы12 = СуммаГрафы12 + ТекСтрока["П000020000312"];
				
			КонецЦикла;
			
		КонецЕсли;
		
		Данные["П000020000412"] = СуммаГрафы12;
		
		//Для инициализации обмена с сервером
		Страница.Данные[0].Пометка = Ложь;
		Страница.ДанныеДопСтрок[0].Пометка = Ложь;

	КонецЦикла;
		
КонецПроцедуры
	
&НаКлиенте
Процедура УстановитьЦветФонаЯчейкиНаКлиенте(ИмяЯчейки = Неопределено, ВариантЗаполнения = Неопределено, ИмяТекущейСтраницыПанели = "") Экспорт
	
	УстановитьЦветФонаЯчейки(ЭтаФорма, ИмяЯчейки, ВариантЗаполнения, ИмяТекущейСтраницыПанели);
	
КонецПроцедуры

&НаСервере
Процедура УстановитьЦветФонаЯчейкиНаСервере(ИмяЯчейки = Неопределено, ВариантЗаполнения = Неопределено, ИмяТекущейСтраницыПанели = "") Экспорт
	
	УстановитьЦветФонаЯчейки(ЭтаФорма, ИмяЯчейки, ВариантЗаполнения, ИмяТекущейСтраницыПанели);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УстановитьЦветФонаЯчейки(Форма, ИмяЯчейки = Неопределено, ВариантЗаполнения = Неопределено, ИмяТекущейСтраницыПанели = "") Экспорт
	
	Перем ЦветФона;
	Перем Комментарий;

	Если Форма.СтруктураРеквизитовФормы.мБезОткрытияФормы Тогда
		Возврат;
	КонецЕсли;

	Если Не ИмяЯчейки = Неопределено Тогда
		// устанавливаем цвет фона конкретной ячейки
		#Если НаКлиенте Тогда
			ИмяСтраницыПанели = РегламентированнаяОтчетностьКлиент.ОпределитьСтраницуПанелиПоКодуПоказателяНаКлиенте(Форма, ИмяЯчейки);
		#Иначе
			ИмяСтраницыПанели = РегламентированнаяОтчетностьВызовСервера.ОпределитьСтраницуПанелиПоКодуПоказателяНаСервере(Форма, ИмяЯчейки);
		#КонецЕсли
		Если ИмяСтраницыПанели = Неопределено Тогда
			Возврат;
		КонецЕсли;

		ИмяПоляТаблДокумента = "ТабличныйДокумент";

		Ключ = "_" + ВариантЗаполнения;
		Форма.мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);

		ЗначениеВКвадратах = РегламентированнаяОтчетностьКлиентСервер.ОбластьЯвляетсяЯчейкойСоставногоПоля(Форма, ИмяЯчейки);

		Если ВариантЗаполнения = 4 ИЛИ ВариантЗаполнения = 5 Тогда

			Если ЗначениеВКвадратах Тогда
				// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
				РегламентированнаяОтчетностьКлиентСервер.СвойстваГрупповыхЗначений(Форма, ИмяЯчейки, "УстановитьЗащиту");
			Иначе
				Форма[ИмяПоляТаблДокумента].Области[ИмяЯчейки].Защита = Истина;
			КонецЕсли;

		Иначе

			Если ЗначениеВКвадратах Тогда
				// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
				РегламентированнаяОтчетностьКлиентСервер.СвойстваГрупповыхЗначений(Форма, ИмяЯчейки, "СнятьЗащиту");
			Иначе
				Форма[ИмяПоляТаблДокумента].Области[ИмяЯчейки].Защита = Ложь;
			КонецЕсли;
			
		КонецЕсли;

		// установим цвет ячейки
		Если ЗначениеВКвадратах Тогда
			РегламентированнаяОтчетностьКлиентСервер.СвойстваГрупповыхЗначений(Форма, ИмяЯчейки, "ПроставитьЦветРаскраски", ЦветФона);
		Иначе
			Форма[ИмяПоляТаблДокумента].Области[ИмяЯчейки].ЦветФона = ЦветФона;
		КонецЕсли;

	Иначе
		// устанавливаем цвет фона всех автозаполняемых ячеек активной страницы

		#Если НаКлиенте Тогда
			ТаблицаВариантыЗаполнения = РегламентированнаяОтчетностьКлиент.ПолучитьТаблицуВариантовЗаполненияНаКлиенте(Форма, ИмяТекущейСтраницыПанели);
		#Иначе
			ТаблицаВариантыЗаполнения = РегламентированнаяОтчетностьВызовСервера.ПолучитьТаблицуВариантовЗаполненияНаСервере(Форма, ИмяТекущейСтраницыПанели);
		#КонецЕсли
		
		Если ТаблицаВариантыЗаполнения = Неопределено Тогда
			Возврат;
		КонецЕсли;

		Для Каждого Строка Из ТаблицаВариантыЗаполнения Цикл
			ИмяПоказателя            =  Строка.КодПоказателя;
			ВариантЗаполнения        =  Строка.ВариантЗаполнения;
			Комментарий              =  Строка.Комментарий;
			КодПоказателяПоСтруктуре =  Строка.КодПоказателяПоСтруктуре;

			КолвоСтрокВМногострочнойЧасти = РегламентированнаяОтчетностьКлиентСервер.ПоказательВходитВМногострочнуюЧасть(Форма, ИмяПоказателя);

			Если КолвоСтрокВМногострочнойЧасти > 0 Тогда
				Многострочность = Истина;
				БазоваяЧасть = ИмяПоказателя;
				
			Иначе
				Многострочность = Ложь;
				КолвоСтрокВМногострочнойЧасти = 1;
			КонецЕсли;

			Для Инд = 1 по КолвоСтрокВМногострочнойЧасти Цикл

				Если Многострочность Тогда
					ИмяПоказателя = БазоваяЧасть + "_" + Формат(Инд, "ЧГ=0");
				КонецЕсли;

				ТекОбластьЯчеек = Форма.ТабличныйДокумент.Области[ИмяПоказателя];
				Если (Не ПустаяСтрока(Комментарий)) ИЛИ (Не ПустаяСтрока(ТекОбластьЯчеек.Примечание.Текст)) Тогда
					ТекОбластьЯчеек.Примечание.Текст = Комментарий;
				КонецЕсли;

				Ключ = "_" + ВариантЗаполнения;
				Форма.мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);

				ЗначениеВКвадратах = ?(ПустаяСтрока(КодПоказателяПоСтруктуре), Ложь, Истина);

				Если ВариантЗаполнения = 4 ИЛИ ВариантЗаполнения = 5 Тогда

					Если ЗначениеВКвадратах Тогда
						// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
						РегламентированнаяОтчетностьКлиентСервер.СвойстваГрупповыхЗначений(Форма, ИмяПоказателя, "УстановитьЗащиту");
					Иначе
						Форма.ТабличныйДокумент.Области[ИмяПоказателя].Защита = Истина;
					КонецЕсли;

				Иначе

					Если ЗначениеВКвадратах Тогда
						// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
						РегламентированнаяОтчетностьКлиентСервер.СвойстваГрупповыхЗначений(Форма, ИмяПоказателя, "СнятьЗащиту");
					Иначе
						Форма.ТабличныйДокумент.Области[ИмяПоказателя].Защита = Ложь;
					КонецЕсли;
				КонецЕсли;

				Если ЗначениеВКвадратах Тогда
					РегламентированнаяОтчетностьКлиентСервер.СвойстваГрупповыхЗначений(Форма, ИмяПоказателя, "ПроставитьЦветРаскраски", ЦветФона);
				Иначе
					Форма.ТабличныйДокумент.Области[ИмяПоказателя].ЦветФона = ЦветФона;
				КонецЕсли;
			КонецЦикла;

		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьСтроку(Команда, ИмяОбласти = "")
	
	ИмяОбласти = ЭтаФорма["ТабличныйДокумент"].ТекущаяОбласть.Имя;
	
	ДобавитьСтрокуНаСервере(Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим, ИмяОбласти);
	
КонецПроцедуры

&НаСервере
Процедура ДобавитьСтрокуНаСервере(КолонкаРазделыОтчетаСокрНаим, ИмяОбласти = Неопределено)
	
	ВставитьДополнительнуюСтроку(ЭтаФорма, КолонкаРазделыОтчетаСокрНаим, ИмяОбласти);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ВставитьДополнительнуюСтроку(Форма, ТекущаяСтраница, ИмяОбласти = Неопределено)
	
	Перем СтруктураГруппы;
	Перем МаксимальноеКоличествоСтрокГруппы;
	
	// Сначала выполним проверку на активную страницу панели формы, которая содержит многострочный раздел.
	#Если НаКлиенте Тогда
		ИмяГруппы = Форма.ОпределитьИдМногострочногоРазделаПоАктивнойСтраницеНаКлиенте(ТекущаяСтраница, ИмяОбласти);
	#Иначе
		ИмяГруппы = Форма.ОпределитьИдМногострочногоРазделаПоАктивнойСтраницеНаСервере(ТекущаяСтраница, ИмяОбласти);
	#КонецЕсли
	
	Если ИмяГруппы = Неопределено Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru='Не выбран многострочный раздел, в который необходимо добавить строку.'");
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;
	
	Если ТекущаяСтраница = "Раздел1" И ИмяГруппы = "П0000100001"
	 ИЛИ ТекущаяСтраница = "Раздел2" И ИмяГруппы = "П0000200001" Тогда
		
		СтраницыРаздела = Неопределено;
		Форма.мСтруктураМногостраничныхРазделов.Свойство(ТекущаяСтраница, СтраницыРаздела);
		СтраницыРаздела = Форма[СтраницыРаздела];
		АктивнаяСтраница = СтраницыРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
		
		Если АктивнаяСтраница.Количество() > 0 Тогда
			АктивнаяСтраница = АктивнаяСтраница[0];
			ИндексСтраницы = СтраницыРаздела.Индекс(АктивнаяСтраница);
		Иначе
			Возврат;
		КонецЕсли;
		
		Если ИндексСтраницы <> 0 Тогда			
			Возврат;
		КонецЕсли;
		
	КонецЕсли;
	
	Модифицированность = Истина;
	
	// Исходное количество строк группы
	Форма.мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, МаксимальноеКоличествоСтрокГруппы);
    	
	ТекТабличноеПолеИмя = "ТабличныйДокумент";
	
	ТекТабличноеПоле = Форма[ТекТабличноеПолеИмя];
		
	Форма.мСтруктураМногострочныхРазделов.Свойство(ИмяГруппы, СтруктураГруппы);
	
	СтруктураГруппы = Форма[СтруктураГруппы];

	// определяем последнюю строку многострочной группы
	КолСтрок = СтруктураГруппы.Количество();
	КолСтрокСтр = Формат(КолСтрок, "ЧГ=0");
	КолСтрокСтр1 = Формат(КолСтрок + 1, "ЧГ=0");
	ИмяПервойЯчейкиПоследнейСтроки = ИмяГруппы + "00_" + КолСтрокСтр;

	// область первой ячейки последней строки многострочного раздела
	ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяПервойЯчейкиПоследнейСтроки];
	
	НастройкиМнгЧ = РегламентированнаяОтчетностьКлиентСервер.ПолучитьСвойствоРаздела(Форма, Форма.СтруктураРеквизитовФормы.НаимТекущегоРаздела, "МногострочностьВРазделе").НайтиСтроки(Новый Структура("ИдГруппы", ИмяГруппы))[0];
	ВысотаСтроки = НастройкиМнгЧ.ВысотаСтроки;
	
	// номера строк исходной области
	НомерВерхЯчейкиОбласти = ОбластьЯчейки.Верх;
	НомерНижнЯчейкиОбласти = ОбластьЯчейки.Низ;
	СдвигСтрок = НомерНижнЯчейкиОбласти - НомерВерхЯчейкиОбласти + 1;

	// номера строк вставляемой области
	НомерВерхЯчейкиНовойОбласти = НомерВерхЯчейкиОбласти + СдвигСтрок;
	НомерНижнЯчейкиНовойОбласти = НомерНижнЯчейкиОбласти + СдвигСтрок;

	РегламентированнаяОтчетностьВызовСервера.СпециальногоДобавленияСтроки(ТекТабличноеПоле, ТекТабличноеПолеИмя, ИмяГруппы, НомерВерхЯчейкиОбласти, НомерНижнЯчейкиОбласти);
	
	Форма[ТекТабличноеПолеИмя] = ТекТабличноеПоле;
	
	СписокИменКолонокРаздела = Форма.мСтруктураИменаКолонокРазделов[ИмяГруппы];
	
	Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
		
		ИмяКолонки = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
		
		// переопределяем имена вставленной области
		Если СтруктураГруппы[0].Свойство(ИмяКолонки) Тогда
			
			ИмяОбластиЯчейки    = ИмяКолонки + "_" + КолСтрокСтр;
			ИмяНовОбластиЯчейки = ИмяКолонки + "_" + КолСтрокСтр1;
			
			ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяОбластиЯчейки];
			ОбластьЯчейки.Имя = ИмяНовОбластиЯчейки;
			
			Если Прав(ИмяКолонки, 2) = "00" Тогда
				ТекТабличноеПоле.Области["УдалитьСтроку" + ИмяОбластиЯчейки].Имя = "УдалитьСтроку" + ИмяНовОбластиЯчейки;
			КонецЕсли;
			
			// определяем границы ячейки исходной области
			НомерВерхСтрокиЯчейки  = ОбластьЯчейки.Верх - СдвигСтрок;
			НомерНижнСтрокиЯчейки  = ОбластьЯчейки.Низ  - СдвигСтрок;
			
			НомерЛевоКолонкиЯчейки = ОбластьЯчейки.Лево;
			НомерПравКолонкиЯчейки = ОбластьЯчейки.Право;
			
			// Назначаем имя ячейки исходной области,
			// (т.к. в результате вставки новой области оно было очищено)
			ОбластьЯчейкиИсходнойОбласти = ТекТабличноеПоле.Область(НомерВерхСтрокиЯчейки, НомерЛевоКолонкиЯчейки, НомерНижнСтрокиЯчейки, НомерПравКолонкиЯчейки);
			ОбластьЯчейкиИсходнойОбласти.Имя = ИмяОбластиЯчейки;
			
			Если Прав(ИмяКолонки, 2) = "00" Тогда
				ТекТабличноеПоле.Область(НомерВерхСтрокиЯчейки, НомерЛевоКолонкиЯчейки - 1, НомерНижнСтрокиЯчейки, НомерПравКолонкиЯчейки - 1).Имя = "УдалитьСтроку" + ИмяОбластиЯчейки;
			КонецЕсли;
			
			// очищаем значения ячеек вставленной области
			Если ОбластьЯчейки.СодержитЗначение = Истина Тогда
				ОбластьЯчейки.Очистить();
			Иначе
				// порядековый номер последней строки перед вставкой
				ИсходныйНомер        = Число("0" + ОбластьЯчейки.Текст);
				НовыйПорядковыйНомер = ИсходныйНомер + 1;
				
				ОбластьЯчейки.Текст  = ? (НЕ НовыйПорядковыйНомер > МаксимальноеКоличествоСтрокГруппы, Строка(НовыйПорядковыйНомер), "");
				
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	// Назначим текущей областью таблицы первую редактируемую ячейку добавленной строки.
	// Определяем текущую область таблицы
	ИмяТекущейОбласти = ИмяГруппы + "00_" + КолСтрокСтр1;
	
	Форма.Элементы[ТекТабличноеПолеИмя].ТекущаяОбласть = ТекТабличноеПоле.Области[ИмяТекущейОбласти];
	
	// установим фокус на поле табличн. документа
	Форма.ТекущийЭлемент = Форма.Элементы[ТекТабличноеПолеИмя];
	
	// добавляем в структуру многострочной группы новую строку
	СтруктураГруппы.Добавить();
	
	МассивОбластейСДопСтроками = Новый Массив;
	
	Для Каждого ОбластьТД Из Форма.ТабличныйДокумент.Области Цикл
		Если СтрЧислоВхождений(ОбластьТД.Имя, "УдалитьСтроку") > 0 Тогда
			Если СтрЧислоВхождений(ОбластьТД.Имя, "_2") > 0 Тогда
				МассивОбластейСДопСтроками.Добавить(Лев(ОбластьТД.Имя, 26));
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	Для Каждого ОбластьТД Из Форма.ТабличныйДокумент.Области Цикл
		Если СтрЧислоВхождений(ОбластьТД.Имя, "УдалитьСтроку") > 0 Тогда
			Если МассивОбластейСДопСтроками.Найти(Лев(ОбластьТД.Имя, 26)) = Неопределено Тогда
				ОбластьТД.Гиперссылка = Ложь;
				ОбластьТД.Текст = "";
			Иначе
				ОбластьТД.Гиперссылка = Истина;
				ОбластьТД.Текст = "х";
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	Если Форма.СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел1" Тогда
		ПронумероватьТаблицыРаздела1(Форма);
	ИначеЕсли Форма.СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел2" Тогда
		ПронумероватьТаблицыРаздела2(Форма);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура УдалитьСтроку(Команда, ИмяОбласти = "")
	
	ТекТабличноеПоле = ЭтаФорма["ТабличныйДокумент"];
	
	ТекущаяОбласть = ТекТабличноеПоле.ТекущаяОбласть;
	ИмяОбласти     = ТекТабличноеПоле.ТекущаяОбласть.Имя;
	
	ИмяГруппы = ОпределитьИдМногострочногоРазделаПоАктивнойСтраницеНаКлиенте(СтруктураРеквизитовФормы.НаимТекущегоРаздела, ИмяОбласти);
	
	Если ИмяГруппы = Неопределено
	 ИЛИ ((ИмяГруппы = "П0000100001" ИЛИ ИмяГруппы = "П0000200001")
	   И Элементы.РазделыОтчета.ТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета > 1) Тогда
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru='Не выбрана удаляемая строка многострочного раздела.'");
		Сообщение.Сообщить();
		
		Возврат;
		
	КонецЕсли;
	
	ТекстВопроса = НСтр("ru='Удалить выбранную строку?'");
	ОписаниеОповещения = Новый ОписаниеОповещения("УдалитьСтрокуЗавершение", ЭтотОбъект, Новый Структура("ИмяГруппы", ИмяГруппы));
	ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Да);
	
КонецПроцедуры

&НаКлиенте
Процедура УдалитьСтрокуЗавершение(РезультатВопроса, ДополнительныеПараметры) Экспорт
	
	ИмяГруппы = ДополнительныеПараметры.ИмяГруппы;
	
	Если РезультатВопроса <> КодВозвратаДиалога.Да Тогда
		Возврат;
	КонецЕсли;
	
	#Если ВебКлиент Тогда
		
		УдалитьДополнительнуюСтрокуНаСервере(Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим, ИмяГруппы);
		
	#Иначе
		
		УдалитьДополнительнуюСтрокуНаКлиенте(Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим, ИмяГруппы);
		
	#КонецЕсли
	
КонецПроцедуры

&НаСервере
Процедура УдалитьДополнительнуюСтрокуНаСервере(ТекущаяСтраница, ИмяГруппы)
	
	УдалитьДополнительнуюСтроку(ЭтаФорма, , , ТекущаяСтраница, ИмяГруппы);
	
КонецПроцедуры

&НаКлиенте
Процедура УдалитьДополнительнуюСтрокуНаКлиенте(ТекущаяСтраница, ИмяГруппы)
	
	УдалитьДополнительнуюСтроку(ЭтаФорма, , , ТекущаяСтраница, ИмяГруппы);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УдалитьДополнительнуюСтроку(Форма, СпециальноеДобавление = Ложь, ИмяКолонкиНомера = Неопределено, ТекущаяСтраница, ИмяГруппы) Экспорт
	Перем ИсходноеКоличествоСтрокГруппы;
	Перем СтруктураГруппы;
	
	// исходное количество строк группы
	Форма.мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, ИсходноеКоличествоСтрокГруппы);
	
	Форма.мСтруктураМногострочныхРазделов.Свойство(ИмяГруппы, СтруктураГруппы);
	
	ТекТабличноеПолеИмя = "ТабличныйДокумент";
	
	ТекТабличноеПоле = Форма[ТекТабличноеПолеИмя];
	ТекущаяОбласть = Форма.Элементы[ТекТабличноеПолеИмя].ТекущаяОбласть;
	ИмяЯчейки      = ТекущаяОбласть.Имя;
	
	#Если НаКлиенте ИЛИ ТолстыйКлиентУправляемоеПриложение Тогда
		ИмяГруппы = РегламентированнаяОтчетностьКлиент.РазделТекущейОбласти(Форма, ТекущаяОбласть);
	#Иначе
		ИмяГруппы = РегламентированнаяОтчетностьВызовСервера.РазделТекущейОбластиНаСервере(Форма, ТекущаяОбласть);
	#КонецЕсли
	
	// предварительно обновим структуру многострочных разделов
	ОбновитьСтруктуруМногострочногоРаздела(Форма, ИмяГруппы);
	
	// номер строки многострочного раздела определим
	// по имени выделенной ячейки
	НомУдаляемойСтроки = Число( Сред( ИмяЯчейки, СтрНайти( ИмяЯчейки, "_") + 1));
	НомУдаляемойСтрокиСтр = Формат(НомУдаляемойСтроки, "ЧГ=");
	НомерСтрокиТаблицы = НомУдаляемойСтроки - 1; // нумерация строк в таблице значений начинается с нуля
	СтруктураГруппы = Форма[СтруктураГруппы];
	
	// Удаление дополнительных данных.
	СтраницыРаздела = Неопределено;
	РазделМногостраничный = Форма.мСтруктураМногостраничныхРазделов.Свойство(ТекущаяСтраница, СтраницыРаздела);
	АктивнаяСтраница = Неопределено;
	ДопДанные = Ложь;
	
	СписокИменКолонокРаздела = Форма.мСтруктураИменаКолонокРазделов[ИмяГруппы];
	
	Если РазделМногостраничный Тогда
		СтраницыРаздела = Форма[СтраницыРаздела];
		АктивнаяСтраница = СтраницыРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
		Если АктивнаяСтраница.Количество() > 0 Тогда
			АктивнаяСтраница = АктивнаяСтраница[0];
			Если АктивнаяСтраница.ДополнительныеДанные.Количество() > 0 Тогда 
				Если ТипЗнч(АктивнаяСтраница.ДополнительныеДанные[0].Значение) = Тип("Структура") Тогда
					ДопДанные = Истина;
					Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
						Если НомерГрафы = 1 Тогда
							КолонкаТаблицыИмя = "УдалитьСтроку" + СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
							ИмяДополнительныхДанных = КолонкаТаблицыИмя + "_" + НомУдаляемойСтрокиСтр;
							Если АктивнаяСтраница.ДополнительныеДанные[0].Значение.Свойство(ИмяДополнительныхДанных) Тогда
								АктивнаяСтраница.ДополнительныеДанные[0].Значение.Удалить(ИмяДополнительныхДанных);
								АктивнаяСтраница.ДополнительныеДанные[0].Пометка = Ложь;
							КонецЕсли;
						КонецЕсли;
						КолонкаТаблицыИмя = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
						ИмяДополнительныхДанных = КолонкаТаблицыИмя + "_" + НомУдаляемойСтрокиСтр;
						Если АктивнаяСтраница.ДополнительныеДанные[0].Значение.Свойство(ИмяДополнительныхДанных) Тогда
							АктивнаяСтраница.ДополнительныеДанные[0].Значение.Удалить(ИмяДополнительныхДанных);
							АктивнаяСтраница.ДополнительныеДанные[0].Пометка = Ложь;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	Иначе
		Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
			Если НомерГрафы = 1 Тогда
				КолонкаТаблицыИмя = "УдалитьСтроку" + СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
				ИмяДополнительныхДанных = КолонкаТаблицыИмя + "_" + НомУдаляемойСтрокиСтр;
				Если Форма.ДополнительныеДанные[ТекущаяСтраница].Свойство(ИмяДополнительныхДанных) Тогда
					Форма.ДополнительныеДанные[ТекущаяСтраница].Удалить(ИмяДополнительныхДанных);
				КонецЕсли;
			КонецЕсли;
			КолонкаТаблицыИмя = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
			ИмяДополнительныхДанных = КолонкаТаблицыИмя + "_" + НомУдаляемойСтрокиСтр;
			Если Форма.ДополнительныеДанные[ТекущаяСтраница].Свойство(ИмяДополнительныхДанных) Тогда
				Форма.ДополнительныеДанные[ТекущаяСтраница].Удалить(ИмяДополнительныхДанных);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;

	Если СтруктураГруппы.Количество() > ИсходноеКоличествоСтрокГруппы Тогда
		// удаляется добавленная строка
		ИмяПервойЯчейкиУдаляемойСтроки = ИмяГруппы + "00_" + НомУдаляемойСтрокиСтр;
		
		// область первой ячейки удаляемой строки многострочного раздела
		ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяПервойЯчейкиУдаляемойСтроки];
		
		НастройкиМнгЧ = РегламентированнаяОтчетностьКлиентСервер.ПолучитьСвойствоРаздела(Форма, ТекущаяСтраница, "МногострочностьВРазделе").НайтиСтроки(Новый Структура("ИдГруппы", ИмяГруппы))[0];
		ВысотаСтроки = НастройкиМнгЧ.ВысотаСтроки;
		
		// номера строк удаляемой области
		НомерВерхЯчейкиОбласти = ОбластьЯчейки.Верх;
		НомерНижнЯчейкиОбласти = ОбластьЯчейки.Низ;
		
		РегламентированнаяОтчетностьВызовСервера.СпециальногоУдаленияСтроки(ТекТабличноеПоле, ТекТабличноеПолеИмя, ИмяГруппы, НомерВерхЯчейкиОбласти, НомерНижнЯчейкиОбласти);
		
		Форма[ТекТабличноеПолеИмя] = ТекТабличноеПоле;
				
		КолвоСдвигаемыхСтрок = СтруктураГруппы.Количество() - НомУдаляемойСтроки;
		
		// обновим имена ячеек сдвинутых строк
		Если КолвоСдвигаемыхСтрок > 0 Тогда
			
			Для НСтр = НомУдаляемойСтроки + 1 По СтруктураГруппы.Количество() Цикл
				НСтрСуфф = Формат(НСтр, "ЧГ=");
				НПредСуфф = Формат(НСтр - 1, "ЧГ=");
				
				ТекСтрока = СтруктураГруппы[НСтр-1];
				
				СписокИменКолонокРаздела = Форма.мСтруктураИменаКолонокРазделов[ИмяГруппы];

				Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
					
					Если НомерГрафы = 1 Тогда
						
						КолонкаИмя = "УдалитьСтроку" + СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
						
						ИмяСдвинутойЯчейки = КолонкаИмя + "_" + НСтрСуфф;
						НовоеИмяСдвинутойЯчейки = КолонкаИмя + "_" + НПредСуфф;
						
						ОбластьСдвинутойЯчейки     = ТекТабличноеПоле.Области[ИмяСдвинутойЯчейки];
						ОбластьСдвинутойЯчейки.Имя = НовоеИмяСдвинутойЯчейки;
						
						// Изменение имени ячейки в дополнительных сведениях многострочной части.
						Если РазделМногостраничный Тогда
							Если ДопДанные Тогда
								Если АктивнаяСтраница.ДополнительныеДанные[0].Значение.Свойство(ИмяСдвинутойЯчейки) Тогда
									АктивнаяСтраница.ДополнительныеДанные[0].Значение.Вставить(НовоеИмяСдвинутойЯчейки, АктивнаяСтраница.ДополнительныеДанные[0].Значение[ИмяСдвинутойЯчейки]);
									АктивнаяСтраница.ДополнительныеДанные[0].Значение.Удалить(ИмяСдвинутойЯчейки);
									АктивнаяСтраница.ДополнительныеДанные[0].Пометка = Ложь;
								КонецЕсли;
							КонецЕсли;
						Иначе
							Если Форма.ДополнительныеДанные[ТекущаяСтраница].Свойство(ИмяСдвинутойЯчейки) Тогда
								Форма.ДополнительныеДанные[ТекущаяСтраница].Вставить(НовоеИмяСдвинутойЯчейки, Форма.ДополнительныеДанные[ТекущаяСтраница][ИмяСдвинутойЯчейки]);
								Форма.ДополнительныеДанные[ТекущаяСтраница].Удалить(ИмяСдвинутойЯчейки);
							КонецЕсли;
						КонецЕсли;
						
					КонецЕсли;
					
					КолонкаИмя = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
					
					Если СтруктураГруппы[0].Свойство(КолонкаИмя) Тогда
						
						ИмяСдвинутойЯчейки = КолонкаИмя + "_" + НСтрСуфф;
						НовоеИмяСдвинутойЯчейки = КолонкаИмя + "_" + НПредСуфф;
						
						ОбластьСдвинутойЯчейки     = ТекТабличноеПоле.Области[ИмяСдвинутойЯчейки];
						ОбластьСдвинутойЯчейки.Имя = НовоеИмяСдвинутойЯчейки;
						
						// Изменение имени ячейки в дополнительных сведениях многострочной части.
						Если РазделМногостраничный Тогда
							Если ДопДанные Тогда 
								Если АктивнаяСтраница.ДополнительныеДанные[0].Значение.Свойство(ИмяСдвинутойЯчейки) Тогда
									АктивнаяСтраница.ДополнительныеДанные[0].Значение.Вставить(НовоеИмяСдвинутойЯчейки, АктивнаяСтраница.ДополнительныеДанные[0].Значение[ИмяСдвинутойЯчейки]);
									АктивнаяСтраница.ДополнительныеДанные[0].Значение.Удалить(ИмяСдвинутойЯчейки);
									АктивнаяСтраница.ДополнительныеДанные[0].Пометка = Ложь;
								КонецЕсли;
							КонецЕсли;
						Иначе
							Если Форма.ДополнительныеДанные[ТекущаяСтраница].Свойство(ИмяСдвинутойЯчейки) Тогда
								Форма.ДополнительныеДанные[ТекущаяСтраница].Вставить(НовоеИмяСдвинутойЯчейки, Форма.ДополнительныеДанные[ТекущаяСтраница][ИмяСдвинутойЯчейки]);
								Форма.ДополнительныеДанные[ТекущаяСтраница].Удалить(ИмяСдвинутойЯчейки);
							КонецЕсли;
						КонецЕсли;
					КонецЕсли;
				КонецЦикла;
			КонецЦикла;
		КонецЕсли;
		
		// обновляем структуру многострочного раздела
		СтруктураГруппы.Удалить(НомерСтрокиТаблицы);
		
	Иначе
		// строка не удаляется в форме табличного документа,
		// а должна осуществляться сдвиг строк
		
		// обновляем структуру многострочного раздела
		// методом удаления выбранной строки и добавления пустой строки
		СтруктураГруппы.Удалить(НомерСтрокиТаблицы);
		
		ДобавляемаяСтрока = СтруктураГруппы.Добавить();
		
		СписокИменКолонокРаздела = Форма.мСтруктураИменаКолонокРазделов[ИмяГруппы];

		// обновляем порядковые номера строк, выводимых в табличный документ
		Для Каждого СтрокаТаблицы Из СтруктураГруппы Цикл
			
			НомерСтрокиВТаблице = СтруктураГруппы.Индекс(СтрокаТаблицы);
			НомерСтрокиВФормеТаблицы = Формат(НомерСтрокиВТаблице + 1, "ЧГ=0");
			
			Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
				
				КолонкаТаблицыИмя = СписокИменКолонокРаздела.Получить(НомерГрафы - 1).Значение;
				
				Если СтруктураГруппы[0].Свойство(КолонкаТаблицыИмя) Тогда
					
					ИмяЯчейки                = КолонкаТаблицыИмя + "_" + НомерСтрокиВФормеТаблицы;
					ОбластьЯчейкиТаблицы     = ТекТабличноеПоле.Области[ИмяЯчейки];
					
					Если ОбластьЯчейкиТаблицы.СодержитЗначение <> Истина Тогда
						
						ПервыйНомерВГруппе = 1;
						
						// обновляем порядковый номер строки
						НовыйПорядковыйНомер = Строка(ПервыйНомерВГруппе + НомерСтрокиВТаблице);
						
						СтрокаТаблицы[КолонкаТаблицыИмя] = НовыйПорядковыйНомер;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
		КонецЦикла;
		
		// Данные в многострочном блоке обновляются в декларациях!
		// Обновляем экранную форму табличного документа
		
		ВывестиРазделВТабличныйДокумент(Форма, ИмяГруппы, СтруктураГруппы);
		
	КонецЕсли;
		
	Расчет(Форма, ТекущаяСтраница);
	
	// назначим текущей областью таблицы первую редактируемую ячейку
	// удаленной строки, если ее порядковый номер меньше кол-ва строк
	// многострочного раздела, или последней строки раздела в противном случае
	
	// определяем текущую область таблицы
	НомТекущейСтроки  = Мин( НомУдаляемойСтроки, СтруктураГруппы.Количество() );
	ИмяТекущейОбласти = ИмяГруппы + "00_" + Формат(НомТекущейСтроки, "ЧГ=0");
	
	Форма.Элементы[ТекТабличноеПолеИмя].ТекущаяОбласть = ТекТабличноеПоле.Области[ИмяТекущейОбласти];
	
	// установим фокус на поле табличн. документа
	ТекущийЭлемент = Форма.Элементы[ТекТабличноеПолеИмя];
	
	Если Форма.СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел1" Тогда
		ПронумероватьТаблицыРаздела1(Форма);
	ИначеЕсли Форма.СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел2" Тогда
		ПронумероватьТаблицыРаздела2(Форма);
	КонецЕсли;
	
	МассивОбластейСДопСтроками = Новый Массив;
	
	Для Каждого ОбластьТД Из Форма.ТабличныйДокумент.Области Цикл
		Если СтрЧислоВхождений(ОбластьТД.Имя, "УдалитьСтроку") > 0 Тогда
			Если СтрЧислоВхождений(ОбластьТД.Имя, "_2") > 0 Тогда
				МассивОбластейСДопСтроками.Добавить(Лев(ОбластьТД.Имя, 26));
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	Для Каждого ОбластьТД Из Форма.ТабличныйДокумент.Области Цикл
		Если СтрЧислоВхождений(ОбластьТД.Имя, "УдалитьСтроку") > 0 Тогда
			Если МассивОбластейСДопСтроками.Найти(Лев(ОбластьТД.Имя, 26)) = Неопределено Тогда
				ОбластьТД.Гиперссылка = Ложь;
				ОбластьТД.Текст = "";
			Иначе
				ОбластьТД.Гиперссылка = Истина;
				ОбластьТД.Текст = "х";
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	Форма.Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьСтраницу(Команда)
	
	ВставитьДополнительнуюСтраницуНаСервере(Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим);
					
КонецПроцедуры

&НаКлиенте
Процедура УдалитьСтраницу(Команда)
	
	ТекстВопроса = НСтр("ru='Удалить текущую страницу?'");
	ОписаниеОповещения = Новый ОписаниеОповещения("УдалитьСтраницуЗавершение", ЭтотОбъект);
	ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ДаНет, 60, КодВозвратаДиалога.Да);
	
КонецПроцедуры

&НаКлиенте
Процедура УдалитьСтраницуЗавершение(РезультатВопроса, ДополнительныеПараметры) Экспорт
	
	Если РезультатВопроса = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли;
	
	ТекущиеДанные = Элементы.РазделыОтчета.ТекущиеДанные;
	
	КопияТекущиеДанные = ТекущиеДанные;
	
	ТекущиеДанные = ТекущиеДанные.ПолучитьРодителя();
	
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ТекущиеДанные.ПолучитьЭлементы().Количество() = 1 Тогда
		Возврат;
	КонецЕсли;
	
	ТекущаяСтраницаРазделаПослеУдаления = Неопределено;
	Если КопияТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета = ТекущиеДанные.ПолучитьЭлементы().Количество() Тогда
		ТекущаяСтраницаРазделаПослеУдаления = РегламентированнаяОтчетностьКлиентСервер.НайтиЭлементВДанныхФормыДерево(ТекущиеДанные.ПолучитьЭлементы(), "КолонкаНомерСтраницыРазделаОтчета", КопияТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета - 1);
	КонецЕсли;
	
	УдалитьДополнительнуюСтраницуНаСервере(Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим);
	
	ТекущиеДанные.ПолучитьЭлементы().Удалить(ТекущиеДанные.ПолучитьЭлементы().Индекс(КопияТекущиеДанные));
	
	НомерСтраницы = 1;
	
	Для Каждого СтраницаРаздела Из ТекущиеДанные.ПолучитьЭлементы() Цикл
		
		СтраницаРаздела.КолонкаРазделыОтчета              = "Стр. " + НомерСтраницы;
		СтраницаРаздела.КолонкаНомерСтраницыРазделаОтчета = НомерСтраницы;
		
		НомерСтраницы = НомерСтраницы + 1;
		
	КонецЦикла;
	
	Если НЕ ТекущаяСтраницаРазделаПослеУдаления = Неопределено Тогда
		Элементы.РазделыОтчета.ТекущаяСтрока = ТекущаяСтраницаРазделаПослеУдаления.ПолучитьИдентификатор();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура УдалитьДополнительнуюСтраницуНаСервере(ИмяТекущейСтраницыПанели = Неопределено)
	
	УдалитьДополнительнуюСтраницу(ЭтаФорма, ИмяТекущейСтраницыПанели);
				
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УдалитьДополнительнуюСтраницу(Форма, ИмяТекущейСтраницыПанели = Неопределено)

	Перем ТаблицаСтраницРаздела;

	Если Не Форма.мСтруктураМногостраничныхРазделов.Свойство(ИмяТекущейСтраницыПанели, ТаблицаСтраницРаздела) Тогда
		Возврат;
	КонецЕсли;
	
	ТаблицаСтраницРаздела = Форма[ТаблицаСтраницРаздела];

	Если ТаблицаСтраницРаздела.Количество() = 1 Тогда
		Возврат;
	КонецЕсли;

	ИмяТекТабличногоПоля     = "ТабличныйДокумент";
	ТекТабличноеПоле         = Форма[ИмяТекТабличногоПоля];

	СтрТаблицаСтраницы = ТаблицаСтраницРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));

	Если СтрТаблицаСтраницы.Количество() > 0 Тогда
		СтрТаблицаСтраницы = СтрТаблицаСтраницы[0];
		ИндексТекСтрока = ТаблицаСтраницРаздела.Индекс(СтрТаблицаСтраницы);
		ТаблицаСтраницРаздела.Удалить(СтрТаблицаСтраницы);

		// очищаем редактируемые ячейки удаляемой страницы
		ОчиститьТабличноеПоле(Форма, ИмяТекущейСтраницыПанели);

		КолвоДопСтраниц = ТаблицаСтраницРаздела.Количество();
		Если КолвоДопСтраниц > 0 Тогда
			СтрТаблицаСтраницыЗамена = ТаблицаСтраницРаздела[Мин(ИндексТекСтрока, КолвоДопСтраниц - 1)];

			// Для страниц многостраничного раздела, содержащих многострочную часть,
			// восстанавливаем структуру дополнительных строк.
			//
			Если (ИмяТекущейСтраницыПанели = "Раздел1") ИЛИ
				 (ИмяТекущейСтраницыПанели = "Раздел2") Тогда

				// Предварительно проверим, содержит ли страница многострочные части
				ДанныеДопСтрокРаздела = СтрТаблицаСтраницыЗамена.ДанныеДопСтрок[0].Значение;

				Если ДанныеДопСтрокРаздела <> Неопределено Тогда
					Для Каждого ГруппаСтрок Из ДанныеДопСтрокРаздела Цикл
						ИмяГруппыДопСтрок = ГруппаСтрок.Ключ;
						ДанныеГруппыСтрок = ГруппаСтрок.Значение;
											
						ПромТаблицаГруппыСтрок = Форма["Хранилище" + ИмяГруппыДопСтрок].Добавить().Таблица;
						
						КопироватьДанныеФормы(ДанныеГруппыСтрок, ПромТаблицаГруппыСтрок);

						// Заменяем таблицу значений с данными текущей страницы.
						КопироватьДанныеФормы(ПромТаблицаГруппыСтрок, Форма[ИмяГруппыДопСтрок]);
						// Выводим в табличный документ строки многострочной группы
						ВывестиРазделВТабличныйДокумент(Форма, ИмяГруппыДопСтрок, ПромТаблицаГруппыСтрок);
						
					КонецЦикла;
				КонецЕсли;

			КонецЕсли;

			// Восстановим данные замещаемой страницы.
			СтруктураДанныхСтраницыЗамена = СтрТаблицаСтраницыЗамена.Данные[0].Значение;

			Для Каждого Элемент Из СтруктураДанныхСтраницыЗамена Цикл

				ИмяПоказателя      = Элемент.Ключ;
				ЗначениеПоказателя = Элемент.Значение;

				Попытка
					Форма[ИмяТекТабличногоПоля].Области[ИмяПоказателя].Значение = ЗначениеПоказателя;
				Исключение
				КонецПопытки;

			КонецЦикла;

			СтрТаблицаСтраницыЗамена.АктивнаяСтраница = Истина;
		КонецЕсли;

		Расчет(Форма, ИмяТекущейСтраницыПанели);
		Форма.Модифицированность = Истина;
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "Раздел1" Тогда
		УстановитьДоступностьПолейРаздела1(Форма);
		ПронумероватьТаблицыРаздела1(Форма);
	ИначеЕсли ИмяТекущейСтраницыПанели = "Раздел2" Тогда
		УстановитьДоступностьПолейРаздела2(Форма);
		ПронумероватьТаблицыРаздела2(Форма);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ВставитьДополнительнуюСтраницуНаСервере(ИмяТекущейСтраницыПанели = Неопределено)
	
	Перем ТаблицаСтраницРаздела;
	Перем СтруктураДанныхДопСтрокРаздела;
	
	Если ИмяТекущейСтраницыПанели = Неопределено Тогда
		ИмяТекущейСтраницыПанели = СтруктураРеквизитовФормы.НаимТекущегоРаздела;
	КонецЕсли;
	
	Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяТекущейСтраницыПанели, ТаблицаСтраницРаздела) Тогда
		Возврат;
	Иначе
		МаксКолвоЭкз = РегламентированнаяОтчетностьКлиентСервер.ПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели, "МаксКолвоЭкз", 0);
		Если МаксКолвоЭкз <> 0 И ЭтаФорма[мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели]].Количество() >= МаксКолвоЭкз Тогда
			ЗаголовокСтраницы = ИмяТекущейСтраницыПанели;
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='В разделе ""%1"" максимальное количество экземпляров страниц равно %2.'"), ЗаголовокСтраницы, МаксКолвоЭкз);
			Сообщение.Сообщить();
			СтруктураРеквизитовФормы.ВыводитьСтраницуВТаблДокНаСервере = Истина;
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	ИмяТекТабличногоПоля = "ТабличныйДокумент";
	ТекТабличноеПоле     = ЭтаФорма[ИмяТекТабличногоПоля];
	
	// Сначала сохраним данные текущей страницы.
	СтруктураДанныхТекущейТаблицы = СобратьДанныеТекущегоТаблПоля(ЭтаФорма, ИмяТекТабличногоПоля);
	
	// Для страниц многостраничного раздела, содержащих многострочную часть,
	// дополнительно сохраняем данные многострочной части.
	СтруктураДанныхДопСтрокРаздела = СформироватьСтруктуруДанныхДопСтрокСтраницы(ЭтаФорма, ИмяТекущейСтраницыПанели);	
	
	ТаблицаСтраницРаздела = ЭтаФорма[ТаблицаСтраницРаздела];
	
	// Найдем активную страницу
	СтрТаблицаСтраницы = ТаблицаСтраницРаздела.НайтиСтроки(Новый Структура ("АктивнаяСтраница", Истина));
	
	Если СтрТаблицаСтраницы.Количество() = 0 Тогда
		Возврат;
	Иначе
		СтрТаблицаСтраницы = СтрТаблицаСтраницы[0];
		СтрТаблицаСтраницы.АктивнаяСтраница = Ложь;
	КонецЕсли;
	
	ОпределитьПредставлениеДопСтраниц(ИмяТекущейСтраницыПанели);
	
	Если СтрТаблицаСтраницы.Данные.Количество() > 0 Тогда
		СтрТаблицаСтраницы.Данные[0].Значение = СтруктураДанныхТекущейТаблицы;
	Иначе
		СтрТаблицаСтраницы.Данные.Добавить(СтруктураДанныхТекущейТаблицы);
	КонецЕсли;
	
	Если (ИмяТекущейСтраницыПанели = "Раздел1") Или (ИмяТекущейСтраницыПанели = "Раздел2") Тогда
		
		Если СтрТаблицаСтраницы.ДанныеДопСтрок.Количество() > 0 Тогда
			СтрТаблицаСтраницы.ДанныеДопСтрок[0].Значение = СтруктураДанныхДопСтрокРаздела;
		Иначе
			СтрТаблицаСтраницы.ДанныеДопСтрок.Добавить(СтруктураДанныхДопСтрокРаздела, "ДанныеФормыКоллекцияТаблицаДопСтрокРаздела");
		КонецЕсли;
		
	КонецЕсли;
	
	// Добавляем новую страницу
	СтрНоваяСтраница = ТаблицаСтраницРаздела.Добавить();
	
	// Присваиваем представление по умолчанию
	СтрНоваяСтраница.Представление = "Новая страница";
	СтрНоваяСтраница.АвтоматическоеПредставление = Истина;
	
	// Ставим признак активной страницы
	СтрНоваяСтраница.АктивнаяСтраница = Истина;
	
	Если ИмяТекущейСтраницыПанели = "Раздел1" Тогда
		УстановитьДоступностьПолейРаздела1(ЭтаФорма);
		ПронумероватьТаблицыРаздела1(ЭтаФорма);
	ИначеЕсли ИмяТекущейСтраницыПанели = "Раздел2" Тогда
		УстановитьДоступностьПолейРаздела2(ЭтаФорма);
		ПронумероватьТаблицыРаздела2(ЭтаФорма);
	КонецЕсли;
	
	ПослеДобавленияДопСтрНаСервере(ИмяТекТабличногоПоля, ИмяТекущейСтраницыПанели);
	
	Модифицированность = Истина;
	
КонецПроцедуры

&НаСервере
Процедура ОпределитьПредставлениеДопСтраниц(ИмяСтраницы = Неопределено, ТолькоУАктивнойСтраницы = Неопределено)
	Перем ТаблицаСтраницРаздела;
	Перем ТекущееПредставлениеСтраницы;

	ТолькоАктивная = ?(ТолькоУАктивнойСтраницы = Неопределено, Ложь, ТолькоУАктивнойСтраницы);
	
	Для Каждого Страница Из мСтруктураМногостраничныхРазделов Цикл
		ИмяТекСтраницы        = Страница.Ключ;
		ТаблицаСтраницРаздела = ЭтаФорма[Страница.Значение];

		Если ИмяСтраницы <> Неопределено Тогда
			Если ИмяТекСтраницы <> ИмяСтраницы Тогда
				Продолжить; // Пропускаем не нужные страницы
			КонецЕсли;
		КонецЕсли;

		// Если есть хоть одна страница - определим ее представление
		Если ТаблицаСтраницРаздела.Количество() > 0 Тогда

			НомерСтраницы = 0;

			Для Каждого СтрокаТаблицы Из ТаблицаСтраницРаздела Цикл

				НомерСтраницы = НомерСтраницы + 1;

				СохрПредставлениеСтраницы = СтрокаТаблицы.Представление;

				// Если колонки нет, тогда автоматическое представление включено по умолчанию.
				Если ТаблицаСтраницРаздела[0].Свойство("АвтоматическоеПредставление") Тогда
					АвтоматическоеПредставление = СтрокаТаблицы.АвтоматическоеПредставление;
				Иначе
					АвтоматическоеПредставление = Истина;
				КонецЕсли;

				Если НЕ АвтоматическоеПредставление Тогда
					Продолжить;
				КонецЕсли;

				Если (НЕ ТолькоАктивная) Или ((ТолькоАктивная) И (СтрокаТаблицы.АктивнаяСтраница))Тогда

					ТекущееПредставлениеСтраницы = "Лист N " + Строка(НомерСтраницы);
					Если Не ПустаяСтрока(ТекущееПредставлениеСтраницы) Тогда
						СтрокаТаблицы.Представление = ТекущееПредставлениеСтраницы;
					Иначе
						СтрокаТаблицы.Представление = "Новая страница";
					КонецЕсли;

				КонецЕсли; // ТолькоАктивная

			КонецЦикла;

		КонецЕсли;

	КонецЦикла;

КонецПроцедуры

&НаСервере
Процедура ПослеДобавленияДопСтрНаСервере(ИмяТекТабличногоПоля, ИмяТекущейСтраницыПанели)
	
	ОчиститьТабличноеПолеНаСервере(ИмяТекущейСтраницыПанели);
	
	РасчетНаСервере(ИмяТекущейСтраницыПанели);
	
	РегламентированнаяОтчетность.ПослеВставкиДополнительнойСтраницыНаСервере(ЭтаФорма, ИмяТекущейСтраницыПанели);
	
КонецПроцедуры

&НаСервере
Процедура ОчисткаРегламентированногоОтчетаНаСервере(ИмяСтраницы, ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста, РежимОчистки, Многостраничность, КолВоСтраницВРазделе) Экспорт
	
	УдалятьсяВсеДопЭкземпляры = Ложь;
	
	Если СтрНайти(РежимОчистки, "ОчиститьТекущийРаздел") > 0 Тогда
		
		Если (Многостраничность) И (КолВоСтраницВРазделе > 1) Тогда
			
			ОчиститьПоказателиОтчетаЗаполняемыеИзИБНаСервере(ИмяСтраницы);
			
			УдалятьсяВсеДопЭкземпляры = Истина;
			
		Иначе
			
			ОчиститьТабличноеПолеНаСервере(ИмяСтраницы);
			
		КонецЕсли;
		
		СформироватьДеревоРазделовОтчетаНаСервере();
		
	ИначеЕсли СтрНайти(РежимОчистки, "ОчиститьТекущийЭкземплярМногостраничногоРаздела") > 0 Тогда
		
		ОчиститьТабличноеПолеНаСервере(ИмяСтраницы);
		
	КонецЕсли;
	
	Если ИмяСтраницы = "Титульный" Тогда
		
		ЭтаФорма.НомерКорректировки                     = 0;
		
		ТабличныйДокумент.Области.НомКорр.Значение      = 0;
		ТабличныйДокумент.Области.ПризнакФормы.Значение = 1;
		СтруктураРеквизитовФормы.ВидДокумента           = 0;
		
		Если Элементы.Найти("ДатаПодписи") = Неопределено Тогда
			Область = ТабличныйДокумент.Области.Найти("ДатаПодписи");
			Если НЕ Область = Неопределено Тогда
				Если ТипЗнч(Область.Значение) = Тип("Строка") Тогда
					ДатаПодписи = Лев(СтрЗаменить(Область.Значение, ".", ""), 8);
				ИначеЕсли ТипЗнч(Область.Значение) = Тип("Дата") Тогда
					Если ЗначениеЗаполнено(Область.Значение) Тогда
						ДатаПодписи = Лев(СтрЗаменить(Формат(Область.Значение, "ДФ = ""дд.ММ.гггг 'г.'"""), ".", ""), 8);
					Иначе
						ДатаПодписи = "        ";
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиентСервер.ПослеОчисткиРегламентированногоОтчета(ЭтаФорма, ИмяСтраницы, ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста);
	
	РегламентированнаяОтчетность.ПолучитьСведенияОПоказателяхОтчета(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ОчисткаРегламентированногоОтчетаНаКлиенте(ИмяСтраницы, ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста, РежимОчистки, Многостраничность, КолВоСтраницВРазделе) Экспорт
	
	УдалятьсяВсеДопЭкземпляры = Ложь;
	
	Если СтрНайти(РежимОчистки, "ОчиститьТекущийРаздел") > 0 Тогда
		
		Если (Многостраничность) И (КолВоСтраницВРазделе > 1) Тогда

			РегламентированнаяОтчетностьКлиентСервер.ОчиститьПоказателиОтчетаЗаполняемыеИзИБ(ЭтаФорма, ИмяСтраницы);

			УдалятьсяВсеДопЭкземпляры = Истина;
			
		Иначе

			ОчиститьТабличноеПолеНаКлиенте(ИмяСтраницы);

		КонецЕсли;
		
		СформироватьДеревоРазделовОтчетаНаКлиенте();
		
	ИначеЕсли СтрНайти(РежимОчистки, "ОчиститьТекущийЭкземплярМногостраничногоРаздела") > 0 Тогда
		
		ОчиститьТабличноеПолеНаКлиенте(ИмяСтраницы);
		
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиентСервер.ПослеОчисткиРегламентированногоОтчета(ЭтаФорма, ИмяСтраницы, ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста);
	
КонецПроцедуры

&НаСервере
Процедура ОчиститьПоказателиОтчетаЗаполняемыеИзИБНаСервере(ИмяСтраницы)
	
	РегламентированнаяОтчетностьКлиентСервер.ОчиститьПоказателиОтчетаЗаполняемыеИзИБ(ЭтаФорма, ИмяСтраницы);
	
КонецПроцедуры

&НаСервере
Функция ОбновитьПеременныеМодуляНаСервере(ИмяПоказателя, ЗначениеПоказателя) Экспорт

	ПеременныеМодуля = Новый Структура;
	
	флОбновитьПеременныеМодуля = ОбновитьПеременныеМодуля(ИмяПоказателя, ЗначениеПоказателя, ПеременныеМодуля);
		
	Возврат флОбновитьПеременныеМодуля;
	
КонецФункции

&НаКлиенте
Функция ОбновитьПеременныеМодуляНаКлиенте(ИмяПоказателя, ЗначениеПоказателя) Экспорт

	ПеременныеМодуля = Новый Структура;
	
	флОбновитьПеременныеМодуля = ОбновитьПеременныеМодуля(ИмяПоказателя, ЗначениеПоказателя, ПеременныеМодуля);
	
	Возврат флОбновитьПеременныеМодуля;
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция ОбновитьПеременныеМодуля(ИмяПоказателя, ЗначениеПоказателя,ПеременныеМодуля) Экспорт
		
	ИзмененияПроизошли = Ложь;

	Если Лев(ИмяПоказателя, 1) = "_" Тогда
		ИзмененияПроизошли = Истина;
		Возврат ИзмененияПроизошли;
	КонецЕсли;

	Возврат ИзмененияПроизошли;	
		
КонецФункции

&НаСервере
Процедура ДатаПодписиПриИзмененииНаСервере()
	
	ЗаполнитьСведенияОбОрганизации(Истина);

	СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Истина;

	ЗаполнитьДатуВЯчейкахНаСервере();

	СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Ложь;

	Модифицированность = Истина;
	
Конецпроцедуры

&НаКлиенте
Процедура Обновить(Команда)
	
	ОбновитьНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ОбновитьНаСервере()
	
	СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Истина;
	
	ЗаполнитьСведенияОбОрганизации();
				
	СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Ложь;
	
	СформироватьДеревоРазделовОтчетаНаСервере();
	
	Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьОтчет(Команда)
	
	РегламентированнаяОтчетностьКлиент.МеханизмыОчисткиРегламентированныхОтчетов(ЭтаФорма, "ОчиститьВесьОтчет");
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьТекущуюСтраницу(Команда)
	
	РегламентированнаяОтчетностьКлиент.МеханизмыОчисткиРегламентированныхОтчетов(ЭтаФорма, "ОчиститьТекущийЭкземплярМногостраничногоРаздела" + Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим);
	
КонецПроцедуры

&НаКлиенте
Процедура Очистить(ВыполняемоеОповещение = Неопределено) Экспорт
	
	РегламентированнаяОтчетностьКлиент.Очистить(ЭтаФорма, ВыполняемоеОповещение);
	
КонецПроцедуры

&НаСервере
Процедура ОчиститьНаСервере() Экспорт
	
	Для каждого ЭлементСтруктурыТаблицаСтраницы Из мСтруктураМногостраничныхРазделов Цикл
		ЭтаФорма[ЭлементСтруктурыТаблицаСтраницы.Значение].Очистить();
	КонецЦикла;
	
	ИнициализацияМногостраничныхРазделов();
	
	Для Каждого мнгРаздел Из мСтруктураМногострочныхРазделов Цикл
		ЭтаФорма[мнгРаздел.Ключ].Очистить();
	КонецЦикла;
	
	НачальныеОперацииСМногострочнымиБлоками();
	
	ЗаполнитьПустыеСтруктурыДанных();
	
	Если НЕ СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Титульный" Тогда
		ОчиститьТабличноеПолеНаСервере(СтруктураРеквизитовФормы.НаимТекущегоРаздела);
	КонецЕсли;
	
	ВывестиМакетСтраницыВТабличныйДокументНаСервере(СтруктураРеквизитовФормы.НаимТекущегоРаздела, 1);
	
	РегламентированнаяОтчетностьКлиентСервер.ОчиститьВариантыЗаполнения(ЭтаФорма);
	
	РегламентированнаяОтчетность.ПолучитьСведенияОПоказателяхОтчета(ЭтаФорма);
	
КонецПроцедуры
 
&НаСервере
Процедура ЗаполнитьПустыеСтруктурыДанных()
	
	СохрТабличныйДокумент = Новый ТабличныйДокумент;
	
	СохрТабличныйДокумент.Вывести(ТабличныйДокумент);
	
	СохрНаимТекущегоРаздела = СтруктураРеквизитовФормы.НаимТекущегоРаздела;
	
	Для Каждого Раздел Из мСвойстваРазделовДекларации.ПолучитьЭлементы() Цикл
		
		Если НЕ Раздел.МногостраничностьВРазделе
		  И (ЭтаФорма["СтруктураДанных" + Раздел.ИмяСтраницы].Количество() = 0) Тогда
		  
			ТабличныйДокумент.Очистить();
			ТабличныйДокумент.Вывести(ПолучитьМакетФормыОтчета(Раздел.ИмяСтраницы));
			
			СтруктураРеквизитовФормы.НаимТекущегоРаздела = Раздел.ИмяСтраницы;
			
			СохранитьДанныеРаздела(Раздел.ИмяСтраницы, Ложь);
			
		ИначеЕсли Раздел.МногостраничностьВРазделе
			    И (ЭтаФорма[мСтруктураМногостраничныхРазделов[Раздел.ИмяСтраницы]][0].Данные.Количество() = 0) Тогда
				
			ТабличныйДокумент.Очистить();
			ТабличныйДокумент.Вывести(ПолучитьМакетФормыОтчета(Раздел.ИмяСтраницы));
			
			СтруктураРеквизитовФормы.НаимТекущегоРаздела = Раздел.ИмяСтраницы;
			
			СохранитьДанныеРаздела(Раздел.ИмяСтраницы, Ложь, Ложь);
			
		КонецЕсли;
		
		Если Раздел.ИмяСтраницы = "Лицензии" ИЛИ Раздел.ИмяСтраницы = "Раздел1" ИЛИ Раздел.ИмяСтраницы = "Раздел2" Тогда
			Для Каждого Страница Из ЭтаФорма[мСтруктураМногостраничныхРазделов[Раздел.ИмяСтраницы]] Цикл
		   		Если Страница.ДополнительныеДанные.Количество() = 0 Тогда
					Страница.ДополнительныеДанные.Очистить();
					Страница.ДополнительныеДанные.Добавить(Новый Структура);
					Страница.ДополнительныеДанные[0].Пометка = Ложь;
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;
	
	КонецЦикла;
	
	ТабличныйДокумент.Очистить();
	ТабличныйДокумент.Вывести(СохрТабличныйДокумент);
	
	СтруктураРеквизитовФормы.НаимТекущегоРаздела = СохрНаимТекущегоРаздела;
	
КонецПроцедуры

&НаКлиенте
Процедура ТабличныйДокументПриИзмененииСодержимогоОбласти(Элемент, Область)
	
	Модифицированность = Истина;
	
	ИмяОбласти = Область.Имя;
	ЭтоКППМестаДеятельности = (СтрНайти(ИмяОбласти, "П000000000201") = 1);
	
	Если ЭтоКППМестаДеятельности Тогда
		
		КППМестаДеятельности = Область.Значение;
		Если КППМестаДеятельности = ""
			ИЛИ (СтроковыеФункцииКлиентСервер.ТолькоЦифрыВСтроке(КППМестаДеятельности) И СтрДлина(КППМестаДеятельности) = 9) Тогда
			
		Иначе
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = НСтр("ru='КПП должен состоять из 9 цифр.'");
			Сообщение.Сообщить();
			Область.Значение = "";
		КонецЕсли;
		
	КонецЕсли;
	
	Если ИмяОбласти = "НомКорр" Тогда
		
		НомерКорректировки = Область.Значение;
		
		СтруктураРеквизитовФормы.ВидДокумента = ?(НомерКорректировки = 0, 0, 1);
		
		Модифицированность = Истина;
		
	ИначеЕсли ИмяОбласти = "ДатаПодписи" Тогда
		
		ДатаПодписи = ТабличныйДокумент.Области.ДатаПодписи.Значение;
		
		ДатаПодписиПриИзмененииНаСервере();
		
	КонецЕсли;
	
	Если СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел1" Или СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел2" Тогда
		
		РасчетНаКлиенте(СтруктураРеквизитовФормы.НаимТекущегоРаздела, Элемент.ТекущаяОбласть.Имя);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ТабличныйДокументВыбор(Элемент, Область, СтандартнаяОбработка)
	
	ИмяОбласти = Область.Имя;
	
	Если СтрЧислоВхождений(ИмяОбласти, "ДобавитьСтраницу") > 0 Тогда
		СтандартнаяОбработка = Ложь;
		ДобавитьСтраницу("");
	ИначеЕсли СтрЧислоВхождений(ИмяОбласти, "УдалитьСтраницу") > 0 И Область.Гиперссылка Тогда
		СтандартнаяОбработка = Ложь;
		УдалитьСтраницу("");
	ИначеЕсли СтрЧислоВхождений(ИмяОбласти, "ДобавитьСтроку") > 0 Тогда
		СтандартнаяОбработка = Ложь;
		ДобавитьСтроку("", ИмяОбласти);
	ИначеЕсли СтрЧислоВхождений(ИмяОбласти, "УдалитьСтроку") > 0 И Область.Гиперссылка Тогда
		СтандартнаяОбработка = Ложь;
		УдалитьСтроку("", ИмяОбласти);		
	КонецЕсли;
	
	Если РегламентированнаяОтчетностьКлиент.ВыбраннаяОбластьРегламентированногоОтчетаНеВерна(ЭтаФорма, Область, СтандартнаяОбработка) Тогда
		Возврат;
	КонецЕсли;
	
	Если (ИмяОбласти = "ОбособленноеПодразделение") Тогда
		СтандартнаяОбработка = Ложь;
		ВвестиСведенияОбОП();
	КонецЕсли;
	
	ЭтоАдресМестаДеятельности = СтрНайти(ИмяОбласти, "П000000000202") = 1
							ИЛИ СтрНайти(ИмяОбласти, "П000000000203") = 1
							ИЛИ СтрНайти(ИмяОбласти, "П000000000204") = 1
							ИЛИ СтрНайти(ИмяОбласти, "П000000000205") = 1
							ИЛИ СтрНайти(ИмяОбласти, "П000000000206") = 1
							ИЛИ СтрНайти(ИмяОбласти, "П000000000207") = 1;
	
	Если ЭтоАдресМестаДеятельности Тогда
		СтандартнаяОбработка = Ложь;
		ВвестиАдресМестаДеятельности(ИмяОбласти, Элемент);
	КонецЕсли;
	
	ПараметрВводаПоля = СвойстваПоказателей.НайтиСтроки(Новый Структура("Показатель", ИмяОбласти));
	Если ПараметрВводаПоля.Количество() = 0 Тогда
		
		ПараметрВводаПоля = Неопределено;
		
		Для Каждого Стр из СвойстваПоказателей Цикл
			Если Лев(Область.Имя, СтрДлина(Стр.Показатель)) = Стр.Показатель Тогда
				ПараметрВводаПоля = Стр;
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
	Иначе
		ПараметрВводаПоля = ПараметрВводаПоля[0];
	КонецЕсли;
	
	Если ПараметрВводаПоля <> Неопределено И ПараметрВводаПоля.ТаблицаЗначений.Количество() > 0 Тогда
		ИмяПоказателя = ?(РегламентированнаяОтчетностьКлиентСервер.ПоказательВходитВМногострочнуюЧасть(ЭтаФорма, ИмяОбласти) > 0, ИмяОбласти, ПараметрВводаПоля.Показатель);
		ВвестиПоказатель(Элемент, Область, ИмяПоказателя, Ложь, ПараметрВводаПоля.ТекстПриВыборе, ПараметрВводаПоля.ТаблицаЗначений, СтандартнаяОбработка);
	КонецЕсли;
	
	Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуКонтактнойИнформацииЗавершение(Результат, Параметры) Экспорт
	
	ОбновитьАдресВТабличномДокументе(Результат, Параметры.АдресМестаДеятельности, Параметры.ПорядковыйНомер, Параметры.АктивнаяСтраница);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьАдресВТабличномДокументе(Результат, АдресМестаДеятельности, ПорядковыйНомер = Неопределено, АктивнаяСтраница = Неопределено)
	
	АдресМестаДеятельности_ = Неопределено;
	
	Если Результат <> Неопределено Тогда
		
		// Обход ошибки платформы: в веб-клиенте, в результате выполнения процедуры "СформироватьАдрес"
		// общего модуля "РегламентированнаяОтчетностьВызовСервера", не изменяются значения ключей
		// соответствия "АдресМестаДеятельности", передаваемого в качестве параметра.
		АдресМестаДеятельности_ = АдресМестаДеятельности;
		
		Если ТипЗнч(Результат) = Тип("Структура") Тогда
			
			АдресМестаДеятельности_.Вставить("КодСтраны",       "");
			АдресМестаДеятельности_.Вставить("Индекс",          "");
			АдресМестаДеятельности_.Вставить("КодРегиона",      "");
			АдресМестаДеятельности_.Вставить("Регион",          "");
			АдресМестаДеятельности_.Вставить("Район",           "");
			АдресМестаДеятельности_.Вставить("Город",           "");
			АдресМестаДеятельности_.Вставить("НаселенныйПункт", "");
			АдресМестаДеятельности_.Вставить("Улица",           "");
			АдресМестаДеятельности_.Вставить("Дом",             "");
			АдресМестаДеятельности_.Вставить("Корпус",          "");
			АдресМестаДеятельности_.Вставить("Квартира",        "");
			АдресМестаДеятельности_.Вставить("ТипДома",         "");
			АдресМестаДеятельности_.Вставить("ТипКорпуса",      "");
			АдресМестаДеятельности_.Вставить("ТипКвартиры",     "");
			
			РегламентированнаяОтчетностьВызовСервера.СформироватьАдрес(Результат.КонтактнаяИнформация, АдресМестаДеятельности_);
			
			Если Результат.ВведеноВСвободнойФорме 
				и ( (АдресМестаДеятельности_.Страна = "643") 
					или (ВРег(АдресМестаДеятельности_.Страна) = "РОССИЯ")
					или (АдресМестаДеятельности_.Страна = "") ) Тогда
			
				// для России ввод адресов в свободной форме запрещен
			    Сообщение = Новый СообщениеПользователю;
				Сообщение.Текст = НСтр("ru='Российские адреса нельзя вводить в свободной форме!'");
				Сообщение.Сообщить();
				
				Возврат;
				
			КонецЕсли;
			
			АдресМестаДеятельности_.Удалить("Регион");

			Модифицированность = Истина;

		КонецЕсли;
		
		ИмяОбластиДляВывода = "П000000000202_" + ПорядковыйНомер;
		ТабличныйДокумент.Области[ИмяОбластиДляВывода].Значение = АдресМестаДеятельности_.Индекс;
		
		ИмяОбластиДляВывода = "П000000000203_" + ПорядковыйНомер;
		ТабличныйДокумент.Области[ИмяОбластиДляВывода].Значение = АдресМестаДеятельности_.КодРегиона;
		
		ТабличныйДокумент.Области["П000000000204_" + ПорядковыйНомер].Значение = АдресМестаДеятельности_.Район;
		ТабличныйДокумент.Области["П000000000205_" + ПорядковыйНомер].Значение = ?(ПустаяСтрока(АдресМестаДеятельности_.Город),
			АдресМестаДеятельности_.НаселенныйПункт, АдресМестаДеятельности_.Город);
		ТабличныйДокумент.Области["П000000000206_" + ПорядковыйНомер].Значение = АдресМестаДеятельности_.Улица;
		
		СтрокаДома = АдресМестаДеятельности_.Дом;
		СтрокаДома = СтрокаДома + ?(ПустаяСтрока(АдресМестаДеятельности_.Корпус), "", ", " + АдресМестаДеятельности_.Корпус);
		СтрокаДома = СтрокаДома + ?(ПустаяСтрока(АдресМестаДеятельности_.Квартира), "", ", " + АдресМестаДеятельности_.Квартира);
		ТабличныйДокумент.Области["П000000000207_" + ПорядковыйНомер].Значение = СтрокаДома;
		
	КонецЕсли;
	
	АктивнаяСтраница.ДополнительныеДанные[0].Значение.Вставить("АдресМестаДеятельности" + ПорядковыйНомер,
		?(АдресМестаДеятельности_ <> Неопределено, АдресМестаДеятельности_, АдресМестаДеятельности));
	АктивнаяСтраница.ДополнительныеДанные[0].Пометка = Ложь;
	
КонецПроцедуры

&НаКлиенте
Процедура ВвестиСведенияОбОП()
		
	ИмяРаздела = СтруктураРеквизитовФормы.НаимТекущегоРаздела;
	
	СтраницыРаздела = Неопределено;
	
	Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяРаздела, СтраницыРаздела) Тогда
		Возврат;
	КонецЕсли;
	
	СтраницыРаздела = ЭтаФорма[СтраницыРаздела];
	
	АктивнаяСтраница = СтраницыРаздела.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
	
	Если АктивнаяСтраница.Количество() = 0 Тогда
		Возврат;
	Иначе
		АктивнаяСтраница = АктивнаяСтраница[0];
	КонецЕсли;
	
	Если АктивнаяСтраница.ДополнительныеДанные.Количество() = 0 Тогда
		АктивнаяСтраница.ДополнительныеДанные.Добавить(Новый Структура);
	КонецЕсли;
	
	ЭтоПБОЮЛ = НЕ РегламентированнаяОтчетностьВызовСервера.ЭтоЮридическоеЛицо(СтруктураРеквизитовФормы.Организация);

	СведенияОбОП = Новый Структура;
	
	СведенияОбОП.Вставить("Наименование", "");
	СведенияОбОП.Вставить("ИНН",          "");
	СведенияОбОП.Вставить("КПП",          "");
	
	СведенияОбОП.Вставить("Страна",          "РОССИЯ");
	СведенияОбОП.Вставить("Индекс",          "");
	СведенияОбОП.Вставить("КодРегиона",      "");
	СведенияОбОП.Вставить("Район",           "");
	СведенияОбОП.Вставить("Город",           "");
	СведенияОбОП.Вставить("НаселенныйПункт", "");
	СведенияОбОП.Вставить("Улица",           "");
	СведенияОбОП.Вставить("Дом",             "");
	СведенияОбОП.Вставить("Корпус",          "");
	СведенияОбОП.Вставить("Квартира",        "");
	
	СведенияОбОП.Вставить("ТипДома",         "");
	СведенияОбОП.Вставить("ТипКорпуса",      "");
	СведенияОбОП.Вставить("ТипКвартиры",     "");
	
	СведенияОбОП.Вставить("ПредставлениеАдреса", "");
	
	СохраненныеСведения = Неопределено;
	ИмяЭлементаСтруктуры = "СведенияОбОП";
	
	Если АктивнаяСтраница.ДополнительныеДанные[0].Значение.Свойство(ИмяЭлементаСтруктуры, СохраненныеСведения) Тогда
    	ЗаполнитьЗначенияСвойств(СведенияОбОП, СохраненныеСведения);
	КонецЕсли;
	
	Если ПустаяСтрока(СведенияОбОП.ИНН) Тогда
		СведенияОбОП.ИНН = СтруктураДанныхТитульный.ИНН1;
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("СведенияОбОП", СведенияОбОП);	
	
	ФормаВводаРеквизитов = РегламентированнаяОтчетностьКлиент.ПолучитьОбщуюФормуПоИмени("ВводРеквизитовОП", ПараметрыФормы);
	
	ДополнительныеПараметры = Новый Структура("АктивнаяСтраница, ИмяЭлементаСтруктуры, СведенияОбОП, ЭтоПБОЮЛ", АктивнаяСтраница, ИмяЭлементаСтруктуры, СведенияОбОП, ЭтоПБОЮЛ);
	ОписаниеОповещения = Новый ОписаниеОповещения("ВвестиСведенияОбОПЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	ФормаВводаРеквизитов.ОписаниеОповещенияОЗакрытии = ОписаниеОповещения;
	ФормаВводаРеквизитов.РежимОткрытияОкна = РежимОткрытияОкнаФормы.БлокироватьОкноВладельца;
	ФормаВводаРеквизитов.Открыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ВвестиСведенияОбОПЗавершение(РезультатВвода, ДополнительныеПараметры) Экспорт
	
	АктивнаяСтраница = ДополнительныеПараметры.АктивнаяСтраница;
	ИмяЭлементаСтруктуры = ДополнительныеПараметры.ИмяЭлементаСтруктуры;
	СведенияОбОП = ДополнительныеПараметры.СведенияОбОП;
	ЭтоПБОЮЛ = ДополнительныеПараметры.ЭтоПБОЮЛ;
	
	Если РезультатВвода <> Неопределено Тогда
		
		Если ЭтоПБОЮЛ Тогда
			ЗаполнитьЗначенияСвойств(СведенияОбОП, РезультатВвода, , "ИНН, КПП");
		Иначе
			ЗаполнитьЗначенияСвойств(СведенияОбОП, РезультатВвода,);
		КонецЕсли;
		
		АктивнаяСтраница.ДополнительныеДанные[0].Значение.Вставить(ИмяЭлементаСтруктуры, СведенияОбОП);
		
		ВыводитьРеквизиты = (НЕ ПустаяСтрока(РезультатВвода.Наименование) 
		ИЛИ НЕ ПустаяСтрока(РезультатВвода.ИНН) 
		ИЛИ НЕ ПустаяСтрока(РезультатВвода.КПП)
		ИЛИ НЕ ПустаяСтрока(РезультатВвода.ПредставлениеАдреса));
		
		Если ВыводитьРеквизиты Тогда
			НаименованиеОП = "";
			Если НЕ ПустаяСтрока(РезультатВвода.Наименование) Тогда
				НаименованиеОП = РезультатВвода.Наименование;
			КонецЕсли;
			Если НЕ ЭтоПБОЮЛ Тогда
				Если НЕ ПустаяСтрока(РезультатВвода.ИНН) Тогда
					НаименованиеОП = НаименованиеОП + ?(ПустаяСтрока(НаименованиеОП), "", ", ") + "ИНН " + РезультатВвода.ИНН;
				КонецЕсли;
				Если НЕ ПустаяСтрока(РезультатВвода.КПП) Тогда
					НаименованиеОП = НаименованиеОП + ?(ПустаяСтрока(НаименованиеОП), "", ", ") + "КПП " + РезультатВвода.КПП;
				КонецЕсли;
			КонецЕсли;
			Если НЕ ПустаяСтрока(РезультатВвода.ПредставлениеАдреса) Тогда
				НаименованиеОП = НаименованиеОП + ?(ПустаяСтрока(НаименованиеОП), "", Символы.ПС) + РезультатВвода.ПредставлениеАдреса;
			КонецЕсли;
		Иначе
			НаименованиеОП = "";
		КонецЕсли;
		
		ТабличныйДокумент.Области.ОбособленноеПодразделение.Значение = НаименованиеОП;
		Модифицированность = Истина;
		
	КонецЕсли;
	
	АктивнаяСтраница.ДополнительныеДанные[0].Пометка = Ложь;
	
КонецПроцедуры

&НаКлиенте
Процедура ВвестиАдресМестаДеятельности(ИмяОбласти, Элемент);
	
	ПорядковыйНомер = Прав(ИмяОбласти, 1);
	
	СтраницыРазделаЛицензии = Неопределено;
	
	Если Не мСтруктураМногостраничныхРазделов.Свойство("Лицензии", СтраницыРазделаЛицензии) Тогда
		Возврат;
	КонецЕсли;
	
	СтраницыРазделаЛицензии = ЭтаФорма[СтраницыРазделаЛицензии];
	
	АктивнаяСтраница = СтраницыРазделаЛицензии.НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
	
	Если АктивнаяСтраница.Количество() = 0 Тогда
		Возврат;
	Иначе
		АктивнаяСтраница = АктивнаяСтраница[0];
	КонецЕсли;
	
	Если АктивнаяСтраница.ДополнительныеДанные.Количество() = 0 Тогда
		АктивнаяСтраница.ДополнительныеДанные.Добавить(Новый Структура);
	КонецЕсли;
		
	АдресМестаДеятельности = Новый Структура;
	АдресМестаДеятельности.Вставить("Страна",          "РОССИЯ");
	АдресМестаДеятельности.Вставить("Индекс",          "");
	АдресМестаДеятельности.Вставить("КодРегиона",      "");
	АдресМестаДеятельности.Вставить("Регион",          "");
	АдресМестаДеятельности.Вставить("Район",           "");
	АдресМестаДеятельности.Вставить("Город",           "");
	АдресМестаДеятельности.Вставить("НаселенныйПункт", "");
	АдресМестаДеятельности.Вставить("Улица",           "");
	АдресМестаДеятельности.Вставить("Дом",             "");
	АдресМестаДеятельности.Вставить("Корпус",          "");
	АдресМестаДеятельности.Вставить("Квартира",        "");
	АдресМестаДеятельности.Вставить("ТипДома",         "");
	АдресМестаДеятельности.Вставить("ТипКорпуса",      "");
	АдресМестаДеятельности.Вставить("ТипКвартиры",     "");

	ИмяЭлементаСтруктуры = "АдресМестаДеятельности" + ПорядковыйНомер;
	СохраненныйАдресМестаДеятельности = Неопределено;

	Если АктивнаяСтраница.ДополнительныеДанные[0].Значение.Свойство(ИмяЭлементаСтруктуры, СохраненныйАдресМестаДеятельности) Тогда
		ЗаполнитьЗначенияСвойств(АдресМестаДеятельности, СохраненныйАдресМестаДеятельности);
	КонецЕсли;
	
	АдресМестаДеятельности.Регион = РегламентированнаяОтчетностьВызовСервера.ПолучитьНазваниеРегионаПоКоду(АдресМестаДеятельности.КодРегиона);
	
	ЗначенияПолей = Новый СписокЗначений;

	ЗначенияПолей.Добавить(АдресМестаДеятельности.Страна,          "Страна");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Индекс,          "Индекс");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Регион,          "Регион");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.КодРегиона,      "КодРегиона");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Район,           "Район");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Город,           "Город");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.НаселенныйПункт, "НаселенныйПункт");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Улица,           "Улица");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Дом,             "Дом");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Корпус,          "Корпус");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.Квартира,        "Квартира");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.ТипДома,         "ТипДома");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.ТипКорпуса,      "ТипКорпуса");
	ЗначенияПолей.Добавить(АдресМестаДеятельности.ТипКвартиры,     "ТипКвартиры");

	Представление = "";
	
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Индекс", АдресМестаДеятельности)),             ", ", Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Регион", АдресМестаДеятельности)),             ", ", Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Район", АдресМестаДеятельности)),              ", ", Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Город", АдресМестаДеятельности)),              ", ", Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("НаселенныйПункт", АдресМестаДеятельности)),    ", ", Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Улица", АдресМестаДеятельности)),              ", ", Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Дом", АдресМестаДеятельности)),                ", " + ЗначениеПоКлючуСтуктуры("ТипДома", АдресМестаДеятельности)    + " № ", Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Корпус", АдресМестаДеятельности)),             ", " + ЗначениеПоКлючуСтуктуры("ТипКорпуса ", АдресМестаДеятельности)+ " ",	Представление);
	ДополнитьПредставлениеАдреса(СокрЛП(ЗначениеПоКлючуСтуктуры("Квартира", АдресМестаДеятельности)),           ", " + ЗначениеПоКлючуСтуктуры("ТипКвартиры", АдресМестаДеятельности) + " ",	Представление);
	
	Если СтрДлина(Представление) > 2 Тогда
		Представление = Сред(Представление, 3);
	КонецЕсли;

	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Заголовок",               "Ввод адреса");
	ПараметрыФормы.Вставить("ЗначенияПолей", 		   ЗначенияПолей);
	ПараметрыФормы.Вставить("Представление", 		   Представление);
	ПараметрыФормы.Вставить("ВидКонтактнойИнформации", СтруктураРеквизитовФормы.СправочникиВидыКонтактнойИнформацииФактАдресОрганизации);
		
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("АдресМестаДеятельности", АдресМестаДеятельности);
	ДополнительныеПараметры.Вставить("ПорядковыйНомер",        ПорядковыйНомер);
	ДополнительныеПараметры.Вставить("АктивнаяСтраница",       АктивнаяСтраница);
	
	ТипЗначения = Тип("ОписаниеОповещения");
	ПараметрыКонструктора = Новый Массив(3);
	ПараметрыКонструктора[0] = "ОткрытьФормуКонтактнойИнформацииЗавершение";
	ПараметрыКонструктора[1] = ЭтаФорма;
	ПараметрыКонструктора[2] = ДополнительныеПараметры;
	
	Оповещение = Новый (ТипЗначения, ПараметрыКонструктора);
	
	ОбщегоНазначенияКлиент.ОбщийМодуль("УправлениеКонтактнойИнформациейКлиент").ОткрытьФормуКонтактнойИнформации(ПараметрыФормы, , Оповещение);
	
КонецПроцедуры

&НаКлиенте
Функция ЗначениеПоКлючуСтуктуры(Ключ, Структура)
	
	Значение = Неопределено;
	
	Если Структура.Свойство(Ключ, Значение) Тогда 
		Возврат Строка(Значение);
	КонецЕсли;
	
	Возврат "";
	
КонецФункции

&НаКлиенте
Процедура ДополнитьПредставлениеАдреса(Дополнение, СтрокаКонкатенации, Представление)
	
	Если Дополнение <> "" Тогда
		Представление = Представление + СтрокаКонкатенации + Дополнение;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВвестиПоказатель(Элемент, Область, КодПоказателя, Знач ЭтоСумма, Знач ТекстВыбора, ТаблицаВыбора, СтандартнаяОбработка, КолонкаПоиска = "Код") Экспорт
	
	Если ТаблицаВыбора = Неопределено ИЛИ СтруктураРеквизитовФормы.мАвтоВыборКодов Тогда
		Возврат;
	КонецЕсли;
	
	// Показатели спаренные по списку выбора.
	Если СтрНайти(КодПоказателя, "П000010000101") = 1 ИЛИ СтрНайти(КодПоказателя, "П000010000301") = 1
	 ИЛИ СтрНайти(КодПоказателя, "П000020000101") = 1 ИЛИ СтрНайти(КодПоказателя, "П000020000301") = 1 Тогда
		КолонкаПоиска = "Название";
	КонецЕсли;
	
	СтандартнаяОбработка = Ложь;
	
	Если Область.Имя = КодПоказателя ИЛИ РегламентированнаяОтчетностьКлиентСервер.ПоказательВходитВМногострочнуюЧасть(ЭтаФорма, КодПоказателя) > 0 Тогда
		ИсходноеЗначение = ?(ТипЗнч(Область.Значение) = Тип("Строка"), СокрЛП(Область.Значение), Область.Значение);
	Иначе
		Разделитель = ?(Лев(Область.Имя, СтрДлина(КодПоказателя) + 1) = КодПоказателя + "_", "_", "");
		ИндексОбласти = 1;
		ИсходноеЗначение = "";
		Пока ЭтаФорма[ТекущийЭлемент.Имя].Области.Найти(КодПоказателя + Разделитель + Формат(ИндексОбласти, "ЧГ=")) <> Неопределено Цикл
			ИсходноеЗначение = ИсходноеЗначение + Строка(ЭтаФорма[ТекущийЭлемент.Имя].Области[КодПоказателя + Разделитель + Формат(ИндексОбласти, "ЧГ=")].Значение);
			ИндексОбласти = ИндексОбласти + 1;
		КонецЦикла;
		ИсходноеЗначение = СокрЛП(ИсходноеЗначение);
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Заголовок",          ТекстВыбора);
	ПараметрыФормы.Вставить("ТаблицаЗначений",    ТаблицаВыбора);
	ПараметрыФормы.Вставить("СтруктураДляПоиска", Новый Структура(КолонкаПоиска, ИсходноеЗначение));
	
	ДополнительныеПараметры = Новый Структура("ИндексОбласти, КодПоказателя, КолонкаПоиска, Область, Разделитель", ИндексОбласти, КодПоказателя, КолонкаПоиска, Область, Разделитель);
	ОписаниеОповещения = Новый ОписаниеОповещения("ВвестиПоказательЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	ОткрытьФорму("Обработка.ОбщиеОбъектыРеглОтчетности.Форма.ФормаВыбораЗначенияИзТаблицы", ПараметрыФормы, ЭтаФорма,,,, ОписаниеОповещения, РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	
КонецПроцедуры

&НаКлиенте
Процедура ВвестиПоказательЗавершение(РезультатВыбора, ДополнительныеПараметры) Экспорт
	
	ИндексОбласти = ДополнительныеПараметры.ИндексОбласти;
	КодПоказателя = ДополнительныеПараметры.КодПоказателя;
	КолонкаПоиска = ДополнительныеПараметры.КолонкаПоиска;
	Область = ДополнительныеПараметры.Область;
	Разделитель = ДополнительныеПараметры.Разделитель;
	
	Если РезультатВыбора = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если Область.Имя = КодПоказателя ИЛИ РегламентированнаяОтчетностьКлиентСервер.ПоказательВходитВМногострочнуюЧасть(ЭтаФорма, КодПоказателя) > 0 Тогда
		Область.Значение = РезультатВыбора[КолонкаПоиска];
		Если Область.Значение = "Пустое значение" Тогда
			Область.Значение = "";
		КонецЕсли;
		ЗаполнитьСвязанныеПоказатели(Область.Имя, РезультатВыбора);
	Иначе
		СтрокаРезультатВыбора = Строка(РезультатВыбора[КолонкаПоиска]);
		Для Инд = СтрДлина(СтрокаРезультатВыбора) + 1 По ИндексОбласти - 1 Цикл
			СтрокаРезультатВыбора = " " + РезультатВыбора[КолонкаПоиска];
		КонецЦикла;
		Для Инд = 1 По ИндексОбласти - 1 Цикл
			ЭтаФорма[ТекущийЭлемент.Имя].Области[КодПоказателя + Разделитель + Формат(Инд, "ЧГ=")].Значение = СокрЛП(Сред(РезультатВыбора[КолонкаПоиска], Инд, 1));
		КонецЦикла;
	КонецЕсли;
	
	Модифицированность = Истина;
	
	РасчетНаКлиенте(СтруктураРеквизитовФормы.НаимТекущегоРаздела, Область.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьСвязанныеПоказатели(ИмяОбласти, РезультатВыбора)
	
	Если СтрНайти(ИмяОбласти, "П000010000101") = 1 Тогда
		ИмяСвязаннойОбласти = "П000010000102" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = РезультатВыбора.Код;
		Если ПустаяСтрока(РезультатВыбора.Код) Тогда
			ТабличныйДокумент.Области[ИмяОбласти].Значение = "";
		КонецЕсли;
		
	ИначеЕсли СтрНайти(ИмяОбласти, "П000010000102") = 1 Тогда
		ИмяСвязаннойОбласти = "П000010000101" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = ?(ПустаяСтрока(РезультатВыбора.Код), "", РезультатВыбора.Название);
		
	ИначеЕсли СтрНайти(ИмяОбласти, "П000010000301") = 1 Тогда
		ИмяСвязаннойОбласти = "П000010000302" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = РезультатВыбора.Код;
		Если ПустаяСтрока(РезультатВыбора.Код) Тогда
			ТабличныйДокумент.Области[ИмяОбласти].Значение = "";
		КонецЕсли;
		
	ИначеЕсли СтрНайти(ИмяОбласти, "П000010000302") = 1 Тогда
		ИмяСвязаннойОбласти = "П000010000301" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = ?(ПустаяСтрока(РезультатВыбора.Код), "", РезультатВыбора.Название);
		
	ИначеЕсли СтрНайти(ИмяОбласти, "П000020000101") = 1 Тогда
		ИмяСвязаннойОбласти = "П000020000102" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = РезультатВыбора.Код;
		Если ПустаяСтрока(РезультатВыбора.Код) Тогда
			ТабличныйДокумент.Области[ИмяОбласти].Значение = "";
		КонецЕсли;
		
	ИначеЕсли СтрНайти(ИмяОбласти, "П000020000102") = 1 Тогда
		ИмяСвязаннойОбласти = "П000020000101" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = ?(ПустаяСтрока(РезультатВыбора.Код), "", РезультатВыбора.Название);
		
	ИначеЕсли СтрНайти(ИмяОбласти, "П000020000301") = 1 Тогда
		ИмяСвязаннойОбласти = "П000020000302" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = РезультатВыбора.Код;
		Если ПустаяСтрока(РезультатВыбора.Код) Тогда
			ТабличныйДокумент.Области[ИмяОбласти].Значение = "";
		КонецЕсли;
		
	ИначеЕсли СтрНайти(ИмяОбласти, "П000020000302") = 1 Тогда
		ИмяСвязаннойОбласти = "П000020000301" + Сред(ИмяОбласти, 14);
		СвязаннаяОбласть = ТабличныйДокумент.Области[ИмяСвязаннойОбласти];
		СвязаннаяОбласть.Значение = ?(ПустаяСтрока(РезультатВыбора.Код), "", РезультатВыбора.Название);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьОтчет(Команда)
	
	Если Элементы.РазделыОтчета.ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	СохранитьНаКлиенте();
	
КонецПроцедуры

// СохранитьНаКлиенте()
//
&НаКлиенте
Процедура СохранитьНаКлиенте(Автосохранение = Ложь, ВыполняемоеОповещение = Неопределено) Экспорт
	
	Вариант = СтруктураРеквизитовФормы.ВидДокумента * НомерКорректировки;

	КодИФНС = "";
	КПП = "";
                       
	Если НЕ РегламентированнаяОтчетностьКлиент.ПриЗаписиРегламентированногоОтчетаНаКлиенте(ЭтаФорма, КодИФНС, Автосохранение, Вариант) Тогда
		Возврат;
	КонецЕсли;
	
	ПодобныйОтчетСуществует = Ложь;
	ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки = Ложь;
	
	Если Элементы.РазделыОтчета.ТекущиеДанные = Неопределено Тогда
		НаименованиеТекущегоРаздела = СтруктураРеквизитовФормы.НаимТекущегоРаздела;
	Иначе
		НаименованиеТекущегоРаздела = Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим;
	КонецЕсли;
	
	РезультатСохранения = ПередСохранением(КодИФНС, КПП, ПодобныйОтчетСуществует, Вариант, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, Автосохранение, НаименованиеТекущегоРаздела);
	
	ВидДокументаНомерКорректировкиИзменен = Неопределено;
	
	Если ПодобныйОтчетСуществует И Автосохранение Тогда
		Возврат;
	КонецЕсли;
	
	НуженВопросПередСохранением = (ПодобныйОтчетСуществует ИЛИ ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки);
	
	Если НуженВопросПередСохранением Тогда
		
		СохранитьНаКлиентеСВопросом(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПодобныйОтчетСуществует, КодИФНС, КПП);
		
	Иначе
		
		ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьНаКлиентеСВопросом(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПодобныйОтчетСуществует, КодИФНС, КПП)
	
	Если ПодобныйОтчетСуществует Тогда
		
		Кнопки = Новый СписокЗначений;
		Кнопки.Добавить(КодВозвратаДиалога.Да, "Сохранить");
		Кнопки.Добавить(КодВозвратаДиалога.Нет, "Отмена");
		
		ТекстВопроса = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Отчет с видом %1 уже существует.
			|Сохранить отчет с таким же видом?'"), ?(Вариант = 0, """Первичный""", """Корректирующий/" + Вариант + """"));
		ДополнительныеПараметры = Новый Структура("Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, КодИФНС, КПП", Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, КодИФНС, КПП);
		ОписаниеОповещения = Новый ОписаниеОповещения("ВопросСохранитьОтчетСТакимЖеВидомЗавершение", ЭтотОбъект, ДополнительныеПараметры);
		ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, Кнопки, , Кнопки.Получить(1).Значение);
		
	Иначе
		
		СохранитьНаКлиентеСВопросомПродолжение(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки,КодИФНС, КПП);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВопросСохранитьОтчетСТакимЖеВидомЗавершение(РезультатВопроса, ДополнительныеПараметры) Экспорт
	
	Автосохранение = ДополнительныеПараметры.Автосохранение;
	Вариант = ДополнительныеПараметры.Вариант;
	ВыполняемоеОповещение = ДополнительныеПараметры.ВыполняемоеОповещение;
	КодИФНС = ДополнительныеПараметры.КодИФНС;
	КПП = ДополнительныеПараметры.КПП;
	ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки = ДополнительныеПараметры.ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки;
	
	Ответ = РезультатВопроса;
	Если Ответ = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли;
	
	СохранитьНаКлиентеСВопросомПродолжение(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки,КодИФНС, КПП);
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьНаКлиентеСВопросомПродолжение(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, КодИФНС, КПП)
	
	Если ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки Тогда
		ПараметрыФормы = Новый Структура();
		ПараметрыФормы.Вставить("ВидОтчета", Вариант);
		
		ФормаВопроса = РегламентированнаяОтчетностьКлиент.ПолучитьОбщуюФормуПоИмени("ВопросПриИзмененииВидаДокументаНомераКорректировки", ПараметрыФормы);
		ФормаВопроса.РежимОткрытияОкна = РежимОткрытияОкнаФормы.БлокироватьОкноВладельца;
		ДополнительныеПараметры = Новый Структура("Автосохранение, Вариант, ВыполняемоеОповещение, КодИФНС, КПП", Автосохранение, Вариант, ВыполняемоеОповещение,КодИФНС, КПП );
		ОписаниеОповещения = Новый ОписаниеОповещения("ВопросПриИзмененииВидаДокументаЗавершение", ЭтотОбъект, ДополнительныеПараметры);
		ФормаВопроса.ОписаниеОповещенияОЗакрытии = ОписаниеОповещения;
		ФормаВопроса.Открыть();
	Иначе
		Состояние(СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Сохраняется %1...'"), ЭтаФорма.Заголовок), , , БиблиотекаКартинок.Записать);
		РезультатСохранения = Сохранить(Автосохранение, КодИФНС, КПП, Вариант, Неопределено, Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим);
		ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВопросПриИзмененииВидаДокументаЗавершение(КодВозврата, ДополнительныеПараметры) Экспорт
	
	Автосохранение = ДополнительныеПараметры.Автосохранение;
	Вариант = ДополнительныеПараметры.Вариант;
	ВыполняемоеОповещение = ДополнительныеПараметры.ВыполняемоеОповещение;
	КодИФНС = ДополнительныеПараметры.КодИФНС;
	КПП = ДополнительныеПараметры.КПП;
	Если КодВозврата = КодВозвратаДиалога.Да
		ИЛИ КодВозврата = КодВозвратаДиалога.Нет Тогда
		ВидДокументаНомерКорректировкиИзменен = ?(КодВозврата = КодВозвратаДиалога.Да, Истина, Ложь);
	Иначе
		Возврат;
	КонецЕсли;
	
	Состояние(СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Сохраняется %1...'"), ЭтаФорма.Заголовок), , , БиблиотекаКартинок.Записать);
	РезультатСохранения = Сохранить(Автосохранение, КодИФНС, КПП, Вариант, ВидДокументаНомерКорректировкиИзменен, Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим);
	ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения)
	
	КлючУникальности = СтруктураРеквизитовФормы.мСохраненныйДок;
	
	Если РезультатСохранения Тогда
		
		РегламентированнаяОтчетностьКлиент.ПослеЗаписиРегламентированногоОтчета(ЭтаФорма);
		
		Если ВыполняемоеОповещение <> Неопределено Тогда
			ВыполнитьОбработкуОповещения(ВыполняемоеОповещение);
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПередСохранением(КодИФНС, КПП, ПодобныйОтчетСуществует, Вариант, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, Автосохранение, НаимТекРаздела)
	
	Если РегламентированнаяОтчетность.БылиИзмененыКлючевыеРеквизитыОтчета(ЭтаФорма, КодИФНС, КПП)
	   И РегламентированнаяОтчетность.СуществуетДокументСАналогичнымиРеквизитами(ЭтаФорма, КодИФНС) Тогда
		
		ПодобныйОтчетСуществует = Истина;
		
	КонецЕсли;
	
	СтруктураРеквизитовФормы.мЗаписываетсяНовыйДокумент = (СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено ИЛИ СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено);
	
	Если Вариант <> Неопределено И ((СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено) ИЛИ (СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено) ИЛИ (Вариант <> СтруктураРеквизитовФормы.мВариант)) Тогда
		
		Если СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено ИЛИ СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено Тогда
						
		ИначеЕсли Вариант <> СтруктураРеквизитовФормы.мВариант Тогда
			
			ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки = Истина;
								
		КонецЕсли;

	КонецЕсли;
	
	Если ПодобныйОтчетСуществует
	 ИЛИ ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки Тогда
	 
	 	Возврат Ложь;
		
 	КонецЕсли;
		
	Возврат Сохранить(Автосохранение, КодИФНС, КПП, Вариант, , НаимТекРаздела);
		
КонецФункции

&НаСервере
Процедура ОчиститьХранилищеОтПробелов(ИдГруппы)
	
	Хранилище = ЭтаФорма["Хранилище" + ИдГруппы];
	Шаблон    = ЭтаФорма[ИдГруппы].Выгрузить().СкопироватьКолонки();
	
	Для Каждого СтраницаХранилища Из Хранилище Цикл
	
		ТаблЗнач = СтраницаХранилища.Таблица;
		КолонкиТаблЗнач = Шаблон.Колонки;
		
		Для Каждого СтрокаТаб Из ТаблЗнач Цикл
		    Для Каждого Колонка Из КолонкиТаблЗнач Цикл
			
				ИмяКолонки = Колонка.Имя;
				Если ТипЗнч(СтрокаТаб[ИмяКолонки]) = Тип("Строка") Тогда
				
					СтрокаТаб[ИмяКолонки] = СокрЛП(СтрокаТаб[ИмяКолонки]);
				
				КонецЕсли; 
			
			КонецЦикла;		
		КонецЦикла; 
	
	КонецЦикла; 
	
КонецПроцедуры

&НаСервере
Процедура ОчиститьХранилищаОтПробелов()

	ОчиститьХранилищеОтПробелов(СтруктураРеквизитовФормы.мИдГруппы12);
	ОчиститьХранилищеОтПробелов(СтруктураРеквизитовФормы.мИдГруппы22);

КонецПроцедуры

&НаСервере
Функция Сохранить(Автосохранение = Ложь, КодИФНС, КПП, Вариант, ВидДокументаНомерКорректировкиИзменен = Неопределено, НаимТекРаздела) Экспорт
	
	ДанныеДляРазблокирования = Неопределено;
	
	Если НЕ СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Тогда
		Если НЕ СтруктураРеквизитовФормы.мБезОткрытияФормы Тогда
			ДанныеДляРазблокирования = Новый Структура("Ключ,ИдФормы",
			СтруктураРеквизитовФормы.мСохраненныйДок, ЭтаФорма.УникальныйИдентификатор);
		КонецЕсли;
		СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.ПолучитьОбъект();
	КонецЕсли;
	
	Если НЕ РегламентированнаяОтчетность.ПриЗаписиРегламентированногоОтчетаНаСервере(ЭтаФорма, КодИФНС, Автосохранение, Вариант, ВидДокументаНомерКорректировкиИзменен, СтруктураРеквизитовФормы.мСохраненныйДок) Тогда
		СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.Ссылка;
		Возврат Ложь;
	КонецЕсли;

	// установим текущие значения реквизитов документа	
	СтруктураРеквизитовФормы.мСохраненныйДок.ИсточникОтчета           = Метаданные.Отчеты[Сред(Лев(СтрЗаменить(ЭтаФорма.ИмяФормы, "Внешний", ""), СтрНайти(СтрЗаменить(ЭтаФорма.ИмяФормы, "Внешний", ""), ".Форма.") - 1), 7)].Имя;
	СтруктураРеквизитовФормы.мСохраненныйДок.НаименованиеОтчета       = Метаданные.Отчеты[Сред(Лев(СтрЗаменить(ЭтаФорма.ИмяФормы, "Внешний", ""), СтрНайти(СтрЗаменить(ЭтаФорма.ИмяФормы, "Внешний", ""), ".Форма.") - 1), 7)].ОсновнаяФорма.Синоним;
	СтруктураРеквизитовФормы.мСохраненныйДок.ДатаНачала               = СтруктураРеквизитовФормы.мДатаНачалаПериодаОтчета;
	СтруктураРеквизитовФормы.мСохраненныйДок.ДатаОкончания            = СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета;
	СтруктураРеквизитовФормы.мСохраненныйДок.Комментарий              = Комментарий;
	СтруктураРеквизитовФормы.мСохраненныйДок.Периодичность            = СтруктураРеквизитовФормы.мПериодичность;
	СтруктураРеквизитовФормы.мСохраненныйДок.ВыбраннаяФорма           = СтруктураРеквизитовФормы.мВыбраннаяФорма;
	СтруктураРеквизитовФормы.мСохраненныйДок.Организация              = СтруктураРеквизитовФормы.Организация;
	СтруктураРеквизитовФормы.мСохраненныйДок.ДатаПодписи              = ДатаПодписи;
	СтруктураРеквизитовФормы.мСохраненныйДок.ВидОтчетности            = Перечисления.ВидыОтчетности.РегламентированнаяОтчетность;
	СтруктураРеквизитовФормы.мСохраненныйДок.КодНалоговогоОргана      = КодИФНС;
	СтруктураРеквизитовФормы.мСохраненныйДок.КПП        			  = КПП;
	СтруктураРеквизитовФормы.мСохраненныйДок.Вид                      = Вариант;
	СтруктураРеквизитовФормы.мСохраненныйДок.ПредставлениеВида        = РегламентированнаяОтчетность.ПредставлениеВидаДокумента(СтруктураРеквизитовФормы.мСохраненныйДок.Вид);
	СтруктураРеквизитовФормы.мВариант 								  = Вариант;

	СтруктураРеквизитовФормы.мСохраненныйДок.ФорматВыгрузки = "Автоматически";
	
	СохранитьДанныеРаздела(НаимТекРаздела, Ложь, Ложь);
	
	ЗаполнитьПустыеСтруктурыДанных();
		
	// Очистка хранилищ от пробелов в строковых значениях
	ОчиститьХранилищаОтПробелов();
		
	// формируем данные редактируемых ячеек таблицы
	ПоказателиОтчета = Новый Структура();

	ЗаполнитьПоказателиОтчетаНаСервере(ПоказателиОтчета);
	
	// формируем список сохранения
	СписокСохранения = Новый Структура();
	
	// вставляем данные редактируемых ячеек таблицы	
	СписокСохранения.Вставить("ПоказателиОтчета", ПоказателиОтчета);
    	
	ДанныеМногострочныхРазделов = Новый Структура;
	
	Для Каждого ЭлементСтруктуры Из мСтруктураМногострочныхРазделов Цикл
		
		ДанныеМногострочныхРазделов.Вставить(ЭлементСтруктуры.Ключ, ДанныеФормыВЗначение(ЭтаФорма[ЭлементСтруктуры.Значение], Тип("ТаблицаЗначений")));
		
	КонецЦикла;
	
	// вставляем данные многострочных разделов
	СписокСохранения.Вставить("ДанныеМногострочныхРазделов", ДанныеМногострочныхРазделов);
	
	ДанныеМногостраничныхРазделов = Новый Структура;
	
	МассивТиповНеопределено = Новый Массив;
	МассивТиповНеопределено.Добавить(Тип("Неопределено"));
	ОписаниеТиповНеопределено = Новый ОписаниеТипов(МассивТиповНеопределено);
		
	Для Каждого ЭлементСтруктуры Из мСтруктураМногостраничныхРазделов Цикл
		
		ДанныеМногостраничныхРазделов.Вставить(ЭлементСтруктуры.Ключ, ДанныеФормыВЗначение(ЭтаФорма[ЭлементСтруктуры.Значение], Тип("ТаблицаЗначений")));
		
		ТаблЗнач = Неопределено;
		
		Если ДанныеМногостраничныхРазделов.Свойство(ЭлементСтруктуры.Ключ, ТаблЗнач) Тогда
						
			Если НЕ ТаблЗнач.Колонки.Найти("Данные") = Неопределено Тогда
												
				ТаблЗнач.Колонки.Удалить("Данные");
				ТаблЗнач.Колонки.Добавить("Данные", ОписаниеТиповНеопределено);
				
				Ном = 0;
				
				Для Каждого СтрокаТаблЗнач Из ТаблЗнач Цикл
					
					СтрокаТаблЗнач.Данные = ЭтаФорма[ЭлементСтруктуры.Значение][Ном].Данные[0].Значение;
					
					Ном = Ном + 1;
					
				КонецЦикла;
				
			КонецЕсли;
			
			Если НЕ ТаблЗнач.Колонки.Найти("ДополнительныеДанные") = Неопределено Тогда
												
				ТаблЗнач.Колонки.Удалить("ДополнительныеДанные");
				ТаблЗнач.Колонки.Добавить("ДополнительныеДанные", ОписаниеТиповНеопределено);
				
				Ном = 0;
				
				Для Каждого СтрокаТаблЗнач Из ТаблЗнач Цикл
					
					СтрокаТаблЗнач.ДополнительныеДанные = ЭтаФорма[ЭлементСтруктуры.Значение][Ном].ДополнительныеДанные[0].Значение;
					
					Ном = Ном + 1;
					
				КонецЦикла;
				
			КонецЕсли;
						
			Если НЕ ТаблЗнач.Колонки.Найти("ДанныеДопСтрок") = Неопределено Тогда
															
				ТаблЗнач.Колонки.Удалить("ДанныеДопСтрок");
				ТаблЗнач.Колонки.Добавить("ДанныеДопСтрок", ОписаниеТиповНеопределено);
				
				Ном = 0;
				
				Для Каждого СтрокаТаблЗнач Из ТаблЗнач Цикл
						
					СтруктураДанныхДопСтрок = Новый Структура;
					
					Для Каждого ЭлСтруктуры Из ЭтаФорма[ЭлементСтруктуры.Значение][Ном].ДанныеДопСтрок[0].Значение Цикл
														
						СтруктураДанныхДопСтрок.Вставить(ЭлСтруктуры.Ключ, ДанныеФормыВЗначение(ЭлСтруктуры.Значение, Тип("ТаблицаЗначений")));	
							
					КонецЦикла;
					
					СтрокаТаблЗнач.ДанныеДопСтрок = СтруктураДанныхДопСтрок;
					
					Ном = Ном + 1;
			
				КонецЦикла;
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	// вставляем данные многостраничных разделов
	СписокСохранения.Вставить("ДанныеМногостраничныхРазделов", ДанныеМногостраничныхРазделов);
	
	ДанныеВариантовАвтоЗаполнения = Новый Структура;
	
	Для Каждого ЭлементСтруктуры Из мСтруктураВариантыЗаполнения Цикл
		МассивТаблЗнач = Новый Массив;
		ДанныеВариантовАвтоЗаполнения.Вставить(ЭлементСтруктуры.Ключ, МассивТаблЗнач);
		Для Каждого ЭлементМассива Из ЭтаФорма["ТаблицаВариантыЗаполнения" + ЭлементСтруктуры.Ключ] Цикл
			МассивТаблЗнач.Добавить(ДанныеФормыВЗначение(ЭлементМассива.ТаблицаВариантовЗаполнения, Тип("ТаблицаЗначений")));
		КонецЦикла;
	КонецЦикла;
	
	СписокСохранения.Вставить("ДанныеВариантовАвтоЗаполнения", ДанныеВариантовАвтоЗаполнения);
	СписокСохранения.Вставить("ВерсияФормы",                   СтруктураРеквизитовФормы.мВерсияФормы);
	СписокСохранения.Вставить("СохранятьРасшифровку",          СтруктураРеквизитовФормы.мСохранятьРасшифровку);
	
	Если СтруктураРеквизитовФормы.АдресВременногоХранилищаРасшифровки <> Неопределено Тогда
		ТаблицаРасшифровки = ПолучитьИзВременногоХранилища(СтруктураРеквизитовФормы.АдресВременногоХранилищаРасшифровки);
		Если СтруктураРеквизитовФормы.мСохранятьРасшифровку = Истина Тогда
			СписокСохранения.Вставить("Расшифровка", ТаблицаРасшифровки);
		КонецЕсли;
	КонецЕсли;
	
	// вствляем флажок пересчета страниц
	СписокСохранения.Вставить("ФлПодсчетСтраниц",     СтруктураРеквизитовФормы.мСчетчикСтраниц);
	СписокСохранения.Вставить("ФлОтклВыборЗначений",  СтруктураРеквизитовФормы.мАвтоВыборКодов);
	СписокСохранения.Вставить("Автозаполнение",       СтруктураРеквизитовФормы.ФлажокОтклАвтоРасчет);
	СписокСохранения.Вставить("ДополнительныеДанные", ДополнительныеДанные);
	
	ХранилищеДанных = Новый ХранилищеЗначения(СписокСохранения);
	СтруктураРеквизитовФормы.мСохраненныйДок.ДанныеОтчета = ХранилищеДанных;
	
	// записываем документ, хранящий данные отчета
	Попытка
		СтруктураРеквизитовФормы.мСохраненныйДок.Записать();
	Исключение
		Если НЕ Автосохранение Тогда
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='%1'"), РегламентированнаяОтчетностьКлиентСервер.СформироватьТекстСообщения(ОписаниеОшибки()));
			Сообщение.Сообщить();
		КонецЕсли;
		СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.Ссылка;
		Возврат Ложь;
	КонецПопытки;
	
	СохранитьДеревоСтраницОтчета(СтруктураРеквизитовФормы.мСохраненныйДок);
	
	Модифицированность = Ложь;
	
	СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.Ссылка;
	
	Если НЕ СтруктураРеквизитовФормы.мБезОткрытияФормы
       И НЕ СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Тогда
				   
    	ЗаблокироватьДанныеДляРедактирования(СтруктураРеквизитовФормы.мСохраненныйДок, , ЭтаФорма.УникальныйИдентификатор);

    КонецЕсли;
	
	Если ДанныеДляРазблокирования <> Неопределено Тогда
		РазблокироватьДанныеДляРедактирования(ДанныеДляРазблокирования.Ключ, ДанныеДляРазблокирования.ИдФормы);
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьПоказателиОтчетаНаСервере(ПоказателиОтчета)
	
	Префикс = "ПолеТабличногоДокумента";
	
	Для Каждого Раздел Из мСвойстваРазделовДекларации.ПолучитьЭлементы() Цикл
			
		Если НЕ Раздел.МногостраничностьВРазделе Тогда
			ПоказателиОтчета.Вставить(Префикс + Раздел.ИмяСтраницы, ЭтаФорма["СтруктураДанных" + Раздел.ИмяСтраницы]);
		КонецЕсли;
	
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ВосстановитьСохраненныеДанные()
	
	Перем ДанныеМногострочныхРазделов;
	Перем ДанныеМногостраничныхРазделов;
	Перем ДанныеВариановАвтоЗаполнения;
	Перем ПоказателиОтчета;
	Перем ВерсияФормы;
	Перем Автозаполнение;
	Перем ТаблицаРасшифровки;
	Перем ТаблицаМногостраничногоДокумента;
	
	// В случае, если формы была скопирована по F9, то проверим, не изменилась ли организация.
	Если СтруктураРеквизитовФормы.Организация <> СтруктураРеквизитовФормы.мСохраненныйДок.Организация
	   И СтруктураРеквизитовФормы.Организация <> РегламентированнаяОтчетностьКлиентСервер.ПустоеЗначениеТипа("СправочникСсылка.Организации")
	   И СтруктураРеквизитовФормы.Организация <> Неопределено Тогда
		СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Истина;
	Иначе
		// восстанавливаем реквизиты отчета
		СтруктураРеквизитовФормы.Организация = СтруктураРеквизитовФормы.мСохраненныйДок.Организация;
	КонецЕсли;
	
	ДатаПодписи = СтруктураРеквизитовФормы.мСохраненныйДок.ДатаПодписи;
	Комментарий = СтруктураРеквизитовФормы.мСохраненныйДок.Комментарий;
	
	// восстанавливаем сохраненные данные отчета
	СписокСохранения = СтруктураРеквизитовФормы.мСохраненныйДок.ДанныеОтчета.Получить();
	
	// список листов, выводимых на печать
	ДеревоНастройкиСтраниц = СтруктураРеквизитовФормы.мСохраненныйДок.ДеревоНастройкиСтраниц.Получить();
	
	// Установим актуальные представления разделов.
	Если НЕ ДеревоНастройкиСтраниц = Неопределено Тогда
		
		Для Каждого СтрокаДерева Из ДеревоНастройкиСтраниц.Строки Цикл
			Счетчик = ?(Счетчик = Неопределено, 0, Счетчик);
			ЭлементмДеревоСтраницОтчета = мДеревоСтраницОтчета.ПолучитьЭлементы().Получить(Счетчик);
			Если СтрокаДерева.ИмяСтраницы = ЭлементмДеревоСтраницОтчета.ИмяСтраницы Тогда
				Если НЕ СтрокаДерева.Представление = ЭлементмДеревоСтраницОтчета.Представление Тогда
					СтрокаДерева.Представление = ЭлементмДеревоСтраницОтчета.Представление;
				КонецЕсли;
			Иначе
				Продолжить;
			КонецЕсли;
			Счетчик = Счетчик + 1;
		КонецЦикла;
		
		ЗначениеВРеквизитФормы(ДеревоНастройкиСтраниц.Скопировать(), "мДеревоСтраницОтчета");
		
	КонецЕсли;
	
	// восстанавливаем сохраненные данные вариантов автозаполнения ячеек
	Если СписокСохранения.Свойство("ДанныеВариантовАвтоЗаполнения", ДанныеВариановАвтоЗаполнения) Тогда
		Если НЕ ДанныеВариановАвтоЗаполнения = Неопределено Тогда
			мСтруктураВариантыЗаполнения.Очистить();
			Для Каждого ЭлементСтруктуры Из ДанныеВариановАвтоЗаполнения Цикл
				мСтруктураВариантыЗаполнения.Вставить(ЭлементСтруктуры.Ключ, ЭлементСтруктуры.Ключ);
				ЭтаФорма["ТаблицаВариантыЗаполнения" + ЭлементСтруктуры.Ключ].Очистить();
				Для Каждого ЭлементМассива Из ЭлементСтруктуры.Значение Цикл
					ТаблВарЗаполнения = ЭтаФорма["ТаблицаВариантыЗаполнения" + ЭлементСтруктуры.Ключ].Добавить().ТаблицаВариантовЗаполнения;
					ЗначениеВДанныеФормы(ЭлементМассива, ТаблВарЗаполнения);
				КонецЦикла;
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;
	
	// восстановим сохраненные данные редактируемых ячеек
	СписокСохранения.Свойство( "ПоказателиОтчета", ПоказателиОтчета );
	
	// восстанавливаем сохраненные данные многострочных разделов
	Если СписокСохранения.Свойство( "ДанныеМногострочныхРазделов", ДанныеМногострочныхРазделов) Тогда
		Для Каждого ЭлементСтруктуры Из ДанныеМногострочныхРазделов Цикл
			НайденноеЗначение = Неопределено;
			мСтруктураМногострочныхРазделов.Свойство(ЭлементСтруктуры.Ключ, НайденноеЗначение);
			Если НЕ НайденноеЗначение = Неопределено Тогда
				ЗначениеВДанныеФормы(ЭлементСтруктуры.Значение, ЭтаФорма[НайденноеЗначение])
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	Если СписокСохранения.Свойство("ДанныеМногостраничныхРазделов", ДанныеМногостраничныхРазделов) Тогда
		
		Для Каждого ЭлементСтруктуры Из ДанныеМногостраничныхРазделов Цикл
			НайденноеЗначение = Неопределено;
			мСтруктураМногостраничныхРазделов.Свойство(ЭлементСтруктуры.Ключ, НайденноеЗначение);
			
			Если НЕ НайденноеЗначение = Неопределено Тогда
				НайденноеЗначение = ЭтаФорма[НайденноеЗначение];
				ЗначениеВДанныеФормы(ЭлементСтруктуры.Значение, НайденноеЗначение);
				
				Если НайденноеЗначение[0].Свойство("Данные") Тогда
					Для Каждого СтрокаТаблЗнач Из НайденноеЗначение Цикл
						Если ТипЗнч(СтрокаТаблЗнач.Данные) = Тип("СписокЗначений") Тогда
							СтрокаТаблЗнач.Данные.Очистить();
							СтрокаТаблЗнач.Данные.Добавить(ЭлементСтруктуры.Значение[НайденноеЗначение.Индекс(СтрокаТаблЗнач)].Данные);
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				
				Если НайденноеЗначение[0].Свойство("ДополнительныеДанные") Тогда
					Для Каждого СтрокаТаблЗнач Из НайденноеЗначение Цикл
						Если ТипЗнч(СтрокаТаблЗнач.ДополнительныеДанные) = Тип("СписокЗначений") Тогда
							СтрокаТаблЗнач.ДополнительныеДанные.Очистить();
							СтрокаТаблЗнач.ДополнительныеДанные.Добавить(ЭлементСтруктуры.Значение[НайденноеЗначение.Индекс(СтрокаТаблЗнач)].ДополнительныеДанные);
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				
				Если НайденноеЗначение[0].Свойство("ДанныеДопСтрок") Тогда
					Ном = 0;
					Для Каждого СтрокаТаблЗнач Из ЭлементСтруктуры.Значение Цикл
						Если ТипЗнч(СтрокаТаблЗнач.ДанныеДопСтрок) = Тип("Структура") Тогда
							СтруктураДопСтрок = Новый Структура;
							Для Каждого ЭлСтруктуры Из СтрокаТаблЗнач.ДанныеДопСтрок Цикл
								ТаблЗнач = ЭлСтруктуры.Значение;
								СтрокаТаблЗначДанныеДопСтрок = ЭтаФорма["Хранилище" + ЭлСтруктуры.Ключ].Добавить().Таблица;
								ЗначениеВДанныеФормы(ТаблЗнач, СтрокаТаблЗначДанныеДопСтрок);
								СтруктураДопСтрок.Вставить(ЭлСтруктуры.Ключ, СтрокаТаблЗначДанныеДопСтрок);
							КонецЦикла;
							НайденноеЗначение[Ном].ДанныеДопСтрок.Добавить(СтруктураДопСтрок, "ДанныеФормыКоллекцияТаблицаДопСтрокРаздела");
						КонецЕсли;
						Ном = Ном + 1;
					КонецЦикла;
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	Для Каждого Раздел Из мСтруктураМногостраничныхРазделов Цикл
		Для Каждого Страница Из ЭтаФорма[Раздел.Значение] Цикл
			Страница.АктивнаяСтраница = Ложь;
		КонецЦикла;
	КонецЦикла;
	
	СписокСохранения.Свойство("Автозаполнение", Автозаполнение);
	СтруктураРеквизитовФормы.ФлажокОтклАвтоРасчет = Автозаполнение;
	
	СписокСохранения.Свойство("СохранятьРасшифровку", СтруктураРеквизитовФормы.мСохранятьРасшифровку);
	Если СтруктураРеквизитовФормы.мСохранятьРасшифровку = Неопределено Тогда
		СтруктураРеквизитовФормы.мСохранятьРасшифровку = Истина;
	КонецЕсли;
	
	СписокСохранения.Свойство("Расшифровка", ТаблицаРасшифровки);
	
	Если ТипЗнч(ТаблицаРасшифровки) = Тип("ТаблицаЗначений") Тогда
		
		Если ТаблицаРасшифровки.Колонки.Найти("НомСтроки") <> Неопределено Тогда
			
			ИмяПоказателя     = ТаблицаРасшифровки.Колонки.Найти("ИмяПоказателя");
			ИмяПоказателя.Имя = "НаименованиеПоказателя";
			
			ИмяЯчейки     = ТаблицаРасшифровки.Колонки.Найти("ИмяЯчейки");
			ИмяЯчейки.Имя = "ИмяПоказателя";
			
			Раздел     = ТаблицаРасшифровки.Колонки.Найти("Раздел");
			Раздел.Имя = "ИмяРаздела";
			
			ИмяСлагаемого     = ТаблицаРасшифровки.Колонки.Найти("ИмяСлагаемого");
			ИмяСлагаемого.Имя = "НаименованиеСлагаемого";
			
			ТаблицаРасшифровки.Колонки.Добавить("ДополнительныеПараметры");
			
			Для Каждого Элемент Из ТаблицаРасшифровки Цикл
				
				Если ЗначениеЗаполнено(Элемент.КодСчета) Тогда
					Элемент.НаименованиеСлагаемого = Элемент.НаименованиеСлагаемого + Элемент.КодСчета.Код;
				КонецЕсли;
				
				ДопПараметры = Новый Структура;
				
				Если ЗначениеЗаполнено(Элемент.Субконто1) Тогда
					ДопПараметры.Вставить("Субконто1", Новый Структура("ВидСубконто,ЗначениеСубконто", Элемент.КодСчета.ВидыСубконто[0].ВидСубконто, Элемент.Субконто1));
				КонецЕсли;
				
				Если ЗначениеЗаполнено(Элемент.Субконто2) Тогда
					ДопПараметры.Вставить("Субконто2", Новый Структура("ВидСубконто,ЗначениеСубконто", Элемент.КодСчета.ВидыСубконто[1].ВидСубконто, Элемент.Субконто2));
				КонецЕсли;
				
				Если ЗначениеЗаполнено(Элемент.Субконто3) Тогда
					ДопПараметры.Вставить("Субконто3", Новый Структура("ВидСубконто,ЗначениеСубконто", Элемент.КодСчета.ВидыСубконто[2].ВидСубконто, Элемент.Субконто3));
				КонецЕсли;
				
				Элемент.ДополнительныеПараметры = ДопПараметры;
				
			КонецЦикла;
			
			ТаблицаРасшифровки = ТаблицаРасшифровки.Скопировать(, "ИмяПоказателя, НаименованиеПоказателя, ЗнакОперации, НаименованиеСлагаемого, Сумма, ИмяРаздела, ДополнительныеПараметры");
			
		КонецЕсли;
		
		СтруктураРеквизитовФормы.АдресВременногоХранилищаРасшифровки = ПоместитьВоВременноеХранилище(ТаблицаРасшифровки, УникальныйИдентификатор);
		Элементы.Расшифровать.Доступность = Истина;
		
	КонецЕсли;
	
	СписокСохранения.Свойство("ФлПодсчетСтраниц", СтруктураРеквизитовФормы.мСчетчикСтраниц);
	
	СписокСохранения.Свойство("ФлОтклВыборЗначений", СтруктураРеквизитовФормы.мАвтоВыборКодов);
	Если СтруктураРеквизитовФормы.мАвтоВыборКодов = Неопределено Тогда
		СтруктураРеквизитовФормы.мАвтоВыборКодов = Ложь;
	КонецЕсли;
	
	СписокСохранения.Свойство("ДополнительныеДанные", ДополнительныеДанные);
	ВосстановитьСтруктуруДополнительныхДанных(ЭтаФорма);
	
	СформироватьДеревоРазделовОтчетаНаСервере();
	
	Префикс = "ПолеТабличногоДокумента";
	
	
	Для Каждого Раздел Из мСвойстваРазделовДекларации.ПолучитьЭлементы() Цикл
		Если НЕ Раздел.МногостраничностьВРазделе Тогда
			ЭтаФорма["СтруктураДанных" + Раздел.ИмяСтраницы] = ПоказателиОтчета[Префикс + Раздел.ИмяСтраницы];
		КонецЕсли;
	КонецЦикла;
	
	ВосстановитьСведенияОбОрганизацииИзТитульногоЛистаСтарогоОбразца(ПоказателиОтчета);
	ВосстановитьСведенияОЛицензияхИзЛистаЛицензииСтарогоОбразца();
	
	ИмяТекРаздела = "Титульный";
	
	Для Каждого ЭлСтруктуры Из ЭтаФорма["СтруктураДанных" + ИмяТекРаздела] Цикл
		Попытка
			ТабличныйДокумент.Области[ЭлСтруктуры.Ключ].Значение = ЭлСтруктуры.Значение;
		Исключение
		КонецПопытки;
	КонецЦикла;
	
	РегламентированнаяОтчетность.ОперацииПриВосстановленииРегламентированногоОтчета(ЭтаФорма);
	
	// Управляем видимостью страниц основной панели формы
	КопироватьДанныеФормы(мДеревоСтраницОтчета, мДеревоВыбранныхСтраниц);
	
	Модифицированность = Ложь;
	
	СтруктураРеквизитовФормы.мДокументВосстановлен = Истина;
	
КонецПроцедуры

&НаСервере
Процедура ВосстановитьСведенияОбОрганизацииИзТитульногоЛистаСтарогоОбразца(ПоказателиОтчета)
		
	ПоказателиТаблПоле = ПоказателиОтчета["ПолеТабличногоДокументаТитульный"];
		
	Для Каждого Показатель Из ПоказателиТаблПоле Цикл
		
		ИмяПоказателя = Показатель.Ключ;
		
		Если ИмяПоказателя = "ИНН1_1" Тогда
			СтруктураДанныхТитульный.Вставить("ИНН1");
			Для Ном = 1 По 12 Цикл
				СтруктураДанныхТитульный.ИНН1 = СокрЛП(СтруктураДанныхТитульный.ИНН1) + ПоказателиТаблПоле["ИНН1_" + Ном];
				СтруктураДанныхТитульный.Удалить("ИНН1_" + Ном);
			КонецЦикла;
			Если Лев(СтруктураДанныхТитульный.ИНН1, 2) = "00" Тогда
				СтруктураДанныхТитульный.ИНН1 = Сред(СтруктураДанныхТитульный.ИНН1, 3);
			КонецЕсли;
		ИначеЕсли ИмяПоказателя = "КПП1_1" Тогда
			СтруктураДанныхТитульный.Вставить("КПП1");
			Для Ном = 1 По 9 Цикл
				СтруктураДанныхТитульный.КПП1 = СокрЛП(СтруктураДанныхТитульный.КПП1) + ПоказателиТаблПоле["КПП1_" + Ном];
				СтруктураДанныхТитульный.Удалить("КПП1_" + Ном);
			КонецЦикла;
		ИначеЕсли ИмяПоказателя = "ОтчетныйГод1" Тогда
			СтруктураДанныхТитульный.Вставить("ОтчетныйГод");
			Для Ном = 1 По 4 Цикл
				СтруктураДанныхТитульный.ОтчетныйГод = СокрЛП(СтруктураДанныхТитульный.ОтчетныйГод) + ПоказателиТаблПоле["ОтчетныйГод" + Ном];
				СтруктураДанныхТитульный.Удалить("ОтчетныйГод" + Ном);
			КонецЦикла;
		ИначеЕсли ИмяПоказателя = "НомКорр1" Тогда
			СтруктураДанныхТитульный.Вставить("НомКорр");
			Для Ном = 1 По 2 Цикл
				СтруктураДанныхТитульный.НомКорр = СокрЛП(СтруктураДанныхТитульный.НомКорр) + ПоказателиТаблПоле["НомКорр" + Ном];
				СтруктураДанныхТитульный.Удалить("НомКорр" + Ном);
			КонецЦикла;
		ИначеЕсли ИмяПоказателя = "ПочтовыйИндекс1" Тогда
			СтруктураДанныхТитульный.Вставить("ПочтовыйИндекс");
			Для Ном = 1 По 6 Цикл
				СтруктураДанныхТитульный.ПочтовыйИндекс = СокрЛП(СтруктураДанныхТитульный.ПочтовыйИндекс) + ПоказателиТаблПоле["ПочтовыйИндекс" + Ном];
				СтруктураДанныхТитульный.Удалить("ПочтовыйИндекс" + Ном);
			КонецЦикла;
		ИначеЕсли ИмяПоказателя = "КодРегиона1" Тогда
			СтруктураДанныхТитульный.Вставить("КодРегиона");
			Для Ном = 1 По 2 Цикл
				СтруктураДанныхТитульный.КодРегиона = СокрЛП(СтруктураДанныхТитульный.КодРегиона) + ПоказателиТаблПоле["КодРегиона" + Ном];
				СтруктураДанныхТитульный.Удалить("КодРегиона" + Ном);
			КонецЦикла;
		ИначеЕсли ИмяПоказателя = "Прил1" Тогда
			СтруктураДанныхТитульный.Вставить("Прил");
			Для Ном = 1 По 3 Цикл
				СтруктураДанныхТитульный.Прил = СокрЛП(СтруктураДанныхТитульный.Прил) + ПоказателиТаблПоле["Прил" + Ном];
				СтруктураДанныхТитульный.Удалить("Прил" + Ном);
			КонецЦикла;
				
		КонецЕсли;
		
	КонецЦикла;
		
	СтруктураРеквизитовФормы.Руководитель   			   = ПоказателиТаблПоле.ОргДиректор;
	СтруктураРеквизитовФормы.Бухгалтер     				   = ПоказателиТаблПоле.ОргБухгалтер;
	СтруктураРеквизитовФормы.ИндивидуальныйПредприниматель = ПоказателиТаблПоле.ОргИндивидуальныйПредприниматель;
	СтруктураРеквизитовФормы.ТелОрганизации 			   = ПоказателиТаблПоле.ТелОрганизации;
	
	ЗаполнитьДатуВЯчейкахНаСервере();

КонецПроцедуры

&НаСервере
Процедура ВосстановитьСведенияОЛицензияхИзЛистаЛицензииСтарогоОбразца()
	
	Для Каждого ЭлементТабл Из ЭтаФорма[мСтруктураМногостраничныхРазделов.Лицензии] Цикл
		
		ЭлементТабл.АктивнаяСтраница = Ложь;
		
		ПоказателиТаблПоле = ЭлементТабл.Данные[0].Значение;
		
		СтруктураДанныхЛицензии = ЭлементТабл.Данные[0].Значение;
		
		Для Каждого Показатель Из ПоказателиТаблПоле Цикл
			
			ИмяПоказателя = Показатель.Ключ;
			
			Для Инд = 1 По 6 Цикл
			
				Если ИмяПоказателя = "П000000000201_1_" + Инд Тогда
					СтруктураДанныхЛицензии.Вставить("П000000000201_" + Инд);
					Для Ном = 1 По 9 Цикл
						СтруктураДанныхЛицензии["П000000000201_" + Инд] = СокрЛП(СтруктураДанныхЛицензии["П000000000201_" + Инд]) + ПоказателиТаблПоле["П000000000201_" + Ном + "_" + Инд];
						СтруктураДанныхЛицензии.Удалить("П000000000201_" + Ном + "_" + Инд);
					КонецЦикла;
					
				ИначеЕсли ИмяПоказателя = "П000000000202_1_" + Инд Тогда
					СтруктураДанныхЛицензии.Вставить("П000000000202_" + Инд);
					Для Ном = 1 По 6 Цикл
						СтруктураДанныхЛицензии["П000000000202_" + Инд] = СокрЛП(СтруктураДанныхЛицензии["П000000000202_" + Инд]) + ПоказателиТаблПоле["П000000000202_" + Ном + "_" + Инд];
						СтруктураДанныхЛицензии.Удалить("П000000000202_" + Ном + "_" + Инд);
					КонецЦикла;
					
     			ИначеЕсли ИмяПоказателя = "П000000000203_1_" + Инд Тогда
					СтруктураДанныхЛицензии.Вставить("П000000000203_" + Инд);
					Для Ном = 1 По 2 Цикл
						СтруктураДанныхЛицензии["П000000000203_" + Инд] = СокрЛП(СтруктураДанныхЛицензии["П000000000203_" + Инд]) + ПоказателиТаблПоле["П000000000203_" + Ном + "_" + Инд];
						СтруктураДанныхЛицензии.Удалить("П000000000203_" + Ном + "_" + Инд);
					КонецЦикла;	
		
				КонецЕсли;
				
			КонецЦикла;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуНастроек(Команда)
	
	ОткрытьФормуВыбораСтраниц("ВыбратьДляНастройки");

КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуВыбораСтраниц(ВариантВыбора)
    Перем ТекущийРазделОтчетаСокрНаим;
	Перем НомерСтраницыРазделаОтчета;
	
	// Запоминаем текущий раздел, установленный в дереве разделов отчета.
	Если НЕ Элементы.РазделыОтчета.ТекущиеДанные = Неопределено Тогда
		ТекущийРазделОтчетаСокрНаим = Элементы.РазделыОтчета.ТекущиеДанные.КолонкаРазделыОтчетаСокрНаим;
		НомерСтраницыРазделаОтчета  = Элементы.РазделыОтчета.ТекущиеДанные.КолонкаНомерСтраницыРазделаОтчета;
	КонецЕсли;
	
	мПараметры = Новый Структура;
	мПараметры.Вставить("ПроверкаСоотношений", Ложь);
	мПараметры.Вставить("Автосохранение", Ложь);
	мПараметры.Вставить("Выгрузка", Ложь);
	мПараметры.Вставить("ИмеетсяРеквизитДеревоВыбранныхСтраниц", Истина);
	
	Если СтруктураРеквизитовФормы.ОтображатьКнопкуРасшифровать Тогда
		мПараметры.Вставить("СохранятьРасшифровкуАвтозаполнения", Истина);
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("ФлажокОтклАвтоРасчет", СтруктураРеквизитовФормы.ФлажокОтклАвтоРасчет);
	ПараметрыФормы.Вставить("мСчетчикСтраниц", СтруктураРеквизитовФормы.мСчетчикСтраниц);
	ПараметрыФормы.Вставить("мАвтоВыборКодов", СтруктураРеквизитовФормы.мАвтоВыборКодов);
	ПараметрыФормы.Вставить("СохранятьРасшифровкуАвтозаполнения", СтруктураРеквизитовФормы.мСохранятьРасшифровку);
	ПараметрыФормы.Вставить("мПараметры", мПараметры);
					
	ФормаНастройкиОтчета = РегламентированнаяОтчетностьКлиент.ПолучитьОбщуюФормуПоИмени("НастройкиОтчета", ПараметрыФормы, ЭтаФорма);

	мДеревоВыбранныхСтраниц.ПолучитьЭлементы().Очистить();
    
	КопироватьДанныеФормы(мДеревоСтраницОтчета, ФормаНастройкиОтчета.Дерево);
	
	ЗначениеАвторасчета = СтруктураРеквизитовФормы.ФлажокОтклАвтоРасчет;
	
	ДополнительныеПараметры = Новый Структура("ЗначениеАвторасчета, НомерСтраницыРазделаОтчета, ТекущийРазделОтчетаСокрНаим", ЗначениеАвторасчета, НомерСтраницыРазделаОтчета, ТекущийРазделОтчетаСокрНаим);
	ОписаниеОповещения = Новый ОписаниеОповещения("ОткрытьФормуВыбораСтраницЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	ФормаНастройкиОтчета.ОписаниеОповещенияОЗакрытии = ОписаниеОповещения;
	ФормаНастройкиОтчета.РежимОткрытияОкна = РежимОткрытияОкнаФормы.БлокироватьОкноВладельца;
	ФормаНастройкиОтчета.Открыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуВыбораСтраницЗавершение(РезультатВыбора, ДополнительныеПараметры) Экспорт
	
	ЗначениеАвторасчета = ДополнительныеПараметры.ЗначениеАвторасчета;
	НомерСтраницыРазделаОтчета = ДополнительныеПараметры.НомерСтраницыРазделаОтчета;
	ТекущийРазделОтчетаСокрНаим = ДополнительныеПараметры.ТекущийРазделОтчетаСокрНаим;
	
	Модифицированность = Истина;
	
	флЗначенияИдентичны = Истина;
	
	Для Индекс = 0 По мДеревоСтраницОтчета.ПолучитьЭлементы().Количество() - 1 Цикл
		
		Если НЕ мДеревоСтраницОтчета.ПолучитьЭлементы()[Индекс].ПоказатьСтраницу = мДеревоВыбранныхСтраниц.ПолучитьЭлементы()[Индекс].ПоказатьСтраницу Тогда	
			флЗначенияИдентичны = Ложь;
			Прервать;
		КонецЕсли;
		
	КонецЦикла;
	
	Если ЗначениеАвторасчета <> СтруктураРеквизитовФормы.ФлажокОтклАвтоРасчет Тогда
		
		ИзменитьТаблицуВариантовЗаполненияНаСервере();
		
		Если ТекущийРазделОтчетаСокрНаим = "Раздел1" Тогда
			УстановитьДоступностьПолейРаздела1(ЭтаФорма);
		ИначеЕсли ТекущийРазделОтчетаСокрНаим = "Раздел2" Тогда
			УстановитьДоступностьПолейРаздела2(ЭтаФорма);
		КонецЕсли;
		
	КонецЕсли;
	
	// Управляем видимостью страниц основной панели формы
	РегламентированнаяОтчетностьКлиент.ПоказатьСтраницыОтчетаНаКлиенте(ЭтаФорма);
	
	Если НЕ флЗначенияИдентичны Тогда
		
		СформироватьДеревоРазделовОтчетаНаКлиенте();
		
		Если НЕ ТекущийРазделОтчетаСокрНаим = Неопределено Тогда
			
			// Пытаемся найти ранее запомненный раздел.
			НайденнаяСтрока = РегламентированнаяОтчетностьКлиентСервер.НайтиЭлементВДанныхФормыДерево(РазделыОтчета.ПолучитьЭлементы(), "КолонкаРазделыОтчетаСокрНаим", ТекущийРазделОтчетаСокрНаим);
			
			Если НЕ НайденнаяСтрока = Неопределено 
				И НЕ НомерСтраницыРазделаОтчета = Неопределено 
				И НайденнаяСтрока.ПолучитьЭлементы().Количество() > 0 Тогда
				
				НайденнаяСтрока = РегламентированнаяОтчетностьКлиентСервер.НайтиЭлементВДанныхФормыДерево(НайденнаяСтрока.ПолучитьЭлементы(), "КолонкаНомерСтраницыРазделаОтчета", НомерСтраницыРазделаОтчета);
				
			КонецЕсли;
			
			// В случае успешного поиска, устанавливаем курсор на найденный раздел.
			Если НЕ НайденнаяСтрока = Неопределено Тогда
				Элементы.РазделыОтчета.ТекущаяСтрока = НайденнаяСтрока.ПолучитьИдентификатор();
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
		
КонецПроцедуры

&НаСервере
Процедура ИзменитьТаблицуВариантовЗаполненияНаСервере()
	
	РегламентированнаяОтчетностьКлиентСервер.ИзменитьТаблицуВариантовЗаполнения(ЭтаФорма, НЕ СтруктураРеквизитовФормы.ФлажокОтклАвтоРасчет);
	
	РегламентированнаяОтчетность.ПолучитьСведенияОПоказателяхОтчета(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура Выгрузить(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьЗавершение", ЭтотОбъект);

	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	ВыгрузитьОтчет();
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьОтчет() Экспорт
	
	Если НЕ ЗначениеЗаполнено(СтруктураРеквизитовФормы.Организация) Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru='Организация не выбрана! Выгрузка невозможна.'");
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьОтчетЗавершение", ЭтотОбъект);
	
	Если Модифицированность Тогда
		СохранитьНаКлиенте(,ОписаниеОповещения);
	Иначе
		ВыполнитьОбработкуОповещения(ОписаниеОповещения);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьОтчетЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	ФормаВыгрузкиРеглОтчета = ПолучитьФорму("Документ.ВыгрузкаРегламентированныхОтчетов.Форма.ФормаДокумента", , ЭтаФорма);
	
	СпДокОсн = Новый СписокЗначений;
	СпДокОсн.Добавить(СтруктураРеквизитовФормы.мСохраненныйДок);
	
	ФормаВыгрузкиРеглОтчета.СформироватьИЗаписать(СпДокОсн);
	
КонецПроцедуры

&НаКлиенте
Функция УниверсальнаяВыгрузка(Текст = Неопределено, ПроверятьБлокировки = Истина) Экспорт
	
	Если НЕ УниверсальнаяВыгрузкаXMLНаСервере(Текст) Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции

&НаСервере
Функция УниверсальнаяВыгрузкаXMLНаСервере(Текст)
	
	// проверяем показатели 
	Если НЕ ПроверитьПоказатели() Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Текст = ВыгрузитьДеревоВXML(ДеревоВыгрузки, ПараметрыВыгрузки);
	
	СтрокаИмениФайла = "<!-- ИдФайл=""" + ПараметрыВыгрузки.ИдФайл + """ -->";
	Текст = Текст + Символы.ПС + СтрокаИмениФайла;
	
	Возврат Истина;
	
КонецФункции

&НаСервере
Функция ПроверитьПоказатели() Экспорт
	
	ПараметрыВыгрузки = СформироватьСтруктуруПоказателейИСтруктуруПараметров();
	
	Если НЕ ОтчетЗаполненКорректно(ПараметрыВыгрузки) Тогда
		Возврат Ложь;
	КонецЕсли;
	
	ДеревоВыгрузки = ИзвлечьСтруктуруXML();
	ЗаполнитьДанными(ДеревоВыгрузки, ПараметрыВыгрузки);
	
	Если НЕ ПроверитьДанные(ДеревоВыгрузки) Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции

&НаСервере
Функция ОтчетЗаполненКорректно(ПараметрыВыгрузки)
	
	СтатусПроверки = Истина;
	
	ПроверитьЗаполнениеТитульный(ПараметрыВыгрузки, СтатусПроверки);
		
	ПроверитьЗаполнениеРаздел1(ПараметрыВыгрузки, СтатусПроверки);
	
	Если ТаблицаСообщений.Количество() <=  100 Тогда
		ПроверитьЗаполнениеРаздел2(ПараметрыВыгрузки, СтатусПроверки);
	КонецЕсли;
		
	Возврат СтатусПроверки;
	
КонецФункции

&НаСервере
Процедура ПроверитьЗаполнениеТитульный(ПараметрыВыгрузки, СтатусПроверки)
	
	Если ПараметрыВыгрузки.ЭтоПБОЮЛ Тогда
		
		УказаныФИО = НЕ ПустаяСтрока(ПараметрыВыгрузки.РуководительФамилия) И НЕ ПустаяСтрока(ПараметрыВыгрузки.РуководительИмя);
		Если НЕ УказаныФИО Тогда
			ТекстОписанияОшибки = "На Титульном листе не указаны фамилия, имя и отчество индивидуального предпринимателя!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ОргИндивидуальныйПредприниматель");
		КонецЕсли;
		
		Если ПустаяСтрока(ПараметрыВыгрузки.ИННФЛ) Тогда
			ТекстОписанияОшибки = "На Титульном листе не задан ИНН индивидуального предпринимателя!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ИНН1");
		ИначеЕсли СтрДлина(СокрЛП(ПараметрыВыгрузки.ИННФЛ))<> 12 Тогда
			ТекстОписанияОшибки = "На Титульном листе неверно задан ИНН индивидуального предпринимателя!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ИНН1");
		КонецЕсли;

	Иначе
		
		УказаныФИО = НЕ ПустаяСтрока(ПараметрыВыгрузки.РуководительФамилия) И НЕ ПустаяСтрока(ПараметрыВыгрузки.РуководительИмя);
		Если НЕ УказаныФИО Тогда
			ТекстОписанияОшибки = "На Титульном листе не указаны фамилия, имя и отчество (при наличии) руководителя!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ОргДиректор");
		КонецЕсли;
		УказаныФИО = НЕ ПустаяСтрока(ПараметрыВыгрузки.ГлавбухФамилия) И НЕ ПустаяСтрока(ПараметрыВыгрузки.ГлавбухИмя);
		Если НЕ УказаныФИО Тогда
			ТекстОписанияОшибки = "На Титульном листе не указаны фамилия, имя и отчество (при наличии) главного бухгалтера!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ОргБухгалтер");
		КонецЕсли;
		
		ИНН = СокрЛП(ПараметрыВыгрузки.ИННЮЛ);
		КПП = СокрЛП(ПараметрыВыгрузки.КППЮЛ);
		
		Если ПустаяСтрока(ИНН) Тогда
			ТекстОписанияОшибки = "На Титульном листе не задан ИНН организации!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ИНН1");
		ИначеЕсли СтрДлина(ИНН) <> 10 Тогда
			ТекстОписанияОшибки = "На Титульном листе неверно задан ИНН организации!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ИНН1");
		КонецЕсли;
		
		Если ПустаяСтрока(КПП) Тогда
			ТекстОписанияОшибки = "На Титульном листе не задан КПП организации!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "КПП1");
		ИначеЕсли СтрДлина(КПП)<> 9 Тогда
			ТекстОписанияОшибки = "На Титульном листе неверно задан КПП организации!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "КПП1");
		КонецЕсли;
		
	КонецЕсли;	
		
	Если ПустаяСтрока(ПараметрыВыгрузки.НаимЮЛ) Тогда
		ТекстОписанияОшибки = "На Титульном листе не указано полное наименование организации!";
		СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "ОргНазв");
	КонецЕсли;
	
	Если ПустаяСтрока(ПараметрыВыгрузки.КодРегион) Тогда
		ТекстОписанияОшибки = "На Титульном листе в адресе организации не указан код региона!";
		СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "КодРегиона");
	ИначеЕсли СтрДлина(СокрЛП(ПараметрыВыгрузки.КодРегион))<> 2 Тогда
		ТекстОписанияОшибки = "На Титульном листе в адресе организации неверно указан код региона!";
		СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Титульный", "КодРегиона");
	КонецЕсли;	
	
КонецПроцедуры

&НаСервере
Функция ПроверитьЗаполнениеОП(СтатусПроверки, ЛистРаздела, НомерЛиста, ИмяРаздела, СтрВКакомРазделе, 
							КПП_НеОбязателен = Ложь, ПроверятьНаПустоту = Истина, СведенияОбОП = Неопределено)
							
	ДанныеЛиста = ЛистРаздела.Данные[0].Значение;
	НомерЛистаСтроковый = Формат(НомерЛиста, "ЧГ=0");
	
	ТекстОписанияОшибки = "";
		
	Если ПустаяСтрока(ДанныеЛиста.ОбособленноеПодразделение) и ПроверятьНаПустоту Тогда
		ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", не указаны реквизиты обособленного подразделения!";
		СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
	Иначе
		СведенияОбОП = Неопределено;
		Если ТипЗнч(ЛистРаздела.ДополнительныеДанные[0].Значение) = Тип("Структура") И ЛистРаздела.ДополнительныеДанные[0].Значение.Свойство("СведенияОбОП", СведенияОбОП) Тогда
			
			ИНН = СокрЛП(СведенияОбОП.ИНН);
			КПП = СокрЛП(СведенияОбОП.КПП);
			
			ДлинаИНН = СтрДлина(ИНН);
			ДлинаКПП = СтрДлина(КПП);
			
			Если ДлинаИНН = 0 Тогда
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", не указан ИНН обособленного подразделения!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
			ИначеЕсли (ДлинаИНН <> 10) и (ДлинаИНН <> 12) Тогда					
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", неверно указан ИНН обособленного подразделения!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
			Иначе
				Если (ДлинаИНН = 12) и (НЕ КПП_НеОбязателен) Тогда
				    ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", неверно указан ИНН обособленного подразделения!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);					
				КонецЕсли; 
			КонецЕсли; 				
			
			Если ДлинаИНН = 10 Тогда
				Если ДлинаКПП = 0 Тогда
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", не указан КПП обособленного подразделения!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
				ИначеЕсли ДлинаКПП <> 9 Тогда
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", неверно указан КПП обособленного подразделения!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
				КонецЕсли; 
			ИначеЕсли (ДлинаИНН = 12) и КПП_НеОбязателен Тогда
				Если НЕ ДлинаКПП = 0 Тогда
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", КПП обособленного подразделения должен быть пуст!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
				КонецЕсли;	
			КонецЕсли;
			
			// Контроль на цифры ИНН
			Если ДлинаИНН > 2 Тогда
		
				Если НЕ ВСтрокеВсеЦифры(ИНН) Тогда
					
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", строка ИНН обособленного подразделения должна состоять только из цифр!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
					
				КонецЕсли; 
				
				// первые 2 цифры ИНН не могут быть "00" для российского ИНН
				Если Лев(СокрЛП(ИНН), 2) = "00" Тогда
					
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", строка ИНН обособленного подразделения не должна начинаться с ""00""!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
					
				КонецЕсли;

			КонецЕсли;
			
			// Контроль на цифры КПП
			Если ДлинаКПП > 2 Тогда
			
				Если НЕ ВСтрокеВсеЦифры(КПП) Тогда
				
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", строка КПП обособленного подразделения должна состоять только из цифр!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
					
				КонецЕсли; 
				
				// первые 2 цифры КПП не могут быть "00", КПП может быть только Российским
				Если Лев(СокрЛП(КПП), 2) = "00" Тогда
					
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", строка КПП обособленного подразделения не должна начинаться с ""00""!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
					
				КонецЕсли;
			
			КонецЕсли;
			
			ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", не указано наименование обособленного подразделения!";
			Если ПустаяСтрока(СведенияОбОП.Наименование) Тогда
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
			КонецЕсли;
			
			Если ПустаяСтрока(СведенияОбОП.ПредставлениеАдреса) Тогда
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", не указан адрес обособленного подразделения!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
			ИначеЕсли ПустаяСтрока(СведенияОбОП.КодРегиона) Тогда
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
							+ ", в адресе обособленного подразделения не указан регион!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
			КонецЕсли;
		Иначе
			Если ПроверятьНаПустоту Тогда
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
								+ ", нарушена внутренняя структура реквизитов обособленного подразделения, требуется повторный ввод данных!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, "ОбособленноеПодразделение", НомерЛиста);
			КонецЕсли;	
		КонецЕсли;
	КонецЕсли;
	
	Возврат (ТекстОписанияОшибки = "");

КонецФункции

&НаСервере
Функция ВСтрокеВсеЦифры(ПроверяемаяСтрока)
	
	Если ПустаяСтрока(ПроверяемаяСтрока) = 1 Тогда
		// пустая строка не является строкой цифр
		Возврат Ложь;
	КонецЕсли;
	
	//Добавим цифру "1" для обработки ситуаций
	// - наличие лидирующих нулей
	// - введен один единственный символ не цифра 
	Попытка
		ДлинаПроверяемойСтроки = СтрДлина(Формат(Цел(Число("1" + СокрЛП(ПроверяемаяСтрока))), "ЧГ=0;ЧВН"));
	Исключение
		// если возникло исключение - значит не смогли преобразовать к числу "1" + СокрЛП(ПроверяемаяСтрока)
		Возврат Ложь;
	КонецПопытки;
	
	Возврат  ДлинаПроверяемойСтроки = (СтрДлина(ПроверяемаяСтрока) + 1);
	
КонецФункции

&НаСервере
Функция ПроверкаИННКППвСтрокахТаблиц(СтатусПроверки, ИмяРаздела, СтрВКакомРазделе, НомерЛиста, НомерСтрокиСтроковый, ИмяТаблицы, 
									ИмяПоказателяИНН, ИНН, ИмяПоказателяКПП, КПП, РодПадежЧейИННКПП, 
									РоссийскийКонтрагент = Неопределено, 
									МожетБытьПустойИНН = Ложь, МожетБытьПустойКПП = Ложь,
									РоссийскийТолькоЮЛ = Ложь, РоссийскийТолькоФЛ = Ложь)
									
	ДлинаИНН = СтрДлина(ИНН);
	ДлинаКПП = СтрДлина(КПП);
	НомерЛистаСтроковый = Формат(НомерЛиста, "ЧГ=0");
	ТекстОписанияОшибки = "";
	
	// В графе ИНН помимо собственно ИНН РФ (10 или 12 цифр) может указываться
	// Белоруссия - УНП - 9 цифр
	// Казахстан  - РНН или БИН или ИИН - все коды 12 цифр
	// Кыргызстан - ИНН - 14 цифр
	// Армения    - УНН - 8 цифр.
	ДлиныИНН_РФ 				= Новый Массив(2);
	ДлиныИНН_РФ.Добавить(10);
	ДлиныИНН_РФ.Добавить(12);
	
	ДлиныИНН_ТС 				= Новый Массив(5);
	ДлиныИНН_ТС.Добавить(8);
	ДлиныИНН_ТС.Добавить(9);
	ДлиныИНН_ТС.Добавить(10);
	ДлиныИНН_ТС.Добавить(12);
	ДлиныИНН_ТС.Добавить(14);
	
	ДлиныИНН_ТС_БезРФ 			= Новый Массив(4);
	ДлиныИНН_ТС_БезРФ.Добавить(8);
	ДлиныИНН_ТС_БезРФ.Добавить(9);
	ДлиныИНН_ТС_БезРФ.Добавить(12);
	ДлиныИНН_ТС_БезРФ.Добавить(14);
	// если МожетБытьПустойИНН - добавляется длина 0
	ДлиныИНН_Возможные 			= Новый Массив(6);
	ДлиныИНН_Возможные.Добавить(0);
	ДлиныИНН_Возможные.Добавить(8);
	ДлиныИНН_Возможные.Добавить(9);
	ДлиныИНН_Возможные.Добавить(10);
	ДлиныИНН_Возможные.Добавить(12);
	ДлиныИНН_Возможные.Добавить(14);
	
	ДлиныИНН_Возможные_БезРФ 	= Новый Массив(5);
	ДлиныИНН_Возможные_БезРФ.Добавить(0);
	ДлиныИНН_Возможные_БезРФ.Добавить(8);
	ДлиныИНН_Возможные_БезРФ.Добавить(9);
	ДлиныИНН_Возможные_БезРФ.Добавить(12);
	ДлиныИНН_Возможные_БезРФ.Добавить(14);
	
	// если КПП точно непуст - это точно российский резидент								
	Если НЕ МожетБытьПустойКПП Тогда
	    РоссийскийКонтрагент = Истина	
	КонецЕсли;
	
	// если российский резидент	то ИНН точно не пуст
	ЭтоТочноРоссийскийКонтрагент = (Не (РоссийскийКонтрагент = Неопределено)) и РоссийскийКонтрагент;
	
	Если ЭтоТочноРоссийскийКонтрагент Тогда
	    МожетБытьПустойИНН = Ложь	
	КонецЕсли;
	
	МожетБытьРоссийский = (РоссийскийКонтрагент = Неопределено) или ЭтоТочноРоссийскийКонтрагент;
	
	СтрИностранного = "";
	
	// Если известно резидент или нет								
	Если РоссийскийКонтрагент = Неопределено Тогда
		
		// если сюда попали - КПП может быть пуст
		Если Не МожетБытьПустойИНН Тогда
		    // из стран ТС (Россия, Белорусь, Казахстан, Армения, Кыргызстан)
			Если ДлинаИНН = 0 Тогда				
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", не указан ИНН " + РодПадежЧейИННКПП + "!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
			Иначе				
				Если ДлиныИНН_ТС.Найти(ДлинаИНН) = Неопределено Тогда
					
				    // длина не соответствует ни одной стране ТС
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан ИНН " + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
					 				
				КонецЕсли; 
			КонецЕсли; 			 
			
		Иначе
			// откуда угодно
			Если ДлиныИНН_Возможные.Найти(ДлинаИНН) = Неопределено Тогда
					
			    // длина не соответствует ни одной стране ТС и не пуста
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан ИНН " + РодПадежЧейИННКПП + "!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
				 				
			КонецЕсли;
		КонецЕсли; 
		
	Иначе
		Если РоссийскийКонтрагент Тогда
		    // точно резидент РФ
			СтрИностранного = " российского ";
			Если НЕ МожетБытьПустойКПП Тогда
			    // ЮрЛицо
				Если ДлинаИНН = 0 Тогда
					
				    ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", не указан ИНН" +  СтрИностранного + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
					
				ИначеЕсли НЕ ДлинаИНН = 10 Тогда	
					
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан ИНН" +  СтрИностранного + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
					
				КонецЕсли; 
			Иначе
				// ЮрЛицо или ФизЛицо				
				Если ДлинаИНН = 0 Тогда
					
				    ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", не указан ИНН" +  СтрИностранного + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
					
				ИначеЕсли ДлиныИНН_РФ.Найти(ДлинаИНН) = Неопределено Тогда
					// длина не 10 и не 12
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан ИНН" +  СтрИностранного + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
				Иначе
					
					Если РоссийскийТолькоЮЛ и (ДлинаИНН <> 10) Тогда
					
						ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан ИНН" +  СтрИностранного + РодПадежЧейИННКПП + "! ИНН должен быть 10-значный!";
						СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
						
						
					ИначеЕсли РоссийскийТолькоФЛ и (ДлинаИНН <> 12) Тогда
						
						ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан ИНН" +  СтрИностранного + РодПадежЧейИННКПП + "! ИНН должен быть 12-значный!";
						СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
						
					КонецЕсли;
					
				КонецЕсли; 
				
			КонецЕсли; 
		Иначе
			// точно иностранец
			СтрИностранного = " иностранного ";
			
			Если Не МожетБытьПустойИНН Тогда
			    // из стран ТС (Белорусь, Казахстан, Армения, Кыргызстан)
				Если ДлинаИНН = 0 Тогда
					
				    ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", не указан Идентификационный Номер" +  СтрИностранного + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
					
				ИначеЕсли ДлиныИНН_ТС_БезРФ.Найти(ДлинаИНН) = Неопределено Тогда
					// длина не 10 и не 12
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан Идентификационный Номер" + СтрИностранного + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
					
				КонецЕсли;
				
			Иначе	
			    // откуда угодно  
				Если ДлиныИНН_Возможные_БезРФ.Найти(ДлинаИНН) = Неопределено Тогда
					
				    // длина не соответствует ни одной стране ТС (кроме России) и не пуста
					ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", неверно указан Идентификационный Номер" + СтрИностранного + РодПадежЧейИННКПП + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
					 				
				КонецЕсли;
				
			КонецЕсли; 
			
			// для правильной отработки контроля КПП в случае если Длина ИНН равна 10
			// КПП для иностранцев должен быть пуст
			ДлинаИНН = ?(ДлинаИНН = 10, 9, ДлинаИНН);
		КонецЕсли; 
	
	КонецЕсли; 
	
	// Контроль КПП
	Если (ДлинаИНН = 10) и МожетБытьРоссийский Тогда
		
		Если НЕ РоссийскийТолькоФЛ Тогда
			
			// Это вероятно резидент РФ - ЮрЛицо и должно быть КПП
			Если ДлинаКПП = 0 Тогда
			    // КПП пуст
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
											+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
											+ ", не указан КПП " + РодПадежЧейИННКПП + "!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяКПП, НомерЛиста);
			ИначеЕсли НЕ ДлинаКПП = 9 Тогда
				// КПП неверный
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
											+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
											+ ", неверно указан КПП " + РодПадежЧейИННКПП + "!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяКПП, НомерЛиста);
			КонецЕсли;
			
		КонецЕсли;
		
	Иначе
		// КПП должен быть пуст 
		Если НЕ ДлинаКПП = 0 Тогда
			ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", КПП " + РодПадежЧейИННКПП + " должен быть пуст!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяКПП, НомерЛиста);
		КонецЕсли;	
	КонецЕсли;
	
	Если ТекстОписанияОшибки = "" Тогда
	
		// т.е ошибок по длинам ИНН-КПП не было
		// контроль на цифры
		
		Если ДлинаИНН > 0 Тогда
		
			Если НЕ ВСтрокеВсеЦифры(ИНН) Тогда
			
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", строка ИНН " + РодПадежЧейИННКПП + " должна состоять только из цифр!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяИНН, НомерЛиста);
			
			КонецЕсли; 
						
		КонецЕсли;
		
		Если ДлинаКПП > 0 Тогда
		
			Если НЕ ВСтрокеВсеЦифры(КПП) Тогда
			
				ТекстОписанияОшибки = СтрВКакомРазделе + " декларации, на листе " + НомерЛистаСтроковый 
										+ ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы 
										+ ", строка КПП " + РодПадежЧейИННКПП + " должна состоять только из цифр!";
				СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, ИмяРаздела, ИмяПоказателяКПП, НомерЛиста);
			
			КонецЕсли; 
			
		КонецЕсли;
	
	КонецЕсли; 
	
	Возврат (ТекстОписанияОшибки = "");
	    
КонецФункции

&НаСервере
Процедура ПроверитьЗаполнениеРаздел1(ПараметрыВыгрузки, СтатусПроверки)
	
	КПП_НеОбязателен = Истина;
	ИмяРаздела = "Раздел1";
	СтрВКакомРазделе = "В Разделе 1";
	ПроверятьНаПустоту = Истина;
	
	// Инициация таблицы Производителей из Раздела 1.
	ДанныеПроизводителейРаздел_Р1 = Новый ТаблицаЗначений;
		
	ДанныеПроизводителейРаздел_Р1.Колонки.Добавить("НаименованиеПроизводителя");
	ДанныеПроизводителейРаздел_Р1.Колонки.Добавить("ИННПроизводителя");
	ДанныеПроизводителейРаздел_Р1.Колонки.Добавить("КПППроизводителя");
	ДанныеПроизводителейРаздел_Р1.Колонки.Добавить("ОП_ИНН");
	ДанныеПроизводителейРаздел_Р1.Колонки.Добавить("ОП_КПП");
	ДанныеПроизводителейРаздел_Р1.Колонки.Добавить("ОП_Наим");
	
	ДанныеРаздела = мДанныеОтчета.Раздел1;
	
	Если СтруктураРеквизитовФормы.мСохраненныйДок.ДатаОкончания > '20140901' Тогда
		
		// Контроль записей на уникальность ("КПП ОП" + "Наименование ОП").
		//
		ДанныеОПТЗ_Р1 = Новый ТаблицаЗначений;
		
		ДанныеОПТЗ_Р1.Колонки.Добавить("НаимОП");
		ДанныеОПТЗ_Р1.Колонки.Добавить("КППОП");
		ДанныеОПТЗ_Р1.Колонки.Добавить("НомерЛиста");
		ДанныеОПТЗ_Р1.Колонки.Добавить("Колво");
		
		НомерЛиста = 0;
		Для Каждого ЛистРаздела Из ДанныеРаздела Цикл
			НомерЛиста = НомерЛиста + 1;
			ДанныеОП   = ЛистРаздела.Данные[0].Значение.ОбособленноеПодразделение;
						
			Если ПустаяСтрока(ДанныеОП) Тогда				
				Продолжить;
			КонецЕсли;
			
			СведенияОбОП = Неопределено;
			Если ТипЗнч(ЛистРаздела.ДополнительныеДанные[0].Значение) = Тип("Структура") 
				И ЛистРаздела.ДополнительныеДанные[0].Значение.Свойство("СведенияОбОП", СведенияОбОП) Тогда
				
				Если ЗначениеЗаполнено(СведенияОбОП.КПП) или ЗначениеЗаполнено(СведенияОбОП.Наименование) Тогда
					
					НоваяСтрокаТЗ = ДанныеОПТЗ_Р1.Добавить();
					НоваяСтрокаТЗ.КППОП      = СокрЛП(СведенияОбОП.КПП);
					НоваяСтрокаТЗ.НаимОП     = СокрЛП(СведенияОбОП.Наименование);
					НоваяСтрокаТЗ.Колво      = 1;
					НоваяСтрокаТЗ.НомерЛиста = НомерЛиста;
			
				КонецЕсли;
				
			КонецЕсли;
						
		КонецЦикла;
		
		КопияДанныеОПТЗ_Р1 = ДанныеОПТЗ_Р1.Скопировать();
		КопияДанныеОПТЗ_Р1.Свернуть("НаимОП, КППОП", "Колво");
		КопияДанныеОПТЗ_Р1.Сортировать("Колво Убыв");
		
		Для Каждого СтрокаТЗ Из КопияДанныеОПТЗ_Р1 Цикл
			
			Если СтрокаТЗ.Колво > 1 Тогда
				
				ОтборПовторов = Новый Структура;
				ОтборПовторов.Вставить("НаимОП", СтрокаТЗ.НаимОП);
				ОтборПовторов.Вставить("КППОП",  СтрокаТЗ.КППОП);
				
				НайденныеОП = ДанныеОПТЗ_Р1.НайтиСтроки(ОтборПовторов);
				
				Если НайденныеОП.Количество() > 0 Тогда
					
					ЛистыПовторы = "";
					Для Каждого ЭлНайденныеОП Из НайденныеОП Цикл
						ЛистыПовторы = ЛистыПовторы + ?(ПустаяСтрока(ЛистыПовторы), "", ", ") + ЭлНайденныеОП.НомерЛиста;
					КонецЦикла;
					
					ТекстОписанияОшибки = "В Разделе 1 декларации страницы №№ " + ЛистыПовторы + "  заполнены по одному и тому же предприятию: " + ЭлНайденныеОП.НаимОП 
										+ ?(НЕ ПустаяСтрока(ЭлНайденныеОП.КППОП), ", (КПП " + ЭлНайденныеОП.КППОП + ")", "");
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", "ОбособленноеПодразделение", ЭлНайденныеОП.НомерЛиста);
					
				КонецЕсли;
				
			Иначе
				Прервать;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
		
	ЕстьЗаполненныйЛистРаздела = Ложь;
		
	КоличествоСтрокТаблицыПоОрганизации = 0;
	ОбщееКоличествоСтрокПоОП = 0;
	
	НомерЛиста = 0;
	Для Каждого ЛистРаздела Из ДанныеРаздела Цикл
		
		НомерЛиста = НомерЛиста + 1;
		
		НомерЛистаСтроковый = Формат(НомерЛиста, "ЧГ=0");
		
		ДанныеЛиста = ЛистРаздела.Данные[0].Значение;
		
		СведенияОбОП = Неопределено;
		ПроверитьЗаполнениеОП(СтатусПроверки, ЛистРаздела, НомерЛиста, ИмяРаздела, СтрВКакомРазделе, 
							КПП_НеОбязателен, ПроверятьНаПустоту, СведенияОбОП);
		
		Если НЕ ПустаяСтрока(ДанныеЛиста.ОбособленноеПодразделение) Тогда
			ЕстьЗаполненныйЛистРаздела = Истина;
		КонецЕсли;
		
		// Проверка заполнения таблиц декларации.
		ДанныеДопСтрок = Неопределено;
		Если НомерЛиста = 1 Тогда
			
			ЛистРаздела.ДанныеДопСтрок[0].Значение.Свойство(СтруктураРеквизитовФормы.мИдГруппы11, ДанныеДопСтрок);
			ДополнительныеДанныеЛиста = Неопределено;
			Если ТипЗнч(ЛистРаздела.ДополнительныеДанные[0].Значение) = Тип("Структура") Тогда
				ДополнительныеДанныеЛиста = ЛистРаздела.ДополнительныеДанные[0].Значение;
			КонецЕсли;
			КоличЗаполненных = 0;
			ПроверитьЗаполнениеТаблицыРаздел1(СтатусПроверки, СтруктураРеквизитовФормы.мИдГруппы11, ДанныеДопСтрок, ДополнительныеДанныеЛиста, НомерЛиста, СведенияОбОП, , КоличЗаполненных);
			
			КоличествоСтрокТаблицыПоОрганизации = КоличЗаполненных;		
			
		КонецЕсли; 
		
		ДанныеДопСтрок = Неопределено;
		ДополнительныеДанныеЛиста = Неопределено;
				
		ЛистРаздела.ДанныеДопСтрок[0].Значение.Свойство(СтруктураРеквизитовФормы.мИдГруппы12, ДанныеДопСтрок);
		
		Если ТипЗнч(ЛистРаздела.ДополнительныеДанные[0].Значение) = Тип("Структура") Тогда
			ДополнительныеДанныеЛиста = ЛистРаздела.ДополнительныеДанные[0].Значение;
		КонецЕсли;
		КоличЗаполненных = 0;
		ПроверитьЗаполнениеТаблицыРаздел1(СтатусПроверки, СтруктураРеквизитовФормы.мИдГруппы12, ДанныеДопСтрок, ДополнительныеДанныеЛиста, НомерЛиста, СведенияОбОП, ЕстьЗаполненныйЛистРаздела, КоличЗаполненных);
		
		ОбщееКоличествоСтрокПоОП = ОбщееКоличествоСтрокПоОП + КоличЗаполненных;		
		
		Если ТаблицаСообщений.Количество() >  100 Тогда
			ТекстОписанияОшибки = "Найдено 100 и более ошибок. Дальнейшая проверка прекращена!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", , НомерЛиста);
		    Возврат;
		КонецЕсли; 
				
	КонецЦикла;
		
	Если НЕ ЕстьЗаполненныйЛистРаздела Тогда
		ТекстОписанияОшибки = "Не заполнен ни один лист декларации в Разделе 1!";
		СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", "ОбособленноеПодразделение", 1);
	КонецЕсли;
		
	Если КоличествоСтрокТаблицыПоОрганизации > ОбщееКоличествоСтрокПоОП Тогда
	    ТекстОписанияОшибки = "В Разделе 1 декларации в верхней таблице ""Сведения по организации/индивидуальному предпринимателю"" " 
							+ "заполнено больше строк, чем во всех нижних таблицах ""Сведения по обособленному подразделению""!";		
	    СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", "ОбособленноеПодразделение", 1);
	КонецЕсли;
			
КонецПроцедуры

&НаСервере
Процедура ПроверитьЗаполнениеТаблицыРаздел1(СтатусПроверки, ИдГруппы, ДанныеДопСтрок, ДополнительныеДанные, НомерЛиста, СведенияОбОП = Неопределено, ЕстьЗаполненныйЛистРаздела = Ложь, КоличЗаполненных)
	
	КоличЗаполненных = 0;
	ВерхняяТаблица = Ложь;
	
	НомерЛистаСтроковый = Формат(НомерЛиста, "ЧГ=0");
	
	ПрефиксИмени = ИдГруппы;
	
	Если ПрефиксИмени = "П0000100001" Тогда
		ИмяТаблицы = """Сведения по организации/индивидуальному предпринимателю""";
		ВерхняяТаблица = Истина;
	Иначе
		ИмяТаблицы = """Сведения по обособленному подразделению""";
	КонецЕсли;
	
	// Зафиксируем имена ключевых полей.
	ИмяКодаВидаПродукции = ПрефиксИмени + "02";
	ИмяНаименованияПроизводителя  = ПрефиксИмени + "03";
	ИмяИННПроизводителя = ПрефиксИмени + "04";
	ИмяКПППроизводителя = ПрефиксИмени + "05";
	
	СписокСтрокДубликатов = Новый СписокЗначений;
	
	НомерСтроки = 0;
	Для Каждого СтрокаДекларации Из ДанныеДопСтрок Цикл
		
		НомерСтроки = НомерСтроки + 1;
		
		НомерСтрокиСтроковый = Формат(НомерСтроки, "ЧГ=0");
		
		СтрокаЗаполнена = ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "02"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "03"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "04"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "05"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "06"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "07"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "08"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "09"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "10"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "11"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "12"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "13"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "14"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "15"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "16"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "17"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "18"]);
		Если НЕ СтрокаЗаполнена Тогда						  
			Продолжить;
		КонецЕсли;
		
		КоличЗаполненных = КоличЗаполненных + 1;
		Если ВерхняяТаблица Тогда
			// не проверяем - только считаем заполненные
			Продолжить;
		КонецЕсли;
		
		ЕстьЗаполненныйЛистРаздела = Истина;
		
		ИмяГрафы = ПрефиксИмени + "02";
		ИмяПоказателя = ПрефиксИмени + "02_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СокрЛП(СтрокаДекларации[ИмяГрафы]);
		КодВидаПродукции = ЗначениеГрафы;
		Если ПустаяСтрока(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 1 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не задан код вида продукции!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", ИмяПоказателя, НомерЛиста);
		ИначеЕсли СтрДлина(ЗначениеГрафы) <> 3 Тогда
			ТекстОписанияОшибки = "В Разделе 1 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", неверно задан код вида продукции!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		ИмяГрафы = ПрефиксИмени + "03";
		ИмяПоказателя = ПрефиксИмени + "03_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СокрЛП(СтрокаДекларации[ИмяГрафы]);
		СтрокаДекларации[ИмяГрафы] = ЗначениеГрафы;
		НаименованиеПроизводителя = ЗначениеГрафы;
		Если НЕ ЗначениеЗаполнено(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 1 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не указано наименование производителя/импортера!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		////////////////////////////////////////////////////////////////////////////////
		// Контроль ИНН-КПП
		
		ИмяГрафыИНН = ПрефиксИмени + "04";
		ИмяПоказателяИНН = ПрефиксИмени + "04_" + НомерСтрокиСтроковый;
		ИННПроизводителя = СокрЛП(СтрокаДекларации[ИмяГрафыИНН]);
		ИНН = ИННПроизводителя;
		СтрокаДекларации[ИмяГрафыИНН] = ИНН;
		ДлинаИНН = СтрДлина(ИНН);
		
		ИмяГрафыКПП = ПрефиксИмени + "05";
		ИмяПоказателяКПП = ПрефиксИмени + "05_" + НомерСтрокиСтроковый;
		КПППроизводителя = СокрЛП(СтрокаДекларации[ИмяГрафыКПП]);
		КПП = КПППроизводителя;
		СтрокаДекларации[ИмяГрафыКПП] = КПП;
		
		ИмяРаздела = "Раздел1";
		СтрВКакомРазделе = "В Разделе 1";
		РодПадежЧейИННКПП = "производителя/импортера";
		РоссийскийКонтрагент = Неопределено;
		МожетБытьПустойИНН = Ложь;
		МожетБытьПустойКПП = Истина;
		
		ПроверкаИННКППвСтрокахТаблиц(СтатусПроверки, ИмяРаздела, СтрВКакомРазделе, НомерЛиста, НомерСтрокиСтроковый, ИмяТаблицы, 
									ИмяПоказателяИНН, ИНН, ИмяПоказателяКПП, КПП, РодПадежЧейИННКПП, 
									РоссийскийКонтрагент, МожетБытьПустойИНН, МожетБытьПустойКПП);
		//
		////////////////////////////////////////////////////////////////////////////////
				
		// Заполняем Таблицу Производителей раздела 1.
		Если (ИмяТаблицы = """Сведения по обособленному подразделению""") и НЕ(СведенияОбОП = Неопределено) Тогда
			Если ЗначениеЗаполнено(НаименованиеПроизводителя) и ЗначениеЗаполнено(ИНН)
				и ЗначениеЗаполнено(СведенияОбОП.ИНН) и ЗначениеЗаполнено(СведенияОбОП.Наименование) Тогда
				
				НоваяСтрокаТЗ = ДанныеПроизводителейРаздел_Р1.Добавить();
						
				НоваяСтрокаТЗ.НаименованиеПроизводителя = СокрЛП(НаименованиеПроизводителя);
				НоваяСтрокаТЗ.ИННПроизводителя = ИНН;
				НоваяСтрокаТЗ.КПППроизводителя = КПП;
				НоваяСтрокаТЗ.ОП_ИНН = СокрЛП(СведенияОбОП.ИНН);
				НоваяСтрокаТЗ.ОП_КПП = СокрЛП(СведенияОбОП.КПП);
				НоваяСтрокаТЗ.ОП_Наим = СокрЛП(СведенияОбОП.Наименование);
				
			КонецЕсли;
		КонецЕсли;
		
		// Проверка на дублирование по ключевым полям.
		
		// Сначала проверим - возможно эта строка уже найдена как дубликат.
		Если СписокСтрокДубликатов.НайтиПоЗначению(НомерСтроки) = Неопределено Тогда 
			
			// Проверяем заполнение - нет смысла проверять неполностью заполненные ключевые поля.
			Если НЕ(ЗначениеЗаполнено(КодВидаПродукции) 
				ИЛИ ЗначениеЗаполнено(НаименованиеПроизводителя)
				ИЛИ ЗначениеЗаполнено(ИННПроизводителя)) Тогда
				// Проверку заполнения КПП пропускаем - Если не российская организация, КПП Может быть не заполнен.
				
				Продолжить;
			КонецЕсли;
			
			ОтборДубликатов = Новый Структура;
			ОтборДубликатов.Вставить(ИмяКодаВидаПродукции, КодВидаПродукции);
			ОтборДубликатов.Вставить(ИмяНаименованияПроизводителя, НаименованиеПроизводителя);
			ОтборДубликатов.Вставить(ИмяИННПроизводителя, ИННПроизводителя);
			ОтборДубликатов.Вставить(ИмяКПППроизводителя, КПППроизводителя);
			
			СтрокиДубликатов = ДанныеДопСтрок.НайтиСтроки(ОтборДубликатов);
			
			Если СтрокиДубликатов.Количество() > 1 Тогда
				
				ПереченьСтрок = "";
				АдресДубликата = "";
				Для Каждого СтрокаДубликата Из СтрокиДубликатов Цикл
					НомерСтрокиДубликата = ДанныеДопСтрок.Индекс(СтрокаДубликата) + 1;
					НомерСтрокиДубликатаСтроковый = Формат(НомерСтрокиДубликата, "ЧГ=0");
					
					// Добавим в Список уже отработанных строк. 
					СписокСтрокДубликатов.Добавить(НомерСтрокиДубликата);
				
					Если ПустаяСтрока(АдресДубликата) Тогда
						АдресДубликата = ИмяКодаВидаПродукции + "_" + НомерСтрокиДубликатаСтроковый;
					КонецЕсли;
					
					ПереченьСтрок = ПереченьСтрок + ?(ПустаяСтрока(ПереченьСтрок), "", ", ") + НомерСтрокиДубликатаСтроковый;
				КонецЦикла;
				
				Если НЕ ПустаяСтрока(АдресДубликата) Тогда
					ТекстОписанияОшибки ="В Разделе 1 декларации, на листе " + НомерЛистаСтроковый + " в таблице "+ ИмяТаблицы 
										  + ", повторяются сочетания кода вида продукции и реквизитов производителя/импортера в строках " 
										  + ПереченьСтрок + "!";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел1", АдресДубликата, НомерЛиста);
				КонецЕсли;
	        			
			КонецЕсли;
			
		Конецесли;	
		
		Если ТаблицаСообщений.Количество() >  100 Тогда		    
		    Возврат;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ПроверитьЗаполнениеРаздел2(ПараметрыВыгрузки, СтатусПроверки)
	
	КПП_НеОбязателен = Истина;
	ИмяРаздела = "Раздел2";
	СтрВКакомРазделе = "В Разделе 2";
	ПроверятьНаПустоту = Ложь; // Раздел 2 может не заполняться
	
	ДанныеРаздела = мДанныеОтчета.Раздел2;
	
	Если СтруктураРеквизитовФормы.мСохраненныйДок.ДатаОкончания > '20140901' Тогда
		
		// Контроль записей на уникальность ("КПП ОП" + "Наименование ОП").
		//
		ДанныеОПТЗ_Р2 = Новый ТаблицаЗначений;
		
		ДанныеОПТЗ_Р2.Колонки.Добавить("НаимОП");
		ДанныеОПТЗ_Р2.Колонки.Добавить("КППОП");
		ДанныеОПТЗ_Р2.Колонки.Добавить("НомерЛиста");
		ДанныеОПТЗ_Р2.Колонки.Добавить("Колво");
		
		НомерЛиста = 0;
		Для Каждого ЛистРаздела Из ДанныеРаздела Цикл
			
			НомерЛиста = НомерЛиста + 1;
			
			ДанныеОП   = ЛистРаздела.Данные[0].Значение.ОбособленноеПодразделение;
						
			Если ПустаяСтрока(ДанныеОП) Тогда				
				Продолжить;
			КонецЕсли;
			
			СведенияОбОП = Неопределено;
			Если ТипЗнч(ЛистРаздела.ДополнительныеДанные[0].Значение) = Тип("Структура") 
				И ЛистРаздела.ДополнительныеДанные[0].Значение.Свойство("СведенияОбОП", СведенияОбОП) Тогда
				
				Если ЗначениеЗаполнено(СведенияОбОП.КПП) или ЗначениеЗаполнено(СведенияОбОП.Наименование) Тогда
					
					НоваяСтрокаТЗ = ДанныеОПТЗ_Р2.Добавить();
					НоваяСтрокаТЗ.КППОП      = СокрЛП(СведенияОбОП.КПП);
					НоваяСтрокаТЗ.НаимОП     = СокрЛП(СведенияОбОП.Наименование);
					НоваяСтрокаТЗ.Колво      = 1;
					НоваяСтрокаТЗ.НомерЛиста = НомерЛиста;
			
				КонецЕсли;
				
			КонецЕсли;
									
		КонецЦикла;
		
		КопияДанныеОПТЗ_Р2 = ДанныеОПТЗ_Р2.Скопировать();
		КопияДанныеОПТЗ_Р2.Свернуть("НаимОП, КППОП", "Колво");
		КопияДанныеОПТЗ_Р2.Сортировать("Колво Убыв");
		
		Для Каждого СтрокаТЗ Из КопияДанныеОПТЗ_Р2 Цикл
			
			Если СтрокаТЗ.Колво > 1 Тогда
				
				ОтборПовторов = Новый Структура;
				ОтборПовторов.Вставить("НаимОП", СтрокаТЗ.НаимОП);
				ОтборПовторов.Вставить("КППОП",  СтрокаТЗ.КППОП);
				
				НайденныеОП = ДанныеОПТЗ_Р2.НайтиСтроки(ОтборПовторов);
				
				Если НайденныеОП.Количество() > 0 Тогда
					
					ЛистыПовторы = "";
					Для Каждого ЭлНайденныеОП Из НайденныеОП Цикл
						ЛистыПовторы = ЛистыПовторы + ?(ПустаяСтрока(ЛистыПовторы), "", ", ") + ЭлНайденныеОП.НомерЛиста;
					КонецЦикла;
					
					ТекстОписанияОшибки = "В Разделе 2 декларации страницы №№ " + ЛистыПовторы + " заполнены по одному и тому же предприятию: " + ЭлНайденныеОП.НаимОП 
										+ ?(НЕ ПустаяСтрока(ЭлНайденныеОП.КППОП), ", (КПП " + ЭлНайденныеОП.КППОП + ")", "");
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", "ОбособленноеПодразделение", ЭлНайденныеОП.НомерЛиста);
					
				КонецЕсли;
				
			Иначе
				Прервать;
			КонецЕсли;
			
		КонецЦикла;
		
		// Контроль на наличие в Разделе 1 всех ОП из Раздела 2.
		// 		
		// В  КопияДанныеОПТЗ_Р2 свернутые данные по Разделу 2, в ДанныеОПТЗ - по разделу 1.
		Для Каждого СтрокаТЗ Из КопияДанныеОПТЗ_Р2 Цикл
			
			Отбор = Новый Структура;
			Отбор.Вставить("НаимОП", СтрокаТЗ.НаимОП);
			Отбор.Вставить("КППОП",  СтрокаТЗ.КППОП);
			
			НайденныеОП = ДанныеОПТЗ_Р1.НайтиСтроки(Отбор);
			
			Если НайденныеОП.Количество() > 0 Тогда
				// ОП из Раздела 2 есть в Разделе 1.
				Продолжить;
			КонецЕсли;
			
			// Определим лист ошибки в Разделе 2.
			НайденныеОП = ДанныеОПТЗ_Р2.НайтиСтроки(Отбор);
			ЛистРаздела2 =  НайденныеОП[0].НомерЛиста;
			
			ТекстОписанияОшибки = "В Разделе 2 декларации, на странице № " + ЛистРаздела2 + ", заполнены данные по обособленному подразделению " + СтрокаТЗ.НаимОП 
								  + "," + ?(НЕ ПустаяСтрока(СтрокаТЗ.КППОП), " (КПП " + СтрокаТЗ.КППОП + "),", "") 
								  + " но это обособленное подразделение не найдено в Разделе 1!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", "ОбособленноеПодразделение", ЛистРаздела2);
												
		КонецЦикла;
		
	КонецЕсли;
		
	КоличествоСтрокТаблицыПоОрганизации = 0;
	ОбщееКоличествоСтрокПоОП = 0;
		
	НомерЛиста = 0;
	Для Каждого ЛистРаздела Из ДанныеРаздела Цикл
		
		НомерЛиста = НомерЛиста + 1;
		
		НомерЛистаСтроковый = Формат(НомерЛиста, "ЧГ=0");
		
		ДанныеЛиста = ЛистРаздела.Данные[0].Значение;
				
		ЗаполненоОП = НЕ ПустаяСтрока(ДанныеЛиста.ОбособленноеПодразделение);
		ЕстьЗаполненныеСтроки = Ложь;
		
		СведенияОбОП = Неопределено;
		ПроверитьЗаполнениеОП(СтатусПроверки, ЛистРаздела, НомерЛиста, ИмяРаздела, СтрВКакомРазделе, 
							КПП_НеОбязателен, ПроверятьНаПустоту, СведенияОбОП);
		
		// Проверка заполнения таблиц декларации.
		ДанныеДопСтрок = Неопределено;
		Если НомерЛиста = 1 Тогда
			
			ЛистРаздела.ДанныеДопСтрок[0].Значение.Свойство(СтруктураРеквизитовФормы.мИдГруппы21, ДанныеДопСтрок);
			ДополнительныеДанныеЛиста = Неопределено;
			Если ТипЗнч(ЛистРаздела.ДополнительныеДанные[0].Значение) = Тип("Структура") Тогда
				ДополнительныеДанныеЛиста = ЛистРаздела.ДополнительныеДанные[0].Значение;
			КонецЕсли;
			КоличЗаполненных = 0;
			ПроверитьЗаполнениеТаблицыРаздел2(СтатусПроверки, СтруктураРеквизитовФормы.мИдГруппы21, ДанныеДопСтрок, ДополнительныеДанныеЛиста, НомерЛиста, СведенияОбОП, , КоличЗаполненных);
			
			КоличествоСтрокТаблицыПоОрганизации = КоличЗаполненных;		
			
		КонецЕсли; 
		
		ДанныеДопСтрок = Неопределено;
		ДополнительныеДанныеЛиста = Неопределено;
				
		ЛистРаздела.ДанныеДопСтрок[0].Значение.Свойство(СтруктураРеквизитовФормы.мИдГруппы22, ДанныеДопСтрок);
		
		Если ТипЗнч(ЛистРаздела.ДополнительныеДанные[0].Значение) = Тип("Структура") Тогда
			ДополнительныеДанныеЛиста = ЛистРаздела.ДополнительныеДанные[0].Значение;
		КонецЕсли;
		КоличЗаполненных = 0;
		ПроверитьЗаполнениеТаблицыРаздел2(СтатусПроверки, СтруктураРеквизитовФормы.мИдГруппы22, ДанныеДопСтрок, ДополнительныеДанныеЛиста, НомерЛиста, СведенияОбОП, ЕстьЗаполненныеСтроки, КоличЗаполненных);
		
		ОбщееКоличествоСтрокПоОП = ОбщееКоличествоСтрокПоОП + КоличЗаполненных;		
		
		// Раздел 2 не обязателен к заполнению
		Если ЕстьЗаполненныеСтроки и (НЕ ЗаполненоОП)  Тогда
		    ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", не указаны реквизиты обособленного подразделения!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", "ОбособленноеПодразделение", НомерЛиста);
		КонецЕсли; 
		
		Если ТаблицаСообщений.Количество() >  100 Тогда
			ТекстОписанияОшибки = "Найдено 100 и более ошибок. Дальнейшая проверка прекращена!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", , НомерЛиста);
		    Возврат;
		КонецЕсли;
		
	КонецЦикла;
	
	Если КоличествоСтрокТаблицыПоОрганизации > ОбщееКоличествоСтрокПоОП Тогда
	    ТекстОписанияОшибки = "В Разделе 2 декларации в верхней таблице ""Сведения по организации/индивидуальному предпринимателю"" " 
							+ "заполнено больше строк, чем во всех нижних таблицах ""Сведения по обособленному подразделению""!";		
	    СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", "ОбособленноеПодразделение", 1);
	КонецЕсли;
			
КонецПроцедуры

&НаСервере
Процедура ПроверитьЗаполнениеТаблицыРаздел2(СтатусПроверки, ИдГруппы, ДанныеДопСтрок, ДополнительныеДанные, НомерЛиста, СведенияОбОП = Неопределено, ЕстьЗаполненныйЛистРаздела = Ложь, КоличЗаполненных)
	
	КоличЗаполненных = 0;
	ВерхняяТаблица = Ложь;
	
	НомерЛистаСтроковый = Формат(НомерЛиста, "ЧГ=0");
	
	ПрефиксИмени = ИдГруппы;
	
	Если ПрефиксИмени = "П0000200001" Тогда
		ИмяТаблицы = """Сведения по организации/индивидуальному предпринимателю""";
		ВерхняяТаблица = Истина;
	Иначе
		ИмяТаблицы = """Сведения по обособленному подразделению""";
	КонецЕсли;
	
	НомерСтроки = 0;
	Для Каждого СтрокаДекларации Из ДанныеДопСтрок Цикл
		
		НомерСтроки = НомерСтроки + 1;
		
		НомерСтрокиСтроковый = Формат(НомерСтроки, "ЧГ=0");
		
		СтрокаЗаполнена = ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "02"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "03"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "04"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "05"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "06"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "07"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "08"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "09"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "10"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "11"])
		              ИЛИ ЗначениеЗаполнено(СтрокаДекларации[ПрефиксИмени + "12"]);
		Если НЕ СтрокаЗаполнена Тогда			
			Продолжить;
		КонецЕсли;
		
		КоличЗаполненных = КоличЗаполненных + 1;
		Если ВерхняяТаблица Тогда
			// не проверяем - только считаем заполненные
			Продолжить;
		КонецЕсли;
		
		ЕстьЗаполненныйЛистРаздела = Истина;
		
		ИмяГрафы = ПрефиксИмени + "02";
		ИмяПоказателя = ПрефиксИмени + "02_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СокрЛП(СтрокаДекларации[ИмяГрафы]);
		Если ПустаяСтрока(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не задан код вида продукции!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяПоказателя, НомерЛиста);
		ИначеЕсли СтрДлина(ЗначениеГрафы) <> 3 Тогда
			ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", неверно задан код вида продукции!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		ИмяГрафы = ПрефиксИмени + "03";
		ИмяПоказателя = ПрефиксИмени + "03_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СокрЛП(СтрокаДекларации[ИмяГрафы]);
		СтрокаДекларации[ИмяГрафы] = ЗначениеГрафы;
		НаименованиеПроизводителя = ЗначениеГрафы;
		ИмяНаименованиеПроизводителя = ИмяПоказателя;
        Если НЕ ЗначениеЗаполнено(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не указано наименование производителя/импортера!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		////////////////////////////////////////////////////////////////////////////////
		// Контроль ИНН-КПП
		
		ИмяГрафыИНН = ПрефиксИмени + "04";
		ИмяПоказателяИНН = ПрефиксИмени + "04_" + НомерСтрокиСтроковый;
		ИНН = СокрЛП(СтрокаДекларации[ИмяГрафыИНН]);
		ИННПроизводителя = ИНН;
		СтрокаДекларации[ИмяГрафыИНН] = ИНН;
		ДлинаИНН = СтрДлина(ИНН);
		
		ИмяГрафыКПП = ПрефиксИмени + "05";
		ИмяПоказателяКПП = ПрефиксИмени + "05_" + НомерСтрокиСтроковый;
		КПП = СокрЛП(СтрокаДекларации[ИмяГрафыКПП]);
		КПППроизводителя = КПП;
		СтрокаДекларации[ИмяГрафыКПП] = КПП;
						
		ИмяРаздела = "Раздел2";
		СтрВКакомРазделе = "В Разделе 2";
		РодПадежЧейИННКПП = "производителя/импортера";
		// по схеме выгрузки предполагается ЮЛ или ФЛ РФ, но пока оставим
		// возможность заполнения производителя/импортера из ТС - не резидентом РФ
		РоссийскийКонтрагент = Неопределено;
		МожетБытьПустойИНН = Ложь;
		МожетБытьПустойКПП = Истина;
		
		ПроверкаИННКППвСтрокахТаблиц(СтатусПроверки, ИмяРаздела, СтрВКакомРазделе, НомерЛиста, НомерСтрокиСтроковый, ИмяТаблицы, 
									ИмяПоказателяИНН, ИНН, ИмяПоказателяКПП, КПП, РодПадежЧейИННКПП, 
									РоссийскийКонтрагент, МожетБытьПустойИНН, МожетБытьПустойКПП);
		//
		////////////////////////////////////////////////////////////////////////////////
        
		// Контроль по наличию Производителей/Импортеров из Раздела 2 в Разделе 1.
		Если (ИмяТаблицы = """Сведения по обособленному подразделению""") и НЕ(СведенияОбОП = Неопределено) Тогда
			Если ЗначениеЗаполнено(НаименованиеПроизводителя) и ЗначениеЗаполнено(ИННПроизводителя)
				и ЗначениеЗаполнено(СведенияОбОП.ИНН) и ЗначениеЗаполнено(СведенияОбОП.Наименование) Тогда
				
				Отбор = Новый Структура;
				Отбор.Вставить("НаименованиеПроизводителя", НаименованиеПроизводителя);
				Отбор.Вставить("ИННПроизводителя",  ИННПроизводителя);
		        Отбор.Вставить("КПППроизводителя",  КПППроизводителя);
				Отбор.Вставить("ОП_ИНН", СокрЛП(СведенияОбОП.ИНН));
				Отбор.Вставить("ОП_КПП",  СокрЛП(СведенияОбОП.КПП));
		        Отбор.Вставить("ОП_Наим",  СокрЛП(СведенияОбОП.Наименование));
							
				НайденныеПроизводители = ДанныеПроизводителейРаздел_Р1.НайтиСтроки(Отбор);
				Если НайденныеПроизводители.Количество() = 0 Тогда
					ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", " 
										+ "указан Производитель/Импортер " + НаименованиеПроизводителя + " (" 
										+ ?(ПустаяСтрока(ИННПроизводителя),"ИНН незаполнен" ,"ИНН "+ ИННПроизводителя)
										+ ?(ПустаяСтрока(КПППроизводителя), "", ", КПП " + КПППроизводителя) 
										+ "), которого нет по тому же обособленному подразделению в Разделе 1";
					СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяНаименованиеПроизводителя, НомерЛиста);
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
		ИмяГрафы = ПрефиксИмени + "06";
		ИмяПоказателя = ПрефиксИмени + "06_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СокрЛП(СтрокаДекларации[ИмяГрафы]);
		СтрокаДекларации[ИмяГрафы] = ЗначениеГрафы;
		Если НЕ ЗначениеЗаполнено(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не указано наименование поставщика!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		
		////////////////////////////////////////////////////////////////////////////////
		// Контроль ИНН-КПП
		
		ИмяГрафыИНН = ПрефиксИмени + "07";
		ИмяПоказателяИНН = ПрефиксИмени + "07_" + НомерСтрокиСтроковый;
		ИНН = СокрЛП(СтрокаДекларации[ИмяГрафыИНН]);
		ДлинаИНН = СтрДлина(ИНН);
		СтрокаДекларации[ИмяГрафыИНН] = ИНН;
		
		ИмяГрафыКПП = ПрефиксИмени + "08";
		ИмяПоказателяКПП = ПрефиксИмени + "08_" + НомерСтрокиСтроковый;
		КПП = СокрЛП(СтрокаДекларации[ИмяГрафыКПП]);
		СтрокаДекларации[ИмяГрафыКПП] = КПП;
		
		ИмяРаздела = "Раздел2";
		СтрВКакомРазделе = "В Разделе 2";
		РодПадежЧейИННКПП = "поставщика";
		// по схеме выгрузки предполагается ЮЛ или ФЛ РФ, но пока оставим
		// возможность заполнения поставщиками из ТС - не резидентами РФ
		РоссийскийКонтрагент = Неопределено; 
		МожетБытьПустойИНН = Ложь;
		МожетБытьПустойКПП = Истина;
		
		ПроверкаИННКППвСтрокахТаблиц(СтатусПроверки, ИмяРаздела, СтрВКакомРазделе, НомерЛиста, НомерСтрокиСтроковый, ИмяТаблицы, 
									ИмяПоказателяИНН, ИНН, ИмяПоказателяКПП, КПП, РодПадежЧейИННКПП, 
									РоссийскийКонтрагент, МожетБытьПустойИНН, МожетБытьПустойКПП);
		//
		////////////////////////////////////////////////////////////////////////////////
				
		ИмяГрафы = ПрефиксИмени + "09";
		ИмяПоказателя = ПрефиксИмени + "09_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СтрокаДекларации[ИмяГрафы];
		Если НЕ ЗначениеЗаполнено(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не указана дата закупки!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		ИмяГрафы = ПрефиксИмени + "10";
		ИмяПоказателя = ПрефиксИмени + "10_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СокрЛП(СтрокаДекларации[ИмяГрафы]);
		СтрокаДекларации[ИмяГрафы] = ЗначениеГрафы;
		Если ПустаяСтрока(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не указан номер товарно-транспортной накладной!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		// Номер ГТД (11) всегда выгружается, но не всегда заполняется.
		// Не контролируем.
		
		ИмяГрафы = ПрефиксИмени + "12";
		ИмяПоказателя = ПрефиксИмени + "12_" + НомерСтрокиСтроковый;
		ЗначениеГрафы = СтрокаДекларации[ИмяГрафы];
		Если НЕ ЗначениеЗаполнено(ЗначениеГрафы) Тогда
			ТекстОписанияОшибки = "В Разделе 2 декларации, на листе " + НомерЛистаСтроковый + ", в строке " + НомерСтрокиСтроковый + ", в таблице "+ ИмяТаблицы + ", не указан объем закупленной продукции!";
			СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, "Раздел2", ИмяПоказателя, НомерЛиста);
		КонецЕсли;
		
		Если ТаблицаСообщений.Количество() >  100 Тогда		    
		    Возврат;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура СообщитьОбОшибкеЗаполнения(СтатусПроверки, ТекстОписанияОшибки, Раздел, Показатель, ЛистРаздела = Неопределено)
	
	СтатусПроверки = Ложь;
	Если ЛистРаздела = Неопределено Тогда
		РегламентированнаяОтчетность.СообщитьВТаблицуСообщений(ЭтаФорма, ТекстОписанияОшибки, Раздел, Показатель);
	Иначе
		РегламентированнаяОтчетность.СообщитьВТаблицуСообщений(ЭтаФорма, ТекстОписанияОшибки, Раздел, Показатель, ЛистРаздела);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ДополнительныеДанныеПоАдресу(Данные, Адрес)
	
	Перем ЗначениеДанных;
	
	Если ТипЗнч(Данные) = Тип("Структура") Тогда
		ПозицияРазделителя = СтрНайти(Адрес, ".");
		Если ПозицияРазделителя = 0 Тогда
			АдресВерхнегоУровня = СокрЛП(Адрес);
			Данные.Свойство(АдресВерхнегоУровня, ЗначениеДанных);
		Иначе
			АдресВерхнегоУровня = СокрЛП(Лев(Адрес, ПозицияРазделителя - 1));
			ДанныеВерхнегоУровня = Неопределено;
			Если Данные.Свойство(АдресВерхнегоУровня, ДанныеВерхнегоУровня) Тогда
				АдресСледующегоУровня = СокрЛП(Сред(Адрес, ПозицияРазделителя + 1));
				ЗначениеДанных = ДополнительныеДанныеПоАдресу(ДанныеВерхнегоУровня, АдресСледующегоУровня);
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Возврат ЗначениеДанных;
	
КонецФункции

&НаСервере
Функция СформироватьСтруктуруПоказателейИСтруктуруПараметров()
	
	мДанныеОтчета = Новый Структура;
	
	СохрСтруктура = СтруктураРеквизитовФормы.мСохраненныйДок.ДанныеОтчета.Получить();
	ПоказателиОтчета = СохрСтруктура.ПоказателиОтчета;
	Для Каждого Раздел Из ПоказателиОтчета Цикл
		мДанныеОтчета.Вставить(Раздел.Ключ, РегламентированнаяОтчетность.СвернутьДанныеТабличногоПоля(Раздел.Значение));
	КонецЦикла;
	
	ТекущийРаздел = Неопределено;
	Если мСтруктураМногостраничныхРазделов.Свойство(СтруктураРеквизитовФормы.НаимТекущегоРаздела, ТекущийРаздел) Тогда
		АктивнаяСтраница = ЭтаФорма[ТекущийРаздел].НайтиСтроки(Новый Структура("АктивнаяСтраница", Истина));
		Если АктивнаяСтраница.Количество() > 0 Тогда
			АктивнаяСтраница = АктивнаяСтраница[0];
			ИндексАктивнойСтраницы = ЭтаФорма[ТекущийРаздел].Индекс(АктивнаяСтраница);
		КонецЕсли;
	КонецЕсли;

	Для Каждого ЭлементСтруктуры Из СохрСтруктура.ДанныеМногостраничныхРазделов Цикл	
		
		НайденноеЗначение = Неопределено;
		
		мСтруктураМногостраничныхРазделов.Свойство(ЭлементСтруктуры.Ключ, НайденноеЗначение);
		
		Если НЕ НайденноеЗначение = Неопределено Тогда
			
			НайденноеЗначение = ЭтаФорма[НайденноеЗначение];
			
			ЗначениеВДанныеФормы(ЭлементСтруктуры.Значение, НайденноеЗначение);
			
			Если НайденноеЗначение[0].Свойство("Данные") Тогда
				
				Для Каждого СтрокаТаблЗнач Из НайденноеЗначение Цикл
					
					Если ТипЗнч(СтрокаТаблЗнач.Данные) = Тип("СписокЗначений") Тогда
						
						СтрокаТаблЗнач.Данные.Очистить();
						СтрокаТаблЗнач.Данные.Добавить(ЭлементСтруктуры.Значение[НайденноеЗначение.Индекс(СтрокаТаблЗнач)].Данные);
						
					КонецЕсли;
					
				КонецЦикла;
				
			КонецЕсли;
			
			Если НайденноеЗначение[0].Свойство("ДополнительныеДанные") Тогда
				
				Для Каждого СтрокаТаблЗнач Из НайденноеЗначение Цикл
					
					Если ТипЗнч(СтрокаТаблЗнач.ДополнительныеДанные) = Тип("СписокЗначений") Тогда
						
						СтрокаТаблЗнач.ДополнительныеДанные.Очистить();
						СтрокаТаблЗнач.ДополнительныеДанные.Добавить(ЭлементСтруктуры.Значение[НайденноеЗначение.Индекс(СтрокаТаблЗнач)].ДополнительныеДанные);
						
					КонецЕсли;
					
				КонецЦикла;
				
			КонецЕсли;
			
			Если НайденноеЗначение[0].Свойство("ДанныеДопСтрок") Тогда
				
				Ном = 0;
				
				Для Каждого СтрокаТаблЗнач Из ЭлементСтруктуры.Значение Цикл
					
					Если ТипЗнч(СтрокаТаблЗнач.ДанныеДопСтрок) = Тип("Структура") Тогда
						
						СтруктураДопСтрок = Новый Структура;
																		
						Для Каждого ЭлСтруктуры Из СтрокаТаблЗнач.ДанныеДопСтрок Цикл
							
							ТаблЗнач = ЭлСтруктуры.Значение;
							
							СтрокаТаблЗначДанныеДопСтрок = ЭтаФорма["Хранилище" + ЭлСтруктуры.Ключ].Добавить().Таблица;
							
							ЗначениеВДанныеФормы(ТаблЗнач, СтрокаТаблЗначДанныеДопСтрок);
							
							СтруктураДопСтрок.Вставить(ЭлСтруктуры.Ключ, СтрокаТаблЗначДанныеДопСтрок);
							
						КонецЦикла;
						
						НайденноеЗначение[Ном].ДанныеДопСтрок.Добавить(СтруктураДопСтрок, "ДанныеФормыКоллекцияТаблицаДопСтрокРаздела");

					ИначеЕсли ТипЗнч(СтрокаТаблЗнач.ДанныеДопСтрок) = Тип("ТаблицаЗначений") Тогда
						
						СтрокаТаблЗначДанныеДопСтрок = ЭтаФорма["Хранилище" + ЭлементСтруктуры.Ключ].Добавить().Таблица;
						
						ЗначениеВДанныеФормы(СтрокаТаблЗнач.ДанныеДопСтрок, СтрокаТаблЗначДанныеДопСтрок);
						
						НайденноеЗначение[Ном].ДанныеДопСтрок.Добавить(СтрокаТаблЗначДанныеДопСтрок, "ДанныеФормыКоллекцияТаблицаДопСтрокРаздела");
						
					КонецЕсли;
					
					Ном = Ном + 1;
					
				КонецЦикла;
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	Для Каждого Раздел Из мСтруктураМногостраничныхРазделов Цикл
		Для Каждого Страница Из ЭтаФорма[Раздел.Значение] Цикл
			Страница.АктивнаяСтраница = Ложь;
		КонецЦикла;
	КонецЦикла;

	ТекущийРаздел = Неопределено;
	Если мСтруктураМногостраничныхРазделов.Свойство(СтруктураРеквизитовФормы.НаимТекущегоРаздела, ТекущийРаздел) Тогда
		Если ИндексАктивнойСтраницы <> Неопределено Тогда
			ЭтаФорма[ТекущийРаздел][ИндексАктивнойСтраницы].АктивнаяСтраница = Истина;
		КонецЕсли;
	КонецЕсли;

	Для Каждого Раздел Из мСтруктураМногостраничныхРазделов Цикл
		ТаблицаЛистовРаздела = ЭтаФорма[Раздел.Значение];
		Для Каждого Лист Из ТаблицаЛистовРаздела Цикл
			Лист.Данные[0].Значение = РегламентированнаяОтчетность.СвернутьДанныеТабличногоПоля(Лист.Данные[0].Значение);
		КонецЦикла;
		мДанныеОтчета.Вставить(Раздел.Ключ, ЭтаФорма[Раздел.Значение]);
	КонецЦикла;
	
	// Формируем параметры выгрузки.
	Данные = СохрСтруктура;
	Орг = СтруктураРеквизитовФормы.мСохраненныйДок.Организация;
	
	ПоказателиОтчета = Данные.ПоказателиОтчета;
	ПоказателиТитульный = РегламентированнаяОтчетность.СвернутьДанныеТабличногоПоля(РегламентированнаяОтчетность.СкопированнаяСтруктура(ПоказателиОтчета.ПолеТабличногоДокументаТитульный));
	
	НомерГода = Формат(СтруктураРеквизитовФормы.мСохраненныйДок.ДатаОкончания, "ДФ=гггг");
	
	ПараметрыВыгрузки = Новый Структура;
	ПараметрыВыгрузки.Вставить("НаимПрог", РегламентированнаяОтчетность.НазваниеИВерсияПрограммы());
	ПараметрыВыгрузки.Вставить("ДатаДок",  Формат(ТекущаяДатаСеанса(), "ДФ=дд.ММ.гггг"));
	
	КодКвартала = ПолучитьКодКвартала(ПоказателиТитульный);
	ПараметрыВыгрузки.Вставить("ПризПериодОтч", КодКвартала);
	
	Вариант = СтруктураРеквизитовФормы.мСохраненныйДок.Вид;
	ЭтоПервичнаяОтчетность = (Вариант = 0);
	
	ПараметрыВыгрузки.Вставить("ГодПериодОтч",   НомерГода);
	ПараметрыВыгрузки.Вставить("Первичная",      ЭтоПервичнаяОтчетность);
	ПараметрыВыгрузки.Вставить("Корректирующая", НЕ ЭтоПервичнаяОтчетность);
	ПараметрыВыгрузки.Вставить("НомерКорр",      Вариант);
	
	ЭтоПБОЮЛ = НЕ РегламентированнаяОтчетностьВызовСервера.ЭтоЮридическоеЛицо(Орг);

	НазваниеОрганизации = СокрЛП(ПоказателиТитульный.ОргНазв);
	ИНН = СокрЛП(ПоказателиТитульный.ИНН1);
	Если НЕ ЭтоПБОЮЛ И Лев(ИНН, 2) = "00" Тогда
		ИНН = Сред (ИНН, 3); // Удаление нулей, добавленных в соответствии с порядком заполнения.
	КонецЕсли;
	КПП = СокрЛП(ПоказателиТитульный.КПП1);
	
	ТелефонОрганизации  = СокрЛП(ПоказателиТитульный.ТелОрганизации);
	ЭлектроннаяПочтаОрганизации = СокрЛП(ПоказателиТитульный.ЭлектроннаяПочта);
	
	ПараметрыВыгрузки.Вставить("ЭтоПБОЮЛ", ЭтоПБОЮЛ);
	ПараметрыВыгрузки.Вставить("НаимЮЛ",   НазваниеОрганизации);
	
	Если ЭтоПБОЮЛ Тогда
		ПараметрыВыгрузки.Вставить("ИННФЛ", ИНН);
	Иначе
		ПараметрыВыгрузки.Вставить("ИННЮЛ", ИНН);
		ПараметрыВыгрузки.Вставить("КППЮЛ", КПП);
	КонецЕсли;
	
	ПараметрыВыгрузки.Вставить("ТелОрг",    ТелефонОрганизации);
	ПараметрыВыгрузки.Вставить("EmailОтпр", ЭлектроннаяПочтаОрганизации);
	
	СтруктураАдреса = Данные.ДополнительныеДанные.Титульный.АдресОрганизации;
	ПараметрыВыгрузки.Вставить("КодСтраны",  СтруктураАдреса.КодСтраны);
	ПараметрыВыгрузки.Вставить("Индекс",     СтруктураАдреса.Индекс);
	ПараметрыВыгрузки.Вставить("КодРегион",  СтруктураАдреса.КодРегиона);
	ПараметрыВыгрузки.Вставить("Район",      СтруктураАдреса.Район);
	ПараметрыВыгрузки.Вставить("Город",      СтруктураАдреса.Город);
	ПараметрыВыгрузки.Вставить("НаселПункт", СтруктураАдреса.НаселенныйПункт);
	ПараметрыВыгрузки.Вставить("Улица",      СтруктураАдреса.Улица);
	ПараметрыВыгрузки.Вставить("Дом",        СтруктураАдреса.Дом);
	ПараметрыВыгрузки.Вставить("Корпус",     СтруктураАдреса.Корпус);
	ПараметрыВыгрузки.Вставить("Литера",     "");
	ПараметрыВыгрузки.Вставить("Кварт",      СтруктураАдреса.Квартира);
	
	ФИОРуководителя = РегламентированнаяОтчетность.РазложитьФИО(ПоказателиТитульный.ОргДиректор);
	ПараметрыВыгрузки.Вставить("РуководительФамилия",  ФИОРуководителя.Фамилия);
	ПараметрыВыгрузки.Вставить("РуководительИмя",      ФИОРуководителя.Имя);
	ПараметрыВыгрузки.Вставить("РуководительОтчество", ФИОРуководителя.Отчество);
	
	ФИОГлавбуха = РегламентированнаяОтчетность.РазложитьФИО(ПоказателиТитульный.ОргБухгалтер);
	ПараметрыВыгрузки.Вставить("ГлавбухФамилия",  ФИОГлавбуха.Фамилия);
	ПараметрыВыгрузки.Вставить("ГлавбухИмя",      ФИОГлавбуха.Имя);
	ПараметрыВыгрузки.Вставить("ГлавбухОтчество", ФИОГлавбуха.Отчество);
	
	Если ЭтоПБОЮЛ Тогда
		
		ФИОИП = РегламентированнаяОтчетность.РазложитьФИО(Орг.ФизическоеЛицо.Наименование);
		
		ПараметрыВыгрузки.Вставить("РуководительФамилия",  ФИОИП.Фамилия);
		ПараметрыВыгрузки.Вставить("РуководительИмя",      ФИОИП.Имя);
		ПараметрыВыгрузки.Вставить("РуководительОтчество", ФИОИП.Отчество);
		
		ПараметрыВыгрузки.Вставить("ИПФамилия",  ФИОИП.Фамилия);
		ПараметрыВыгрузки.Вставить("ИПИмя",      ФИОИП.Имя);
		ПараметрыВыгрузки.Вставить("ИПОтчество", ФИОИП.Отчество);
		
	КонецЕсли;
	
	ПараметрыВыгрузки.Вставить("ИмяКлючевогоУзлаСодержательнойЧасти", "Документ");
	
	ПараметрыВыгрузки.Вставить("ИдФайл", СформироватьИдФайл(ПараметрыВыгрузки));
	
	Возврат ПараметрыВыгрузки;
		
КонецФункции

&НаСервере
Функция ПолучитьКодКвартала(ПоказателиТитульногоЛиста)
	
	Если НЕ ПустаяСтрока(ПоказателиТитульногоЛиста.ОтчетныйПериод1Кв) Тогда
		Возврат "3";
		
	ИначеЕсли НЕ ПустаяСтрока(ПоказателиТитульногоЛиста.ОтчетныйПериод2Кв) Тогда
		Возврат "6";
		
	ИначеЕсли НЕ ПустаяСтрока(ПоказателиТитульногоЛиста.ОтчетныйПериод3Кв) Тогда
		Возврат "9";
		
	ИначеЕсли НЕ ПустаяСтрока(ПоказателиТитульногоЛиста.ОтчетныйПериод4Кв) Тогда
		Возврат "0";
		
	Иначе
		Возврат "";
	КонецЕсли;
	
КонецФункции

&НаСервере
Функция ИзвлечьСтруктуруXML()
	
	ДеревоСтруктуры = Новый ДеревоЗначений;
	ДеревоСтруктуры.Колонки.Добавить("Код");
	ДеревоСтруктуры.Колонки.Добавить("Тип");
	ДеревоСтруктуры.Колонки.Добавить("Формат");
	ДеревоСтруктуры.Колонки.Добавить("МинРазмерность");
	ДеревоСтруктуры.Колонки.Добавить("МаксРазмерность");
	ДеревоСтруктуры.Колонки.Добавить("Обязательность");
	ДеревоСтруктуры.Колонки.Добавить("Многостраничность");
	ДеревоСтруктуры.Колонки.Добавить("Многострочность");
	ДеревоСтруктуры.Колонки.Добавить("Раздел");
	ДеревоСтруктуры.Колонки.Добавить("Ключ");
	ДеревоСтруктуры.Колонки.Добавить("Условие");
	ДеревоСтруктуры.Колонки.Добавить("ЗначениеПоУмолчанию");
	ДеревоСтруктуры.Колонки.Добавить("Значение");
	ДеревоСтруктуры.Колонки.Добавить("Представление");
	ДеревоСтруктуры.Колонки.Добавить("Показатели");
	
	ИмяМакета = "СхемаВыгрузки" + СтруктураРеквизитовФормы.мВерсияФормата;
	
	Макет = ОбъектОтчета(ЭтаФорма.ИмяФормы).ПолучитьМакет(ИмяМакета);
	
	ВысотаТаблицы = Макет.ВысотаТаблицы;
	
	УчтенныеГруппы = Новый Соответствие;
	
	Для Уровень = 0 По Макет.КоличествоУровнейГруппировокСтрок() - 1 Цикл
		Макет.ПоказатьУровеньГруппировокСтрок(Уровень);
		Для НомерСтроки = 2 По ВысотаТаблицы Цикл
			НомСтр = ВысотаТаблицы - НомерСтроки + 2;
			Если Макет.Область(НомСтр, 0, НомСтр, 0).Видимость И УчтенныеГруппы.Получить(НомСтр) = Неопределено Тогда
				
				РодительскийУзел = ДеревоСтруктуры;
				Если Уровень <> 0 Тогда
					Для Инд = 1 По НомСтр - 2 Цикл
						Узел = УчтенныеГруппы.Получить(НомСтр - Инд);
						Если Узел <> Неопределено Тогда
							РодительскийУзел = Узел;
							Прервать;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				
				НовСтр = РодительскийУзел.Строки.Вставить(0);
				НовСтр.Код = СокрЛП(Макет.Область(НомСтр, 1, НомСтр, 1).Текст);
				НовСтр.Раздел = СокрЛП(Макет.Область(НомСтр, 2, НомСтр, 2).Текст);
				НовСтр.Ключ = СокрЛП(Макет.Область(НомСтр, 3, НомСтр, 3).Текст);
				НовСтр.Тип = СокрЛП(Макет.Область(НомСтр, 4, НомСтр, 4).Текст);
				НовСтр.Формат = СокрЛП(Макет.Область(НомСтр, 5, НомСтр, 5).Текст);
				МинРазмерность = СокрЛП(Макет.Область(НомСтр, 6, НомСтр, 6).Текст);
				НовСтр.МинРазмерность = ?(ПустаяСтрока(МинРазмерность), ?(НовСтр.Формат = "N", 99999, 0), Число(МинРазмерность));
				МаксРазмерность = СокрЛП(Макет.Область(НомСтр, 7, НомСтр, 7).Текст);
				НовСтр.МаксРазмерность = ?(ПустаяСтрока(МаксРазмерность), 99999, Число(МаксРазмерность));
				НовСтр.Обязательность = СокрЛП(Макет.Область(НомСтр, 8, НомСтр, 8).Текст);
				НовСтр.Многостраничность = НЕ ПустаяСтрока(Макет.Область(НомСтр, 9, НомСтр, 9).Текст);
				НовСтр.Многострочность = НЕ ПустаяСтрока(Макет.Область(НомСтр, 10, НомСтр, 10).Текст);
				НовСтр.Условие = СокрЛП(Макет.Область(НомСтр, 11, НомСтр, 11).Текст);
				НовСтр.ЗначениеПоУмолчанию = СокрЛП(Макет.Область(НомСтр, 12, НомСтр, 12).Текст);
				НовСтр.Представление = СокрЛП(Макет.Область(НомСтр, 13, НомСтр, 13).Текст);
				
				УчтенныеГруппы.Вставить(НомСтр, НовСтр);
				
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
	Возврат ДеревоСтруктуры;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьДанными(ДеревоВыгрузки, ПараметрыВыгрузки)
	
	ОбработатьУсловныеЭлементы(ПараметрыВыгрузки, ДеревоВыгрузки); // формируем точную структуру XML-макета
	ЗаполнитьДаннымиУзел(ПараметрыВыгрузки, ДеревоВыгрузки); // заполняем дерево данными
	ОтсечьНезаполненныеНеобязательныеУзлы(ДеревоВыгрузки);
	
КонецПроцедуры

&НаСервере
Функция ПроверитьДанные(Узел)
	
	СтатусПроверки = Истина;
	Если ТипЗнч(Узел) <> Тип("ДеревоЗначений") Тогда
		Если НЕ ЗначениеСоответствуетФормату(Узел) Тогда
			СтатусПроверки = Ложь;
		КонецЕсли;
	КонецЕсли;
	Для Каждого Стр из Узел.Строки Цикл
		СтатусПроверки = (ПроверитьДанные(Стр) И СтатусПроверки); // именно в указанном порядке для выдачи всех ошибок
	КонецЦикла;
	Возврат СтатусПроверки;
		
КонецФункции

&НаСервере
Функция ВыгрузитьДеревоВXML(ДеревоВыгрузки, ПараметрыВыгрузки)
	
	ПотокXML = РегламентированнаяОтчетность.СоздатьНовыйПотокXML("windows-1251"); // создаем новый поток для записи
	ЗаписатьУзелДереваВXML(ДеревоВыгрузки, ПотокXML, ПараметрыВыгрузки); // пишем дерево в поток
	ТекстДляЗаписи = ПотокXML.Закрыть(); // получаем текст XML
	Возврат ТекстДляЗаписи;
	
КонецФункции

&НаСервере
Функция СформироватьИдФайл(ПараметрыВыгрузки)
	
	ПрефиксИмениФайлаВыгрузки = "R2";
	
	ИдентификаторОтправителя = ?(ПараметрыВыгрузки.Свойство("ИННФЛ"), ПараметрыВыгрузки.ИННФЛ, ПараметрыВыгрузки.ИННЮЛ);
	ПериодДекларации = "0" + ПараметрыВыгрузки.ПризПериодОтч + Прав(ПараметрыВыгрузки.ГодПериодОтч, 1);
	ДеньФормированияДекларации = Формат(ТекущаяДатаСеанса(), "ДФ=ддММгггг");
	УникальныйИдентификаторФайла = Врег(Строка(Новый УникальныйИдентификатор));
	
	Возврат ПрефиксИмениФайлаВыгрузки
	        + "_" + ИдентификаторОтправителя
	        + "_" + ПериодДекларации
	        + "_" + ДеньФормированияДекларации
	        + "_" + УникальныйИдентификаторФайла;
	
КонецФункции

&НаСервере
Процедура ОбработатьУсловныеЭлементы(Знач ПараметрыВыгрузки, Узел)
	
	КоличествоСтрок = Узел.Строки.Количество();
	Для Инд = 1 По КоличествоСтрок Цикл
		ТекСтр = Узел.Строки.Получить(КоличествоСтрок - Инд);
		Если НЕ ПустаяСтрока(ТекСтр.Условие) Тогда
			Если НЕ РегламентированнаяОтчетность.УсловиеВыполнено(ЭтаФорма, ПараметрыВыгрузки, ТекСтр.Условие) Тогда
				Узел.Строки.Удалить(ТекСтр);
				Продолжить;
			КонецЕсли;
		КонецЕсли;
		ОбработатьУсловныеЭлементы(ПараметрыВыгрузки, ТекСтр);
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьДаннымиУзел(ПараметрыВыгрузки, Узел, НомерСтроки = Неопределено)
	
	Для Каждого Стр из Узел.Строки Цикл
		Если Стр.Тип = "С" ИЛИ Стр.Тип = "C" Тогда // учтем оба варианта: кириллицу и латиницу
			Если РегламентированнаяОтчетностьКлиентСервер.СвойствоОпределено(ПараметрыВыгрузки, "ИмяКлючевогоУзлаСодержательнойЧасти") И Стр.Код = ПараметрыВыгрузки.ИмяКлючевогоУзлаСодержательнойЧасти Тогда
				ЗаполнитьДаннымиУзел(ПараметрыВыгрузки, Стр);
				ЗаполнитьСодержательнуюЧасть(Стр, Узел, ПараметрыВыгрузки);
			Иначе
				ЗаполнитьДаннымиУзел(ПараметрыВыгрузки, Стр);
			КонецЕсли;
		Иначе
			Если ПустаяСтрока(Стр.ЗначениеПоУмолчанию) Тогда
				Если НЕ ПустаяСтрока(Стр.Ключ) И РегламентированнаяОтчетностьКлиентСервер.СвойствоОпределено(ПараметрыВыгрузки, Стр.Ключ) Тогда
					ВывестиПоказательВXML(Стр, ПараметрыВыгрузки[Стр.Ключ]);
				Иначе
					Стр.Значение = "";
				КонецЕсли;
			ИначеЕсли Лев(Стр.ЗначениеПоУмолчанию, 1) = "&" Тогда
				Ключ = Сред(Стр.ЗначениеПоУмолчанию, 2);
				Если РегламентированнаяОтчетностьКлиентСервер.СвойствоОпределено(ПараметрыВыгрузки, Ключ) Тогда
					ВывестиПоказательВXML(Стр, ПараметрыВыгрузки[Ключ]);
				КонецЕсли;
			Иначе
				Стр.Значение = Стр.ЗначениеПоУмолчанию;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ОтсечьНезаполненныеНеобязательныеУзлы(Узел)
	
	КоличествоСтрок = Узел.Строки.Количество();
	Для Инд = 1 По КоличествоСтрок Цикл
		Стр = Узел.Строки.Получить(КоличествоСтрок - Инд);
		ОтсечьНезаполненныеНеобязательныеУзлы(Стр);
	КонецЦикла;
	
	Если ТипЗнч(Узел) <> Тип("ДеревоЗначений") Тогда
		Если (СтрНайти(Узел.Обязательность, "Н") <> 0 ИЛИ СтрНайти(Узел.Обязательность, "H") <> 0) И УзелПуст(Узел) Тогда // учтем оба варианта: кириллицу и латиницу
			РегламентированнаяОтчетность.УдалитьУзел(Узел);
		ИначеЕсли (СтрНайти(Узел.Обязательность, "М") <> 0 ИЛИ СтрНайти(Узел.Обязательность, "M") <> 0) // учтем оба варианта: кириллицу и латиницу
		И УзелПуст(Узел)
		И ?(СтрНайти(Узел.Обязательность, "О") <> 0 ИЛИ СтрНайти(Узел.Обязательность, "O") <> 0, РегламентированнаяОтчетность.ИмеютсяАналогичныеСоседниеУзлыКлюч(Узел), Истина) Тогда
			РегламентированнаяОтчетность.УдалитьУзел(Узел);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ЗначениеСоответствуетФормату(Стр)
	
	СтатусПроверки = Истина;
	Если Стр.Формат = "Т" ИЛИ Стр.Формат = "T" Тогда // учтем оба варианта: кириллицу и латиницу
		ДлинаЗначения = СтрДлина(Стр.Значение);
		Если ДлинаЗначения < Стр.МинРазмерность Тогда
			СтатусПроверки = Ложь;
			РегламентированнаяОтчетность.СообщитьВТаблицуСообщений(ЭтаФорма, "Формирование XML: Длина значения показателя """ + РегламентированнаяОтчетность.ПредставлениеПоказателя(Стр) + """ меньше минимально возможной (" + ДлинаЗначения + " < " + Стр.МинРазмерность + ")", "Титульный", "");
		КонецЕсли;
		Если ДлинаЗначения > Стр.МаксРазмерность Тогда
			СтатусПроверки = Ложь;
			РегламентированнаяОтчетность.СообщитьВТаблицуСообщений(ЭтаФорма, "Формирование XML: Длина значения показателя """ + РегламентированнаяОтчетность.ПредставлениеПоказателя(Стр) + """ больше максимально возможной (" + ДлинаЗначения + " > " + Стр.МаксРазмерность + ")", "Титульный", "");
		КонецЕсли;
	КонецЕсли;
	Возврат СтатусПроверки;
	
КонецФункции

&НаСервере
Функция ЗаписатьУзелДереваВXML(СтрокаДерева, ПотокXML, ПараметрыВыгрузки) Экспорт
	
	Если ТипЗнч(СтрокаДерева) = Тип("ДеревоЗначений") Тогда
		ПотокXML.ЗаписатьНачалоЭлемента("Файл");
		Для каждого Стр Из СтрокаДерева.Строки Цикл
			ЗаписатьУзелДереваВXML(Стр, ПотокXML, ПараметрыВыгрузки);
		КонецЦикла;
		ПотокXML.ЗаписатьКонецЭлемента();
	Иначе
		Если СтрокаДерева.Тип = "А" ИЛИ СтрокаДерева.Тип = "A" Тогда 
			ПотокXML.ЗаписатьАтрибут(СтрокаДерева.Код, Строка(СтрокаДерева.Значение));
		Иначе
			ПотокXML.ЗаписатьНачалоЭлемента(СтрокаДерева.Код);
			Для каждого Лист из СтрокаДерева.Строки Цикл
				ЗаписатьУзелДереваВXML(Лист, ПотокXML, ПараметрыВыгрузки);
			КонецЦикла;
			ПотокXML.ЗаписатьТекст(Строка(СтрокаДерева.Значение));
			ПотокXML.ЗаписатьКонецЭлемента();
		КонецЕсли;
	КонецЕсли;

КонецФункции

&НаСервере
Функция НовыйУзелИзПрототипа(ПрототипУзла);
	
	РодительУзла = ПрототипУзла.Родитель;
	
	ПозицияИсходногоУзла = РодительУзла.Строки.Индекс(ПрототипУзла);
	НовыйУзел = РодительУзла.Строки.Вставить(ПозицияИсходногоУзла);
	ЗаполнитьЗначенияСвойств(НовыйУзел, ПрототипУзла, , "Родитель, Строки");
	Для Каждого Стр из ПрототипУзла.Строки Цикл
		СкопироватьУзел(НовыйУзел, Стр);
	КонецЦикла;
	
	Возврат НовыйУзел;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьСодержательнуюЧасть(УзелРодитель, КорневойУзел, ПараметрыВыгрузки)
	
	УзелСправочники = ПолучитьПодчиненныйЭлемент(КорневойУзел, "Справочники");
	Узел_Документ = УзелРодитель;
	
	Узел_Организация = ПолучитьПодчиненныйЭлемент(Узел_Документ, "Организация");
	
	ДанныеВыгрузки = Новый Структура; // Структура для обработки данных выгрузки и хранения справочников
	
	ПроизводителиИмпортеры = Новый ТаблицаЗначений;
	ПроизводителиИмпортеры.Колонки.Добавить("ИДПроизвИмп"); // Уникальный идентификатор
	ПроизводителиИмпортеры.Колонки.Добавить("П000000000004"); // Наименование производителя/импортера
	ПроизводителиИмпортеры.Колонки.Добавить("П000000000005"); // ИНН производителя/импортера
	ПроизводителиИмпортеры.Колонки.Добавить("П000000000006"); // КПП производителя/импортера
	
	ДанныеВыгрузки.Вставить("ПроизводителиИмпортеры", ПроизводителиИмпортеры);
	
	Поставщики = Новый ТаблицаЗначений;
	Поставщики.Колонки.Добавить("ИдПостав"); // Уникальный идентификатор
	Поставщики.Колонки.Добавить("П000000000007"); // Наименование оргнанизации/ФИО для физ лица
	Поставщики.Колонки.Добавить("П000000000009"); // ИНН
	Поставщики.Колонки.Добавить("П000000000010"); // КПП
	
	ДанныеВыгрузки.Вставить("Поставщики", Поставщики);
		
	ПрототипУзла_ОбъемОборота = ПолучитьПодчиненныйЭлемент(Узел_Документ, "ОбъемОборота");
	
	// Сведения обособленных подразделений;
	Для Каждого Страница Из мДанныеОтчета.Раздел1 Цикл
		ДанныеСтраницы = Страница.Данные[0].Значение;
		ДополнительныеДанныеСтраницы = Страница.ДополнительныеДанные[0].Значение;
		
		СведенияОбОП = ДополнительныеДанныеПоАдресу(ДополнительныеДанныеСтраницы, "СведенияОбОП");
		ИдентификаторОП = ИдентификаторОП(СведенияОбОП);
		
		Если ИдентификаторОП = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		НазваниеОрганизации = СведенияОбОП.Наименование;
		КПП = СведенияОбОП.КПП;
		
		Если ПустаяСтрока(НазваниеОрганизации) И ПустаяСтрока(КПП) Тогда
			Продолжить;
		КонецЕсли;
		
		Узел_ОбъемОборота = НовыйУзелИзПрототипа(ПрототипУзла_ОбъемОборота);
		
		Если СтруктураРеквизитовФормы.мВерсияФормата = "431" Тогда		
			// формат 4.31
			УстановитьЗначениеЭлемента(Узел_ОбъемОборота, "Наим", НазваниеОрганизации);			
		Иначе			
			// формат 4.30
			УстановитьЗначениеЭлемента(Узел_ОбъемОборота, "НаимЮЛ", НазваниеОрганизации);		
		КонецЕсли;
		
		Если НЕ ПустаяСтрока(КПП) Тогда
		    УстановитьЗначениеЭлемента(Узел_ОбъемОборота, "КППЮЛ", КПП);		
		КонецЕсли;
				
		Узел_АдрОрг = ПолучитьПодчиненныйЭлемент(Узел_ОбъемОборота, "АдрОрг");
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "КодСтраны",  "643");
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "Индекс",     СведенияОбОП.Индекс);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "КодРегион",  СведенияОбОП.КодРегиона);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "Район",      СведенияОбОП.Район);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "Город",      СведенияОбОП.Город);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "НаселПункт", СведенияОбОП.НаселенныйПункт);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "Улица",      СведенияОбОП.Улица);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "Дом",        СведенияОбОП.Дом);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "Корпус",     СведенияОбОП.Корпус);
		УстановитьЗначениеЭлемента(Узел_АдрОрг, "Кварт",      СведенияОбОП.Квартира);
		
		ТаблицаДвиженийОП = Страница.ДанныеДопСтрок[0].Значение.П0000100003.Выгрузить();
		// Приведение второй части таблицы к виду первой части.
		Для Каждого Колонка Из ТаблицаДвиженийОП.Колонки Цикл
			Колонка.Имя = СтрЗаменить(Колонка.Имя, "П0000100003", "П0000100001");
		КонецЦикла;
		
		ТаблицаПоставокОП = мДанныеОтчета.Раздел2[0].ДанныеДопСтрок[0].Значение.П0000200003.Выгрузить();
		ТаблицаПоставокОП.Очистить();
		Для Каждого СтраницаТабл2 Из мДанныеОтчета.Раздел2 Цикл
			СведенияОбОПРаздела2 = ДополнительныеДанныеПоАдресу(СтраницаТабл2.ДополнительныеДанные[0].Значение, "СведенияОбОП");
			ИдентификаторОПРаздела2 = ИдентификаторОП(СведенияОбОПРаздела2);
			Если ИдентификаторОПРаздела2 = ИдентификаторОП Тогда
				ТаблицаПоставокОП = СтраницаТабл2.ДанныеДопСтрок[0].Значение.П0000200003.Выгрузить();
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
		// Приведение второй части таблицы к виду первой части.
		Для Каждого Колонка Из ТаблицаПоставокОП.Колонки Цикл
			Колонка.Имя = СтрЗаменить(Колонка.Имя, "П0000200003", "П0000200001");
		КонецЦикла;
		
		ДанныеВыгрузки.Вставить("ТаблицаДвижений", ТаблицаДвиженийОП);
		ДанныеВыгрузки.Вставить("ТаблицаПоставок", ТаблицаПоставокОП);
		ЗаполнитьСведенияДекларации(Узел_ОбъемОборота, ДанныеВыгрузки);
		
		Узел_Оборот = ПолучитьПодчиненныйЭлемент(Узел_ОбъемОборота, "Оборот");
		ЕстьОборот = (Узел_Оборот <> Неопределено);
		УстановитьЗначениеЭлемента(Узел_ОбъемОборота, "НаличиеОборота", ?(ЕстьОборот, "true", "false"));
		
	КонецЦикла;
	РегламентированнаяОтчетность.УдалитьУзел(ПрототипУзла_ОбъемОборота);
	
	ЗаполнитьСправочникиДекларации(УзелСправочники, ДанныеВыгрузки);
	
КонецПроцедуры

&НаСервере
Функция ИдентификаторОП(СведенияОП)
	
	Если СведенияОП <> Неопределено 
		И (ЗначениеЗаполнено(СведенияОП.КПП)
		   Или ЗначениеЗаполнено(СведенияОП.Наименование)
		   Или ЗначениеЗаполнено(СведенияОП.ИНН)) Тогда
		   
		Наименование = "";   
		Если ЗначениеЗаполнено(СведенияОП.Наименование) Тогда
		
			Наименование = ВРег(СокрЛП(СведенияОП.Наименование));
			Наименование = СтрЗаменить(Наименование, " ", "");	
			
		КонецЕсли;		
		
		Возврат ?(ЗначениеЗаполнено(СведенияОП.КПП), СокрЛП(СведенияОП.КПП), "") + Символы.ПС
	    	+ Наименование + Символы.ПС
			+ ?(ЗначениеЗаполнено(СведенияОП.ИНН), СокрЛП(СведенияОП.ИНН), "");
	Иначе
		Возврат Неопределено;
	КонецЕсли;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьСведенияДекларации(Узел_ОбъемОборота, ДанныеВыгрузки)
	
	ПрототипУзла_Оборот = ПолучитьПодчиненныйЭлемент(Узел_ОбъемОборота, "Оборот");
	
	ТаблицаДвижений = ДанныеВыгрузки.ТаблицаДвижений;
	ТаблицаПоставок = ДанныеВыгрузки.ТаблицаПоставок;
	
	КодыВидовПродукции = ТаблицаДвижений.Скопировать(, "П000010000102");
	КодыВидовПродукции.Свернуть("П000010000102");
	
	НомерППКодаВидаПродукции = 0;
	Для Каждого СтрокаКодаВидаПродукции Из КодыВидовПродукции Цикл
		КодВидаПродукции = СтрокаКодаВидаПродукции.П000010000102;
		
		Если ПустаяСтрока(КодВидаПродукции) Тогда
			Продолжить;
		КонецЕсли;
		
		Узел_Оборот = НовыйУзелИзПрототипа(ПрототипУзла_Оборот);
		
		НомерППКодаВидаПродукции = НомерППКодаВидаПродукции + 1;
		
		УстановитьЗначениеЭлемента(Узел_Оборот, "ПN", НомерППКодаВидаПродукции);
		УстановитьЗначениеЭлемента(Узел_Оборот, "П000000000003", КодВидаПродукции);
		
		ОбразецУзлаСведПроизвИмпорт = ПолучитьПодчиненныйЭлемент(Узел_Оборот, "СведПроизвИмпорт");
		
		УсловияОтбора = Новый Структура("П000010000102", КодВидаПродукции);
		СтрокиСведений = ТаблицаДвижений.НайтиСтроки(УсловияОтбора);
		СведенияОПроизводителеИмпортере = ТаблицаДвижений.Скопировать(СтрокиСведений, "П000010000103, П000010000104, П000010000105");
		СведенияОПроизводителеИмпортере.Свернуть("П000010000103, П000010000104, П000010000105");
		
		НомерППСведенийОПроизводителеИмпортере = 0;
		Для Каждого СтрокаСведенийОПроизводителеИмпортере Из СведенияОПроизводителеИмпортере Цикл
			НовыйУзелСведПроизвИмпорт = СкопироватьУзел(Узел_Оборот, ОбразецУзлаСведПроизвИмпорт);
			
			НомерППСведенийОПроизводителеИмпортере = НомерППСведенийОПроизводителеИмпортере + 1;
			
			ИдПроизвИмп = ПолучитьИдентификаторПроизводителяИмпортера(ДанныеВыгрузки, СтрокаСведенийОПроизводителеИмпортере);
			
			УстановитьЗначениеЭлемента(НовыйУзелСведПроизвИмпорт, "ПN", НомерППСведенийОПроизводителеИмпортере);
			УстановитьЗначениеЭлемента(НовыйУзелСведПроизвИмпорт, "ИдПроизвИмп", ИдПроизвИмп);
			
			// Сведения о поставщиках.
			ОбразецУзлаПоставщик = ПолучитьПодчиненныйЭлемент(НовыйУзелСведПроизвИмпорт, "Поставщик");
			
			УсловияОтбора = Новый Структура;
			УсловияОтбора.Вставить("П000020000102", КодВидаПродукции);
			УсловияОтбора.Вставить("П000020000103", СтрокаСведенийОПроизводителеИмпортере.П000010000103);
			УсловияОтбора.Вставить("П000020000104", СтрокаСведенийОПроизводителеИмпортере.П000010000104);
			УсловияОтбора.Вставить("П000020000105", СтрокаСведенийОПроизводителеИмпортере.П000010000105);
			
			СтрокиПоставщиков = ТаблицаПоставок.НайтиСтроки(УсловияОтбора);
			СведенияОПоставщиках = ТаблицаПоставок.Скопировать(СтрокиПоставщиков, "П000020000106, П000020000107, П000020000108");
			СведенияОПоставщиках.Свернуть("П000020000106, П000020000107, П000020000108");
			
			НомерПППоставщика = 0;
			Для Каждого СтрокаСведенийОПоставщике Из СведенияОПоставщиках Цикл
				НовыйУзелПоставщик = СкопироватьУзел(НовыйУзелСведПроизвИмпорт, ОбразецУзлаПоставщик);
				
				НомерПППоставщика = НомерПППоставщика + 1;
				
				ИдПоставщика = ПолучитьИдентификаторПоставщика(ДанныеВыгрузки, СтрокаСведенийОПоставщике);
				
				УстановитьЗначениеЭлемента(НовыйУзелПоставщик, "ПN", НомерПППоставщика);
				УстановитьЗначениеЭлемента(НовыйУзелПоставщик, "ИдПоставщика", ИдПоставщика);
				
				// Сведения о поставках продукции.
				ОбразецУзлаПродукция = ПолучитьПодчиненныйЭлемент(НовыйУзелПоставщик, "Продукция");
				
				УсловияОтбора.Вставить("П000020000107", СтрокаСведенийОПоставщике.П000020000107);
				УсловияОтбора.Вставить("П000020000108", СтрокаСведенийОПоставщике.П000020000108);
				
				СтрокиПродукции = ТаблицаПоставок.НайтиСтроки(УсловияОтбора);
				Для Каждого СтрокаПродукции Из СтрокиПродукции Цикл
					НовыйУзелПродукция = СкопироватьУзел(НовыйУзелПоставщик, ОбразецУзлаПродукция);
					
					УстановитьЗначениеЭлемента(НовыйУзелПродукция, "П200000000013", СтрокаПродукции.П000020000109);
					УстановитьЗначениеЭлемента(НовыйУзелПродукция, "П200000000014", СтрокаПродукции.П000020000110);
					УстановитьЗначениеЭлемента(НовыйУзелПродукция, "П200000000015", СтрокаПродукции.П000020000111);
					УстановитьЗначениеЭлемента(НовыйУзелПродукция, "П200000000016", СтрокаПродукции.П000020000112);
					
				КонецЦикла;
				
				РегламентированнаяОтчетность.УдалитьУзел(ОбразецУзлаПродукция);
				
			КонецЦикла;
			
			РегламентированнаяОтчетность.УдалитьУзел(ОбразецУзлаПоставщик);
			
			// Сведения о движениях.
			ОбразецУзлаДвижение = ПолучитьПодчиненныйЭлемент(НовыйУзелСведПроизвИмпорт, "Движение");
			
			УсловияОтбора = Новый Структура;
			УсловияОтбора.Вставить("П000010000102", КодВидаПродукции);
			УсловияОтбора.Вставить("П000010000103", СтрокаСведенийОПроизводителеИмпортере.П000010000103);
			УсловияОтбора.Вставить("П000010000104", СтрокаСведенийОПроизводителеИмпортере.П000010000104);
			УсловияОтбора.Вставить("П000010000105", СтрокаСведенийОПроизводителеИмпортере.П000010000105);
			
			СтрокиСведений = ТаблицаДвижений.НайтиСтроки(УсловияОтбора);
			
			НомерППДвижения = 0;
			Для Каждого СтрокаДвижения Из СтрокиСведений Цикл
				НовыйУзелДвижение = СкопироватьУзел(НовыйУзелСведПроизвИмпорт, ОбразецУзлаДвижение);
				
				НомерППДвижения = НомерППДвижения + 1;
				
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "ПN", НомерППДвижения);
				
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000006", СтрокаДвижения.П000010000106);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000007", СтрокаДвижения.П000010000107);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000008", СтрокаДвижения.П000010000108);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000009", СтрокаДвижения.П000010000109);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000010", СтрокаДвижения.П000010000110);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000011", СтрокаДвижения.П000010000111);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000012", СтрокаДвижения.П000010000112);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000013", СтрокаДвижения.П000010000113);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000014", СтрокаДвижения.П000010000114);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000015", СтрокаДвижения.П000010000115);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000016", СтрокаДвижения.П000010000116);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000017", СтрокаДвижения.П000010000117);
				УстановитьЗначениеЭлемента(НовыйУзелДвижение, "П100000000018", СтрокаДвижения.П000010000118);
				
			КонецЦикла;
			
			РегламентированнаяОтчетность.УдалитьУзел(ОбразецУзлаДвижение);
			
		КонецЦикла;
		
		РегламентированнаяОтчетность.УдалитьУзел(ОбразецУзлаСведПроизвИмпорт);
		
	КонецЦикла;
	
	РегламентированнаяОтчетность.УдалитьУзел(ПрототипУзла_Оборот);
	
КонецПроцедуры

&НаСервере
Функция ПолучитьИдентификаторПроизводителяИмпортера(ДанныеВыгрузки, СтрокаСведенийОПроизводителеИмпортере)
	
	Результат = 0;
	
	// Обработка ситуации отсутствия производителя. Проверяем заполнение Наименования - оно обязательно.
	Если НЕ ЗначениеЗаполнено(СтрокаСведенийОПроизводителеИмпортере.П000010000103) Тогда
		// возвращаем 0.
		Возврат Результат;
	КонецЕсли;
	
	ПроизводителиИмпортеры = ДанныеВыгрузки.ПроизводителиИмпортеры;
	
	УсловияОтбора = Новый Структура;
	УсловияОтбора.Вставить("П000000000004", СтрокаСведенийОПроизводителеИмпортере.П000010000103);
	УсловияОтбора.Вставить("П000000000005", СтрокаСведенийОПроизводителеИмпортере.П000010000104);
	УсловияОтбора.Вставить("П000000000006", СтрокаСведенийОПроизводителеИмпортере.П000010000105);
	
	НайденныеСтроки = ПроизводителиИмпортеры.НайтиСтроки(УсловияОтбора);
	
	Если НайденныеСтроки.Количество() > 0 Тогда
		
		Результат = НайденныеСтроки[0].ИДПроизвИмп;
		
	Иначе
		НоваяСтрока = ПроизводителиИмпортеры.Добавить();
		
		Идентификатор = ПроизводителиИмпортеры.Индекс(НоваяСтрока) + 1;
		
		НоваяСтрока.ИДПроизвИмп   = Идентификатор;
		НоваяСтрока.П000000000004 = СтрокаСведенийОПроизводителеИмпортере.П000010000103;
		НоваяСтрока.П000000000005 = СтрокаСведенийОПроизводителеИмпортере.П000010000104;
		НоваяСтрока.П000000000006 = СтрокаСведенийОПроизводителеИмпортере.П000010000105;
		
		Результат = Идентификатор;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

&НаСервере
Функция ПолучитьИдентификаторПоставщика(ДанныеВыгрузки, СтрокаСведенийОПоставщике)
	
	Результат = 0;
	
	// Обработка ситуации отсутствия поставщика. Проверяем заполнение ИНН.
	Если НЕ ЗначениеЗаполнено(СтрокаСведенийОПоставщике.П000020000107) Тогда
		// возвращаем 0.
		Возврат Результат;
	КонецЕсли;
	
	Поставщики = ДанныеВыгрузки.Поставщики;
	
	УсловияОтбора = Новый Структура;
	УсловияОтбора.Вставить("П000000000009", СтрокаСведенийОПоставщике.П000020000107);
	УсловияОтбора.Вставить("П000000000010", СтрокаСведенийОПоставщике.П000020000108);
	
	НайденныеСтроки = Поставщики.НайтиСтроки(УсловияОтбора);
	
	Если НайденныеСтроки.Количество() > 0 Тогда
		
		Результат = НайденныеСтроки[0].ИдПостав;
		
	Иначе
		НоваяСтрока = Поставщики.Добавить();
		
		Идентификатор = Поставщики.Индекс(НоваяСтрока) + 1;
		
		НоваяСтрока.ИдПостав      = Идентификатор;
		НоваяСтрока.П000000000007 = СтрокаСведенийОПоставщике.П000020000106;
		НоваяСтрока.П000000000009 = СтрокаСведенийОПоставщике.П000020000107;
		НоваяСтрока.П000000000010 = СтрокаСведенийОПоставщике.П000020000108;
		
		Результат = Идентификатор;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьСправочникиДекларации(УзелСправочники, ДанныеВыгрузки)
	
	ОбразецУзлаПроизводителиИмпортеры = ПолучитьПодчиненныйЭлемент(УзелСправочники, "ПроизводителиИмпортеры");
	
	Для Каждого СтрокаПроизводителяИмпортера Из ДанныеВыгрузки.ПроизводителиИмпортеры Цикл
		
		НовыйУзелПроизводителиИмпортеры = СкопироватьУзел(УзелСправочники, ОбразецУзлаПроизводителиИмпортеры);
		
		УстановитьЗначениеЭлемента(НовыйУзелПроизводителиИмпортеры, "ИДПроизвИмп", СтрокаПроизводителяИмпортера.ИДПроизвИмп);
		УстановитьЗначениеЭлемента(НовыйУзелПроизводителиИмпортеры, "П000000000004", СтрокаПроизводителяИмпортера.П000000000004);
				
		ИНН = СтрокаПроизводителяИмпортера.П000000000005;
		КПП = СтрокаПроизводителяИмпортера.П000000000006;
		
		Узел_ЮЛ = ПолучитьПодчиненныйЭлемент(НовыйУзелПроизводителиИмпортеры, "ЮЛ");
		Узел_ФЛ = ПолучитьПодчиненныйЭлемент(НовыйУзелПроизводителиИмпортеры, "ФЛ");
		
		Если НЕ ПустаяСтрока(КПП) Тогда
			УстановитьЗначениеЭлемента(Узел_ЮЛ, "П000000000005", ИНН);
			УстановитьЗначениеЭлемента(Узел_ЮЛ, "П000000000006", КПП);
			РегламентированнаяОтчетность.УдалитьУзел(Узел_ФЛ);
		Иначе
			РегламентированнаяОтчетность.УдалитьУзел(Узел_ЮЛ);
			УстановитьЗначениеЭлемента(Узел_ФЛ, "П000000000005", ИНН);
		КонецЕсли;
		
	КонецЦикла;
	
	РегламентированнаяОтчетность.УдалитьУзел(ОбразецУзлаПроизводителиИмпортеры);
	
	ОбразецУзлаПоставщики = ПолучитьПодчиненныйЭлемент(УзелСправочники, "Поставщики");
	
	Для Каждого СтрокаПоставщика Из ДанныеВыгрузки.Поставщики Цикл
		
		НовыйУзелПоставщики = СкопироватьУзел(УзелСправочники, ОбразецУзлаПоставщики);
		
		УстановитьЗначениеЭлемента(НовыйУзелПоставщики, "ИдПостав", СтрокаПоставщика.ИдПостав);
		УстановитьЗначениеЭлемента(НовыйУзелПоставщики, "П000000000007", СтрокаПоставщика.П000000000007);
		
		УказанИНН = НЕ ПустаяСтрока(СтрокаПоставщика.П000000000009);
		УказанКПП = НЕ ПустаяСтрока(СтрокаПоставщика.П000000000010);
				
		Узел_ЮЛ = ПолучитьПодчиненныйЭлемент(НовыйУзелПоставщики, "ЮЛ");
		Узел_ФЛ = ПолучитьПодчиненныйЭлемент(НовыйУзелПоставщики, "ФЛ");
		Если УказанКПП Тогда
			УстановитьЗначениеЭлемента(Узел_ЮЛ, "П000000000009", СтрокаПоставщика.П000000000009);
			УстановитьЗначениеЭлемента(Узел_ЮЛ, "П000000000010", СтрокаПоставщика.П000000000010);
			РегламентированнаяОтчетность.УдалитьУзел(Узел_ФЛ);
		Иначе
			РегламентированнаяОтчетность.УдалитьУзел(Узел_ЮЛ);
			УстановитьЗначениеЭлемента(Узел_ФЛ, "П000000000009", СтрокаПоставщика.П000000000009);
		КонецЕсли;
		
	КонецЦикла;
	
	РегламентированнаяОтчетность.УдалитьУзел(ОбразецУзлаПоставщики);
	
КонецПроцедуры

&НаСервере
Процедура УстановитьЗначениеЭлемента(УзелРодитель, ИмяЭлемента, ЗначениеЭлемента)
	
	ПодчиненныйЭлемент = ПолучитьПодчиненныйЭлемент(УзелРодитель, ИмяЭлемента);
	ВывестиПоказательВXML(ПодчиненныйЭлемент, ЗначениеЭлемента);
	
КонецПроцедуры

&НаСервере
Функция ВывестиПоказательВXML(Узел, ЗначениеПоказателя)
	
	МинШирина = Узел.МинРазмерность;
	МаксШирина = Узел.МаксРазмерность;
	
	Если Узел.Формат = "T" ИЛИ Узел.Формат = "Т" Тогда // учтем оба варианта: кириллицу и латиницу
		Узел.Значение = ?(МаксШирина < СтрДлина(СокрЛП(ЗначениеПоказателя)), СокрЛП(Лев(СокрЛП(ЗначениеПоказателя), МаксШирина)), СокрЛП(ЗначениеПоказателя));
	ИначеЕсли Узел.Формат = "N" Тогда
		СтрокаФормата = "ЧРД=.;ЧН=0;ЧГ=;";
		Если Узел.МаксРазмерность <> 0 И Узел.МаксРазмерность <> 99999 Тогда
			СтрокаФормата = СтрокаФормата + "ЧЦ=" + Формат(Узел.МаксРазмерность, "ЧГ=") + ";";
		КонецЕсли;
		Если Узел.МинРазмерность <> 99999 Тогда
			СтрокаФормата = СтрокаФормата + "ЧДЦ=" + Формат(Узел.МинРазмерность, "ЧГ=") + ";";
		КонецЕсли;
		Узел.Значение = СокрЛП(Формат(ЗначениеПоказателя, СтрокаФормата));
	ИначеЕсли Узел.Формат = "gYear" Тогда
		Если ТипЗнч(ЗначениеПоказателя) = Тип("Дата") Тогда
			Узел.Значение = СокрЛП(Формат(ЗначениеПоказателя, "ДФ=гггг"));
		Иначе
			Узел.Значение = Прав(СокрЛП(ЗначениеПоказателя), 4);
		КонецЕсли;
	КонецЕсли;
	
КонецФункции

&НаСервере
Функция УзелПуст(Узел)
	
	ПустойУзел = ?(Узел.Формат = "N", Узел.Значение = "0" ИЛИ (НЕ ЗначениеЗаполнено(Узел.Значение)), НЕ ЗначениеЗаполнено(Узел.Значение));
	Для Каждого Стр из Узел.Строки Цикл
		Если НЕ УзелПуст(Стр) Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;
	Возврат ПустойУзел;
	
КонецФункции

&НаСервере
Функция ПолучитьПодчиненныйЭлемент(Узел, КодЭлемента)
	
	Для Каждого Стр Из Узел.Строки Цикл
		Если Стр.Код = КодЭлемента Тогда
			Возврат Стр;
		КонецЕсли;
	КонецЦикла;
	
КонецФункции 

&НаСервере
Функция СкопироватьУзел(Родитель, Узел)
	
	НовыйУзел = Родитель.Строки.Добавить();
	ЗаполнитьЗначенияСвойств(НовыйУзел, Узел, , "Родитель, Строки");
	Для Каждого Стр из Узел.Строки Цикл
		СкопироватьУзел(НовыйУзел, Стр);
	КонецЦикла;
	Возврат НовыйУзел;
	
КонецФункции

&НаКлиенте
Процедура ПроверитьВыгрузку(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверитьВыгрузкуЗавершение", ЭтотОбъект);

	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
		
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВыгрузкуЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	ПроверитьВыгрузкуОтчета();
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВыгрузкуОтчета()
	
	Если НЕ ЗначениеЗаполнено(СтруктураРеквизитовФормы.Организация) Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru='Организация не выбрана! Выгрузка невозможна.'");
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверитьВыгрузкуОтчетаЗавершение", ЭтотОбъект);
	
	Если Модифицированность Тогда
		СохранитьНаКлиенте(,ОписаниеОповещения);
	Иначе
		ВыполнитьОбработкуОповещения(ОписаниеОповещения);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВыгрузкуОтчетаЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	ФормаВыгрузкиРеглОтчета = ПолучитьФорму("Документ.ВыгрузкаРегламентированныхОтчетов.Форма.ФормаДокумента", , ЭтаФорма);
	
	СпДокОсн = Новый СписокЗначений;
	СпДокОсн.Добавить(СтруктураРеквизитовФормы.мСохраненныйДок);
	
	ФормаВыгрузкиРеглОтчета.Проверить(СпДокОсн);
	
КонецПроцедуры

&НаКлиенте
Процедура АктивизироватьЯчейку(Ячейка) Экспорт
	
	РегламентированнаяОтчетностьКлиент.АктивизироватьЯчейку(ЭтаФорма, Ячейка);
	УстановитьДоступностьПолейРаздела1(ЭтаФорма);
	УстановитьДоступностьПолейРаздела2(ЭтаФорма);

КонецПроцедуры

&НаКлиенте
Процедура ПоказатьБланк(Команда)
	
	Отказ = Ложь;
	
	ДополнительныеПараметры = Новый Структура();
	ДополнительныеПараметры.Вставить("Команда", Команда);
	ОписаниеОповещения = Новый ОписаниеОповещения("ПоказатьБланкЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередПечатьюРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьБланкЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;

	Команда = ДополнительныеПараметры.Команда;
		
	Печать(Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура Печать(ВидПечати, НеИзФормыОтчета = Ложь) Экспорт
        	
	Состояние(СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='%1. Формируется печатная форма...'"), ЭтаФорма.Заголовок), , , БиблиотекаКартинок.Печать);
	
	Если НЕ ПечатьНаСервере(ВидПечати) Тогда
		Возврат;
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиент.ОткрытьФормуПредварительногоПросмотра(ЭтаФорма, ВидПечати, , СтруктураРеквизитовФормы.СписокПечатаемыхЛистов);
	
	СтруктураРеквизитовФормы.мРежимПечати = Ложь;

КонецПроцедуры

&НаСервере
Функция ПечатьНаСервере(ВидПечати)
	
	Если НЕ РегламентированнаяОтчетность.ПринтерДоступен() Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru='Перед формированием печатных форм необходимо определить в системе принтер и задать его в качестве используемого по умолчанию!'");
		Сообщение.Сообщить();
		Возврат Ложь;
	КонецЕсли;
	
	Если ТипЗнч(мДеревоВыбранныхСтраниц) <> Тип("ДанныеФормыДерево") Тогда
		Возврат Ложь;
	КонецЕсли;
	
	СтруктураРеквизитовФормы.мПечатныеФормы.Очистить();
	СтруктураРеквизитовФормы.мРежимПечати = Истина;
	
	СтруктураПараметров = Новый Структура;
	
	СохранитьДанныеРаздела(СтруктураРеквизитовФормы.НаимТекущегоРаздела, Ложь, Ложь);
	
	ЗаполнитьПустыеСтруктурыДанных();
	
	// Если текущий раздел многостраничный, имеющий многострочные части,
	// предварительно сохраним данные многострочных групп.
	Если СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел1" Тогда
		СохрТЗМногострочнойГруппы11 = ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы11].Выгрузить();
		СохрТЗМногострочнойГруппы12 = ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы12].Выгрузить();
	ИначеЕсли СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел2" Тогда
		СохрТЗМногострочнойГруппы21 = ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы21].Выгрузить();
		СохрТЗМногострочнойГруппы22 = ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы22].Выгрузить();
	КонецЕсли;
	
	сохрТаблДок = ТабличныйДокумент.ПолучитьОбласть();
	
	СтрПоля = "ПолеСверху, ПолеСправа, ПолеСнизу, ПолеСлева";
	ВремПоля = Новый Структура(СтрПоля);
	
	ЗаполнитьЗначенияСвойств(ВремПоля, ТабличныйДокумент, СтрПоля);
	
	ВывестиМакетВТаблДокНаСервере("Титульный", 1);
	
	ОбщиеРеквизитыРазделов = ПолучитьОбщиеРеквизитыСТитульногоЛиста();
	
	Для Каждого СтрокаУровня1 Из мДеревоВыбранныхСтраниц.ПолучитьЭлементы() Цикл
		
		Пометка = РегламентированнаяОтчетность.ПечататьРаздел(ЭтаФорма, СтрокаУровня1);
		
		ИмяСтраницыПанели  = СтрокаУровня1.ИмяСтраницы;
		НаименованиеЛиста  = СтрокаУровня1.Представление;
		ОриентацияЛиста    = СтрокаУровня1.ОриентацияСтраницы;
		ИмяОбластиТаблПоля = СтрокаУровня1.ИмяОбластиТабличногоПоля;
		
		Если Пометка = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		СтруктураПараметров.Очистить();
		СтруктураПараметров.Вставить("НаименованиеЛиста",  НаименованиеЛиста);
		СтруктураПараметров.Вставить("ОриентацияЛиста",    ОриентацияЛиста);
		СтруктураПараметров.Вставить("ИмяСтраницы",        ИмяСтраницыПанели);
		Структурапараметров.Вставить("ИмяОбластиТаблПоля", ИмяОбластиТаблПоля);
		СтруктураПараметров.Вставить("ВидПечати",          ВидПечати);
		
		Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницыПанели) Тогда
			ВывестиМакетВТаблДокНаСервере(СтрокаУровня1.ИмяСтраницы, 0);
			ВывестиНаПечатьЛист(СтруктураПараметров, ОбщиеРеквизитыРазделов, СтрПоля);
		ИначеЕсли ИмяСтраницыПанели = "Раздел1" Тогда
			СтруктураПараметров.Вставить("ИмяСтраницыПанели", ИмяСтраницыПанели);
			ВывестиНаПечатьРаздел1(СтруктураПараметров);
		ИначеЕсли ИмяСтраницыПанели = "Раздел2" Тогда
			СтруктураПараметров.Вставить("ИмяСтраницыПанели", ИмяСтраницыПанели);
			ВывестиНаПечатьРаздел2(СтруктураПараметров);
		Иначе
			// Вывод на печать всех страниц многостраничного раздела.
			СтруктураПараметров.Вставить("ИмяСтраницыПанели", ИмяСтраницыПанели);
			ВывестиНаПечатьДополнительныеСтраницы(СтруктураПараметров, ОбщиеРеквизитыРазделов);
		КонецЕсли;
		
	КонецЦикла;
	
	// Если текущий раздел многостраничный, имеющий многострочные части,
	// восстановим предварительно сохраненные данные многострочных групп.
	Если СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел1" Тогда
		ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы11].Загрузить(СохрТЗМногострочнойГруппы11);
		ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы12].Загрузить(СохрТЗМногострочнойГруппы12);
	ИначеЕсли СтруктураРеквизитовФормы.НаимТекущегоРаздела = "Раздел2" Тогда
		ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы21].Загрузить(СохрТЗМногострочнойГруппы21);
		ЭтаФорма[СтруктураРеквизитовФормы.мИдГруппы22].Загрузить(СохрТЗМногострочнойГруппы22);
	КонецЕсли;
	
	ТабличныйДокумент.Очистить();
	ТабличныйДокумент.Вывести(сохрТаблДок);
	ЗаполнитьЗначенияСвойств(ТабличныйДокумент, ВремПоля, СтрПоля);
	
	РегламентированнаяОтчетностьКлиентСервер.ПроставлениеНомеровЛистов(ЭтаФорма, , СтруктураРеквизитовФормы.СписокПечатаемыхЛистов);
	
	КопироватьДанныеФормы(мДеревоВыбранныхСтраниц, мДеревоСтраницОтчета);
	
	Возврат Истина;
	
КонецФункции

&НаСервере
Процедура ВывестиНаПечатьЛист(Парам1, ОбщиеРеквизитыРазделов, СтрПоля = Неопределено)
	
	СоответствиеРазделовМакетам = Новый Соответствие;
	
	Если СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета < '20140101' Тогда
		СоответствиеРазделовМакетам.Вставить("Титульный",  "ПечатнаяФормаОтчета2012Кв3_Титульный");		
	Иначе
		СоответствиеРазделовМакетам.Вставить("Титульный",  "ПечатнаяФормаОтчета2012Кв3_Титульный_20140101");		
	КонецЕсли;
	СоответствиеРазделовМакетам.Вставить("Лицензии",   "ПечатнаяФормаОтчета2012Кв3_Лицензии");

	ПечатнаяФормаРаздела = СоответствиеРазделовМакетам[Парам1.ИмяСтраницы];
		
	МакетПечатнойФормы = ОбъектОтчета(ЭтаФорма.ИмяФормы).ПолучитьМакет(ПечатнаяФормаРаздела);
	МакетПечатнойФормы.ПолеСверху = 5;
	МакетПечатнойФормы.ПолеСправа = 5;
	МакетПечатнойФормы.ПолеСнизу = 5;
	МакетПечатнойФормы.ПолеСлева = 5;
		
	ЗаполнитьПечатнуюФорму(Парам1, МакетПечатнойФормы, ОбщиеРеквизитыРазделов);
		
	ТабличныйДокумент.Очистить();
	ТабличныйДокумент.Вывести(МакетПечатнойФормы);
	ЗаполнитьЗначенияСвойств(ТабличныйДокумент, МакетПечатнойФормы, СтрПоля, "Макет");

	РегламентированнаяОтчетность.ВывестиНаПечатьЛистОбщая(ЭтаФорма.Заголовок, Парам1, ТабличныйДокумент, СтруктураРеквизитовФормы.мПечатныеФормы);
	
КонецПроцедуры

&НаСервере
Процедура ВывестиНаПечатьДополнительныеСтраницы(СтруктураПараметровСтраницы, ОбщиеРеквизитыРазделов)
	
	Перем ИмяСтраницы;
	Перем ТаблицаСтраницРаздела;
	
	СтруктураПараметровСтраницы.Свойство("ИмяСтраницыПанели", ИмяСтраницы);
	
	Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницы, ТаблицаСтраницРаздела) Тогда
		Возврат;
	КонецЕсли;
	
	ТаблицаСтраницРаздела = ЭтаФорма[ТаблицаСтраницРаздела];
	
	МассивПризнаковАктивности = Новый Массив;
	Для Каждого Страница Из ТаблицаСтраницРаздела Цикл
		ТекущийИндекс = ТаблицаСтраницРаздела.Индекс(Страница);
		МассивПризнаковАктивности.Добавить(ТаблицаСтраницРаздела[ТекущийИндекс].АктивнаяСтраница);
	КонецЦикла;
	
	Для Каждого Страница Из ТаблицаСтраницРаздела Цикл
		ТекущийИндекс = ТаблицаСтраницРаздела.Индекс(Страница);
		ВывестиМакетВТаблДокНаСервере(ИмяСтраницы, ТекущийИндекс + 1);
		ВывестиНаПечатьЛист(СтруктураПараметровСтраницы, ОбщиеРеквизитыРазделов);
	КонецЦикла;
	
	Для Каждого Страница Из ТаблицаСтраницРаздела Цикл
		ТекущийИндекс = ТаблицаСтраницРаздела.Индекс(Страница);
		ТаблицаСтраницРаздела[ТекущийИндекс].АктивнаяСтраница = МассивПризнаковАктивности[ТекущийИндекс];
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ВывестиНаПечатьРаздел1(СтруктураПараметровСтраницы)
	
	ЭтоПБОЮЛ = НЕ РегламентированнаяОтчетностьВызовСервера.ЭтоЮридическоеЛицо(СтруктураРеквизитовФормы.Организация);

	МакетПечати = ПолучитьМакетПечатнойФормы("Раздел1");
	
	ПечатнаяФорма = Новый ТабличныйДокумент();
	ПечатнаяФорма.ОтображатьЗаголовки = Ложь;
	ПечатнаяФорма.ОтображатьСетку     = Ложь;
	ПечатнаяФорма.ЧерноБелыйПросмотр  = Истина;
	ПечатнаяФорма.ЧерноБелаяПечать    = Истина;
	ПечатнаяФорма.Автомасштаб         = Истина;
	ПечатнаяФорма.ОриентацияСтраницы  = ОриентацияСтраницы.Ландшафт;
	
	Область_Шапка = МакетПечати.ПолучитьОбласть("Шапка");
	ПечатнаяФорма.Вывести(Область_Шапка);
	
	Область_РеквизитыОрганизации = МакетПечати.ПолучитьОбласть("РеквизитыОрганизации");
	Наименование = СокрЛП(СтруктураДанныхТитульный.ОргНазв);
	ИНН = СтруктураДанныхТитульный.ИНН1;
	Если ЭтоПБОЮЛ Тогда
		Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по индивидуальному предпринимателю";
		Адрес = СокрЛП(СтруктураДанныхТитульный.АдресИндивидуальногоПредпринимателя);
		ТекстРеквизитов = Наименование + ", ИНН " + ИНН + ", Адрес: " + Адрес;
	Иначе
		Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по организации";
		КПП = СтруктураДанныхТитульный.КПП1;
		Адрес = СокрЛП(СтруктураДанныхТитульный.АдресОрганизации);
		ТекстРеквизитов = Наименование + ", ИНН " + ИНН + ", КПП " + КПП + ", Адрес: " + Адрес;
	КонецЕсли;
	
	Область_РеквизитыОрганизации.Области.Реквизиты.Текст = ТекстРеквизитов;
	ПечатнаяФорма.Вывести(Область_РеквизитыОрганизации);
	
	ДанныеПоОрганизации = ЭтаФорма[мСтруктураМногостраничныхРазделов.Раздел1][0].ДанныеДопСтрок[0].Значение.П0000100001.Выгрузить();
	Для Каждого СтрокаДанных Из ДанныеПоОрганизации Цикл
		Область_Строка = МакетПечати.ПолучитьОбласть("Строка");
		Для Каждого Колонка Из ДанныеПоОрганизации.Колонки Цикл
			ИмяКолонки = Колонка.Имя;
			ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000100001", "П0000100003");
			Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
				Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
			КонецЕсли;
		КонецЦикла;
		ПечатнаяФорма.Вывести(Область_Строка);
	КонецЦикла;
	
	ДанныеПоОрганизации.Свернуть("П000010000102", "П000010000106, П000010000107, П000010000108, П000010000109,
		|П000010000110, П000010000111, П000010000112, П000010000113, П000010000114, П000010000115, П000010000116, П000010000117, П000010000118");
	Для Каждого СтрокаДанных Из ДанныеПоОрганизации Цикл
		Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
		Область_Строка.Области.ОписаниеИтого.Текст = "Итого по коду " + СтрокаДанных.П000010000102;
		Для Каждого Колонка Из ДанныеПоОрганизации.Колонки Цикл
			ИмяКолонки = Колонка.Имя;
			ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000100001", "П0000100004");
			Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
				Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
			КонецЕсли;
		КонецЦикла;
		ПечатнаяФорма.Вывести(Область_Строка);
	КонецЦикла;
	
	ДанныеПоОрганизации.Свернуть( , "П000010000106, П000010000107, П000010000108, П000010000109,
		|П000010000110, П000010000111, П000010000112, П000010000113, П000010000114, П000010000115, П000010000116, П000010000117, П000010000118");
	Для Каждого СтрокаДанных Из ДанныеПоОрганизации Цикл
		Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
		Область_Строка.Области.ОписаниеИтого.Текст = "ИТОГО";
		Для Каждого Колонка Из ДанныеПоОрганизации.Колонки Цикл
			ИмяКолонки = Колонка.Имя;
			ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000100001", "П0000100004");
			Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
				Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
			КонецЕсли;
		КонецЦикла;
		ПечатнаяФорма.Вывести(Область_Строка);
	КонецЦикла;
	
	Для Каждого Лист Из ЭтаФорма[мСтруктураМногостраничныхРазделов.Раздел1] Цикл
		
		Область_ПустаяСтрока = МакетПечати.ПолучитьОбласть("ПустаяСтрока");
		ПечатнаяФорма.Вывести(Область_ПустаяСтрока);
		
		ДанныеЛиста = Лист.Данные[0].Значение;
		ДанныеПоПодразделению = Лист.ДанныеДопСтрок[0].Значение.П0000100003.Выгрузить();
		Область_РеквизитыОрганизации = МакетПечати.ПолучитьОбласть("РеквизитыОрганизации");
		Если ЭтоПБОЮЛ Тогда
			Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по по объекту торговли индивидуального предпринимателя (с указанием адреса)";
		Иначе
			Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по обособленному подразделению (с указанием ИНН, КПП и адреса)";
		КонецЕсли;
		Область_РеквизитыОрганизации.Области.Реквизиты.Текст = ДанныеЛиста.ОбособленноеПодразделение;
		ПечатнаяФорма.Вывести(Область_РеквизитыОрганизации);
		
		Для Каждого СтрокаДанных Из ДанныеПоПодразделению Цикл
			Область_Строка = МакетПечати.ПолучитьОбласть("Строка");
			Для Каждого Колонка Из ДанныеПоПодразделению.Колонки Цикл
				ИмяКолонки = Колонка.Имя;
				ИмяКолонкиМакета = ИмяКолонки;
				Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
					Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
				КонецЕсли;
			КонецЦикла;
			ПечатнаяФорма.Вывести(Область_Строка);
		КонецЦикла;
		
		ДанныеПоПодразделению.Свернуть("П000010000302", "П000010000306, П000010000307, П000010000308, П000010000309,
			|П000010000310, П000010000311, П000010000312, П000010000313, П000010000314, П000010000315, П000010000316, П000010000317, П000010000318");
		Для Каждого СтрокаДанных Из ДанныеПоПодразделению Цикл
			Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
			Область_Строка.Области.ОписаниеИтого.Текст = "Итого по коду " + СтрокаДанных.П000010000302;
			Для Каждого Колонка Из ДанныеПоПодразделению.Колонки Цикл
				ИмяКолонки = Колонка.Имя;
				ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000100003", "П0000100004");
				Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
					Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
				КонецЕсли;
			КонецЦикла;
			ПечатнаяФорма.Вывести(Область_Строка);
		КонецЦикла;
		
		ДанныеПоПодразделению.Свернуть( , "П000010000306, П000010000307, П000010000308, П000010000309,
			|П000010000310, П000010000311, П000010000312, П000010000313, П000010000314, П000010000315, П000010000316, П000010000317, П000010000318");
		Для Каждого СтрокаДанных Из ДанныеПоПодразделению Цикл
			Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
			Область_Строка.Области.ОписаниеИтого.Текст = "ИТОГО";
			Для Каждого Колонка Из ДанныеПоПодразделению.Колонки Цикл
				ИмяКолонки = Колонка.Имя;
				ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000100003", "П0000100004");
				Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
					Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
				КонецЕсли;
			КонецЦикла;
			ПечатнаяФорма.Вывести(Область_Строка);
		КонецЦикла;
	
	КонецЦикла;
	
	Область_Подвал = МакетПечати.ПолучитьОбласть("Подвал");
	Область_Подвал.Области.Руководитель.Значение = СтруктураРеквизитовФормы.Руководитель;
	Область_Подвал.Области.Бухгалтер.Значение = СтруктураРеквизитовФормы.Бухгалтер;
	Область_Подвал.Области.ИндивидуальныйПредприниматель.Значение = СтруктураРеквизитовФормы.ИндивидуальныйПредприниматель;

	ПечатнаяФорма.Вывести(Область_Подвал);
	
	СтруктураРеквизитовФормы.мПечатныеФормы.Добавить(ПечатнаяФорма, СтруктураПараметровСтраницы.НаименованиеЛиста);
	
КонецПроцедуры

&НаСервере
Процедура ВывестиНаПечатьРаздел2(СтруктураПараметровСтраницы)
	
	ЭтоПБОЮЛ = НЕ РегламентированнаяОтчетностьВызовСервера.ЭтоЮридическоеЛицо(СтруктураРеквизитовФормы.Организация);

	МакетПечати = ПолучитьМакетПечатнойФормы("Раздел2");
	
	ПечатнаяФорма = Новый ТабличныйДокумент();
	ПечатнаяФорма.ОтображатьЗаголовки = Ложь;
	ПечатнаяФорма.ОтображатьСетку     = Ложь;
	ПечатнаяФорма.ЧерноБелыйПросмотр  = Истина;
	ПечатнаяФорма.ЧерноБелаяПечать    = Истина;
	ПечатнаяФорма.Автомасштаб         = Истина;
	ПечатнаяФорма.ОриентацияСтраницы  = ОриентацияСтраницы.Ландшафт;
	
	Область_Шапка = МакетПечати.ПолучитьОбласть("Шапка");
	ПечатнаяФорма.Вывести(Область_Шапка);
	
	Область_РеквизитыОрганизации = МакетПечати.ПолучитьОбласть("РеквизитыОрганизации");
	Наименование = СокрЛП(СтруктураДанныхТитульный.ОргНазв);
	ИНН = СтруктураДанныхТитульный.ИНН1;
	Если ЭтоПБОЮЛ Тогда
		Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по индивидуальному предпринимателю";
		Адрес = СокрЛП(СтруктураДанныхТитульный.АдресИндивидуальногоПредпринимателя);
		ТекстРеквизитов = Наименование + ", ИНН " + ИНН + ", Адрес: " + Адрес;
	Иначе
		Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по организации";
		КПП = СтруктураДанныхТитульный.КПП1;
		Адрес = СокрЛП(СтруктураДанныхТитульный.АдресОрганизации);
		ТекстРеквизитов = Наименование + ", ИНН " + ИНН + ", КПП " + КПП + ", Адрес: " + Адрес;
	КонецЕсли;
	Область_РеквизитыОрганизации.Области.Реквизиты.Текст = ТекстРеквизитов;
	ПечатнаяФорма.Вывести(Область_РеквизитыОрганизации);
	
	ДанныеПоОрганизации = ЭтаФорма[мСтруктураМногостраничныхРазделов.Раздел2][0].ДанныеДопСтрок[0].Значение.П0000200001.Выгрузить();
	Для Каждого СтрокаДанных Из ДанныеПоОрганизации Цикл
		Область_Строка = МакетПечати.ПолучитьОбласть("Строка");
		Для Каждого Колонка Из ДанныеПоОрганизации.Колонки Цикл
			ИмяКолонки = Колонка.Имя;
			ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000200001", "П0000200003");
			Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
				Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
			КонецЕсли;
		КонецЦикла;
		ПечатнаяФорма.Вывести(Область_Строка);
	КонецЦикла;
	
	ДанныеПоОрганизации.Свернуть("П000020000102", "П000020000112");
	Для Каждого СтрокаДанных Из ДанныеПоОрганизации Цикл
		Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
		Область_Строка.Области.ОписаниеИтого.Текст = "Итого по коду " + СтрокаДанных.П000020000102;
		Для Каждого Колонка Из ДанныеПоОрганизации.Колонки Цикл
			ИмяКолонки = Колонка.Имя;
			ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000200001", "П0000200004");
			Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
				Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
			КонецЕсли;
		КонецЦикла;
		ПечатнаяФорма.Вывести(Область_Строка);
	КонецЦикла;
	
	ДанныеПоОрганизации.Свернуть( , "П000020000112");
	Для Каждого СтрокаДанных Из ДанныеПоОрганизации Цикл
		Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
		Область_Строка.Области.ОписаниеИтого.Текст = "ИТОГО";
		Для Каждого Колонка Из ДанныеПоОрганизации.Колонки Цикл
			ИмяКолонки = Колонка.Имя;
			ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000200001", "П0000200004");
			Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
				Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
			КонецЕсли;
		КонецЦикла;
		ПечатнаяФорма.Вывести(Область_Строка);
	КонецЦикла;
	
	Для Каждого Лист Из ЭтаФорма[мСтруктураМногостраничныхРазделов.Раздел2] Цикл
		
		Область_ПустаяСтрока = МакетПечати.ПолучитьОбласть("ПустаяСтрока");
		ПечатнаяФорма.Вывести(Область_ПустаяСтрока);
		
		ДанныеЛиста = Лист.Данные[0].Значение;
		ДанныеПоПодразделению = Лист.ДанныеДопСтрок[0].Значение.П0000200003.Выгрузить();
		Область_РеквизитыОрганизации = МакетПечати.ПолучитьОбласть("РеквизитыОрганизации");
		Если ЭтоПБОЮЛ Тогда
			Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по по объекту торговли индивидуального предпринимателя (с указанием адреса)";
		Иначе
			Область_РеквизитыОрганизации.Области.ЗаголовокРеквизитов.Текст = "Сведения по обособленному подразделению (с указанием ИНН, КПП и адреса)";
		КонецЕсли;
		Область_РеквизитыОрганизации.Области.Реквизиты.Текст = ДанныеЛиста.ОбособленноеПодразделение;
		ПечатнаяФорма.Вывести(Область_РеквизитыОрганизации);
		
		Для Каждого СтрокаДанных Из ДанныеПоПодразделению Цикл
			Область_Строка = МакетПечати.ПолучитьОбласть("Строка");
			Для Каждого Колонка Из ДанныеПоПодразделению.Колонки Цикл
				ИмяКолонки = Колонка.Имя;
				ИмяКолонкиМакета = ИмяКолонки;
				Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
					Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
				КонецЕсли;
			КонецЦикла;
			ПечатнаяФорма.Вывести(Область_Строка);
		КонецЦикла;
		
		ДанныеПоПодразделению.Свернуть("П000020000302", "П000020000312");
		Для Каждого СтрокаДанных Из ДанныеПоПодразделению Цикл
			Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
			Область_Строка.Области.ОписаниеИтого.Текст = "Итого по коду " + СтрокаДанных.П000020000302;
			Для Каждого Колонка Из ДанныеПоПодразделению.Колонки Цикл
				ИмяКолонки = Колонка.Имя;
				ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000200003", "П0000200004");
				Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
					Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
				КонецЕсли;
			КонецЦикла;
			ПечатнаяФорма.Вывести(Область_Строка);
		КонецЦикла;
		
		ДанныеПоПодразделению.Свернуть( , "П000020000312");
		Для Каждого СтрокаДанных Из ДанныеПоПодразделению Цикл
			Область_Строка = МакетПечати.ПолучитьОбласть("СтрокаИтого");
			Область_Строка.Области.ОписаниеИтого.Текст = "ИТОГО";
			Для Каждого Колонка Из ДанныеПоПодразделению.Колонки Цикл
				ИмяКолонки = Колонка.Имя;
				ИмяКолонкиМакета = СтрЗаменить(ИмяКолонки, "П0000200003", "П0000200004");
				Если Область_Строка.Области.Найти(ИмяКолонкиМакета) <> Неопределено Тогда
					Область_Строка.Области[ИмяКолонкиМакета].Значение = СтрокаДанных[ИмяКолонки];
				КонецЕсли;
			КонецЦикла;
			ПечатнаяФорма.Вывести(Область_Строка);
		КонецЦикла;
		
	КонецЦикла;
	
	Область_Подвал = МакетПечати.ПолучитьОбласть("Подвал");
	Область_Подвал.Области.Руководитель.Значение = СтруктураРеквизитовФормы.Руководитель;
	Область_Подвал.Области.Бухгалтер.Значение = СтруктураРеквизитовФормы.Бухгалтер;
	Область_Подвал.Области.ИндивидуальныйПредприниматель.Значение = СтруктураРеквизитовФормы.ИндивидуальныйПредприниматель;
	ПечатнаяФорма.Вывести(Область_Подвал);
	
	СтруктураРеквизитовФормы.мПечатныеФормы.Добавить(ПечатнаяФорма, СтруктураПараметровСтраницы.НаименованиеЛиста);
	
КонецПроцедуры

&НаСервере
Функция ПолучитьОбщиеРеквизитыСТитульногоЛиста()
	
	МассивИНН            = Новый Массив(12);
	МассивКПП            = Новый Массив(9);
	МассивДатаПодписиРук = Новый Массив(8);
	МассивДатаПодписиБух = Новый Массив(8);
	МассивДатаПодписиИП  = Новый Массив(8);
				
	ИсходныйМакет = ТабличныйДокумент;
		
	Область = ИсходныйМакет.Области.Найти("ИНН1");
	
	Если НЕ Область = Неопределено Тогда
		
		СтрИНН = Область.Значение;
		
		Если СтрДлина(СтрИНН) = 10 Тогда
			СтрИНН = "00" + СтрИНН;
		КонецЕсли;
				
		Для Ном = 1 По СтрДлина(СтрИНН) Цикл
			
			МассивИНН[Ном - 1] = Сред(СтрИНН, Ном, 1);
			
		КонецЦикла;
		
	КонецЕсли;
		
	Область = ИсходныйМакет.Области.Найти("КПП1");
	
	Если НЕ Область = Неопределено Тогда
		
		Для Ном = 1 По СтрДлина(Область.Значение) Цикл
			
			МассивКПП[Ном - 1] = Сред(Область.Значение, Ном, 1);
			
		КонецЦикла;
		
	КонецЕсли;
	
	Область = ИсходныйМакет.Области.Найти("ДатаПодписи");
	
	Если НЕ Область = Неопределено Тогда
		
		СтрДатаПодписи = Лев(СтрЗаменить(Область.Значение, ".", ""), 8);
		СтрДатаПодписи = ?(СтрДатаПодписи = "01010001", "        ", СтрДатаПодписи);
		
		Для Ном = 1 По СтрДлина(СтрДатаПодписи) Цикл
			
			Если ЗначениеЗаполнено(ИсходныйМакет.Области.ОргДиректор.Значение) Тогда
				МассивДатаПодписиРук[Ном - 1] = Сред(СтрДатаПодписи, Ном, 1);
			КонецЕсли;	
			Если ЗначениеЗаполнено(ИсходныйМакет.Области.ОргБухгалтер.Значение) Тогда
				МассивДатаПодписиБух[Ном - 1] = Сред(СтрДатаПодписи, Ном, 1);
			КонецЕсли;
			Если ЗначениеЗаполнено(ИсходныйМакет.Области.ОргИндивидуальныйПредприниматель.Значение) Тогда
				МассивДатаПодписиИП[Ном - 1] = Сред(СтрДатаПодписи, Ном, 1);
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	ОбщиеРеквизитыРазделов = Новый Структура;
		
	ОбщиеРеквизитыРазделов.Вставить("ИНН", МассивИНН);
	ОбщиеРеквизитыРазделов.Вставить("КПП", МассивКПП);
	ОбщиеРеквизитыРазделов.Вставить("ДатаПодписиРук", МассивДатаПодписиРук);
	ОбщиеРеквизитыРазделов.Вставить("ДатаПодписиБух", МассивДатаПодписиБух);
	ОбщиеРеквизитыРазделов.Вставить("ДатаПодписиИП",  МассивДатаПодписиИП);
	
	Возврат ОбщиеРеквизитыРазделов;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьПечатнуюФорму(ПараметрыПечати, МакетПечатнойФормы, ОбщиеРеквизитыРазделов)
	
	ИсходныйМакет = ТабличныйДокумент;
		
	Для Каждого Область Из ИсходныйМакет.Области Цикл
		
		Если Область.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник
		   И Область.СодержитЗначение И НЕ Область.Имя = "ПризнакФормы" Тогда
			
			Если ПараметрыПечати.ИмяСтраницы = "Титульный" Тогда
				
				Если СтрЧислоВхождений(Область.Имя, "ИНН") > 0
				 ИЛИ СтрЧислоВхождений(Область.Имя, "КПП") > 0
				 ИЛИ СтрЧислоВхождений(Область.Имя, "ДатаПодписи") > 0 Тогда
					
					Продолжить;
					
				ИначеЕсли СтрЧислоВхождений(Область.Имя, "ОтчетныйГод") > 0
					  ИЛИ СтрЧислоВхождений(Область.Имя, "Прил") > 0
					  ИЛИ СтрЧислоВхождений(Область.Имя, "ПочтовыйИндекс") > 0
					  ИЛИ СтрЧислоВхождений(Область.Имя, "КодРегиона") > 0 Тогда
					
					Для Ном = 1 По СтрДлина(Область.Значение) Цикл
						
						МакетПечатнойФормы.Области[Область.Имя + Ном].Значение = Сред(Область.Значение, Ном, 1);
						
					КонецЦикла;
					
					Продолжить;
					
				ИначеЕсли СтрЧислоВхождений(Область.Имя, "НомКорр") > 0 Тогда
					
					НомерКорр = Формат(Область.Значение, "ЧЦ=2; ЧН=00; ЧВН=");
					
					Если НомерКорр = "00" Тогда
						НомерКорр = СтрЗаменить(НомерКорр, 0, " ");
					КонецЕсли;
					
					Для Ном = 1 По СтрДлина(НомерКорр) Цикл
						МакетПечатнойФормы.Области[Область.Имя + Ном].Значение = Сред(НомерКорр, Ном, 1);
					КонецЦикла;
					
					Продолжить;
					
				ИначеЕсли СтрЧислоВхождений(Область.Имя, "ВидДокументаПервичный") > 0
					  ИЛИ СтрЧислоВхождений(Область.Имя, "ВидДокументаКорректирующий") > 0 Тогда
					
					Продолжить;
					
				КонецЕсли;
				
				ЭтоКоррДокумент = ?(СтруктураРеквизитовФормы.ВидДокумента = 0, Ложь, Истина);
				
				МакетПечатнойФормы.Области.ВидДокументаПервичный.Значение = ?(ЭтоКоррДокумент, "", "V");
				МакетПечатнойФормы.Области.ВидДокументаКорректирующий.Значение = ?(ЭтоКоррДокумент, "V", "");
				
			ИначеЕсли ПараметрыПечати.ИмяСтраницы = "Лицензии" Тогда
				
				Если (СтрЧислоВхождений(Область.Имя, "П000000000201") > 0  
					ИЛИ СтрЧислоВхождений(Область.Имя, "П000000000202") > 0
					ИЛИ СтрЧислоВхождений(Область.Имя, "П000000000203") > 0) Тогда
					
					Если Не ПустаяСтрока(Область.Значение) Тогда
						Для Ном = 1 По СтрДлина(Область.Значение) Цикл
							МакетПечатнойФормы.Области[Лев(Область.Имя, 14) + Ном + "_" + Прав(Область.Имя, 1)].Значение = Сред(Область.Значение, Ном, 1);
						КонецЦикла;
					КонецЕсли;
					
					Продолжить;     				
					
				КонецЕсли;

			КонецЕсли;
			
			МакетПечатнойФормы.Области[Область.Имя].Значение = Область.Значение;
			
		КонецЕсли;
		
	КонецЦикла;
		
	Для Каждого Реквизит Из ОбщиеРеквизитыРазделов Цикл
		
		Индекс = 1;
		Постфикс = "_1";
		Разделитель = Истина;
		
		Если Реквизит.Ключ = "ДатаПодписиРук" Тогда
			Постфикс = "1";
			Разделитель = Ложь;
			Если ПараметрыПечати.ИмяСтраницы = "Титульный" Тогда
				НаименованиеОбласти = "ДатаПодписиРук";
			Иначе
				НаименованиеОбласти = "ДатаПодписи";
			КонецЕсли;
		ИначеЕсли Реквизит.Ключ = "ДатаПодписиБух" Тогда
			Постфикс = "1";
			Разделитель = Ложь;
			Если ПараметрыПечати.ИмяСтраницы = "Титульный" Тогда
				НаименованиеОбласти = "ДатаПодписиБух";
			Иначе
				НаименованиеОбласти = "ДатаПодписи";
			КонецЕсли;
		Иначе
			НаименованиеОбласти = Реквизит.Ключ + Индекс;
		КонецЕсли;
		
		Пока НЕ МакетПечатнойФормы.Области.Найти(НаименованиеОбласти + Постфикс) = Неопределено Цикл
			
			Для Ном = 1 По Реквизит.Значение.Количество() Цикл
				НомСтр = Формат(Ном, "ЧГ=");
				Если ЗначениеЗаполнено(Реквизит.Значение[Ном - 1]) Тогда
					МакетПечатнойФормы.Области[НаименованиеОбласти + ?(Разделитель, "_", "") + НомСтр].Значение = Реквизит.Значение[Ном - 1];
				КонецЕсли;
			КонецЦикла;
			
			Индекс = Индекс + 1;
			
			НаименованиеОбласти = Реквизит.Ключ + Индекс;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьАвто(Команда)
	
	Отказ = Ложь;
	
	ДополнительныеПараметры = Новый Структура();
	ДополнительныеПараметры.Вставить("Команда", Команда);
	ОписаниеОповещения = Новый ОписаниеОповещения("ЗаполнитьАвтоЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередЗаполнениемРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьАвтоЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	Команда = ДополнительныеПараметры.Команда;
	
	ЗаполнитьАвтоНаСервере();
	
	СтруктураРеквизитовФормы.ВыводитьСтраницуВТаблДокНаСервере = Ложь;
	
	РегламентированнаяОтчетностьКлиент.ОбновитьДеревоРазделовВФормеОтчета(ЭтаФорма);
	
	Если НЕ Элементы.РазделыОтчета.ТекущиеДанные.ПолучитьРодителя() = Неопределено Тогда
		Элементы.РазделыОтчета.ТекущаяСтрока = Элементы.РазделыОтчета.ТекущиеДанные.ПолучитьРодителя().ПолучитьЭлементы()[0].ПолучитьИдентификатор();
	КонецЕсли;
	
	Если Элементы.Расшифровать.Видимость Тогда
		Элементы.Расшифровать.Доступность = Истина;
		Элементы.ТабличныйДокументКонтекстноеМенюРасшифровать.Доступность = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьАвтоНаСервере()
	
	СохранитьДанныеРаздела(СтруктураРеквизитовФормы.НаимТекущегоРаздела, Ложь);
	
	ЗаполнитьПустыеСтруктурыДанных();	
	
	ПараметрыОтчета = Новый Структура();
	ПараметрыОтчета.Вставить("Организация", 			 СтруктураРеквизитовФормы.Организация);
	ПараметрыОтчета.Вставить("мДатаНачалаПериодаОтчета", СтруктураРеквизитовФормы.мДатаНачалаПериодаОтчета);
	ПараметрыОтчета.Вставить("мДатаКонцаПериодаОтчета",  СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	ПараметрыОтчета.Вставить("АдресВременногоХранилищаРасшифровки"); // Адрес временного хранилища, где размещена расшифровка результата автозаполнения.

	Контейнер = Новый Структура();
	Контейнер.Вставить("Раздел1", ТаблицаСтраницыРаздел1);
	Контейнер.Вставить("Раздел2", ТаблицаСтраницыРаздел2);
	Контейнер.Вставить("Раздел1_ДанныеДопСтрок1", П0000100001);
	Контейнер.Вставить("Раздел1_ХранилищеДанныхДопСтрок1", ХранилищеП0000100001);
	Контейнер.Вставить("Раздел1_ДанныеДопСтрок2", П0000100003);
	Контейнер.Вставить("Раздел1_ХранилищеДанныхДопСтрок2", ХранилищеП0000100003);
	Контейнер.Вставить("Раздел2_ДанныеДопСтрок1", П0000200001);
	Контейнер.Вставить("Раздел2_ХранилищеДанныхДопСтрок1", ХранилищеП0000200001);
	Контейнер.Вставить("Раздел2_ДанныеДопСтрок2", П0000200003);
	Контейнер.Вставить("Раздел2_ХранилищеДанныхДопСтрок2", ХранилищеП0000200003);
	
	РегламентированнаяОтчетностьПереопределяемый.ЗаполнитьОтчет(Сред(Лев(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7), Сред(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, ".Форма.") + 7), ПараметрыОтчета, Контейнер);
	
	СтруктураРеквизитовФормы.АдресВременногоХранилищаРасшифровки = ПараметрыОтчета.АдресВременногоХранилищаРасшифровки;

	ВывестиМакетВТаблДокНаСервере(СтруктураРеквизитовФормы.НаимТекущегоРаздела, 1);
		
	РасчетНаСервере();
	
	Модифицированность = Истина;
		
КонецПроцедуры

&НаКлиенте
Процедура Расшифровать(Команда)
	
	ПараметрыОтчета = Новый Структура();
	ПараметрыОтчета.Вставить("Организация", 				    	СтруктураРеквизитовФормы.Организация);
	ПараметрыОтчета.Вставить("мДатаНачалаПериодаОтчета",			СтруктураРеквизитовФормы.мДатаНачалаПериодаОтчета);
	ПараметрыОтчета.Вставить("мДатаКонцаПериодаОтчета",             СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	ПараметрыОтчета.Вставить("АдресВременногоХранилищаРасшифровки", СтруктураРеквизитовФормы.АдресВременногоХранилищаРасшифровки);
	
	ИДИменПоказателей = Новый Массив();
	ИДИменПоказателей.Добавить(Элементы.ТабличныйДокумент.ТекущаяОбласть.Имя);
	
	РегламентированнаяОтчетностьКлиент.ОткрытьРасшифровкуОтчета(Сред(Лев(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7), Сред(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, ".Форма.") + 7), ИДИменПоказателей, ПараметрыОтчета)
	
КонецПроцедуры

&НаКлиенте
Функция ОпределитьТабличноеПолеПоИдМногострочногоРазделаНаКлиенте(ИдГруппы) Экспорт
	
	ИдГрупп = Новый Структура;
	ИдГрупп.Вставить("мИдГруппы11", СтруктураРеквизитовФормы.мИдГруппы11);
	ИдГрупп.Вставить("мИдГруппы12", СтруктураРеквизитовФормы.мИдГруппы12);
	ИдГрупп.Вставить("мИдГруппы21", СтруктураРеквизитовФормы.мИдГруппы21);
	ИдГрупп.Вставить("мИдГруппы22", СтруктураРеквизитовФормы.мИдГруппы22);
			
	Возврат ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИдГруппы, ИдГрупп);
		
КонецФункции

&НаСервере
Функция ОпределитьТабличноеПолеПоИдМногострочногоРазделаНаСервере(ИдГруппы) Экспорт
	
	ИдГрупп = Новый Структура;
	ИдГрупп.Вставить("мИдГруппы11", СтруктураРеквизитовФормы.мИдГруппы11);
	ИдГрупп.Вставить("мИдГруппы12", СтруктураРеквизитовФормы.мИдГруппы12);
	ИдГрупп.Вставить("мИдГруппы21", СтруктураРеквизитовФормы.мИдГруппы21);
	ИдГрупп.Вставить("мИдГруппы22", СтруктураРеквизитовФормы.мИдГруппы22);
		
	Возврат ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИдГруппы, ИдГрупп);
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИдГруппы, ИдГрупп) Экспорт
	
	Перем ТекТабличноеПоле;
		
	Если ИдГруппы = ИдГрупп.мИдГруппы11
	 ИЛИ ИдГруппы = ИдГрупп.мИдГруппы12 Тогда
		
		ТекТабличноеПоле = "Раздел1";
		
	ИначеЕсли ИдГруппы = ИдГрупп.мИдГруппы21
		  ИЛИ ИдГруппы = ИдГрупп.мИдГруппы22 Тогда
		
		ТекТабличноеПоле = "Раздел2";
		
	КонецЕсли;
	
	Возврат ТекТабличноеПоле;
	
КонецФункции

&НаСервере
Процедура ОставитьВТаблицеТребуемыйКодПродукции(ТаблицаИсточник, ТаблицаПриемник, Поле, Условие, КолонкаИНН) Экспорт

	// Заполним значения в совпадающих колонках.
	Для каждого СтрокаТаблицыИсточника Из ТаблицаИсточник Цикл

		Если (СтрокаТаблицыИсточника[Поле] = Условие) Тогда
			СтрокаТаблицыПриемника = ТаблицаПриемник.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаТаблицыПриемника, СтрокаТаблицыИсточника);
		КонецЕсли;

	КонецЦикла;

КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьПакет(Команда)
	Если НЕ ЗначениеЗаполнено(СтруктураРеквизитовФормы.Организация) Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru = 'Организация не выбрана! Выгрузка невозможна.'");
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьПакетЗавершение", ЭтотОбъект);
	
	Если Модифицированность Тогда
		СохранитьНаКлиенте(,ОписаниеОповещения);
	Иначе
		ВыполнитьОбработкуОповещения(ОписаниеОповещения);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьПакетЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьПакетПослеПолученияКонтекста", ЭтотОбъект);
	ДокументооборотСКОКлиент.ПолучитьКонтекстЭДО(ОписаниеОповещения);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьПакетПослеПолученияКонтекста(Результат, ДополнительныеПараметры) Экспорт
	
	КонтекстЭДОКлиент = Результат.КонтекстЭДО;
	
	ДополнительныеПараметры = Новый Структура("КонтекстЭДОКлиент", КонтекстЭДОКлиент);
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьПакетПослеПолученияКонтекстаЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	КонтекстЭДОКлиент.ВыгрузитьПакетДляОтправкиВФСРАР(ЭтаФорма, ОписаниеОповещения);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьПакетПослеПолученияКонтекстаЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	КонтекстЭДОКлиент = ДополнительныеПараметры.КонтекстЭДОКлиент;
	ИмяВременногоФайлаПакета = Результат.РезультатВыгрузки;
	Если ЗначениеЗаполнено(ИмяВременногоФайлаПакета) Тогда
		ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьПакетПослеСохраненияФайлаНаКлиентеЗавершение", ЭтотОбъект);
		КонтекстЭДОКлиент.СохранитьФайлНаКлиенте(ИмяВременногоФайлаПакета, ОписаниеОповещения);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьПакетПослеСохраненияФайлаНаКлиентеЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	Если Не Результат Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Ошибка при выгрузке пакета'"));
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьМакетФормыОтчета(ИмяРаздела)
	Если СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета < '20140101' Или ИмяРаздела <> "Титульный" Тогда
		ИмяСуффиксаРаздела = "";
	Иначе
		ИмяСуффиксаРаздела = "_20140101";
	КонецЕсли;
	Возврат ОбъектОтчета(ЭтаФорма.ИмяФормы)
	    .ПолучитьМакет(Сред(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, "ФормаОтчета")) + "_" + ИмяРаздела + ИмяСуффиксаРаздела);
КонецФункции

&НаСервере
Функция ПолучитьМакетПечатнойФормы(ИмяРаздела)
	Если СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета < '20140101' Или ИмяРаздела <> "Титульный" Тогда
		ИмяСуффиксаРаздела = "";
	Иначе
		ИмяСуффиксаРаздела = "_20140101";
	КонецЕсли;
	Возврат ОбъектОтчета(ЭтаФорма.ИмяФормы)
	    .ПолучитьМакет("Печатная" + Сред(ЭтаФорма.ИмяФормы, СтрНайти(ЭтаФорма.ИмяФормы, "ФормаОтчета")) + "_" + ИмяРаздела + ИмяСуффиксаРаздела);
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// ОТПРАВКА ОТЧЕТА В ФСРАР

&НаКлиенте
Процедура ПроверитьВИнтернете(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверитьВИнтернетеЗавершение", ЭтотОбъект);

	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
		
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВИнтернетеЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиент.ПроверитьВИнтернете(ЭтаФорма, "ФСРАР");
	
КонецПроцедуры

//
////////////////////////////////////////////////////////////////////////////////

#Область ПанельОтправкиВКонтролирующиеОрганы

&НаКлиенте
Процедура ОбновитьОтправку(Команда)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОбновитьОтправкуИзПанелиОтправки(ЭтаФорма, "ФСРАР");
КонецПроцедуры

&НаКлиенте
Процедура ГиперссылкаПротоколНажатие(Элемент)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОткрытьПротоколИзПанелиОтправки(ЭтаФорма, "ФСРАР");
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьНеотправленноеИзвещение(Команда)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОтправитьНеотправленноеИзвещениеИзПанелиОтправки(ЭтаФорма, "ФСРАР");
КонецПроцедуры

&НаКлиенте
Процедура ЭтапыОтправкиНажатие(Элемент)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОткрытьСостояниеОтправкиИзПанелиОтправки(ЭтаФорма, "ФСРАР");
КонецПроцедуры

&НаКлиенте
Процедура КритическиеОшибкиОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОткрытьКритическиеОшибкиИзПанелиОтправки(ЭтаФорма, "ФСРАР");
КонецПроцедуры

#КонецОбласти

&НаКлиенте
Процедура ОтправитьВКонтролирующийОрган(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверкаВозможностиВыгрузкиРегламентированногоОтчетаПередОтправкой", ЭтотОбъект);
	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередОтправкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверкаВозможностиВыгрузкиРегламентированногоОтчетаПередОтправкой(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ОтправитьВКонтролирующийОрганЗавершение", ЭтотОбъект);
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьВКонтролирующийОрганЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиент.ПриНажатииНаКнопкуОтправкиВКонтролирующийОрган(ЭтаФорма, "ФСРАР");
	
КонецПроцедуры

&НаКлиенте
Процедура  ЗаписатьИЗакрыть(Команда)
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("Форма", ЭтаФорма);
	Оповещение = Новый ОписаниеОповещения("ПослеСохраненияФормыЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	СохранитьНаКлиенте(, Оповещение);
КонецПроцедуры

&НаКлиенте
Процедура ПослеСохраненияФормыЗавершение(Результат, ДополнительныеПараметры) Экспорт
	ДополнительныеПараметры.Форма.Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура ТабличныйДокументПриАктивизацииОбласти(Элемент)
	
	ПерваяСтраница = Истина;
	
	Если ТабличныйДокумент.Области.Найти("ДобавитьСтрокуЗначокТ1") <> Неопределено Тогда
		ДобавитьСтрокуЗначокТ1Верх = ТабличныйДокумент.Области.Найти("ДобавитьСтрокуЗначокТ1").Верх;
		ПерваяСтраница = ТабличныйДокумент.Область("R" + Формат(ДобавитьСтрокуЗначокТ1Верх, "ЧГ=0")).ВысотаСтроки <> 1;
	КонецЕсли;
	
	Если СтрЧислоВхождений(Элемент.ТекущаяОбласть.Имя, "П0000100001") > 0 И ПерваяСтраница
	 ИЛИ СтрЧислоВхождений(Элемент.ТекущаяОбласть.Имя, "П0000100003") > 0
	 ИЛИ СтрЧислоВхождений(Элемент.ТекущаяОбласть.Имя, "П0000200001") > 0 И ПерваяСтраница
	 ИЛИ СтрЧислоВхождений(Элемент.ТекущаяОбласть.Имя, "П0000200003") > 0 Тогда
		
		Элементы.ТабличныйДокументКонтекстноеМенюДобавитьСтроку.Доступность = Истина;
		
		ПозицияЗнакаПодчеркивания = СтрНайти(Элемент.ТекущаяОбласть.Имя, "_");
		
		Если НЕ ПозицияЗнакаПодчеркивания = Неопределено Тогда
			
			КодОбласти = Лев(Элемент.ТекущаяОбласть.Имя, ПозицияЗнакаПодчеркивания);
			
			Если НЕ ТабличныйДокумент.Области.Найти(КодОбласти + "2") = Неопределено Тогда
				Элементы.ТабличныйДокументКонтекстноеМенюУдалитьСтроку.Доступность = Истина;
			Иначе
				Элементы.ТабличныйДокументКонтекстноеМенюУдалитьСтроку.Доступность = Ложь;
			КонецЕсли;
			
		КонецЕсли;
		
	Иначе
		
		Элементы.ТабличныйДокументКонтекстноеМенюДобавитьСтроку.Доступность = Ложь;
		Элементы.ТабличныйДокументКонтекстноеМенюУдалитьСтроку.Доступность  = Ложь;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ОткрытьПрисоединенныеФайлы(Команда)
	
	РегламентированнаяОтчетностьКлиент.СохранитьОтчетИОткрытьФормуПрисоединенныеФайлы(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура КомментарийПриИзменении(Элемент)
	
	Модифицированность = Истина;
	
КонецПроцедуры

&НаСервере
Функция ОбъектОтчета(ЭтаФормаИмя) Экспорт
	
	Если мОбъектОтчета = Неопределено Тогда 
		мОбъектОтчета = РегламентированнаяОтчетностьВызовСервера.ОбъектОтчета(ЭтаФормаИмя);
	КонецЕсли;
	
	Возврат мОбъектОтчета;
	
КонецФункции