Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
	// Форма договора ИТС
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.МенеджерПечати = "Документ.бизЗаключениеДоговораИТС";
	КомандаПечати.Идентификатор = "ДоговорИТС";
	КомандаПечати.Представление = НСтр("ru = 'Договор ИТС'");
	КомандаПечати.СписокФорм    = "ФормаДокумента,ФормаСписка";
	КомандаПечати.ПроверкаПроведенияПередПечатью = Истина;
	КомандаПечати.Картинка = БиблиотекаКартинок.ФорматMXL;
	
	//Форма дополнительного соглашения о переходе на абонементную форму оплаты
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.МенеджерПечати = "Документ.бизЗаключениеДоговораИТС";
	КомандаПечати.Идентификатор = "ДопСоглашениеАбонемент";
	КомандаПечати.Представление = НСтр("ru = 'Доп. соглашение о переходе на абонемент'");
	КомандаПечати.СписокФорм    = "ФормаДокумента,ФормаСписка";
	КомандаПечати.ПроверкаПроведенияПередПечатью = Истина;
	КомандаПечати.Картинка = БиблиотекаКартинок.ФорматMXL;

	
	
КонецПроцедуры

Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт 	
	
	
	ПараметрыВывода.ДоступнаПечатьПоКомплектно = Истина;
	
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ДоговорИТС") Тогда
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "ДоговорИТС", "Доп. соглашение о переходе на абонемент", 
		СформироватьПечатнуюФормуДоговораИТС(МассивОбъектов, ОбъектыПечати),,"ОбщийМакет.бизДоговорИТС");
	КонецЕсли;
	
		
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ДопСоглашениеАбонемент") Тогда
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "ДопСоглашениеАбонемент", "Договор ИТС", 
		СформироватьПечФормуДопСоглашенияАбонемент(МассивОбъектов, ОбъектыПечати),,"Документ.бизЗаключениеДоговораИТС.бизДопСоглашениеАбонемент");
	КонецЕсли;

	
	
КонецПроцедуры

Функция СформироватьПечатнуюФормуДоговораИТС(МассивОбъектов, ОбъектыПечати)
	
	Для каждого ДокументДоговорИТС Из МассивОбъектов Цикл
		
		ТабДок = Новый ТабличныйДокумент;
		ТабДок.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
		ТабДок.АвтоМасштаб = Истина;
		
		ТабДок.ПолеСверху = 10;
		Табдок.ПолеСнизу = 15;
		Табдок.ПолеСправа = 5;
		Табдок.ПолеСлева = 10;
		ТабДок.РазборПоКопиям = Истина;
		
		
		Макет = УправлениеПечатью.МакетПечатнойФормы("Документ.бизЗаключениеДоговораИТС.бизДоговорИТС");
		ДоговорШапка = Макет.ПолучитьОбласть("ДоговорШапка");
		ДоговорПункт1 = Макет.ПолучитьОбласть("ДоговорПункт1");
		//Пукнт2
		Договор2Пункт2_1 = Макет.ПолучитьОбласть("Договор2Пункт2_1");
		Договор2Пункт2_4 = Макет.ПолучитьОбласть("Договор2Пункт2_4");
		Договор2Пункт2_41 = Макет.ПолучитьОбласть("Договор2Пункт2_41");
		Договор2Пункт2_5 = Макет.ПолучитьОбласть("Договор2Пункт2_5");
		Договор2Пункт2_6 = Макет.ПолучитьОбласть("Договор2Пункт2_6");
		Договор2Пункт2_7 = Макет.ПолучитьОбласть("Договор2Пункт2_7");
		Договор2Пункт2_8 = Макет.ПолучитьОбласть("Договор2Пункт2_8");
		Договор2Пункт2_9 = Макет.ПолучитьОбласть("Договор2Пункт2_9");
		Договор2Пункт2_10 = Макет.ПолучитьОбласть("Договор2Пункт2_10");
		Договор2Пункт2_10 = Макет.ПолучитьОбласть("Договор2Пункт2_10");
		Договор2Пункт2_11 = Макет.ПолучитьОбласть("Договор2Пункт2_11");
		//Пункт3
		Договор3Пункт3_1 = Макет.ПолучитьОбласть("Договор3Пункт3_1");
		Договор3Пункт3_2 =  Макет.ПолучитьОбласть("Договор3Пункт3_2");
		Договор3Пункт3_3_1 =  Макет.ПолучитьОбласть("Договор3Пункт3_3_1");
		Договор3Пункт3_3_2 =  Макет.ПолучитьОбласть("Договор3Пункт3_3_2");
		Договор3Пункт3_4 =  Макет.ПолучитьОбласть("Договор3Пункт3_4");
		//Пункт4
		ДоговорПункт4_1 = Макет.ПолучитьОбласть("ДоговорПункт4_1");
		ДоговорПункт4_2 = Макет.ПолучитьОбласть("ДоговорПункт4_2");
		ДоговорПункт4_3 = Макет.ПолучитьОбласть("ДоговорПункт4_3");
		ДоговорПункт4_4 = Макет.ПолучитьОбласть("ДоговорПункт4_4");
		ДоговорПункт4_5 = Макет.ПолучитьОбласть("ДоговорПункт4_5");
		Договор5_пункт4 = Макет.ПолучитьОбласть("Договор5_пункт4");
		Договор5_пункт4_доп = Макет.ПолучитьОбласть("Договор5_пункт4_доп");
		
		Приложение1Шапка = Макет.ПолучитьОбласть("Приложение1Шапка");
		Приложение1ТЧ = Макет.ПолучитьОбласть("Приложение1ТЧ");
		Приложение2Шапка = Макет.ПолучитьОбласть("Приложение2Шапка");
		Приложение2ТЧ = Макет.ПолучитьОбласть("Приложение2ТЧ");
		Приложение2Подвал = Макет.ПолучитьОбласть("Приложение2Подвал");
		
		ПараметрыЗаполнения = ПолучитьУниверсальнуюСтруктуруПараметровЗаполнения();
		Выборка = ПолучитьВыборкуИзДоговораИТС(ДокументДоговорИТС);
		НомерСтраницы = 0;
		Пока Выборка.Следующий()Цикл
			
			
			//Заполнить шапку договора
			ЗаполнитьЗначенияСвойств(ПараметрыЗаполнения,Выборка);	
			ПараметрыЗаполнения.НомерДоговора = ПрефиксацияОбъектовКлиентСервер.ПолучитьНомерНаПечать(ПараметрыЗаполнения.НомерДоговора,Истина);
			ПараметрыЗаполнения.ДоговораДата = Формат(Выборка.ДоговораДата,"ДЛФ=DD");
			ПараметрыЗаполнения.ВступаетВСилуСДата = Формат(Выборка.ВступаетВСилуСДата, "ДЛФ=DD");
			МассивСлов = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивСлов(СокрЛП(ПараметрыЗаполнения.ОрганизацияГород)," ");
			ПараметрыЗаполнения.ОрганизацияГород ="г. " + МассивСлов[0];
			ДоговорШапка.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(ДоговорШапка);
			
			//Заполнить сведения о ПП 1С, которые будут сопровождаться в рамках данного договора
			ВыборкаПП = Выборка.ПрограммыНаСопровождении.Выбрать();
			ПредставлениеПродукта = "";
			Пока ВыборкаПП.Следующий() Цикл
				Если ВыборкаПП.ВключитьВДоговор Тогда
					ПредставлениеПродукта =ПредставлениеПродукта+"«"+ВыборкаПП.Продукт+"», регистрационный номер "+ВыборкаПП.РегНомер+", ";
				КонецЕсли;
			КонецЦикла;
			ПараметрыЗаполнения.ПредставлениеПродукта = ПредставлениеПродукта;
			ДоговорПункт1.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(ДоговорПункт1);
			
			МассивОбластей = Новый Массив;
			
			ТабДок.Вывести(Договор2Пункт2_1);
			
			МассивОбластей.Добавить(Договор2Пункт2_4);
			МассивОбластей.Добавить(Договор2Пункт2_41);
			МассивОбластей.Добавить(Договор2Пункт2_5);
			МассивОбластей.Добавить(Договор2Пункт2_6);
			МассивОбластей.Добавить(Договор2Пункт2_7);
			МассивОбластей.Добавить(Договор2Пункт2_8);
			МассивОбластей.Добавить(Договор2Пункт2_9);
			МассивОбластей.Добавить(Договор2Пункт2_10);
			МассивОбластей.Добавить(Договор2Пункт2_11);
			МассивОбластей.Добавить(Договор3Пункт3_1);
			МассивОбластей.Добавить(Договор3Пункт3_2);
			МассивОбластей.Добавить(Договор3Пункт3_3_1);
			МассивОбластей.Добавить(Договор3Пункт3_3_2);
			МассивОбластей.Добавить(Договор3Пункт3_4);

			
			
			//Сформировать сведения о дате окончания договора
			ПараметрыЗаполнения.КонецГодаДатаДоговора = Формат(Выборка.КонецГодаДатаДоговора,"ДЛФ=DD");
			ДоговорПункт4_1.Параметры.Заполнить(ПараметрыЗаполнения);
			МассивОбластей.Добавить(ДоговорПункт4_1);	
			МассивОбластей.Добавить(ДоговорПункт4_2);
			МассивОбластей.Добавить(ДоговорПункт4_3);
			МассивОбластей.Добавить(ДоговорПункт4_4);
			МассивОбластей.Добавить(Договор5_пункт4);
			МассивОбластей.Добавить(Договор5_пункт4_доп);			
			
			//Сформировать сведения об основном банковском счете сторон договора
			СведенияОбОрганизации = УправлениеНебольшойФирмойСервер.СведенияОЮрФизЛице(Выборка.ОрганизацияСсылка, Выборка.ДоговораДата);
			ПараметрыЗаполнения.ОрганизацияБанк = УправлениеНебольшойФирмойСервер.ОписаниеОрганизации(СведенияОбОрганизации,"НомерСчета,Банк,БИК,КоррСчет");
			СведенияОКонтрагенте = УправлениеНебольшойФирмойСервер.СведенияОЮрФизЛице(Выборка.КонтрагентСсылка, Выборка.ДоговораДата);
			ПараметрыЗаполнения.КонтрагентБанк = УправлениеНебольшойФирмойСервер.ОписаниеОрганизации(СведенияОКонтрагенте,"НомерСчета,Банк,БИК,КоррСчет");
			//Сформировать сведения о подписантах договора
			ПараметрыЗаполнения.ОрганизацияРуководительКратк = ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(Выборка.ОрганизацияРуководитель.ФизЛицо.Наименование);
			ПараметрыЗаполнения.КонтрагентРуководительКратк = ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(Выборка.КонтрагентРуководитель);
			ДоговорПункт4_5.Параметры.Заполнить(ПараметрыЗаполнения);
			МассивОбластей.Добавить(ДоговорПункт4_5);
			
			Для каждого Область Из МассивОбластей Цикл
				Если Область = Договор5_пункт4_доп Тогда
					Пока  ТабДок.ПроверитьВывод(Область) Цикл
						ТабДок.Вывести(Область);	
					КонецЦикла;
					ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
				ИначеЕсли НЕ ТабДок.ПроверитьВывод(Область)Тогда
					ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
					ТабДок.Вывести(Область);
				Иначе ТабДок.Вывести(Область);
				КонецЕсли;
				
			КонецЦикла;
			
			
			ТабДок.НижнийКолонтитул.ВертикальноеПоложение = ВертикальноеПоложение.Центр;
			ТабДок.НижнийКолонтитул.ТекстСлева = "От исполнителя_________________/" + ПараметрыЗаполнения.ОрганизацияРуководительКратк;
			ТабДок.НижнийКолонтитул.ТекстСправа =  "От заказчика, ознакомлен(а)_________________/"+ ПараметрыЗаполнения.КонтрагентРуководительКратк;
			ТабДок.НижнийКолонтитул.ТекстВЦентре =  "[&НомерСтраницы]";
			ТабДок.НижнийКолонтитул.Выводить = Истина;
			
			//Приложение 1
			ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
			Приложение1Шапка.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(Приложение1Шапка);
			Приложение1ТЧ.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(Приложение1ТЧ);
			
			ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
			Приложение2Шапка.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(Приложение2Шапка);
			Приложение2ТЧ.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(Приложение2ТЧ);
			Приложение2Подвал.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(Приложение2Подвал);
			
			НомерСтрокиНачало = 1;
			УправлениеПечатью.ЗадатьОбластьПечатиДокумента(ТабДок, НомерСтрокиНачало, ОбъектыПечати, ДокументДоговорИТС);	
			
		КонецЦикла;
		
		
		Возврат ТабДок;
		
	КонецЦикла;

КонецФункции // СформироватьПечатнуюФормуДоговораИТС(МассивОбъектов, ОбъектыПечати)

Процедура УправлятьВыводомРазделителяСтраниц(ТабДок,МассивВыводимыхОбластей)

	Если НЕ ТабДок.ПроверитьВывод(МассивВыводимыхОбластей) Тогда
		ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
	КонецЕсли;

КонецПроцедуры

Функция ПолучитьВыборкуИзДоговораИТС(ДокументДоговорИТС)

	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА ОрганизацииКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ЮрАдресОрганизации)
	               |				ТОГДА ОрганизацииКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК ОрганизацияАдрес,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА ОрганизацииКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресОрганизации)
	               |				ТОГДА ОрганизацииКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК ОрганизацияФактАдрес,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА ОрганизацииКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонОрганизации)
	               |				ТОГДА ОрганизацииКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК ОрганизацияТелефон,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА ОрганизацииКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.EmailОрганизации)
	               |				ТОГДА ОрганизацииКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК ОрганизацияЕМэйл,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА КонтрагентыКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ЮрАдресКонтрагента)
	               |				ТОГДА КонтрагентыКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК КонтрагентАдрес,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА КонтрагентыКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресКонтрагента)
	               |				ТОГДА КонтрагентыКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК КонтрагентФактАдрес,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА КонтрагентыКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонКонтрагента)
	               |				ТОГДА КонтрагентыКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК КонтрагентТелефон,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА КонтрагентыКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.EmailКонтрагента)
	               |				ТОГДА КонтрагентыКонтактнаяИнформация.Представление
	               |		КОНЕЦ) КАК КонтрагентЕМэйл,
	               |	ОрганизацииКонтактнаяИнформация.Ссылка КАК ОрганизацияСсылка,
	               |	КонтрагентыКонтактнаяИнформация.Ссылка КАК КонтрагентСсылка,
	               |	МАКСИМУМ(ОрганизацииКонтактнаяИнформация.Город) КАК ОрганизацияГород
	               |ПОМЕСТИТЬ КонтактнаяИнформация
	               |ИЗ
	               |	Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация,
	               |	Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
	               |ГДЕ
	               |	КонтрагентыКонтактнаяИнформация.Ссылка = &Контрагент
	               |	И ОрганизацииКонтактнаяИнформация.Ссылка = &Организация
	               |	И КонтрагентыКонтактнаяИнформация.Тип В (ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес), ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон), ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ОрганизацииКонтактнаяИнформация.Ссылка,
	               |	КонтрагентыКонтактнаяИнформация.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	бизЗаключениеДоговораИТС.Номер КАК НомерДоговора,
	               |	бизЗаключениеДоговораИТС.Дата КАК ДоговораДата,
	               |	бизЗаключениеДоговораИТС.ОрганизацияПолное,
	               |	бизЗаключениеДоговораИТС.КонтрагентПолное,
	               |	ВЫБОР
	               |		КОГДА бизЗаключениеДоговораИТС.Контрагент.ВидКонтрагента = ЗНАЧЕНИЕ(Перечисление.ВидыКонтрагентов.ЮридическоеЛицо)
	               |			ТОГДА "", действующего на основании "" + бизЗаключениеДоговораИТС.ДействующегоНаКонтрагент + "", именуемого""
	               |		ИНАЧЕ "", действующий на основании "" + бизЗаключениеДоговораИТС.ДействующегоНаКонтрагент + "", именуемый""
	               |	КОНЕЦ КАК ДействующегоНаКонтрагент,
	               |	бизЗаключениеДоговораИТС.ДействующегоНаОрганизация,
	               |	бизЗаключениеДоговораИТС.ОрганизацияВлице,
	               |	ВЫБОР
	               |		КОГДА бизЗаключениеДоговораИТС.Контрагент.ВидКонтрагента = ЗНАЧЕНИЕ(Перечисление.ВидыКонтрагентов.ЮридическоеЛицо)
	               |			ТОГДА "", в лице "" + бизЗаключениеДоговораИТС.КонтрагентВЛице
	               |		ИНАЧЕ """"
	               |	КОНЕЦ КАК КонтрагентВЛице,
	               |	бизЗаключениеДоговораИТС.ПрограммыНаСопровождении.(
	               |		ППНаСопровождении КАК Продукт,
	               |		РегНомер,
	               |		ВключитьВДоговор
	               |	),
	               |	КОНЕЦПЕРИОДА(бизЗаключениеДоговораИТС.ВступаетВСилуСДата, ГОД) КАК КонецГодаДатаДоговора,
	               |	бизЗаключениеДоговораИТС.Организация.НаименованиеПолное КАК Организация,
	               |	бизЗаключениеДоговораИТС.Контрагент.НаименованиеПолное КАК Контрагент,
	               |	бизЗаключениеДоговораИТС.Организация.ИНН + ""/"" + бизЗаключениеДоговораИТС.Организация.КПП КАК ОрганизацияИННКПП,
	               |	бизЗаключениеДоговораИТС.Контрагент.ИНН + ""/"" + бизЗаключениеДоговораИТС.Контрагент.КПП КАК КонтрагентИННКПП,
	               |	бизЗаключениеДоговораИТС.Организация.Ссылка,
	               |	бизЗаключениеДоговораИТС.Контрагент.Ссылка,
	               |	ОтветственныеЛицаСрезПоследних.Сотрудник КАК ОрганизацияРуководитель,
	               |	ОтветственныеЛицаСрезПоследних.Должность КАК ОрганизацияДолжность,
	               |	бизЗаключениеДоговораИТС.Контрагент.КонтактноеЛицо.Наименование КАК КонтрагентРуководитель,
	               |	КонтактныеЛицаРолиКонтактногоЛица.Роль КАК КонтрагентДолжность,
	               |	бизЗаключениеДоговораИТС.Контрагент.КодПоОКПО,
	               |	бизЗаключениеДоговораИТС.Организация.КодПоОКПО,
	               |	КонтактнаяИнформация.ОрганизацияАдрес,
	               |	КонтактнаяИнформация.ОрганизацияФактАдрес,
	               |	КонтактнаяИнформация.ОрганизацияТелефон,
	               |	КонтактнаяИнформация.ОрганизацияЕМэйл,
	               |	КонтактнаяИнформация.КонтрагентАдрес,
	               |	КонтактнаяИнформация.КонтрагентФактАдрес,
	               |	КонтактнаяИнформация.КонтрагентТелефон,
	               |	КонтактнаяИнформация.КонтрагентЕМэйл,
	               |	КонтактнаяИнформация.ОрганизацияГород,
	               |	бизЗаключениеДоговораИТС.ВступаетВСилуСДата
	               |ИЗ
	               |	Документ.бизЗаключениеДоговораИТС КАК бизЗаключениеДоговораИТС
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ОтветственныеЛица.СрезПоследних(&ДатаДоговораИТС, ) КАК ОтветственныеЛицаСрезПоследних
	               |		ПО бизЗаключениеДоговораИТС.Организация = ОтветственныеЛицаСрезПоследних.Организация
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КонтактныеЛица.Роли КАК КонтактныеЛицаРолиКонтактногоЛица
	               |		ПО бизЗаключениеДоговораИТС.Контрагент.КонтактноеЛицо = КонтактныеЛицаРолиКонтактногоЛица.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ КонтактнаяИнформация КАК КонтактнаяИнформация
	               |		ПО бизЗаключениеДоговораИТС.Организация = КонтактнаяИнформация.ОрганизацияСсылка
	               |ГДЕ
	               |	бизЗаключениеДоговораИТС.Ссылка = &Ссылка
	               |	И ОтветственныеЛицаСрезПоследних.ТипОтветственногоЛица = ЗНАЧЕНИЕ(Перечисление.ТипыОтветственныхЛиц.Руководитель)
	               |	И бизЗаключениеДоговораИТС.Организация = &Организация";
	Запрос.УстановитьПараметр("Ссылка", ДокументДоговорИТС);
	Запрос.УстановитьПараметр("ДатаДоговораИТС", ДокументДоговорИТС.Дата);
	Запрос.УстановитьПараметр("Контрагент",ДокументДоговорИТС.Контрагент);
	Запрос.УстановитьПараметр("Организация",ДокументДоговорИТС.Организация);
	Выборка = Запрос.Выполнить().Выбрать();
	
	Возврат Выборка;
КонецФункции // ПолучитьВыборкуИзДоговораИТС()

Функция ПолучитьУниверсальнуюСтруктуруПараметровЗаполнения()

	ПараметрыЗаполнения = Новый Структура("НомерДоговора,ДоговораДата,ОрганизацияПолное,КонтрагентПолное,
	|ДействующегоНаКонтрагент,ДействующегоНаОрганизация,ОрганизацияВЛице,КонтрагентВЛице,ОрганизацияГород,
	|ПредставлениеПродукта,КонецГодаДатаДоговора,Организация,Контрагент,ОрганизацияИННКПП,КонтрагентИННКПП,
	|ОрганизацияАдрес,КонтрагентАдрес,ОрганизацияБанк,КонтрагентБанк,ОрганизацияРуководитель,ОрганизацияДолжность,
	|ОрганизацияРуководительКратк, КонтрагентРуководитель,КонтрагентДолжность,КонтрагентРуководительКратк,
	|ОрганизацияКодПоОКПО,КонтрагентКодПоОКПО,ОрганизацияФактАдрес,КонтрагентФактАдрес,ОрганизацияТелефон,КонтрагентТелефон,
	|ОрганизацияЕмэйл,КонтрагентЕмэйл,ТарифАбонемента,КоличествоЧасовАбонемента,СуммаАбонемента,ВступаетВСилуСДата");

	Возврат ПараметрыЗаполнения;

КонецФункции // Получить()

Функция СформироватьПечФормуДопСоглашенияАбонемент(МассивОбъектов, ОбъектыПечати)

	Для каждого ДокументДоговорИТС Из МассивОбъектов Цикл
		
		//Создать табличный документ, задать его параметры, подключить макет для заполнения вывести все области макета, предварительно заполнив их данными
		ТабДок = Новый ТабличныйДокумент;
		ТабДок.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
		ТабДок.АвтоМасштаб = Истина;
		
		ТабДок.ПолеСверху = 10;
		Табдок.ПолеСнизу = 15;
		Табдок.ПолеСправа = 5;
		Табдок.ПолеСлева = 10;
		ТабДок.РазборПоКопиям = Истина;		
		
		//Получить выборку данных из документа Договора ИТС в итераторе данного цикла
		Выборка = ПолучитьВыборкуИзДоговораИТС(ДокументДоговорИТС);
		
		ПараметрыЗаполнения = ПолучитьУниверсальнуюСтруктуруПараметровЗаполнения();
		
		Пока Выборка.Следующий() Цикл		
			Макет = УправлениеПечатью.ПолучитьМакет("Документ.бизЗаключениеДоговораИТС.бизДопСоглашениеАбонемент");
			
			Шапка = Макет.ПолучитьОбласть("Шапка");
			
			//Заполнить шапку договора
			ЗаполнитьЗначенияСвойств(ПараметрыЗаполнения,Выборка);	
			ПараметрыЗаполнения.НомерДоговора = ПрефиксацияОбъектовКлиентСервер.ПолучитьНомерНаПечать(ПараметрыЗаполнения.НомерДоговора,Истина);
			ПараметрыЗаполнения.ДоговораДата = Формат(Выборка.ДоговораДата,"ДЛФ=DD");
			МассивСлов = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивСлов(СокрЛП(ПараметрыЗаполнения.ОрганизацияГород)," ");
			ПараметрыЗаполнения.ОрганизацияГород ="г. " + МассивСлов[0];
			Шапка.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(Шапка);

			ОсновнойТекст = Макет.ПолучитьОбласть("ОсновнойТекст");
			ПараметрыЗаполнения.ВступаетВСилуСДата = Формат (ДокументДоговорИТС.ВступаетВСилуСДата,"ДФ=dd.MM.yyyy");
			ПараметрыЗаполнения.ТарифАбонемента = ""+Формат(ДокументДоговорИТС.ТарифАбонемента,"ЧДЦ=2");
			ПараметрыЗаполнения.КоличествоЧасовАбонемента = "" + ДокументДоговорИТС.КоличествоЧасовАбонемента + " астрономических часов (60 мин.)";
			ПараметрыЗаполнения.СуммаАбонемента = ""+Формат(ДокументДоговорИТС.СуммаАбонемента,"ЧДЦ=2") + " рублей";
			ОсновнойТекст.Параметры.Заполнить(ПараметрыЗаполнения);
			ТабДок.Вывести(ОсновнойТекст);
			
			РеквизитыПодписиСторон = Макет.ПолучитьОбласть ("РеквизитыПодписиСторон");
			
			//Сформировать сведения об основном банковском счете сторон договора
			СведенияОбОрганизации = УправлениеНебольшойФирмойСервер.СведенияОЮрФизЛице(Выборка.ОрганизацияСсылка, Выборка.ДоговораДата);
			ПараметрыЗаполнения.ОрганизацияБанк = УправлениеНебольшойФирмойСервер.ОписаниеОрганизации(СведенияОбОрганизации,"НомерСчета,Банк,БИК,КоррСчет");
			СведенияОКонтрагенте = УправлениеНебольшойФирмойСервер.СведенияОЮрФизЛице(Выборка.КонтрагентСсылка, Выборка.ДоговораДата);
			ПараметрыЗаполнения.КонтрагентБанк = УправлениеНебольшойФирмойСервер.ОписаниеОрганизации(СведенияОКонтрагенте,"НомерСчета,Банк,БИК,КоррСчет");
			//Сформировать сведения о подписантах договора
			ПараметрыЗаполнения.ОрганизацияРуководительКратк = ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(Выборка.ОрганизацияРуководитель.ФизЛицо.Наименование);
			ПараметрыЗаполнения.КонтрагентРуководительКратк = ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(Выборка.КонтрагентРуководитель.Наименование);
			РеквизитыПодписиСторон.Параметры.Заполнить(ПараметрыЗаполнения);
			
			ТабДок.Вывести(РеквизитыПодписиСторон);
		КонецЦикла;
		
		НомерСтрокиНачало = 1;
		УправлениеПечатью.ЗадатьОбластьПечатиДокумента(ТабДок, НомерСтрокиНачало, ОбъектыПечати, ДокументДоговорИТС);
		
	КонецЦикла;
	
	Возврат ТабДок;
	
КонецФункции // СформироватьПечФормуДопСоглашенияАбонемент()



