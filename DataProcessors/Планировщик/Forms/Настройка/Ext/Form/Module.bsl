
////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

// Процедура заполняет реквизиты формы из параметров.
//
&НаСервере
Процедура ЗаполнитьРеквизитыПоПараметрам()
	
	Если Параметры.Свойство("ОграничениеВремениС") Тогда
		ОграничениеВремениС = Параметры.ОграничениеВремениС;
		ОграничениеВремениСПриОткрытии = Параметры.ОграничениеВремениС;
	КонецЕсли;
	
	Если Параметры.Свойство("ОграничениеВремениПо") Тогда
		ОграничениеВремениПо = Параметры.ОграничениеВремениПо;
		ОграничениеВремениПоПриОткрытии = Параметры.ОграничениеВремениПо;
	КонецЕсли;
	
	Если Параметры.Свойство("КратностьДня") Тогда
		КратностьДня = Параметры.КратностьДня;
		КратностьДняПриОткрытии = Параметры.КратностьДня;
	КонецЕсли;
	
	Если Параметры.Свойство("ОтображатьЗаказНаряды") Тогда
		Если Параметры.ОтображатьЗаказНаряды Тогда
			ОтображатьДокументы = "ЗаказНаряды";
			ОтображатьДокументыПриОткрытии = "ЗаказНаряды";
		КонецЕсли
	КонецЕсли;
	
	Если Параметры.Свойство("ОтображатьЗаказыНаПроизводство") Тогда
		Если Параметры.ОтображатьЗаказыНаПроизводство Тогда
			Если ПустаяСтрока(ОтображатьДокументы) Тогда
				ОтображатьДокументы = "ЗаказыНаПроизводство";
				ОтображатьДокументыПриОткрытии = "ЗаказыНаПроизводство";
			Иначе
				ОтображатьДокументы =  "ВсеДокументы";
				ОтображатьДокументыПриОткрытии = "ВсеДокументы";
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если Параметры.Свойство("ПланироватьРаботы") Тогда
		Если Параметры.ПланироватьРаботы Тогда
			Элементы.ОтображаемыеДокументы.СписокВыбора.Удалить(1);
		Иначе
			Элементы.ОтображаемыеДокументы.СписокВыбора.Удалить(0);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры // ПроверитьМодифицированностьФормы()

// Процедура проверяет модифицированность формы.
//
&НаКлиенте
Процедура ПроверитьМодифицированностьФормы()
	
	БылиВнесеныИзменения = Ложь;
	
	ИзмененияОтображатьДокументы = ?(ОтображатьДокументыПриОткрытии <> ОтображатьДокументы, Ложь, Истина);
	ИзмененияОграничениеВремениС = ?(ОграничениеВремениСПриОткрытии <> ОграничениеВремениС, Ложь, Истина);
	ИзмененияОграничениеВремениПо = ?(ОграничениеВремениПоПриОткрытии <> ОграничениеВремениПо, Ложь, Истина);
	ИзмененияКратностьДня = ?(КратностьДняПриОткрытии <> КратностьДня, Ложь, Истина);
	
	Если ИзмененияОтображатьДокументы
	 ИЛИ ИзмененияОграничениеВремениС
	 ИЛИ ИзмененияОграничениеВремениПо
	 ИЛИ ИзмененияКратностьДня Тогда
		БылиВнесеныИзменения = Истина;
	КонецЕсли;
	
КонецПроцедуры // ПроверитьМодифицированностьФормы()

&НаКлиенте
// Процедура позволяет получить списко для выбора времени, разбитого по часам
//
Функция ПолучитьСписокВыбораВремени(ДатаДляВыбора)

	НачалоРабочегоДня      = '00010101000000';
	ОкончаниеРабочегоДня   = '00010101235959';

	СписокВремен = Новый СписокЗначений;
	НачалоРабочегоДня = НачалоЧаса(НачалоДня(ДатаДляВыбора) +
		Час(НачалоРабочегоДня) * 3600 +
		Минута(НачалоРабочегоДня)*60);
	ОкончаниеРабочегоДня = КонецЧаса(НачалоДня(ДатаДляВыбора) +
		Час(ОкончаниеРабочегоДня) * 3600 +
		Минута(ОкончаниеРабочегоДня)*60);

	ВремяСписка = НачалоРабочегоДня;
	Пока НачалоЧаса(ВремяСписка) <= НачалоЧаса(ОкончаниеРабочегоДня) Цикл
		Если НЕ ЗначениеЗаполнено(ВремяСписка) Тогда
			ПредставлениеВремени = "00:00";
		Иначе
			ПредставлениеВремени = Формат(ВремяСписка,"ДФ=ЧЧ:мм");
		КонецЕсли;

		СписокВремен.Добавить(ВремяСписка, ПредставлениеВремени);

		ВремяСписка = ВремяСписка + 3600;
	КонецЦикла;

	Возврат СписокВремен;

КонецФункции // ПолучитьСписокВыбораВремени()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Процедура - обработчик события ПриСозданииНаСервере формы.
// В процедуре осуществляется
// - инициализация параметров формы.
//
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЗаполнитьРеквизитыПоПараметрам();
	
	БылиВнесеныИзменения = Ложь;
	
КонецПроцедуры // ПриСозданииНаСервере()

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	УправлениеНебольшойФирмойКлиентСервер.ЗаполнитьСписокИзСписка(ПолучитьСписокВыбораВремени(ОграничениеВремениС),Элементы.ОграничениеВремениС.СписокВыбора);
	УправлениеНебольшойФирмойКлиентСервер.ЗаполнитьСписокИзСписка(ПолучитьСписокВыбораВремени(ОграничениеВремениПо),Элементы.ОграничениеВремениПо.СписокВыбора);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ДЕЙСТВИЯ КОМАНДНЫХ ПАНЕЛЕЙ ФОРМЫ

// Процедура - обработчик события нажатия кнопки ОК.
//
&НаКлиенте
Процедура КомандаОК(Команда)
	
	ПроверитьМодифицированностьФормы();
	
	СтруктураРеквизитовФормы = Новый Структура;
	
	СтруктураРеквизитовФормы.Вставить("БылиВнесеныИзменения", БылиВнесеныИзменения);
	
	СтруктураРеквизитовФормы.Вставить("ОтображатьЗаказНаряды", ОтображатьДокументы = "ЗаказНаряды");
	СтруктураРеквизитовФормы.Вставить("ОтображатьЗаказыНаПроизводство", ОтображатьДокументы = "ЗаказыНаПроизводство");
	
	Если ОтображатьДокументы = "ВсеДокументы" Тогда
		СтруктураРеквизитовФормы.Вставить("ОтображатьЗаказНаряды", Истина);
		СтруктураРеквизитовФормы.Вставить("ОтображатьЗаказыНаПроизводство", Истина);
	КонецЕсли;
	
	СтруктураРеквизитовФормы.Вставить("ОграничениеВремениС", ОграничениеВремениС);
	СтруктураРеквизитовФормы.Вставить("ОграничениеВремениПо", ОграничениеВремениПо);
	
	СтруктураРеквизитовФормы.Вставить("КратностьДня", КратностьДня);
	
	Закрыть(СтруктураРеквизитовФормы);
	
КонецПроцедуры // КомандаОК()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ ФОРМЫ

// Процедура - обработчик события ПриИзменении реквизита ОграничениеВремениС.
//
&НаКлиенте
Процедура ОграничениеВремениСПриИзменении(Элемент)
	
	Если ОграничениеВремениПо <= ОграничениеВремениС 
		И ОграничениеВремениПо <> '00010101000000'
		И ОграничениеВремениС <> '00010101000000' Тогда
		ОграничениеВремениПо = ОграничениеВремениС + 1800;
		Возврат;
	КонецЕсли;
	
КонецПроцедуры // ОграничениеВремениСПриИзменении()

// Процедура - обработчик события ПриИзменении реквизита ОграничениеВремениПо.
//
&НаКлиенте
Процедура ОграничениеВремениПоПриИзменении(Элемент)
	
	Если ОграничениеВремениПо <= ОграничениеВремениС 
		И ОграничениеВремениПо <> '00010101000000'
		И ОграничениеВремениС <> '00010101000000' Тогда
		Сообщить(НСтр("ru='Время окончания не может быть меньше или равно времени начала.'"));
		ОграничениеВремениПо = ОграничениеВремениС + 1800;
		Возврат;
	КонецЕсли;
	
КонецПроцедуры // ОграничениеВремениПоПриИзменении()
