
#Область СобытияФормы

// Процедура - При создании при чтении на сервере
//
// Параметры:
//  Форма			 - УправляемаяФорма	 - форма для размещения контактной информации
//  ВладелецКИ		 - ЛюбаяСсылка	 - владелец контактной информации
//  ШиринаПоляВида	 - число	 - ширина поля вида контактной информации по умолчанию
//
Процедура ПриСозданииПриЧтенииНаСервере(Форма, Объект = Неопределено, ШиринаПоляВида = 8) Экспорт
	
	Если Объект = Неопределено Тогда
		Объект = Форма.Объект;
	КонецЕсли;
	
	ВладелецКИ = Объект.Ссылка;
	
	// Определение вспомогательной информации
	ПолноеИмяОбъектаМетаданных = ВладелецКИ.Метаданные().ПолноеИмя();
	ГруппаВидовКИ = Справочники.ВидыКонтактнойИнформации[СтрЗаменить(ПолноеИмяОбъектаМетаданных, ".", "")];
	
	// Создание таблиц-реквизитов формы, если отсутствуют
	ДобавитьРеквизитыФормыКонтактнойИнформации(Форма);
	
	// Кэширование информации о доступных видах контактной информации в созданной таблице
	ПрочитатьСвойстваВидовКонтактнойИнформации(Форма, ГруппаВидовКИ);
	
	// Чтение имеющейся контактной информации объекта в созданную таблицу для отображения
	ЗаполнитьТаблицуКонтактнойИнформации(Форма, Объект);
	
	// Однократная подготовка элементов и команд формы
	ИнициализироватьФорму(Форма);
	
	// Пересоздание элементов формы по информации из таблицы для отображения
	ОбновитьЭлементыКонтактнойИнформации(Форма, ШиринаПоляВида);
	
КонецПроцедуры

Процедура ПередЗаписьюНаСервере(Форма, ТекущийОбъект) Экспорт
	
	ТекущийОбъект.КонтактнаяИнформация.Очистить();
	
	Для Каждого ДанныеКИ Из Форма.КонтактнаяИнформация Цикл
		УправлениеКонтактнойИнформацией.ЗаписатьКонтактнуюИнформацию(ТекущийОбъект, ДанныеКИ.ЗначенияПолей, ДанныеКИ.Вид, ДанныеКИ.Тип);
	КонецЦикла;
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполненияНаСервере(Форма, Отказ) Экспорт
	
	ЕстьОшибки = Ложь;
	Отбор = Новый Структура("Вид");
	
	Для Каждого СтрокаТаблицы Из Форма.КонтактнаяИнформация Цикл
		
		Отбор.Вид = СтрокаТаблицы.Вид;
		НайденныеСтроки = Форма.СвойстваВидовКонтактнойИнформации.НайтиСтроки(Отбор);
		Если НайденныеСтроки.Количество() = 0 Тогда
			Продолжить;
		КонецЕсли;
		СвойстваВида = НайденныеСтроки[0];
		Индекс = Форма.КонтактнаяИнформация.Индекс(СтрокаТаблицы);
		ИмяРеквизита = "КонтактнаяИнформация["+Индекс+"].Представление";
		
		Если СвойстваВида.ОбязательноеЗаполнение И ПустаяСтрока(СтрокаТаблицы.Представление)
			И Не ЕстьДругиеЗаполненныеСтрокиВидаКИ(Форма, СтрокаТаблицы, СтрокаТаблицы.Вид) Тогда
			// И нет других строк с данными для видов КИ с множественными значениями.
			
			ЕстьОшибки = Истина;
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
				СтрШаблон(НСтр("ru = 'Вид контактной информации ""%1"" не заполнен.'"), СвойстваВида.ПредставлениеВида),,, ИмяРеквизита);
			
		ИначеЕсли СвойстваВида.ПроверятьКорректность И Не ПустаяСтрока(СтрокаТаблицы.Представление) Тогда
			
			ОбъектКИ = УправлениеКонтактнойИнформациейСлужебный.КонтактнаяИнформацияИзXML(СтрокаТаблицы.ЗначенияПолей, СтрокаТаблицы.Вид);
			Если СтрокаТаблицы.Комментарий <> Неопределено Тогда
				ОбъектКИ.Комментарий = СтрокаТаблицы.Комментарий;
			КонецЕсли;
			ОбъектКИ.Представление = СтрокаТаблицы.Представление;
			
			// Проверка
			Если СтрокаТаблицы.Тип = Перечисления.ТипыКонтактнойИнформации.АдресЭлектроннойПочты Тогда
				Если Не ЭлектроннаяПочтаКорректна(ОбъектКИ, ИмяРеквизита) Тогда
					ЕстьОшибки = Истина;
				КонецЕсли;
			ИначеЕсли СтрокаТаблицы.Тип = Перечисления.ТипыКонтактнойИнформации.Адрес Тогда
				Если УправлениеКонтактнойИнформацией.ПроверитьКонтактнуюИнформацию(СтрокаТаблицы.Представление, СтрокаТаблицы.ЗначенияПолей, СтрокаТаблицы.Вид, СтрокаТаблицы.Тип, ИмяРеквизита) > 0 Тогда
					ЕстьОшибки = Истина;
				КонецЕсли;
			ИначеЕсли СтрокаТаблицы.Тип = Перечисления.ТипыКонтактнойИнформации.Телефон Тогда
				Результат = УправлениеНебольшойФирмойКлиентСервер.ПреобразоватьНомерДляОтправкиSMS(СтрокаТаблицы.Представление);
				Если Не Результат.НомерКорректен Тогда
					ЕстьОшибки = Истина;
					ОбщегоНазначенияКлиентСервер.СообщитьПользователю(Результат.СообщениеОбОшибке,,, ИмяРеквизита);
				КонецЕсли;
			Иначе
				// Остальные типы контактной информации не проверяем
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	Если ЕстьОшибки Тогда
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ПрограммныйИнтерфейс

// Процедура обновляет элементы формы в соответствии с данными в реквизите-таблице
//
// Параметры:
//  Форма	 - УправляемаяФорма	 - форма-владелец контактной информации
//
Процедура ОбновитьЭлементыКонтактнойИнформации(Форма, ШиринаПоляВида = 8) Экспорт
	
	КомандыДобавления = Форма.Элементы.Найти("ДобавлениеКонтактнойИнформации");
	Если КомандыДобавления <> Неопределено Тогда
		КомандыДобавления.Видимость = КонтактнаяИнформацияУНФКлиентСервер.СписокВидовДляДобавленияКонтактнойИнформации(Форма).Количество() > 0;
	КонецЕсли;
	
	Элементы = Форма.Элементы;
	УдаляемыеЭлементы = Новый Массив;
	
	Для Каждого ГруппаЭлементов Из Элементы.ЗначенияКонтактнойИнформации.ПодчиненныеЭлементы Цикл
		УдаляемыеЭлементы.Добавить(ГруппаЭлементов);
	КонецЦикла;
	
	ШиринаПоляКомментария = 11;
	Если УдаляемыеЭлементы.Количество() > 0 Тогда
		ШиринаПоляВида = Элементы["ВидКИ_0"].Ширина;
	КонецЕсли;
	
	Для Каждого УдаляемыйЭлемент Из УдаляемыеЭлементы Цикл
		Элементы.Удалить(УдаляемыйЭлемент);
	КонецЦикла;
	
	Отбор = Новый Структура("Вид");
	
	Для Каждого ДанныеКИ Из Форма.КонтактнаяИнформация Цикл
		
		ИндексКИ = Форма.КонтактнаяИнформация.Индекс(ДанныеКИ);
		Отбор.Вид = ДанныеКИ.Вид;
		НайденныеСтроки = Форма.СвойстваВидовКонтактнойИнформации.НайтиСтроки(Отбор);
		Если НайденныеСтроки.Количество() = 0 Тогда
			Продолжить;
		КонецЕсли;
		СвойстваВида = НайденныеСтроки[0];
		
		ГруппаЗначениеКИ = Элементы.Добавить("КИ_" + ИндексКИ, Тип("ГруппаФормы"), Элементы.ЗначенияКонтактнойИнформации);
		ГруппаЗначениеКИ.Вид = ВидГруппыФормы.ОбычнаяГруппа;
		ГруппаЗначениеКИ.Заголовок = ДанныеКИ.Вид;
		ГруппаЗначениеКИ.Отображение = ОтображениеОбычнойГруппы.Нет;
		ГруппаЗначениеКИ.Группировка = ГруппировкаПодчиненныхЭлементовФормы.Горизонтальная;
		ГруппаЗначениеКИ.СквозноеВыравнивание = СквозноеВыравнивание.Использовать;
		ГруппаЗначениеКИ.ОтображатьЗаголовок = Ложь;
		
		ДекорацияДействие = Элементы.Добавить("ДействиеКИ_" + ИндексКИ, Тип("ДекорацияФормы"), ГруппаЗначениеКИ);
		ДекорацияДействие.Вид = ВидДекорацииФормы.Картинка;
		ДекорацияДействие.Картинка = КартинкаДействияПоТипуКонтактнойИнформации(ДанныеКИ.Тип);
		ДекорацияДействие.Гиперссылка = Истина;
		ДекорацияДействие.Ширина = 2;
		ДекорацияДействие.Высота = 1;
		ДекорацияДействие.ВертикальноеПоложениеВГруппе = ВертикальноеПоложениеЭлемента.Центр;
		ДекорацияДействие.УстановитьДействие("Нажатие", "Подключаемый_ДействиеКИНажатие");
		
		ПолеВид = Элементы.Добавить("ВидКИ_" + ИндексКИ, Тип("ПолеФормы"), ГруппаЗначениеКИ);
		ПолеВид.Вид = ВидПоляФормы.ПолеНадписи;
		ПолеВид.ПутьКДанным = "КонтактнаяИнформация[" + ИндексКИ + "].Вид";
		ПолеВид.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Нет;
		ПолеВид.Ширина = ШиринаПоляВида;
		ПолеВид.РастягиватьПоГоризонтали = Ложь;
		
		ДоступноРедактированиеВДиалоге = ДляТипаКонтактнойИнформацииДоступноРедактированиеВДиалоге(ДанныеКИ.Тип);
		
		ПолеПредставление = Элементы.Добавить("ПредставлениеКИ_" + ИндексКИ, Тип("ПолеФормы"), ГруппаЗначениеКИ);
		ПолеПредставление.Вид = ВидПоляФормы.ПолеВвода;
		ПолеПредставление.ПутьКДанным = "КонтактнаяИнформация[" + ИндексКИ + "].Представление";
		ПолеПредставление.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Нет;
		ПолеПредставление.КнопкаВыбора = ДоступноРедактированиеВДиалоге;
		ПолеПредставление.АвтоОтметкаНезаполненного = СвойстваВида.ОбязательноеЗаполнение;
		ПолеПредставление.ШиринаВыпадающегоСписка = 40;
		ПолеПредставление.УстановитьДействие("ПриИзменении", "Подключаемый_ПредставлениеКИПриИзменении");
		ПолеПредставление.УстановитьДействие("Очистка", "Подключаемый_ПредставлениеКИОчистка");
		Если СвойстваВида.РедактированиеТолькоВДиалоге Тогда
			ПолеПредставление.РедактированиеТекста = Ложь;
			ПолеПредставление.ЦветФона = ЦветаСтиля.КонтактнаяИнформацияСРедактированиемВДиалогеЦвет;
		КонецЕсли;
		Если ДоступноРедактированиеВДиалоге Тогда
			ПолеПредставление.УстановитьДействие("НачалоВыбора", "Подключаемый_ПредставлениеКИНачалоВыбора");
		КонецЕсли;
		
		// Команды контекстного меню: показать адрес в Яндекс.Карты или GoogleMaps
		Если ДанныеКИ.Тип = Перечисления.ТипыКонтактнойИнформации.Адрес Тогда
			
			ДобавитьКомандуКонтекстногоМеню(Форма,
				"КонтекстноеМенюКартаЯндекс_" + ИндексКИ,
				БиблиотекаКартинок.ЯндексКарты,
				НСтр("ru = 'Адрес на Яндекс.Картах'"),
				НСтр("ru = 'Показывает адрес на картах Яндекс.Карты'"),
				ПолеПредставление
			);
			ДобавитьКомандуКонтекстногоМеню(Форма,
				"КонтекстноеМенюКартаGoogle_" + ИндексКИ,
				БиблиотекаКартинок.GoogleMaps,
				НСтр("ru = 'Адрес на Google Maps'"),
				НСтр("ru = 'Показывает адрес на карте Google Maps'"),
				ПолеПредставление
			);
			
		КонецЕсли;
		
		Если ДляТипаКонтактнойИнформацииДоступенВводКомментария(ДанныеКИ.Тип) Тогда
			
			ПолеПредставление.АвтоМаксимальнаяШирина = Ложь;
			ПолеПредставление.МаксимальнаяШирина = 27;
			
			ПолеКомментарий = Элементы.Добавить("КомментарийКИ_" + ИндексКИ, Тип("ПолеФормы"), ГруппаЗначениеКИ);
			ПолеКомментарий.Вид = ВидПоляФормы.ПолеВвода;
			ПолеКомментарий.ПутьКДанным = "КонтактнаяИнформация[" + ИндексКИ + "].Комментарий";
			ПолеКомментарий.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Нет;
			ПолеКомментарий.ПропускатьПриВводе = Истина;
			ПолеКомментарий.ПодсказкаВвода = НСтр("ru='Прим.'");
			ПолеКомментарий.АвтоМаксимальнаяШирина = Ложь;
			ПолеКомментарий.МаксимальнаяШирина = ШиринаПоляКомментария;
			ПолеКомментарий.УстановитьДействие("ПриИзменении", "Подключаемый_КомментарийКИПриИзменении");
			
		КонецЕсли;
		
	КонецЦикла;
	
	КонтактнаяИнформацияУНФКлиентСервер.ЗаполнитьСписокВыбораАдресов(Форма);
	
КонецПроцедуры

// Процедура добавляет поля ввода вида контактной информации на форму
//
// Параметры:
//  Форма						 - УправляемаяФорма	 - форма-владелец контактной информации
//  ДобавляемыйВид				 - СправочникСсылка.ВидыКонтактнойИнформации	 - вид для добавления
//  УстановитьВыводВФормеВсегда	 - Булево	 - признак установки настройки "ВыводитьВФормеВсегда"
//
Процедура ДобавитьКонтактнуюИнформацию(Форма, ДобавляемыйВид, УстановитьВыводВФормеВсегда = Ложь) Экспорт
	
	Если УстановитьВыводВФормеВсегда Тогда
		УстановитьФлагВыводитьВФормеВсегда(ДобавляемыйВид);
		НайденныеСтроки = Форма.СвойстваВидовКонтактнойИнформации.НайтиСтроки(Новый Структура("Вид", ДобавляемыйВид));
		Если НайденныеСтроки.Количество() > 0 Тогда
			НайденныеСтроки[0].ВыводитьВФормеВсегда = Истина;
		КонецЕсли;
	КонецЕсли;
	
	КоличествоЭлементовКоллекции = Форма.КонтактнаяИнформация.Количество();
	ИндексВставки = КоличествоЭлементовКоллекции;
	
	Для ОбратныйИндекс = 1 По КоличествоЭлементовКоллекции Цикл
		ТекущийИндекс = КоличествоЭлементовКоллекции - ОбратныйИндекс;
		Если Форма.КонтактнаяИнформация[ТекущийИндекс].Вид = ДобавляемыйВид Тогда
			ИндексВставки = ТекущийИндекс+1;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	ДанныеКИ = Форма.КонтактнаяИнформация.Вставить(ИндексВставки);
	ДанныеКИ.Вид = ДобавляемыйВид;
	ДанныеКИ.Тип = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ДобавляемыйВид, "Тип");
	
	ОбновитьЭлементыКонтактнойИнформации(Форма);
	Форма.ТекущийЭлемент = Форма.Элементы["ПредставлениеКИ_" + ИндексВставки];
	
КонецПроцедуры

// Процедура заполняет значение контактной информации на форме
//
// Параметры:
//  Форма						 - УправляемаяФорма	 - форма-владелец контактной информации
//  ЗаполняемыйВид				 - СправочникСсылка.ВидыКонтактнойИнформации	 - вид для которого заполняется значение
//  ДанныеЗаполнения			 - Структура	 - данные для заполнения, обязательные поля: Представление, Комментарий, ЗначенияПолей
//  ДобавлятьЕслиНет			 - Булево	 - признак необходимости добавления вида на форму, если такого еще нет
//  УстановитьВыводВФормеВсегда	 - Булево	 - признак установки настройки вида в случае добавления вида на форму
//
Процедура ЗаполнитьЗначениеКонтактнойИнформации(Форма, ЗаполняемыйВид, ДанныеЗаполнения, ДобавлятьЕслиНет = Ложь, УстановитьВыводВФормеВсегда = Ложь) Экспорт
	
	Отбор = Новый Структура("Вид", ЗаполняемыйВид);
	НайденныеСтроки = Форма.КонтактнаяИнформация.НайтиСтроки(Отбор);
	
	Если НайденныеСтроки.Количество() > 0 Тогда
		
		СтрокаКЗаполнению = НайденныеСтроки[0];
		
	ИначеЕсли ДобавлятьЕслиНет Тогда
		
		ДобавитьКонтактнуюИнформацию(Форма, ЗаполняемыйВид, УстановитьВыводВФормеВсегда);
		НайденныеСтроки = Форма.КонтактнаяИнформация.НайтиСтроки(Отбор);
		Если НайденныеСтроки.Количество() > 0 Тогда
			СтрокаКЗаполнению = НайденныеСтроки[0];
		Иначе
			Возврат;
		КонецЕсли;
		
	Иначе
		Возврат;
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(СтрокаКЗаполнению, ДанныеЗаполнения, "Представление,Комментарий,ЗначенияПолей");
	
	СтрокаКЗаполнению.Тип = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ЗаполняемыйВид, "Тип");
	
КонецПроцедуры

// Функция - Для типа контактной информации доступно редактирование в диалоге
//
// Параметры:
//  ТипКИ	 - ПеречислениеСсылка.ТипыКонтактнойИнформации	 - тип для которого проверяется доступность редактирования в диалоге
// 
// Возвращаемое значение:
//  Булево - признак возможности редактирования в диалоге
//
Функция ДляТипаКонтактнойИнформацииДоступноРедактированиеВДиалоге(ТипКИ) Экспорт
	
	Если ТипКИ = Перечисления.ТипыКонтактнойИнформации.Адрес Тогда
		Возврат Истина;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.Телефон Тогда
		Возврат Истина;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.Факс Тогда
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;
	
КонецФункции

// Функция - Для типа контактной информации доступен ввод комментария
//
// Параметры:
//  ТипКИ	 - ПеречислениеСсылка.ТипыКонтактнойИнформации	 - тип для которого проверяется доступность ввода комментария
// 
// Возвращаемое значение:
//  Булево - признак наличия поля комментария на форме
//
Функция ДляТипаКонтактнойИнформацииДоступенВводКомментария(ТипКИ) Экспорт
	
	Если ТипКИ = Перечисления.ТипыКонтактнойИнформации.Адрес Или ТипКИ = Перечисления.ТипыКонтактнойИнформации.Другое Тогда
		Возврат Ложь;
	Иначе
		Возврат Истина;
	КонецЕсли;
	
КонецФункции

// Функция - Картинка действия по типу контактной информации
//
// Параметры:
//  ТипКИ	 - ПеречислениеСсылка.ТипыКонтактнойИнформации	 - тип для которого получается картинка
// 
// Возвращаемое значение:
//  Картинка - пиктограмма для отображения
//
Функция КартинкаДействияПоТипуКонтактнойИнформации(ТипКИ) Экспорт
	
	Если ТипКИ = Перечисления.ТипыКонтактнойИнформации.Телефон Тогда
		КартинкаДействия = БиблиотекаКартинок.КонтактнаяИнформацияТелефон;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.АдресЭлектроннойПочты Тогда
		КартинкаДействия = БиблиотекаКартинок.КонтактнаяИнформацияЕмэйл;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.Адрес Тогда
		КартинкаДействия = БиблиотекаКартинок.КонтактнаяИнформацияАдрес;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.Skype Тогда
		КартинкаДействия = БиблиотекаКартинок.КонтактнаяИнформацияСкайп;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.ВебСтраница Тогда
		КартинкаДействия = БиблиотекаКартинок.КонтактнаяИнформацияВебСтраница;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.Факс Тогда
		КартинкаДействия = БиблиотекаКартинок.КонтактнаяИнформацияФакс;
	ИначеЕсли ТипКИ = Перечисления.ТипыКонтактнойИнформации.Другое Тогда
		КартинкаДействия = БиблиотекаКартинок.КонтактнаяИнформацияДругое;
	Иначе
		КартинкаДействия = БиблиотекаКартинок.Пустая;
	КонецЕсли;
	
	Возврат КартинкаДействия;
	
КонецФункции

// Функция проверяет корректность адреса электронной почты
//
// Параметры:
//  ОбъектКИ	 - ОбъектXDTO	 - объект XDTO контактной информации
//  ИмяРеквизита - строка	 - имя реквизита формы, с которым будет связано сообщение об ошибке
// 
// Возвращаемое значение:
//  Булево - признак корректности
//
Функция ЭлектроннаяПочтаКорректна(ОбъектКИ, Знач ИмяРеквизита = "") Экспорт
	
	СтрокаОшибки = "";
	
	АдресЭП = ОбъектКИ.Состав;
	ПространствоИмен = УправлениеКонтактнойИнформациейКлиентСервер.ПространствоИмен();
	Если АдресЭП <> Неопределено И АдресЭП.Тип() = ФабрикаXDTO.Тип(ПространствоИмен, "ЭлектроннаяПочта") Тогда
		Попытка
			Результат = ОбщегоНазначенияКлиентСервер.РазобратьСтрокуСПочтовымиАдресами(АдресЭП.Значение);
			Если Результат.Количество() > 1 Тогда
				
				СтрокаОшибки = Нстр("ru = 'Допускается ввод только одного адреса электронной почты'");
				
			КонецЕсли;
		Исключение
			СтрокаОшибки = КраткоеПредставлениеОшибки(ИнформацияОбОшибке());
		КонецПопытки;
	КонецЕсли;
	
	Если Не ПустаяСтрока(СтрокаОшибки) Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(СтрокаОшибки,,ИмяРеквизита);
	КонецЕсли;
	
	Возврат ПустаяСтрока(СтрокаОшибки);
	
КонецФункции

// Функция возвращает таблицу типов контактной информации в порядке по умолчанию
// 
// Возвращаемое значение:
//  ТаблицаЗначений - Стандартный порядок типов контактной информации для отображения в интерфейсе
//
Функция ПорядокТиповКИ() Экспорт
	
	ПорядокТиповКИ = Новый ТаблицаЗначений;
	ПорядокТиповКИ.Колонки.Добавить("Тип", Новый ОписаниеТипов("ПеречислениеСсылка.ТипыКонтактнойИнформации"));
	ПорядокТиповКИ.Колонки.Добавить("Порядок", Новый ОписаниеТипов("Число"));
	
	СтрокаТипов = ПорядокТиповКИ.Добавить();
	СтрокаТипов.Тип = Перечисления.ТипыКонтактнойИнформации.Телефон;
	СтрокаТипов.Порядок = 1;
	
	СтрокаТипов = ПорядокТиповКИ.Добавить();
	СтрокаТипов.Тип = Перечисления.ТипыКонтактнойИнформации.АдресЭлектроннойПочты;
	СтрокаТипов.Порядок = 2;
	
	СтрокаТипов = ПорядокТиповКИ.Добавить();
	СтрокаТипов.Тип = Перечисления.ТипыКонтактнойИнформации.Адрес;
	СтрокаТипов.Порядок = 3;
	
	СтрокаТипов = ПорядокТиповКИ.Добавить();
	СтрокаТипов.Тип = Перечисления.ТипыКонтактнойИнформации.Skype;
	СтрокаТипов.Порядок = 4;
	
	СтрокаТипов = ПорядокТиповКИ.Добавить();
	СтрокаТипов.Тип = Перечисления.ТипыКонтактнойИнформации.ВебСтраница;
	СтрокаТипов.Порядок = 5;
	
	СтрокаТипов = ПорядокТиповКИ.Добавить();
	СтрокаТипов.Тип = Перечисления.ТипыКонтактнойИнформации.Факс;
	СтрокаТипов.Порядок = 6;
	
	СтрокаТипов = ПорядокТиповКИ.Добавить();
	СтрокаТипов.Тип = Перечисления.ТипыКонтактнойИнформации.Другое;
	СтрокаТипов.Порядок = 7;
	
	Возврат ПорядокТиповКИ;
	
КонецФункции

// Процедура устанавливает настройку вида контактной информации "ВыводитьВФормеВсегда"
//
// Параметры:
//  ВидКонтактнойИнформации	 - СправочникСсылка.ВидыКонтактнойИнформации	 - вид для которого устанавливается настройка
//  Включить				 - булево	 - значение настройки
//
Процедура УстановитьФлагВыводитьВФормеВсегда(ВидКонтактнойИнформации, Включить = Истина) Экспорт
	
	НаборЗаписей = РегистрыСведений.НастройкиВидовКонтактнойИнформации.СоздатьНаборЗаписей();
	
	// Прочитаем набор записей.
	НаборЗаписей.Отбор.Вид.Установить(ВидКонтактнойИнформации);
	НаборЗаписей.Прочитать();
	
	Если НаборЗаписей.Количество() = 0 Тогда
		ЗаписьНабора = НаборЗаписей.Добавить();
	ИначеЕсли НаборЗаписей[0].ВыводитьВФормеВсегда = Включить Тогда
		Возврат; // Настройка уже есть, дополнительных действий не требуется
	Иначе
		ЗаписьНабора = НаборЗаписей[0];
	КонецЕсли;
	
	ЗаписьНабора.Вид = ВидКонтактнойИнформации;
	ЗаписьНабора.ВыводитьВФормеВсегда = Включить;
	
	НаборЗаписей.Записать();
	
КонецПроцедуры

#КонецОбласти

#Область ОбновлениеИнформационнойБазы

// Процедура обновляет/дозаполняет предопределенные виды контактной информации. Начальное заполнение базы.
//
Процедура УстановитьСвойстваПредопределенныхВидовКонтактнойИнформации() Экспорт
	
	Контрагенты_УстановитьСвойстваВидов();
	КонтактныеЛица_УстановитьСвойстваВидов();
	Организации_УстановитьСвойстваВидов();
	ФизическиеЛица_УстановитьСвойстваВидов();
	СтруктурныеЕдиницы_УстановитьСвойстваВидов();
	Пользователи_УстановитьСвойстваВидов();
	ВидыДеятельностиЕНВД_УстановитьСвойстваВидов();
	ТорговыеТочки_УстановитьСвойстваВидов();
	
КонецПроцедуры

Процедура Контрагенты_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Телефон");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ТелефонКонтрагента;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ТелефонCДобавочнымНомером	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("АдресЭлектроннойПочты");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.EmailКонтрагента;
	ПараметрыВида.Порядок = 2;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность		= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ЮрАдресКонтрагента;
	ПараметрыВида.Порядок = 3;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ФактАдресКонтрагента;
	ПараметрыВида.Порядок = 4;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.АдресДоставкиКонтрагета;
	ПараметрыВида.Порядок = 5;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Skype");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.SkypeКонтрагента;
	ПараметрыВида.Порядок = 6;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("ВебСтраница");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ВебСайтКонтрагента;
	ПараметрыВида.Порядок = 7;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Факс");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ФаксКонтрагента;
	ПараметрыВида.Порядок = 8;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ПочтовыйАдресКонтрагента;
	ПараметрыВида.Порядок = 9;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Другое");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ДругаяИнформацияКонтрагента;
	ПараметрыВида.Порядок = 10;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
КонецПроцедуры

Процедура КонтактныеЛица_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Телефон");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ТелефонКонтактногоЛица;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ТелефонCДобавочнымНомером	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("АдресЭлектроннойПочты");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.EmailКонтактногоЛица;
	ПараметрыВида.Порядок = 2;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность		= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Skype");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.SkypeКонтактногоЛица;
	ПараметрыВида.Порядок = 3;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("ВебСтраница");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.СоциальнаяСетьКонтактногоЛица;
	ПараметрыВида.Порядок = 4;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Другое");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.МессенджерКонтактногоЛица;
	ПараметрыВида.Порядок = 5;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
КонецПроцедуры

Процедура Организации_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ЮрАдресОрганизации;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ФактАдресОрганизации;
	ПараметрыВида.Порядок = 2;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ПочтовыйАдресОрганизации;
	ПараметрыВида.Порядок = 3;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Телефон");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ТелефонОрганизации;
	ПараметрыВида.Порядок = 4;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ТелефонCДобавочнымНомером	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("АдресЭлектроннойПочты");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.EmailОрганизации;
	ПараметрыВида.Порядок = 5;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность		= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Факс");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ФаксОрганизации;
	ПараметрыВида.Порядок = 6;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Другое");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ДругаяИнформацияОрганизации;
	ПараметрыВида.Порядок = 7;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
КонецПроцедуры

Процедура ФизическиеЛица_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Телефон");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ТелефонФизЛица;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ТелефонCДобавочнымНомером	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.АдресФизЛицаПоПрописке;
	ПараметрыВида.Порядок = 2;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Ложь;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Истина;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.АдресПроживанияФизЛица;
	ПараметрыВида.Порядок = 3;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Ложь;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Истина;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.АдресДляИнформированияФизЛица;
	ПараметрыВида.Порядок = 4;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Ложь;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Истина;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.АдресФизЛицаЗаПределамиРФ;
	ПараметрыВида.Порядок = 5;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Ложь;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Ложь;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("АдресЭлектроннойПочты");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.EmailФизическиеЛица;
	ПараметрыВида.Порядок = 6;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность = Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Другое");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ДругаяИнформацияФизЛица;
	ПараметрыВида.Порядок = 7;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	
КонецПроцедуры

Процедура СтруктурныеЕдиницы_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Телефон");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ТелефонСтруктурнойЕдиницы;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ТелефонCДобавочнымНомером	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ФактАдресСтруктурнойЕдиницы;
	ПараметрыВида.Порядок = 2;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Ложь;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
КонецПроцедуры

Процедура Пользователи_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Телефон");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.ТелефонПользователя;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ТелефонCДобавочнымНомером	= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("АдресЭлектроннойПочты");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.EmailПользователя;
	ПараметрыВида.Порядок = 2;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность		= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("ВебСтраница");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.СайтПользователя;
	ПараметрыВида.Порядок = 3;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Ложь;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Истина;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Ложь;
	ПараметрыВида.Используется							= Истина;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
КонецПроцедуры

Процедура ВидыДеятельностиЕНВД_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.АдресДеятельностиЕНВД;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Истина;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Истина;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
КонецПроцедуры

Процедура ТорговыеТочки_УстановитьСвойстваВидов()
	
	ПараметрыВида = УправлениеКонтактнойИнформацией.ПараметрыВидаКонтактнойИнформации("Адрес");
	ПараметрыВида.Вид = Справочники.ВидыКонтактнойИнформации.АдресТорговойТочки;
	ПараметрыВида.Порядок = 1;
	ПараметрыВида.МожноИзменятьСпособРедактирования		= Истина;
	ПараметрыВида.РедактированиеТолькоВДиалоге			= Истина;
	ПараметрыВида.ОбязательноеЗаполнение				= Ложь;
	ПараметрыВида.РазрешитьВводНесколькихЗначений		= Ложь;
	ПараметрыВида.ЗапретитьРедактированиеПользователем	= Истина;
	ПараметрыВида.Используется							= Истина;
	ПараметрыВида.НастройкиПроверки.АдресТолькоРоссийский			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьКорректность			= Истина;
	ПараметрыВида.НастройкиПроверки.ПроверятьПоФИАС					= Ложь;
	ПараметрыВида.НастройкиПроверки.СкрыватьНеактуальныеАдреса		= Истина;
	ПараметрыВида.НастройкиПроверки.ВключатьСтрануВПредставление	= Ложь;
	
	// В конструкторе параметров нет свойства "УказыватьОКТМО", добавляем пока вручную
	ПараметрыВида.НастройкиПроверки.Вставить("УказыватьОКТМО", Истина);
	УправлениеКонтактнойИнформацией.УстановитьСвойстваВидаКонтактнойИнформации(ПараметрыВида);
	КонтактнаяИнформацияУНФ.УстановитьФлагВыводитьВФормеВсегда(ПараметрыВида.Вид);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ДобавитьРеквизитыФормыКонтактнойИнформации(Форма)
	
	МассивДобавляемыхРеквизитов = Новый Массив;
	СписокРеквизитовФормы = Форма.ПолучитьРеквизиты();
	
	СоздатьТаблицуКонтактнаяИнформация = Истина;
	СоздатьТаблицуСвойстваВидовКонтактнойИнформации = Истина;
	
	Для Каждого Реквизит Из СписокРеквизитовФормы Цикл
		Если Реквизит.Имя = "КонтактнаяИнформация" Тогда
			СоздатьТаблицуКонтактнаяИнформация = Ложь;
		ИначеЕсли Реквизит.Имя = "СвойстваВидовКонтактнойИнформации" Тогда
			СоздатьТаблицуСвойстваВидовКонтактнойИнформации = Ложь;
		КонецЕсли;
	КонецЦикла;
	
	ОписаниеСтрока = Новый ОписаниеТипов("Строка");
	ОписаниеБулево = Новый ОписаниеТипов("Булево");
	
	Если СоздатьТаблицуКонтактнаяИнформация Тогда
		
		ИмяТаблицы = "КонтактнаяИнформация";
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы(ИмяТаблицы, Новый ОписаниеТипов("ТаблицаЗначений"),,, Истина));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("Вид", Новый ОписаниеТипов("СправочникСсылка.ВидыКонтактнойИнформации"), ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("Тип", Новый ОписаниеТипов("ПеречислениеСсылка.ТипыКонтактнойИнформации"), ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("Представление", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(500)), ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("Комментарий", ОписаниеСтрока, ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("ЗначенияПолей", ОписаниеСтрока, ИмяТаблицы));
		
	КонецЕсли;
	
	Если СоздатьТаблицуСвойстваВидовКонтактнойИнформации Тогда
		
		ИмяТаблицы = "СвойстваВидовКонтактнойИнформации";
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы(ИмяТаблицы, Новый ОписаниеТипов("ТаблицаЗначений")));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("Вид", Новый ОписаниеТипов("СправочникСсылка.ВидыКонтактнойИнформации"), ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("ПредставлениеВида", ОписаниеСтрока, ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("Тип", Новый ОписаниеТипов("ПеречислениеСсылка.ТипыКонтактнойИнформации"), ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("ВыводитьВФормеВсегда", ОписаниеБулево, ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("РазрешитьВводНесколькихЗначений", ОписаниеБулево, ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("ОбязательноеЗаполнение", ОписаниеБулево, ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("ПроверятьКорректность", ОписаниеБулево, ИмяТаблицы));
		МассивДобавляемыхРеквизитов.Добавить(Новый РеквизитФормы("РедактированиеТолькоВДиалоге", ОписаниеБулево, ИмяТаблицы));
		
	КонецЕсли;
	
	Если МассивДобавляемыхРеквизитов.Количество() > 0 Тогда
		Форма.ИзменитьРеквизиты(МассивДобавляемыхРеквизитов);
	КонецЕсли;
	
КонецПроцедуры

Процедура ПрочитатьСвойстваВидовКонтактнойИнформации(Форма, ГруппаВидовКИ)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПорядокТиповКИ.Тип,
		|	ПорядокТиповКИ.Порядок
		|ПОМЕСТИТЬ втПорядокТипов
		|ИЗ
		|	&ПорядокТиповКИ КАК ПорядокТиповКИ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВидыКонтактнойИнформации.Ссылка КАК Вид,
		|	ПРЕДСТАВЛЕНИЕ(ВидыКонтактнойИнформации.Ссылка) КАК ПредставлениеВида,
		|	ВидыКонтактнойИнформации.Тип КАК Тип,
		|	ЕСТЬNULL(НастройкиВидовКонтактнойИнформации.ВыводитьВФормеВсегда, ЛОЖЬ) КАК ВыводитьВФормеВсегда,
		|	ВидыКонтактнойИнформации.РазрешитьВводНесколькихЗначений КАК РазрешитьВводНесколькихЗначений,
		|	ВидыКонтактнойИнформации.ОбязательноеЗаполнение,
		|	ВидыКонтактнойИнформации.ПроверятьКорректность,
		|	ВидыКонтактнойИнформации.РедактированиеТолькоВДиалоге
		|ИЗ
		|	Справочник.ВидыКонтактнойИнформации КАК ВидыКонтактнойИнформации
		|		ЛЕВОЕ СОЕДИНЕНИЕ втПорядокТипов КАК втПорядокТипов
		|		ПО ВидыКонтактнойИнформации.Тип = втПорядокТипов.Тип
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.НастройкиВидовКонтактнойИнформации КАК НастройкиВидовКонтактнойИнформации
		|		ПО ВидыКонтактнойИнформации.Ссылка = НастройкиВидовКонтактнойИнформации.Вид
		|ГДЕ
		|	ВидыКонтактнойИнформации.ПометкаУдаления = ЛОЖЬ
		|	И ВидыКонтактнойИнформации.Родитель = &ГруппаВидовКИ
		|
		|УПОРЯДОЧИТЬ ПО
		|	втПорядокТипов.Порядок,
		|	ВидыКонтактнойИнформации.РеквизитДопУпорядочивания";
	
	Запрос.УстановитьПараметр("ПорядокТиповКИ", ПорядокТиповКИ());
	Запрос.УстановитьПараметр("ГруппаВидовКИ", ГруппаВидовКИ);
	
	ТаблицаСвойств = Запрос.Выполнить().Выгрузить();
	Форма.СвойстваВидовКонтактнойИнформации.Загрузить(ТаблицаСвойств);
	
КонецПроцедуры

Процедура ЗаполнитьТаблицуКонтактнойИнформации(Форма, Объект)
	
	Форма.КонтактнаяИнформация.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПорядокТипов.Тип,
		|	ПорядокТипов.Порядок
		|ПОМЕСТИТЬ втПорядокТипов
		|ИЗ
		|	&ПорядокТипов КАК ПорядокТипов
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВидыКонтактнойИнформации.Ссылка КАК Вид,
		|	ВидыКонтактнойИнформации.Тип КАК Тип,
		|	ВидыКонтактнойИнформации.РеквизитДопУпорядочивания КАК ПорядокВидов,
		|	втПорядокТипов.Порядок КАК ПорядокТипов
		|ПОМЕСТИТЬ втВсегдаВыводимыеВиды
		|ИЗ
		|	Справочник.ВидыКонтактнойИнформации КАК ВидыКонтактнойИнформации
		|		ЛЕВОЕ СОЕДИНЕНИЕ втПорядокТипов КАК втПорядокТипов
		|		ПО ВидыКонтактнойИнформации.Тип = втПорядокТипов.Тип
		|ГДЕ
		|	ВидыКонтактнойИнформации.Ссылка В(&ВсегдаВыводимыеВиды)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Вид"
		+ ОбщегоНазначения.РазделительПакетаЗапросов();
		
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
		
		Запрос.Текст = Запрос.Текст + "
		|ВЫБРАТЬ
		|	ВладелецКонтактнаяИнформация.Вид КАК Вид,
		|	ВладелецКонтактнаяИнформация.Тип,
		|	ВладелецКонтактнаяИнформация.Представление,
		|	ВладелецКонтактнаяИнформация.ЗначенияПолей,
		|	ВладелецКонтактнаяИнформация.Вид.РеквизитДопУпорядочивания КАК ПорядокВидов,
		|	втПорядокТипов.Порядок КАК ПорядокТипов
		|ПОМЕСТИТЬ втДанныеКИ
		|ИЗ
		|	Справочник.Контрагенты.КонтактнаяИнформация КАК ВладелецКонтактнаяИнформация
		|		ЛЕВОЕ СОЕДИНЕНИЕ втПорядокТипов КАК втПорядокТипов
		|		ПО ВладелецКонтактнаяИнформация.Тип = втПорядокТипов.Тип
		|ГДЕ
		|	ВладелецКонтактнаяИнформация.Ссылка = &ВладелецКИ
		|	И ВладелецКонтактнаяИнформация.Вид <> ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ПустаяСсылка)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Вид";
	Иначе
		Запрос.Текст = Запрос.Текст + "
		|ВЫБРАТЬ
		|	ТаблицаКИ.Вид,
		|	ТаблицаКИ.Тип,
		|	ТаблицаКИ.Представление,
		|	ТаблицаКИ.ЗначенияПолей
		|ПОМЕСТИТЬ втТаблицаКИ
		|ИЗ
		|	&ТаблицаКИ КАК ТаблицаКИ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВладелецКонтактнаяИнформация.Вид КАК Вид,
		|	ВладелецКонтактнаяИнформация.Тип,
		|	ВладелецКонтактнаяИнформация.Представление,
		|	ВладелецКонтактнаяИнформация.ЗначенияПолей,
		|	ВладелецКонтактнаяИнформация.Вид.РеквизитДопУпорядочивания КАК ПорядокВидов,
		|	втПорядокТипов.Порядок КАК ПорядокТипов
		|ПОМЕСТИТЬ втДанныеКИ
		|ИЗ
		|	втТаблицаКИ КАК ВладелецКонтактнаяИнформация
		|		ЛЕВОЕ СОЕДИНЕНИЕ втПорядокТипов КАК втПорядокТипов
		|		ПО ВладелецКонтактнаяИнформация.Тип = втПорядокТипов.Тип
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Вид";
	КонецЕсли;
	
	Запрос.Текст = Запрос.Текст + ОбщегоНазначения.РазделительПакетаЗапросов() + "
		|ВЫБРАТЬ
		|	ЕСТЬNULL(втДанныеКИ.Вид, втВсегдаВыводимыеВиды.Вид) КАК Вид,
		|	ЕСТЬNULL(втДанныеКИ.Тип, втВсегдаВыводимыеВиды.Тип) КАК Тип,
		|	ЕСТЬNULL(втДанныеКИ.Представление, """") КАК Представление,
		|	ЕСТЬNULL(втДанныеКИ.ЗначенияПолей, """") КАК ЗначенияПолей,
		|	ЕСТЬNULL(втДанныеКИ.ПорядокТипов, втВсегдаВыводимыеВиды.ПорядокТипов) КАК ПорядокТипов,
		|	ЕСТЬNULL(втДанныеКИ.ПорядокВидов, втВсегдаВыводимыеВиды.ПорядокВидов) КАК ПорядокВидов
		|ИЗ
		|	втВсегдаВыводимыеВиды КАК втВсегдаВыводимыеВиды
		|		ПОЛНОЕ СОЕДИНЕНИЕ втДанныеКИ КАК втДанныеКИ
		|		ПО втВсегдаВыводимыеВиды.Вид = втДанныеКИ.Вид
		|
		|УПОРЯДОЧИТЬ ПО
		|	ПорядокТипов,
		|	ПорядокВидов";
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "Справочник.Контрагенты", Объект.Ссылка.Метаданные().ПолноеИмя());
	Иначе
		Запрос.УстановитьПараметр("ТаблицаКИ", Объект.КонтактнаяИнформация.Выгрузить(,"Вид,Тип,Представление,ЗначенияПолей"));
	КонецЕсли;
	
	Запрос.УстановитьПараметр("ВладелецКИ",		Объект.Ссылка);
	Запрос.УстановитьПараметр("ПорядокТипов",	ПорядокТиповКИ());
	Запрос.УстановитьПараметр("ВсегдаВыводимыеВиды", 
		Форма.СвойстваВидовКонтактнойИнформации.Выгрузить(Новый Структура("ВыводитьВФормеВсегда", Истина), "Вид"));
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		НоваяСтрока = Форма.КонтактнаяИнформация.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
		НоваяСтрока.Комментарий = УправлениеКонтактнойИнформацией.КомментарийКонтактнойИнформации(Выборка.ЗначенияПолей);
	КонецЦикла;
	
КонецПроцедуры

Процедура ИнициализироватьФорму(Форма)
	
	Элементы = Форма.Элементы;
	
	Если Элементы.Найти("ЗначенияКонтактнойИнформации") <> Неопределено Тогда
		Возврат; // Форма уже инициализирована ранее
	КонецЕсли;
	
	ГруппаЗначенийКИ = Элементы.Добавить("ЗначенияКонтактнойИнформации", Тип("ГруппаФормы"), Элементы.КонтактнаяИнформация);
	ГруппаЗначенийКИ.Вид = ВидГруппыФормы.ОбычнаяГруппа;
	ГруппаЗначенийКИ.Заголовок = НСтр("ru='Значения контактной информации'");
	ГруппаЗначенийКИ.Отображение = ОтображениеОбычнойГруппы.Нет;
	ГруппаЗначенийКИ.Группировка = ГруппировкаПодчиненныхЭлементовФормы.Вертикальная;
	ГруппаЗначенийКИ.СквозноеВыравнивание = СквозноеВыравнивание.Использовать;
	ГруппаЗначенийКИ.ОтображатьЗаголовок = Ложь;
	
	Если КонтактнаяИнформацияУНФКлиентСервер.СписокВидовДляДобавленияКонтактнойИнформации(Форма).Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	ИмяКоманды = "ДобавитьПолеКонтактнойИнформации";
	Команда = Форма.Команды.Добавить(ИмяКоманды);
	Команда.Заголовок = НСтр("ru='+ телефон, адрес'");
	Команда.Действие = "Подключаемый_КонтактнаяИнформацияУНФВыполнитьКоманду";
	
	Кнопка = Элементы.Добавить(ИмяКоманды, Тип("КнопкаФормы"), Элементы.КонтактнаяИнформация);
	Кнопка.ИмяКоманды = ИмяКоманды;
	Кнопка.ОтображениеФигуры = ОтображениеФигурыКнопки.Нет;
	Кнопка.ГоризонтальноеПоложениеВГруппе = ГоризонтальноеПоложениеЭлемента.Право;
	
КонецПроцедуры

Функция ЕстьДругиеЗаполненныеСтрокиВидаКИ(Знач Форма, Знач ПроверяемаяСтрока, Знач ВидКонтактнойИнформации)
	
	ВсеСтрокиЭтогоВида = Форма.КонтактнаяИнформация.НайтиСтроки(
		Новый Структура("Вид", ВидКонтактнойИнформации));
	
	Для Каждого СтрокаВида Из ВсеСтрокиЭтогоВида Цикл
		
		Если СтрокаВида <> ПроверяемаяСтрока И Не ПустаяСтрока(СтрокаВида.Представление) Тогда
			Возврат Истина;
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат Ложь;
	
КонецФункции

Процедура ДобавитьКомандуКонтекстногоМеню(Форма, ИмяКоманды, Картинка, Заголовок, Подсказка, ПолеВладелец)
	
	Если Форма.Команды.Найти(ИмяКоманды) = Неопределено Тогда
		Команда = Форма.Команды.Добавить(ИмяКоманды);
		Команда.Картинка = Картинка;
		Команда.Заголовок = Заголовок;
		Команда.Подсказка = Подсказка;
		Команда.Действие = "Подключаемый_КонтактнаяИнформацияУНФВыполнитьКоманду";
	КонецЕсли;
	
	Кнопка = Форма.Элементы.Добавить(ИмяКоманды, Тип("КнопкаФормы"), ПолеВладелец.КонтекстноеМеню);
	Кнопка.ИмяКоманды = ИмяКоманды;
	
КонецПроцедуры

#КонецОбласти
