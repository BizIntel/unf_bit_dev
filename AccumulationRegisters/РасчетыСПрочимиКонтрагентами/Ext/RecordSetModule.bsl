#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПередЗаписью(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	ДополнительныеСвойства.Вставить("КонтрагентыСИзмененнымиВзаиморасчетами", КонтрагентыСИзмененнымиВзаиморасчетами());
	
	Если ДополнительныеСвойства.Свойство("ДляПроведения") И ДополнительныеСвойства.ДляПроведения.Свойство("СтруктураВременныеТаблицы") Тогда
		// Хозяйственная операция"
		ХозяйственныеОперацииСервер.ЗаполнитьХозяйственнуюОперациюВНабореЗаписей(ЭтотОбъект);
		// Конец Хозяйственная операция"
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Если ДополнительныеСвойства.Свойство("КонтрагентыСИзмененнымиВзаиморасчетами") Тогда
		РегистрыСведений.ОстаткиВзаиморасчетов.ОбновитьОстаткиВзаиморасчетов(ДополнительныеСвойства.КонтрагентыСИзмененнымиВзаиморасчетами);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция КонтрагентыСИзмененнымиВзаиморасчетами()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	РасчетыСПрочимиКонтрагентами.Контрагент КАК Контрагент
		|ИЗ
		|	РегистрНакопления.РасчетыСПрочимиКонтрагентами КАК РасчетыСПрочимиКонтрагентами
		|ГДЕ
		|	РасчетыСПрочимиКонтрагентами.Регистратор = &Регистратор";
	
	Запрос.УстановитьПараметр("Регистратор", ЭтотОбъект.Отбор.Регистратор.Значение);
	
	КонтрагентыПрошлогоНабора = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Контрагент");
	КонтрагентыТекущегоНабора = ЭтотОбъект.ВыгрузитьКолонку("Контрагент");
	
	ОбщегоНазначенияКлиентСервер.ДополнитьМассив(КонтрагентыПрошлогоНабора, КонтрагентыТекущегоНабора, Истина);
	
	Возврат КонтрагентыПрошлогоНабора;
	
КонецФункции

#КонецОбласти

#КонецЕсли